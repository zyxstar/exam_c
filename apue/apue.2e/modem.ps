%!PS-Adobe-3.0
%%Creator: groff version 1.19.2
%%CreationDate: Wed Apr 10 20:37:53 2013
%%DocumentNeededResources: font AvantGarde-BookOblique
%%+ font AvantGarde-DemiOblique
%%+ font Helvetica-Bold
%%+ font Palatino-Roman
%%+ font Courier
%%+ font Palatino-Bold
%%+ font Palatino-Italic
%%+ font Symbol
%%DocumentSuppliedResources: procset grops 1.19 2
%%Pages: 53
%%PageOrder: Ascend
%%DocumentMedia: Default 612 792 0 () ()
%%Orientation: Portrait
%%EndComments
%%BeginDefaults
%%PageMedia: Default
%%EndDefaults
%%BeginProlog
%%BeginResource: procset grops 1.19 2
%!PS-Adobe-3.0 Resource-ProcSet
/setpacking where{
pop
currentpacking
true setpacking
}if
/grops 120 dict dup begin
/SC 32 def
/A/show load def
/B{0 SC 3 -1 roll widthshow}bind def
/C{0 exch ashow}bind def
/D{0 exch 0 SC 5 2 roll awidthshow}bind def
/E{0 rmoveto show}bind def
/F{0 rmoveto 0 SC 3 -1 roll widthshow}bind def
/G{0 rmoveto 0 exch ashow}bind def
/H{0 rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/I{0 exch rmoveto show}bind def
/J{0 exch rmoveto 0 SC 3 -1 roll widthshow}bind def
/K{0 exch rmoveto 0 exch ashow}bind def
/L{0 exch rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/M{rmoveto show}bind def
/N{rmoveto 0 SC 3 -1 roll widthshow}bind def
/O{rmoveto 0 exch ashow}bind def
/P{rmoveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/Q{moveto show}bind def
/R{moveto 0 SC 3 -1 roll widthshow}bind def
/S{moveto 0 exch ashow}bind def
/T{moveto 0 exch 0 SC 5 2 roll awidthshow}bind def
/SF{
findfont exch
[exch dup 0 exch 0 exch neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/MF{
findfont
[5 2 roll
0 3 1 roll
neg 0 0]makefont
dup setfont
[exch/setfont cvx]cvx bind def
}bind def
/level0 0 def
/RES 0 def
/PL 0 def
/LS 0 def
/MANUAL{
statusdict begin/manualfeed true store end
}bind def
/PLG{
gsave newpath clippath pathbbox grestore
exch pop add exch pop
}bind def
/BP{
/level0 save def
1 setlinecap
1 setlinejoin
72 RES div dup scale
LS{
90 rotate
}{
0 PL translate
}ifelse
1 -1 scale
}bind def
/EP{
level0 restore
showpage
}def
/DA{
newpath arcn stroke
}bind def
/SN{
transform
.25 sub exch .25 sub exch
round .25 add exch round .25 add exch
itransform
}bind def
/DL{
SN
moveto
SN
lineto stroke
}bind def
/DC{
newpath 0 360 arc closepath
}bind def
/TM matrix def
/DE{
TM currentmatrix pop
translate scale newpath 0 0 .5 0 360 arc closepath
TM setmatrix
}bind def
/RC/rcurveto load def
/RL/rlineto load def
/ST/stroke load def
/MT/moveto load def
/CL/closepath load def
/Fr{
setrgbcolor fill
}bind def
/setcmykcolor where{
pop
/Fk{
setcmykcolor fill
}bind def
}if
/Fg{
setgray fill
}bind def
/FL/fill load def
/LW/setlinewidth load def
/Cr/setrgbcolor load def
/setcmykcolor where{
pop
/Ck/setcmykcolor load def
}if
/Cg/setgray load def
/RE{
findfont
dup maxlength 1 index/FontName known not{1 add}if dict begin
{
1 index/FID ne{def}{pop pop}ifelse
}forall
/Encoding exch def
dup/FontName exch def
currentdict end definefont pop
}bind def
/DEFS 0 def
/EBEGIN{
moveto
DEFS begin
}bind def
/EEND/end load def
/CNT 0 def
/level1 0 def
/PBEGIN{
/level1 save def
translate
div 3 1 roll div exch scale
neg exch neg exch translate
0 setgray
0 setlinecap
1 setlinewidth
0 setlinejoin
10 setmiterlimit
[]0 setdash
/setstrokeadjust where{
pop
false setstrokeadjust
}if
/setoverprint where{
pop
false setoverprint
}if
newpath
/CNT countdictstack def
userdict begin
/showpage{}def
/setpagedevice{}def
}bind def
/PEND{
countdictstack CNT sub{end}repeat
level1 restore
}bind def
end def
/setpacking where{
pop
setpacking
}if
%%EndResource
%%BeginSetup
%%BeginFeature: *PageSize Default
<< /PageSize [ 612 792 ] /ImagingBBox null >> setpagedevice
%%EndFeature
%%IncludeResource: font AvantGarde-BookOblique
%%IncludeResource: font AvantGarde-DemiOblique
%%IncludeResource: font Helvetica-Bold
%%IncludeResource: font Palatino-Roman
%%IncludeResource: font Courier
%%IncludeResource: font Palatino-Bold
%%IncludeResource: font Palatino-Italic
%%IncludeResource: font Symbol
grops begin/DEFS 52 dict def DEFS begin/u{.001 mul}bind def end/RES 72
def/PL 792 def/LS false def/ENC0[/asciicircum/asciitilde/Scaron/Zcaron
/scaron/zcaron/Ydieresis/trademark/quotesingle/Euro/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef/.notdef
/.notdef/.notdef/space/exclam/quotedbl/numbersign/dollar/percent
/ampersand/quoteright/parenleft/parenright/asterisk/plus/comma/hyphen
/period/slash/zero/one/two/three/four/five/six/seven/eight/nine/colon
/semicolon/less/equal/greater/question/at/A/B/C/D/E/F/G/H/I/J/K/L/M/N/O
/P/Q/R/S/T/U/V/W/X/Y/Z/bracketleft/backslash/bracketright/circumflex
/underscore/quoteleft/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/p/q/r/s/t/u/v/w/x/y
/z/braceleft/bar/braceright/tilde/.notdef/quotesinglbase/guillemotleft
/guillemotright/bullet/florin/fraction/perthousand/dagger/daggerdbl
/endash/emdash/ff/fi/fl/ffi/ffl/dotlessi/dotlessj/grave/hungarumlaut
/dotaccent/breve/caron/ring/ogonek/quotedblleft/quotedblright/oe/lslash
/quotedblbase/OE/Lslash/.notdef/exclamdown/cent/sterling/currency/yen
/brokenbar/section/dieresis/copyright/ordfeminine/guilsinglleft
/logicalnot/minus/registered/macron/degree/plusminus/twosuperior
/threesuperior/acute/mu/paragraph/periodcentered/cedilla/onesuperior
/ordmasculine/guilsinglright/onequarter/onehalf/threequarters
/questiondown/Agrave/Aacute/Acircumflex/Atilde/Adieresis/Aring/AE
/Ccedilla/Egrave/Eacute/Ecircumflex/Edieresis/Igrave/Iacute/Icircumflex
/Idieresis/Eth/Ntilde/Ograve/Oacute/Ocircumflex/Otilde/Odieresis
/multiply/Oslash/Ugrave/Uacute/Ucircumflex/Udieresis/Yacute/Thorn
/germandbls/agrave/aacute/acircumflex/atilde/adieresis/aring/ae/ccedilla
/egrave/eacute/ecircumflex/edieresis/igrave/iacute/icircumflex/idieresis
/eth/ntilde/ograve/oacute/ocircumflex/otilde/odieresis/divide/oslash
/ugrave/uacute/ucircumflex/udieresis/yacute/thorn/ydieresis]def
/Palatino-Italic@0 ENC0/Palatino-Italic RE/Palatino-Bold@0 ENC0
/Palatino-Bold RE/Courier@0 ENC0/Courier RE/Palatino-Roman@0 ENC0
/Palatino-Roman RE/Helvetica-Bold@0 ENC0/Helvetica-Bold RE
/AvantGarde-DemiOblique@0 ENC0/AvantGarde-DemiOblique RE
/AvantGarde-BookOblique@0 ENC0/AvantGarde-BookOblique RE
%%EndSetup
%%Page: 1 1
%%BeginPageSetup
BP
%%EndPageSetup
/F0 30/AvantGarde-BookOblique@0 SF(The Lost Cha)129.6 141.6 Q(pter).6 E
/F1 24/AvantGarde-DemiOblique@0 SF 13.44(AM)129.6 246.424 S 6.72
(odem Dialer)-13.44 F/F2 12/Helvetica-Bold@0 SF 29.328(1I)93.6 345.6 S
(ntr)-29.328 E(oduction)-.24 E/F3 10/Palatino-Roman@0 SF(Pr)129.6 369.6
Q 1.152(ograms that deal with modems have always had a har)-.18 F 3.652
(dt)-.18 G 1.152(ime coping with the wide)-3.652 F .853
(variety of modems that ar)129.6 381.6 R 3.354(ea)-.18 G 3.354
(vailable. On)-3.354 F .854(most UNIX systems ther)3.354 F 3.354(ea)-.18
G 1.214 -.18(re t)-3.354 H .854(wo pr).18 F(ograms)-.18 E 1.106
(that handle modems.)129.6 393.6 R 1.106(The \214rst is a r)6.106 F
1.105(emote login pr)-.18 F 1.105(ogram that lets us dial some other)
-.18 F(computer)129.6 405.6 Q 2.716(,l)-.74 G .216
(og in, and use that system.)-2.716 F .216
(In the System V world this pr)5.216 F .217(ogram is called)-.18 F/F4 10
/Courier@0 SF(cu)2.717 E F3(,)A 1.579(while Berkeley systems call it)
129.6 417.6 R F4(tip)4.079 E F3 6.579(.B)C 1.578(oth pr)-6.579 F 1.578
(ograms do similar things, and both have)-.18 F .466
(knowledge of many dif)129.6 429.6 R(fer)-.18 E .466
(ent types of modems.)-.18 F .466(The other pr)5.466 F .466
(ogram that uses a modem)-.18 F(is)129.6 441.6 Q F4(uucico)2.803 E F3
2.803(,p)C .303(art of the UUCP package.)-2.803 F .303(The pr)5.303 F
.302(oblem is that knowledge that a modem is)-.18 F 2.22
(being used is often built into these pr)129.6 453.6 R 2.221
(ograms, and if we want to write some other)-.18 F(pr)129.6 465.6 Q .443
(ogram that needs a modem, we have to perform many of the same tasks.)
-.18 F .443(Also, if we)5.443 F .007(want to change these pr)129.6 477.6
R .007(ograms to use some form of communication instead of a modem)-.18
F(\(such as a network connection\), major changes ar)129.6 489.6 Q 2.5
(eo)-.18 G(ften r)-2.5 E(equir)-.18 E(ed.)-.18 E .007
(In this chapter we develop a separate pr)147.6 501.6 R .006
(ogram that handles all the details of modem)-.18 F 2.757
(handling. This)129.6 513.6 R .257
(lets us isolate all these details into a single pr)2.757 F .258
(ogram, instead of having it)-.18 F(spr)129.6 525.6 Q 1.685(ead thr)-.18
F 1.685(ough multiple pr)-.18 F 4.185(ograms. \(This)-.18 F(pr)4.185 E
1.685(ogram was motivated by the connection)-.18 F .154
(server described in Pr)129.6 537.6 R .154(esotto and Ritchie)-.18 F([)
2.655 -.4 M(1990).4 I(])-.4 I 2.655(.\) T).4 J 2.655(ou)-.92 G .155
(se this pr)-2.655 F .155(ogram we have to be able)-.18 F .597
(to invoke it and have it pass back a \214le descriptor)129.6 549.6 R
3.096(,a)-.74 G 3.096(sw)-3.096 G 3.096(ed)-3.096 G .596
(escribed in Section 17.4.)-3.096 F -.92(We)5.596 G(then use this pr)
129.6 561.6 Q(ogram in developing a r)-.18 E(emote login pr)-.18 E
(ogram \(similar to)-.18 E F4(cu)2.5 E F3(and)2.5 E F4(tip)2.5 E F3(\).)
A F2 29.328(2H)93.6 597.6 S -3.216(istor y)-29.328 F F3(The)129.6 621.6
Q F4(cu)4.836 E F3(\()-.4 I(1).4 I(\))-.4 I 2.337
(command \(which stands for `)4.837 .4 N 2.337(`call UNIX')-.37 F 2.337
('\) appear)-.37 F 2.337(ed in V)-.18 F 2.337(ersion 7.)-1.11 F 2.337
(But it)7.337 F 2.742
(handled only one particular ACU \(automatic call unit\).)129.6 633.6 R
2.742(At Berkeley)7.742 F 5.241(,B)-1.11 G 2.741(ill Shannon)-5.241 F
(modi\214ed)129.6 645.6 Q F4(cu)2.598 E F3 2.598(,a)C .098(nd it appear)
-2.598 F .098(ed in 4.2BSD as the)-.18 F F4(tip)2.599 E F3(\()-.4 I(1).4
I(\))-.4 I(pr)2.599 .4 M 2.599(ogram. The)-.18 F .099
(biggest change was)2.599 F .671(the use of a text \214le \()129.6 657.6
R F4(/etc/remote)A F3 3.171(\)t)C 3.171(oc)-3.171 G .67
(ontain all the information for various systems)-3.171 F 0 Cg EP
%%Page: 2 2
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(2)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)262.686 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF 1.295(\(phone number)129.6 123 R 3.795(,p)-.74 G
-.18(re)-3.795 G(ferr).18 E 1.295(ed dialer)-.18 F 3.795(,b)-.74 G 1.295
(aud rate, parity)-3.795 F 3.795<2c8d>-1.11 G 1.295(ow contr)-3.795 F
1.295(ol, etc.\).)-.18 F 1.295(This version of)6.295 F/F3 10/Courier@0
SF(tip)129.6 135 Q F2 .617(supported about six dif)3.117 F(fer)-.18 E
.616(ent call units and modems, but to add support for some)-.18 F
(other type of modem r)129.6 147 Q(equir)-.18 E(ed sour)-.18 E
(ce code changes.)-.18 E 1.349(Along with)147.6 159 R F3(cu)3.849 E F2
(and)3.849 E F3(tip)3.849 E F2 3.849(,t)C 1.349
(he UUCP system also accessed modems and automatic)-3.849 F 1.759
(call units.)129.6 171 R 1.759(UUCP managed locks on dif)6.759 F(fer)
-.18 E 1.758(ent modems, so that multiple instances of)-.18 F .494
(UUCP could be r)129.6 183 R .494(unning at the same time.)-.08 F(The)
5.494 E F3(tip)2.994 E F2(and)2.994 E F3(cu)2.995 E F2(pr)2.995 E .495
(ograms had to honor the)-.18 F 1.06(UUCP locking pr)129.6 195 R 1.059
(otocol, to avoid interfering with UUCP)-.18 F 6.059(.O)-1.29 G 3.559
(nt)-6.059 G 1.059(he BSD systems, UUCP)-3.559 F 1.733
(developed its own set of dialer functions.)129.6 207 R 1.733
(These functions wer)6.733 F 4.233(el)-.18 G 1.733(ink edited into the)
-4.233 F 1.896
(UUCP executable, which meant the addition of a new modem type r)129.6
219 R(equir)-.18 E 1.895(ed sour)-.18 F(ce)-.18 E(code changes.)129.6
231 Q .86(SVR2 pr)147.6 243 R .86(ovided a)-.18 F F3(dial)3.36 E F2(\()
-.4 I(3).4 I(\))-.4 I .86
(function that attempted to isolate the unique featur)3.36 .4 N .86
(es of)-.18 F .08(modem dialing into a single library function.)129.6
255 R .08(It was used by)5.08 F F3(cu)2.58 E F2 2.58(,b)C .08
(ut not by UUCP)-2.58 F 5.08(.T)-1.29 G(his)-5.08 E
(function was in the standar)129.6 267 Q 2.5(dCl)-.18 G(ibrary)-2.5 E
2.5(,s)-1.11 G 2.5(oi)-2.5 G 2.5(tw)-2.5 G(as available to any pr)-2.5 E
(ogram.)-.18 E .89(The Honey DanBer UUCP system)147.6 279 R([)3.39 -.4 M
.89(Redman 1989).4 J(])-.4 I .89(took the modem commands out)3.39 .4 N
1.284(of the C sour)129.6 291 R 1.284(ce \214les and put them into a)
-.18 F F3(Dialers)3.784 E F2 3.784(\214le. This)3.784 F 1.283
(allowed the addition of)3.783 F .012
(new modem types without having to modify the sour)129.6 303 R .012
(ce code.)-.18 F .012(But the functions used by)5.012 F F3(cu)129.6 315
Q F2 .325(and UUCP to access the)2.825 F F3(Dialers)2.825 E F2 .325
(\214le wer)2.825 F 2.825(en)-.18 G .325(ot generally available.)-2.825
F .325(This means that)5.325 F 1.395(without r)129.6 327 R 1.396
(edeveloping all the code to pr)-.18 F 1.396
(ocess the dialing information in the)-.18 F F3(Dialers)3.896 E F2
(\214le, pr)129.6 339 Q(ograms other than)-.18 E F3(cu)2.5 E F2
(and UUCP couldn't use this \214le.)2.5 E(Thr)147.6 351 Q 2.545
(oughout all these versions of)-.18 F F3(cu)5.044 E F2(,)A F3(tip)5.044
E F2 5.044(,a)C 2.544(nd UUCP)-5.044 F 5.044(,l)-1.29 G 2.544
(ocking was r)-5.044 F(equir)-.18 E 2.544(ed to)-.18 F(assur)129.6 363 Q
5.672(eo)-.18 G 3.173(nly a single pr)-5.672 F 3.173
(ogram accessed a single device at a time.)-.18 F 3.173(Since all these)
8.173 F(pr)129.6 375 Q .36(ograms worked acr)-.18 F .359(oss many dif)
-.18 F(fer)-.18 E .359(ent systems, earlier versions of which pr)-.18 F
.359(ovided no)-.18 F -.18(re)129.6 387 S(cor).18 E 3.921(dl)-.18 G
1.421(ocking, a r)-3.921 F 1.421
(udimentary form of \214le locking was used.)-.08 F 1.422
(This could lead to lock)6.422 F .607(\214les being left ar)129.6 399 R
.607(ound after a pr)-.18 F .607
(ogram crashed, and ad hoc techniques wer)-.18 F 3.106(ed)-.18 G
(eveloped)-3.106 E .332(to handle this.)129.6 411 R(\(W)5.332 E 2.832
(ec)-.92 G .332(an't use r)-2.832 F(ecor)-.18 E 2.833(dl)-.18 G .333
(ocking on special device \214les, so r)-2.833 F(ecor)-.18 E 2.833(dl)
-.18 G .333(ocking by)-2.833 F(itself doesn't pr)129.6 423 Q
(ovide a complete solution.\))-.18 E/F4 12/Helvetica-Bold@0 SF 29.328
(3P)93.6 461.4 S -.24(ro)-29.328 G 3.336(gram Design).24 F F2
(Let's detail the featur)129.6 485.4 Q
(es that we want the modem dialer to have.)-.18 E 6.33(1. It)147.6 505.8
R 1.796(must be possible to add new modem types without r)4.296 F 1.795
(equiring sour)-.18 F 1.795(ce code)-.18 F(changes.)163.93 517.8 Q 2.721
-.92(To o)163.93 535.8 T .881(btain this featur).92 F .881
(e, we'll use the Honey DanBer)-.18 F F3(Dialers)3.382 E F2 3.382
(\214le. W)3.382 F .882(e'll put all)-.92 F 1.978
(the code that uses this \214le to dial the modem into a daemon server)
163.93 547.8 R 4.478(,s)-.74 G 4.478(oa)-4.478 G(ny)-4.478 E(pr)163.93
559.8 Q(ogram can access it using the client\211server functions fr)-.18
E(om Section 17.2.2.)-.18 E 6.33(2. Some)147.6 575.8 R 2.52
(form of locking must be used so that the abnormal termination of a)5.02
F(pr)163.93 587.8 Q 2.198(ogram holding a lock automatically r)-.18 F
2.198(eleases the lock.)-.18 F 2.198(Ad hoc techniques,)7.198 F 1.659
(such as those still used by most versions of)163.93 599.8 R F3(cu)4.159
E F2 1.66(and UUCP)4.159 F 4.16(,s)-1.29 G 1.66(hould \214nally be)-4.16
F(discar)163.93 611.8 Q(ded, since better methods exist.)-.18 E -.92(We)
163.93 629.8 S 5.356
('ll let the server daemon handle all the device locking.).92 F 5.356
(Since the)10.356 F .457(client\211server functions fr)163.93 641.8 R
.458(om Section 17.2.2 automatically notify the server when)-.18 F 2.5
(ac)163.93 653.8 S(lient terminates, the daemon can r)-2.5 E
(elease any locks that the pr)-.18 E(ocess had.)-.18 E 0 Cg EP
%%Page: 3 3
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 3)93.6 84 R(Pr)298.56 E 2.25
(ogram Design)-.162 F/F1 9/Palatino-Bold@0 SF(3)18 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF 6.33(3. New)147.6 123 R(pr)4.208 E 1.707
(ograms must be able to use all the featur)-.18 F 1.707
(es that we develop.)-.18 F 4.207(An)6.707 G(ew)-4.207 E(pr)163.93 135 Q
2.702(ogram that deals with a modem should not have to r)-.18 F 2.703
(einvent the wheel.)-.18 F
(Dialing any type of modem should be as simple as a function call.)
163.93 147 Q 1.126(For this featur)163.93 163.8 R 1.125
(e, we'll let the central server daemon do all the dialing, passing)-.18
F(back a \214le descriptor)163.93 175.8 Q(.)-.74 E 6.33(4. Client)147.6
191.8 R(pr)3.555 E 1.055(ograms, such as)-.18 F/F3 10/Courier@0 SF(cu)
3.555 E F2(and)3.555 E F3(tip)3.555 E F2 3.556(,s)C 1.056
(houldn't need special privileges.)-3.556 F(They)6.056 E
(should not be set-user)163.93 203.8 Q(-ID pr)-.18 E(ograms.)-.18 E -.92
(We)163.93 220.6 S .254('ll give the special privileges to the server d\
aemon, allowing its clients to r).92 F(un)-.08 E
(without any special privileges.)163.93 232.6 Q .962
(Obviously we can't change the existing)129.6 251.8 R F3(cu)3.462 E F2
(,)A F3(tip)3.462 E F2 3.462(,a)C .962(nd UUCP pr)-3.462 F .963
(ograms, but we should)-.18 F .135
(make it easier for others to build on this work.)129.6 263.8 R .134
(Also, we should take the best featur)5.135 F .134(es of)-.18 F
(the existing UNIX dialing pr)129.6 275.8 Q(ograms.)-.18 E(Figur)147.6
287.8 Q 2.5(e1s)-.18 G(hows the arrangement of the client and server)
-2.5 E(.)-.74 E 285 343.4 MT 0 -36 RL -43.2 0 RL 0 36 RL CL ST/F4 8
/Palatino-Roman@0 SF(server)252.452 327.16 Q 285 415.4 MT 0 -36 RL -43.2
0 RL 0 36 RL CL ST(client)253.748 399.16 Q 256.2 343.4 MT 1.8 7.2 RL
-3.6 0 RL CL 0 Fg 256.2 343.4 MT 1.8 7.2 RL -3.6 0 RL CL .1 LW 0 Cg ST
.32 LW 256.2 350.6 256.2 379.4 DL(\()194.616 357.84 Q(1).32 I(\))-.32 I
-.144(re)2 .32 O(quest = call).144 E -.144(re)198.072 368.16 S
(mote system).144 E 270.6 379.4 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Fg 270.6
379.4 MT -1.8 -7.2 RL 3.6 0 RL CL .1 LW 0 Cg ST .32 LW 270.6 343.4 270.6
372.2 DL(\()275.596 357.84 Q(4).32 I(\))-.32 I -.144(re)2 .32 O
(ply = \214le).144 E(descriptor)281.352 368.16 Q 241.8 325.4 MT -7.2 1.8
RL 0 -3.6 RL CL 0 Fg 241.8 325.4 MT -7.2 1.8 RL 0 -3.6 RL CL .1 LW 0 Cg
ST .32 LW 205.8 325.4 234.6 325.4 DL(\()219.136 321.84 Q(2).32 I(\))-.32
I/F5 8/Courier@0 SF(Systems)150.6 317.16 Q F4(,)A F5(Devices)147.828
327.16 Q F4 2(,a)C(nd)-2 E F5(Dialers)148.404 337.16 Q F4(\214les)2 E
285 325.4 MT 7.2 -1.8 RL 0 3.6 RL CL 0 Fg 285 325.4 MT 7.2 -1.8 RL 0 3.6
RL CL .1 LW 0 Cg ST 400.2 325.4 MT -7.2 1.8 RL 0 -3.6 RL CL 0 Fg 400.2
325.4 MT -7.2 1.8 RL 0 -3.6 RL CL 0 Cg ST .32 LW 393 325.4 292.2 325.4
DL(\()315.556 321.84 Q(3).32 I(\))-.32 I(dial modem)2 .32 M 436.2 336.2
MT 0 -21.6 RL -36 0 RL 0 21.6 RL CL ST(modem)404.592 327.16 Q 285 397.4
MT 5.76 -4.752 RL 1.512 3.24 RL CL 0 Fg 285 397.4 MT 5.76 -4.752 RL
1.512 3.24 RL CL .1 LW 0 Cg ST 508.2 325.4 MT -7.2 1.8 RL 0 -3.6 RL CL 0
Fg 508.2 325.4 MT -7.2 1.8 RL 0 -3.6 RL CL 0 Cg ST .32 LW 436.2 325.4
291.48 394.304 DL 501 325.4 436.2 325.4 DL 360.6 361.4 EBEGIN
gsave currentpoint 2 copy translate -25.4633 rotate neg exch neg exch translate
EEND/F0 8/Palatino-Roman@0 SF(\()291.392 367.84 Q(5).32 I(\))-.32 I
(communication with r)2 .32 M(emote system)-.144 E 141 307.4 EBEGIN
grestore
EEND/F0 8/Palatino-Bold@0 SF(Figure 1)253.652 440.6 Q/F1 8
/Palatino-Roman@0 SF(Overview of client and server)6 E(.)-.592 E/F2 10
/Palatino-Roman@0 SF .096
(The steps involved in establishing communications with a r)129.6 464.6
R .096(emote system ar)-.18 F 2.596(ea)-.18 G 2.596(sf)-2.596 G(ollows:)
-2.596 E 6.33(0. The)147.6 483.8 R(server is started.)2.5 E 6.33(1. The)
147.6 499.8 R .763
(client is started and opens a connection to the server)3.264 F 3.263
(,u)-.74 G .763(sing the)-3.263 F/F3 10/Courier@0 SF(cli_conn)3.263 E F2
1.702(function \(Section 17.2.2\).)163.93 511.8 R 1.702
(The client sends a r)6.702 F 1.703(equest for the server to call the)
-.18 F -.18(re)163.93 523.8 S(mote system.).18 E 6.33(2. The)147.6 539.8
R .616(server r)3.116 F .616(eads the)-.18 F F3(Systems)3.116 E F2(,)A
F3(Devices)3.116 E F2 3.115(,a)C(nd)-3.115 E F3(Dialers)3.115 E F2 .615
(\214les to determine how)3.115 F 2.04(to call the r)163.93 551.8 R 2.04
(emote system.)-.18 F(\(W)7.041 E 4.541(ed)-.92 G 2.041
(escribe these \214les in the next section.\))-4.541 F 2.041(If a)7.041
F 3.973(modem is being used, the)163.93 563.8 R F3(Dialers)6.473 E F2
3.973(\214le contains all the modem-speci\214c)6.473 F
(commands to dial the modem.)163.93 575.8 Q 6.33(3. The)147.6 591.8 R
(server)4.444 E F3(open)4.444 E F2 4.444(st)C 1.945
(he modem device and dials the modem.)-4.444 F 1.945(This can take a)
6.945 F 1.084(while \(typically ar)163.93 603.8 R 1.084(ound 15)-.18 F
<89>.833 -.9 M 1.084(30 seconds\).).833 .9 N 1.084
(The server handles all locking of this)6.084 F
(device, to avoid interfering with other users of this device.)163.93
615.8 Q 6.33(4. If)147.6 631.8 R .674(the dialing was successful, the s\
erver passes back the open \214le descriptor for)3.173 F .442
(the modem device to the client.)163.93 643.8 R 2.282 -.92(We u)5.442 H
.442(se our functions fr).92 F .442(om Section 17.4 to send)-.18 F
(and r)163.93 655.8 Q(eceive the descriptor)-.18 E(.)-.74 E 0 Cg EP
%%Page: 4 4
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(4)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)262.686 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF 6.33(5. The)147.6 123 R 2.061
(client communicates dir)4.561 F 2.062(ectly with the r)-.18 F 2.062
(emote system.)-.18 F 2.062(The server is not)7.062 F 4.779
(involved in this communication)163.93 135 R .833<8a74>.833 G 4.778
(he client)-.833 F/F3 10/Courier@0 SF(read)7.278 E F2 7.278(sa)C(nd)
-7.278 E F3(write)7.278 E F2 7.278(st)C 4.778(he \214le)-7.278 F
(descriptor r)163.93 147 Q(eturned in step 4.)-.18 E .32(The communicat\
ion between the client and server \(steps 1 and 4\) is acr)129.6 166.2 R
.32(oss a full-duplex)-.18 F 1.556(pipe \(an)129.6 178.2 R/F4 10
/Palatino-Italic@0 SF(s-pipe)4.056 E F2 4.056(,at)C 1.556(erm we intr)
-4.056 F 1.556(oduced in Section 17.4 to r)-.18 F(epr)-.18 E 1.555
(esent either a STREAMS)-.18 F 2.331
(pipe or a UNIX domain socket being used as a pipe\).)129.6 190.2 R
2.332(When the client is \214nished)7.332 F 4.607
(communicating with the r)129.6 202.2 R 4.606
(emote system it closes this s-pipe \(normally just by)-.18 F 2.5
(terminating\). The)129.6 214.2 R(server notices this close and r)2.5 E
(eleases the lock on the modem device.)-.18 E/F5 12/Helvetica-Bold@0 SF
29.328(4D)93.6 247.8 S 3.336(ata Files)-29.328 F F2 1.634
(In this section we describe the thr)129.6 271.8 R 1.634
(ee \214les used by the Honey DanBer UUCP system:)-.18 F F3(Systems)
129.6 283.8 Q F2(,)A F3(Devices)2.58 E F2 2.58(,a)C(nd)-2.58 E F3
(Dialers)2.58 E F2 5.08(.T)C(her)-5.08 E 2.58(ea)-.18 G .44 -.18(re m)
-2.58 H .08(any \214elds in these \214les that ar).18 F 2.58(eu)-.18 G
.08(sed by)-2.58 F 1.091(the UUCP system.)129.6 295.8 R 2.931 -.92(We d)
6.091 H 1.092
(on't describe these additional \214elds \(or the UUCP system\) in).92 F
2.5(detail. Refer)129.6 307.8 R(to Redman)2.5 E([)2.5 -.4 M(1989).4 I(])
-.4 I(for additional details.)2.5 .4 M(Figur)147.6 319.8 Q 2.5(e2s)-.18
G(hows the six \214elds fr)-2.5 E(om the)-.18 E F3(Systems)2.5 E F2
(\214le in a tabular format.)2.5 E 436.548 333.8 212.652 333.8 DL/F6 8
/Palatino-Italic@0 SF 13.42(name time)219.984 341.8 R 19.484(type class)
17.2 F 26.968(phone login)23.616 F 436.548 345.8 212.652 345.8 DL
436.548 347.8 212.652 347.8 DL/F7 8/Courier@0 SF 7.2(host1 Any)216.652
355.8 R 12(ACU 19200)16.8 F(5551234)12 E/F8 8/Palatino-Roman@0 SF
(\(not used\))12 E F7 7.2(host1 Any)216.652 365.8 R 14.4(ACU 9600)16.8 F
(5552345)14.4 E F8(\(not used\))12 E F7 7.2(host1 Any)216.652 375.8 R
14.4(ACU 2400)16.8 F(5556789)14.4 E F8(\(not used\))12 E F7 7.2
(modem Any modem 19200)216.652 385.8 R(-)26.4 E F8(\(not used\))26.4 E
F7 7.2(laser Any laser 19200)216.652 395.8 R(-)26.4 E F8(\(not used\))
26.4 E 436.548 399.8 212.652 399.8 DL 390.652 333.8 390.652 399.8 DL
345.052 333.8 345.052 399.8 DL 309.052 333.8 309.052 399.8 DL 273.052
333.8 273.052 399.8 DL 246.652 333.8 246.652 399.8 DL 436.548 333.8
436.548 399.8 DL 212.652 333.8 212.652 399.8 DL/F9 8/Palatino-Bold@0 SF
(Figure 2)274.824 417.8 Q F8(The)6 E F7(Systems)2 E F8(\214le.)2 E F2
(The)129.6 440.6 Q F4(name)3.4 E F2 .9(is the name of the r)3.4 F .9
(emote system.)-.18 F 2.74 -.92(We u)5.9 H .9
(se this in commands of the form).92 F F3(cu)3.4 E(host1)129.6 452.6 Q
F2 5.052(,f)C 2.552(or example.)-5.052 F 2.552
(Note that we can have multiple entries for the same r)7.552 F(emote)
-.18 E 2.7(system. These)129.6 464.6 R .2(entries ar)2.7 F 2.7(et)-.18 G
.2(ried in the or)-2.7 F .199(der in which they appear in the \214le.)
-.18 F .199(The entries)5.199 F(named)129.6 476.6 Q F3(modem)4.062 E F2
(and)4.062 E F3(laser)4.063 E F2(ar)4.063 E 4.063(ef)-.18 G 1.563
(or connecting dir)-4.063 F 1.563(ectly to a serial modem and a serial)
-.18 F 1.044(laser printer)129.6 488.6 R 6.044(.W)-.74 G 3.544(ed)-6.964
G 1.044
(on't need to dial a modem to connect to these devices, but we still)
-3.544 F(need to open the appr)129.6 500.6 Q
(opriate terminal line, and handle the appr)-.18 E(opriate locks.)-.18 E
F4(time)147.6 512.6 Q F2 .191
(speci\214es the time-of-day and days of the week to call this host.)
2.691 F .192(This is a UUCP)5.192 F 2.606(\214eld. The)129.6 524.6 R F4
(type)2.606 E F2 .105(\214eld speci\214es which entry in the)2.606 F F3
(Devices)2.605 E F2 .105(\214le is to be used for this)2.605 F F4(name)
2.605 E F2(.)A(The)129.6 536.6 Q F4(class)3.208 E F2 .708(\214eld is r)
3.208 F .708(eally the line speed to be used \(baud rate\).)-.18 F F4
(phone)5.708 E F2 .709(speci\214es the phone)3.208 F 2.404
(number for entries with a)129.6 548.6 R F4(type)4.903 E F2(of)4.903 E
F3(ACU)4.903 E F2 7.403(.F)C 2.403(or other entries the)-7.403 F F3
(phone)4.903 E F2 2.403(\214eld is just a)4.903 F 3.207(hyphen. The)
129.6 560.6 R .707(\214nal \214eld,)3.207 F F4(login)3.207 E F2 3.207
(,i)C 3.207(st)-3.207 G .707(he r)-3.207 F .707(emainder of the line.)
-.18 F .707(It is a series of strings used)5.707 F
(by UUCP to log in to the r)129.6 572.6 Q(emote system.)-.18 E 1.84 -.92
(We d)5 H(on't need this \214eld.).92 E(The)147.6 584.6 Q F3(Devices)
5.079 E F2 2.579(\214le contains information on the modems and dir)5.079
F 2.579(ectly connected)-.18 F 3.24(hosts. Figur)129.6 596.6 R 3.24(e3s)
-.18 G .74(hows the \214ve \214elds in this \214le.)-3.24 F(The)5.741 E
F4(type)3.241 E F2 .741(\214eld matches an entry in the)3.241 F F3
(Systems)129.6 608.6 Q F2 1.468(\214le with an entry in the)3.968 F F3
(Devices)3.967 E F2 3.967(\214le. The)3.967 F F4(class)3.967 E F2 1.467
(\214eld must also match the)3.967 F(corr)129.6 620.6 Q
(esponding \214eld in the)-.18 E F3(Systems)2.5 E F2 2.5(\214le. It)2.5
F(normally speci\214es the line speed.)2.5 E .916
(The actual name of a device is obtained by pr)147.6 632.6 R .917
(e\214xing the)-.18 F F4(line)3.417 E F2 .917(\214eld with)3.417 F F3
(/dev/)3.417 E F2 5.917(.I)C(n)-5.917 E 1.861
(this example the actual devices ar)129.6 644.6 R(e)-.18 E F3(/dev/cua0)
4.361 E F2(,)A F3(/dev/ttya)4.361 E F2 4.361(,a)C(nd)-4.361 E F3
(/dev/ttyb)4.361 E F2 6.861(.T)C(he)-6.861 E(next \214eld,)129.6 656.6 Q
F4(line2)2.5 E F2 2.5(,i)C 2.5(sn)-2.5 G(ot used.)-2.5 E 0 Cg EP
%%Page: 5 5
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 4)93.6 84 R 2.25(Data Files)
323.994 F/F1 9/Palatino-Bold@0 SF(5)18 E .32 LW 97.6 91.2 93.6 91.2 DL
99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2 103.6 91.2 DL
111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6 91.2 115.6 91.2
DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL 131.6 91.2 127.6
91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2 DL 143.6 91.2
139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6 91.2 DL 155.6
91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2 159.6 91.2 DL
167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6 91.2 171.6 91.2
DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL 187.6 91.2 183.6
91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2 DL 199.6 91.2
195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6 91.2 DL 211.6
91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2 215.6 91.2 DL
223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6 91.2 227.6 91.2
DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL 243.6 91.2 239.6
91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2 DL 255.6 91.2
251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6 91.2 DL 267.6
91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2 271.6 91.2 DL
279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6 91.2 283.6 91.2
DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL 299.6 91.2 295.6
91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2 DL 311.6 91.2
307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6 91.2 DL 323.6
91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2 327.6 91.2 DL
335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6 91.2 339.6 91.2
DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL 355.6 91.2 351.6
91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2 DL 367.6 91.2
363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6 91.2 DL 379.6
91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2 383.6 91.2 DL
391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6 91.2 395.6 91.2
DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL 411.6 91.2 407.6
91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2 DL 423.6 91.2
419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6 91.2 DL 435.6
91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2 439.6 91.2 DL
447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6 91.2 451.6 91.2
DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL 467.6 91.2 463.6
91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2 DL 479.6 91.2
475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6 91.2 DL 491.6
91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2 495.6 91.2 DL
503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6 91.2 507.6 91.2
DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL 408.604 125 240.596
125 DL/F2 8/Palatino-Italic@0 SF 18.708(type line)249.708 133 R 14.372
(line2 class)15.596 F(dialer)21.66 E 408.604 137 240.596 137 DL 408.604
139 240.596 139 DL/F3 8/Courier@0 SF 12(ACU cua0)249.396 147 R 17.604
(-1)17.604 G 7.2(9200 tbfast)-17.604 F 12(ACU cua0)249.396 157 R 20.004
(-9)17.604 G 9.6(600 tb9600)-20.004 F 12(ACU cua0)249.396 167 R 20.004
(-2)17.604 G 9.6(400 tb2400)-20.004 F 12(ACU cua0)249.396 177 R 20.004
(-1)17.604 G 9.6(200 tb1200)-20.004 F 7.2(modem ttya)244.596 187 R
17.604(-1)17.604 G 7.2(9200 direct)-17.604 F 7.2(laser ttyb)244.596 197
R 17.604(-1)17.604 G 7.2(9200 direct)-17.604 F 408.604 201 240.596 201
DL 369.804 125 369.804 201 DL 333.804 125 333.804 201 DL 305.796 125
305.796 201 DL 274.596 125 274.596 201 DL 408.604 125 408.604 201 DL
240.596 125 240.596 201 DL/F4 8/Palatino-Bold@0 SF(Figure 3)274.824 219
Q/F5 8/Palatino-Roman@0 SF(The)6 E F3(Devices)2 E F5(\214le.)2 E/F6 10
/Palatino-Roman@0 SF .398(The \214nal \214eld,)147.6 243 R/F7 10
/Palatino-Italic@0 SF(dialer)2.898 E F6 2.898(,m)C .398(atches the corr)
-2.898 F .399(esponding entry in the)-.18 F/F8 10/Courier@0 SF(Dialers)
2.899 E F6 2.899(\214le. For)2.899 F(the)2.899 E(dir)129.6 255 Q
(ectly connected entries this \214eld is)-.18 E F8(direct)2.5 E F6(.)A
(Figur)147.6 267 Q 3.145(e4s)-.18 G .645(hows the format of the)-3.145 F
F8(Dialers)3.145 E F6 3.145(\214le. This)3.145 F .645
(is the \214le that contains all the)3.145 F
(modem-speci\214c dialing commands.)129.6 279 Q 519.2 297.8 122.4 297.8
DL F2 19.256(dialer sub)131.688 305.8 R(handshake)157.704 E 519.2 309.8
122.4 309.8 DL 519.2 311.8 122.4 311.8 DL F3 7.2(tb9600 =W-, "")126.4
319.8 R(\\dA\\pA\\pA\\pTQ0S2=255S12=255s50=6s58=2s68=255\\r\\c)4.8 E
(OK\\r \\EATDT\\T\\r\\c CONNECT\\s9600 \\r\\c "")198.4 329.8 Q 519.2
333.8 122.4 333.8 DL 7.2(tbfast =W-, "")126.4 341.8 R
(\\dA\\pA\\pA\\pTQ0S2=255S12=255s50=255s58=2s68=255s110=1s111=30\\r\\c)
4.8 E(OK\\r \\EATDT\\T\\r\\c CONNECT\\sFAST)198.4 351.8 Q 519.2 355.8
122.4 355.8 DL 192.4 297.8 192.4 355.8 DL 161.2 297.8 161.2 355.8 DL
519.2 297.8 519.2 355.8 DL 122.4 297.8 122.4 355.8 DL F4(Figure 4)
274.824 373.8 Q F5(The)6 E F3(Dialers)2 E F5(\214le.)2 E F6 3.739 -.92
(We s)129.6 397.8 T 1.899(how only two entries for this \214le).92 F
.833<8a77>.833 G 4.4(ed)-.833 G 1.9(on't show the entries for)-4.4 F F8
(tb1200)4.4 E F6(and)4.4 E F8(tb2400)129.6 409.8 Q F6 .352(that wer)
2.852 F 2.852(er)-.18 G(efer)-3.032 E .352(enced in the)-.18 F F8
(Devices)2.852 E F6 2.851(\214le. The)2.851 F F7(handshake)2.851 E F6
.351(\214eld is contained on a)2.851 F(single line.)129.6 421.8 Q 1.84
-.92(We h)5 H(ave br).92 E(oken it into two lines to \214t on the page.)
-.18 E(The)147.6 433.8 Q F7(dialer)2.933 E F6 .433
(\214eld is used to locate the matching entry fr)2.933 F .434(om the)
-.18 F F8(Devices)2.934 E F6 2.934(\214le. The)2.934 F F7(sub)2.934 E F6
1.281(\214eld speci\214es substitutions to be performed for an equals s\
ign and a minus sign that)129.6 445.8 R .153(appear in a phone number)
129.6 457.8 R 5.154(.I)-.74 G 2.654(nt)-5.154 G .154
(he two entries in Figur)-2.654 F 2.654(e4t)-.18 G .154
(his \214eld says to substitute a)-2.654 F F8(W)2.654 E F6 .975
(for an equals sign, and a comma for a minus sign.)129.6 469.8 R .975
(This allows the phone numbers in)5.975 F(the)129.6 481.8 Q F8(Systems)
3.356 E F6 .856(\214le to contain an equals sign \(meaning `)3.356 F
.857(`wait for dialtone')-.37 F .857('\) and a minus)-.37 F 2.614
(sign \(meaning `)129.6 493.8 R(`pause')-.37 E 5.114('\). The)-.37 F
2.613(translation of these two characters to whatever each)5.114 F
(particular modem r)129.6 505.8 Q(equir)-.18 E(es is speci\214ed by the)
-.18 E F8(Dialers)2.5 E F6(\214le.)2.5 E .188(The \214nal \214eld,)147.6
517.8 R F7(handshake)2.688 E F6 2.688(,c)C .188
(ontains the actual dialing instr)-2.688 F 2.689(uctions. It)-.08 F .189
(is a sequence of)2.689 F 2.926
(blank-separated strings called expect\211send strings.)129.6 529.8 R
4.766 -.92(We e)7.926 H 2.926(xpect \(i.e.,).92 F F8(read)5.426 E F6
2.926(until we)5.426 F 1.928
(match\) the \214rst string and then send \(i.e.,)129.6 541.8 R F8
(write)4.429 E F6 4.429(\)t)C 1.929(he next string.)-4.429 F 1.929
(Let's look at the)6.929 F F8(tbfast)129.6 553.8 Q F6 1.018
(entry as an example.)3.518 F 1.018(This entry is for a T)6.018 F 1.018
(elebit T)-.92 F 1.018(railblazer modem in its PEP)-.9 F
(\(packetized ensemble pr)129.6 565.8 Q(otocol\) mode.)-.18 E 6.33
(1. The)147.6 586.2 R 4.312(\214rst expect string is empty)6.812 F 6.812
(,m)-1.11 G 4.312(eaning `)-6.812 F 4.312(`expect nothing.')-.37 F 9.312
('W)-.37 G 6.812(ea)-10.232 G(lways)-6.812 E
(successfully match this empty string.)163.93 598.2 Q 6.33(2. W)147.6
614.2 R 2.53(es)-.92 G .029(end the next string.)-2.53 F .029
(Special send sequences ar)5.029 F 2.529(es)-.18 G .029
(peci\214ed with the backslash)-2.529 F(character)163.93 626.2 Q(.)-.74
E F8(\\d)6.086 E F6 1.086(causes a delay for 2 seconds.)3.586 F 2.926
-.92(We t)6.086 H 1.086(hen send an).92 F F8(A)3.586 E F6 6.086(.W)C
3.586(ep)-7.006 G 1.086(ause for)-3.586 F .976(one-half second \()163.93
638.2 R F8(\\p)A F6 .976(\), send another)B F8(A)3.476 E F6 3.476(,p)C
.976(ause, send another)-3.476 F F8(A)3.476 E F6 3.476(,a)C .975
(nd pause again.)-3.476 F 3.926 -.92(We t)163.93 650.2 T 2.086
(hen send the r).92 F 2.087
(emaining characters in the string, starting with)-.18 F F8(T)4.587 E F6
7.087(.T)C(hese)-7.087 E 0 Cg EP
%%Page: 6 6
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(6)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)262.686 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF .062(commands all set parameters in the modem.)
163.93 123 R(The)5.062 E/F3 10/Courier@0 SF(\\r)2.561 E F2 .061
(sends a carriage r)2.561 F .061(eturn and)-.18 F(the \214nal)163.93 135
Q F3(\\c)2.5 E F2
(says not to write the normal newline at the end of the send string.)2.5
E 6.33(3. W)147.6 151 R(e)-.92 E F3(read)5.661 E F2(fr)5.661 E 3.162
(om the modem until we r)-.18 F 3.162(eceive the string)-.18 F F3(OK\\r)
5.662 E F2 8.162(.\()C 3.162(Again, the)-8.162 F(sequence)163.93 163 Q
F3(\\r)2.5 E F2(means a carriage r)2.5 E(eturn.\))-.18 E 6.33(4. The)
147.6 179 R .54(next send string begins with)3.04 F F3(\\E)3.04 E F2
5.54(.T)C .54(his enables echo checking: each time we)-5.54 F .624
(send a character to the modem, we r)163.93 191 R .624
(ead back until the character is echoed.)-.18 F -.92(We)5.625 G 1.075
(then send the four characters)163.93 203 R F3(ATDT)3.575 E F2 6.075(.T)
C 1.075(he next special character)-6.075 F(,)-.74 E F3(\\T)3.575 E F2
3.575(,c)C 1.075(auses the)-3.575 F 1.029
(phone number to be substituted.)163.93 215 R 1.029
(This is followed by a carriage r)6.029 F 1.03(eturn; the)-.18 F F3(\\c)
3.53 E F2(pr)163.93 227 Q
(events the normal newline at the end of the send string fr)-.18 E
(om being sent.)-.18 E 6.33(5. The)147.6 243 R .703
(\214nal expect string waits for)3.203 F F3 -1.002(CONNECT FAST)3.203 F
F2 .703(to be r)3.203 F .702(eturned by the modem.)-.18 F
(\(The sequence)163.93 255 Q F3(\\s)2.5 E F2(means a single space.\))2.5
E .249(When this \214nal expect string is r)129.6 275.4 R .249
(eceived, the dialing is complete.)-.18 F(\(Ther)5.25 E 2.75(ea)-.18 G
.61 -.18(re m)-2.75 H .25(any mor).18 F(e)-.18 E
(special sequences that can appear in the)129.6 287.4 Q/F4 10
/Palatino-Italic@0 SF(handshake)2.5 E F2(string that we don't cover)2.5
E(.\))-.74 E
(Let's summarize the actions that we have to perform with these thr)
147.6 299.4 Q(ee \214les.)-.18 E 6.33(1. Using)147.6 319.8 R 1.285
(the name of the r)3.785 F 1.285
(emote system, \214nd the \214rst entry in the)-.18 F F3(Systems)3.785 E
F2(\214le)3.785 E(with the same)163.93 331.8 Q F4(name)2.5 E F2(.)A 6.33
(2. Find)147.6 347.8 R .228(the matching entry in the)2.728 F F3
(Devices)2.728 E F2 .228(\214le with a)2.728 F F4(type)2.728 E F2(and)
2.728 E F4(class)2.728 E F2 .228(that match the)2.728 F(corr)163.93
359.8 Q(esponding entries in the)-.18 E F3(Systems)2.5 E F2
(\214le entry)2.5 E(.)-1.11 E 6.33(3. Find)147.6 375.8 R .703
(the entry in the)3.203 F F3(Dialers)3.203 E F2 .703
(\214le that matches the)3.203 F F4(dialer)3.203 E F2 .703
(\214eld in the)3.203 F F3(Devices)3.202 E F2(\214le.)163.93 387.8 Q
6.33(4. Dial)147.6 403.8 R(the modem.)2.5 E(Ther)129.6 424.2 Q 3.009(ea)
-.18 G .869 -.18(re t)-3.009 H .509(wo r).18 F .509
(easons why this can fail:)-.18 F(\()3.009 -.4 M(1).4 I(\))-.4 I .509
(the device corr)3.009 .4 N .51(esponding to the)-.18 F F4(line)3.01 E
F2 .51(\214eld in)3.01 F(the)129.6 436.2 Q F3(Devices)3.95 E F2 1.45
(\214le is alr)3.95 F 1.449(eady in use by someone else or)-.18 F(\()
3.949 -.4 M(2).4 I(\))-.4 I 1.449(the dialing is unsuccessful)3.949 .4 N
.651(\(e.g., the phone on the r)129.6 448.2 R .652(emote system is busy)
-.18 F 3.152(,o)-1.11 G 3.152(rt)-3.152 G .652(he r)-3.152 F .652
(emote system is down and is not)-.18 F .737(answering the phone\).)
129.6 460.2 R .737
(The second case is often detected by a timeout occurring when)5.737 F
(we'r)129.6 472.2 Q 3.626(er)-.18 G 1.126(eading fr)-3.806 F 1.126
(om the modem, trying to match an expect string \(see Exer)-.18 F 1.127
(cise 10\).)-.18 F(In)6.127 E 1.511
(either case, we want to go back to step 1 and sear)129.6 484.2 R 1.51
(ch for the next entry for the same)-.18 F -.18(re)129.6 496.2 S .017
(mote system.).18 F .017(As we saw in Figur)5.017 F 2.517(e2)-.18 G
-5.016 2.517(,a g)-2.517 H .018
(iven host can have multiple entries, each with)-2.517 F 4.535(ad)129.6
508.2 S(if)-4.535 E(fer)-.18 E 2.034
(ent phone number \(and each phone number could corr)-.18 F 2.034
(espond to a dif)-.18 F(fer)-.18 E(ent)-.18 E(device\).)129.6 520.2 Q
(Ther)147.6 532.2 Q 3.062(ea)-.18 G .922 -.18(re o)-3.062 H .563(ther \
\214les in the Honey DanBer system that we don't use in the example).18
F .057(in this chapter)129.6 544.2 R 5.057(.T)-.74 G .057(he \214le)
-5.057 F F3(Dialcodes)2.556 E F2 .056(speci\214es dialcode abbr)2.556 F
.056(eviations for phone numbers)-.18 F 1.03(in the)129.6 556.2 R F3
(Systems)3.53 E F2 3.53(\214le. The)3.53 F(\214le)3.53 E F3(Sysfiles)
3.53 E F2 1.03(allows the speci\214cation of alternate copies of)3.53 F
(the thr)129.6 568.2 Q(ee \214les)-.18 E F3(Systems)2.5 E F2(,)A F3
(Devices)2.5 E F2 2.5(,a)C(nd)-2.5 E F3(Dialers)2.5 E F2(.)A/F5 12
/Helvetica-Bold@0 SF 29.328(5S)93.6 600.6 S -3.216(er ver)-29.328 F
(Design)6.672 E F2 -.92(We)129.6 624.6 S
('ll start with a description of the server).92 E 5(.T)-.74 G
(wo factors af)-5.9 E(fect the design of the server:)-.18 E 6.33
(1. Dialing)147.6 645 R 1.953(can take a while \(15)4.454 F<89>.833 -.9
M 1.953(30 seconds\), so the server has to).833 .9 N F3(fork)4.453 E F2
4.453(ac)4.453 G(hild)-4.453 E(pr)163.93 657 Q
(ocess to do the actual dialing.)-.18 E 0 Cg EP
%%Page: 7 7
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 5)93.6 84 R 2.25(Server Design)
307.767 F/F1 9/Palatino-Bold@0 SF(7)18 E .32 LW 97.6 91.2 93.6 91.2 DL
99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2 103.6 91.2 DL
111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6 91.2 115.6 91.2
DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL 131.6 91.2 127.6
91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2 DL 143.6 91.2
139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6 91.2 DL 155.6
91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2 159.6 91.2 DL
167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6 91.2 171.6 91.2
DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL 187.6 91.2 183.6
91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2 DL 199.6 91.2
195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6 91.2 DL 211.6
91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2 215.6 91.2 DL
223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6 91.2 227.6 91.2
DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL 243.6 91.2 239.6
91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2 DL 255.6 91.2
251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6 91.2 DL 267.6
91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2 271.6 91.2 DL
279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6 91.2 283.6 91.2
DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL 299.6 91.2 295.6
91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2 DL 311.6 91.2
307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6 91.2 DL 323.6
91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2 327.6 91.2 DL
335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6 91.2 339.6 91.2
DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL 355.6 91.2 351.6
91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2 DL 367.6 91.2
363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6 91.2 DL 379.6
91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2 383.6 91.2 DL
391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6 91.2 395.6 91.2
DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL 411.6 91.2 407.6
91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2 DL 423.6 91.2
419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6 91.2 DL 435.6
91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2 439.6 91.2 DL
447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6 91.2 451.6 91.2
DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL 467.6 91.2 463.6
91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2 DL 479.6 91.2
475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6 91.2 DL 491.6
91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2 495.6 91.2 DL
503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6 91.2 507.6 91.2
DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2 10
/Palatino-Roman@0 SF 6.33(2. The)147.6 123 R .936
(daemon server \(the par)3.436 F .936(ent\) has to be the one pr)-.18 F
.937(ocess that manages all the)-.18 F(locks.)163.93 135 Q(Figur)129.6
155.4 Q 2.5(e5s)-.18 G(hows the arrangement of the pr)-2.5 E(ocesses.)
-.18 E 295.8 218.2 MT 0 -36 RL -43.2 0 RL 0 36 RL CL ST/F3 8
/Palatino-Roman@0 SF(server)263.252 196.96 Q/F4 7/Palatino-Roman@0 SF
(w/lock table)254.334 206.96 Q 295.8 290.2 MT 0 -36 RL -43.2 0 RL 0 36
RL CL ST F3(client)264.548 273.96 Q 252.6 200.2 MT -7.2 1.8 RL 0 -3.6 RL
CL 0 Fg 252.6 200.2 MT -7.2 1.8 RL 0 -3.6 RL CL .1 LW 0 Cg ST .32 LW
216.6 200.2 245.4 200.2 DL/F5 8/Courier@0 SF(Systems)161.4 191.96 Q F3
(,)A F5(Devices)158.628 201.96 Q F3 2(,a)C(nd)-2 E F5(Dialers)159.204
211.96 Q F3(\214les)2 E 403.8 218.2 MT 0 -36 RL -43.2 0 RL 0 36 RL CL ST
(server)371.252 201.96 Q(par)262.74 178.96 Q(ent)-.144 E(child)373.324
178.96 Q 360.6 194.224 MT -7.2 1.8 RL 0 -3.6 RL CL 0 Fg 360.6 194.224 MT
-7.2 1.8 RL 0 -3.6 RL CL .1 LW 0 Cg ST .32 LW 353.4 194.224 295.8
194.224 DL F5(fork)318.6 190.984 Q 295.8 206.176 MT 7.2 -1.8 RL 0 3.6 RL
CL 0 Fg 295.8 206.176 MT 7.2 -1.8 RL 0 3.6 RL CL .1 LW 0 Cg ST .32 LW
360.6 206.176 303 206.176 DL(exit)307.188 212.936 Q F3(status)2 E 403.8
200.2 MT 7.2 -1.8 RL 0 3.6 RL CL 0 Fg 403.8 200.2 MT 7.2 -1.8 RL 0 3.6
RL CL .1 LW 0 Cg ST 461.4 200.2 MT -7.2 1.8 RL 0 -3.6 RL CL 0 Fg 461.4
200.2 MT -7.2 1.8 RL 0 -3.6 RL CL 0 Cg ST .32 LW 454.2 200.2 411 200.2
DL(dialing)420.112 196.96 Q(commands)413.108 206.96 Q 497.4 211 MT 0
-21.6 RL -36 0 RL 0 21.6 RL CL ST(modem)465.792 201.96 Q 274.2 218.2 MT
1.8 7.2 RL -3.6 0 RL CL 0 Fg 274.2 218.2 MT 1.8 7.2 RL -3.6 0 RL CL .1
LW 0 Cg ST .32 LW 274.2 225.4 274.2 254.2 DL -.144(re)246.216 237.96 S
(quest).144 E 274.2 254.2 MT 6.264 -3.96 RL 1.152 3.384 RL CL 0 Fg 274.2
254.2 MT 6.264 -3.96 RL 1.152 3.384 RL CL .1 LW 0 Cg ST .32 LW 382.2
218.2 281.04 251.896 DL 328.2 236.2 EBEGIN
gsave currentpoint 2 copy translate -18.4349 rotate neg exch neg exch translate
EEND/F0 8/Palatino-Roman@0 SF(\214le descriptor)303.652 232.96 Q(or err)
314.668 242.96 Q(or)-.144 E 151.8 182.2 EBEGIN
grestore
EEND/F0 8/Palatino-Bold@0 SF(Figure 5)229.62 315.4 Q/F1 8
/Palatino-Roman@0 SF(Arrangement of pr)6 E(ocesses in modem dialer)-.144
E(.)-.592 E/F2 10/Palatino-Roman@0 SF
(The steps performed by the server ar)129.6 339.4 Q 2.5(et)-.18 G
(he following:)-2.5 E 6.33(1. The)147.6 359.8 R(par)2.64 E .14(ent r)
-.18 F .14(eceives the r)-.18 F .14(equest fr)-.18 F .14
(om the client at the server)-.18 F .14('s well-known name.).74 F 2.777
(As we described in Sections 17.2.2 and 17.3.2, this cr)163.93 371.8 R
2.778(eates a unique s-pipe)-.18 F .07(between the client and server)
163.93 383.8 R 5.07(.T)-.74 G .07(his par)-5.07 F .07(ent pr)-.18 F .07
(ocess has to handle multiple clients)-.18 F
(at the same time, like the open server in Section 17.6.)163.93 395.8 Q
6.33(2. Based)147.6 411.8 R 1.541(on the name of the r)4.041 F 1.542
(emote system that the client wants to contact, the)-.18 F(par)163.93
423.8 Q 1.205(ent goes thr)-.18 F 1.205(ough the)-.18 F/F3 10/Courier@0
SF(Systems)3.705 E F2 1.205(\214le and)3.705 F F3(Devices)3.705 E F2
1.204(\214le to \214nd a match.)3.705 F(The)6.204 E(par)163.93 435.8 Q
1.406(ent also keeps a lock table of which devices ar)-.18 F 3.907(ec)
-.18 G(urr)-3.907 E 1.407(ently in use, so it can)-.18 F
(skip those entries in the)163.93 447.8 Q F3(Devices)2.5 E F2
(\214le that ar)2.5 E 2.5(ei)-.18 G 2.5(nu)-2.5 G(se.)-2.5 E 6.33(3. If)
147.6 463.8 R 3.124(am)3.124 G .624(atch is found, a child is)-3.124 F
F3(fork)3.124 E F2 .624(ed to do the actual dialing.)B .623(\(The par)
5.623 F .623(ent can)-.18 F 3.71(handle other clients at this point.\))
163.93 475.8 R 3.71(If successful, the child sends the \214le)8.71 F
.769(descriptor for the modem back to the client on the client-speci\
\214c s-pipe \(which)163.93 487.8 R 1.067(got duplicated acr)163.93
499.8 R 1.067(oss the)-.18 F F3(fork)3.567 E F2 3.567(\)a)C 1.067
(nd calls)-3.567 F F3(exit\(0\))3.568 E F2 6.068(.I)C 3.568(fa)-6.068 G
3.568(ne)-3.568 G(rr)-3.568 E 1.068(or occurs \(phone)-.18 F(line busy)
163.93 511.8 Q 2.5(,n)-1.11 G 2.5(oa)-2.5 G(nswer)-2.5 E 2.5(,e)-.74 G
(tc.\), the child calls)-2.5 E F3(exit\(1\))2.5 E F2(.)A 6.33(4. The)
147.6 527.8 R(par)5.065 E 2.564
(ent is noti\214ed of the child termination by)-.18 F F3(SIGCHLD)5.064 E
F2 2.564(and fetches its)5.064 F(termination status \()163.93 539.8 Q F3
(waitpid)A F2(\).)A .693(If the child was successful ther)163.93 557.8 R
3.193(ei)-.18 G 3.193(sn)-3.193 G .693(othing mor)-3.193 F 3.193(ef)-.18
G .693(or the par)-3.193 F .694(ent to do.)-.18 F .694(The lock)5.694 F
4.408
(must be held until the client is \214nished with the modem device.)
163.93 569.8 R(The)9.407 E .371
(client-speci\214c s-pipe between the client and par)163.93 581.8 R .372
(ent is left open.)-.18 F .372(This way)5.372 F 2.872(,w)-1.11 G(hen)
-2.872 E .321(the client does terminate, the par)163.93 593.8 R .321
(ent is noti\214ed, and the par)-.18 F .32(ent r)-.18 F .32
(eleases the lock.)-.18 F .423(If the child was not successful, the par)
163.93 611.8 R .423(ent picks up in the)-.18 F F3(Systems)2.924 E F2
.424(\214le wher)2.924 F 2.924(ei)-.18 G(t)-2.924 E .769(left of)163.93
623.8 R 3.269(ff)-.18 G .769
(or this client and tries to \214nd another match.)-3.269 F .768
(If another entry is found)5.768 F .599(for the r)163.93 635.8 R .599
(emote system, the par)-.18 F .599(ent goes back to step 3 and)-.18 F F3
(fork)3.1 E F2 3.1(san)C .6(ew child to)-3.1 F .57
(do the actual dialing.)163.93 647.8 R .569(If no mor)5.57 F 3.069(ee)
-.18 G .569(ntries exist for the r)-3.069 F .569(emote system, the par)
-.18 F(ent)-.18 E(calls)163.93 659.8 Q F3(send_err)2.5 E F2(\(Figur)2.5
E 2.5(e1)-.18 G(7.19\) and closes the client-speci\214c s-pipe.)-2.5 E 0
Cg EP
%%Page: 8 8
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(8)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)262.686 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF .001(Having a unique connection to each client a\
llows the child to send debug output back to)129.6 123 R .77
(the client, if desir)129.6 135 R 3.27(ed. Often)-.18 F .769
(the client wants to see the pr)3.27 F(ogr)-.18 E .769
(ess of the actual dialing, if)-.18 F(pr)129.6 147 Q 1.592(oblems occur)
-.18 F 6.592(.E)-.74 G 1.592
(ven though the dialing is being done by the child of an unr)-6.592 F
(elated)-.18 E(server)129.6 159 Q 2.5(,t)-.74 G
(he unique connection allows the child to send output dir)-2.5 E
(ectly back to its client.)-.18 E/F3 12/Helvetica-Bold@0 SF 29.328(6S)
93.6 190.2 S -3.216(er ver)-29.328 F(Sour)6.672 E 3.336(ce Code)-.24 F
F2 2.536 -.92(We h)129.6 211.8 T .696(ave 17 sour).92 F .695
(ce \214les that constitute the server)-.18 F 5.695(.F)-.74 G(igur)
-5.695 E 3.195(e6l)-.18 G .695(ists the \214les containing the)-3.195 F
1.34(various functions and speci\214es which ar)129.6 223.8 R 3.841(eu)
-.18 G 1.341(sed by the par)-3.841 F 1.341(ent and the child.)-.18 F
(Figur)6.341 E 3.841(e7)-.18 G(pr)129.6 235.8 Q
(ovides an overview of how the various functions ar)-.18 E 2.5(ec)-.18 G
(alled.)-2.5 E 515.632 248.8 133.568 248.8 DL/F4 8/Palatino-Roman@0 SF
(Sour)145.572 255.8 Q(ce \214le)-.144 E(Par)20.004 E 117.384
(ent/Child Functions)-.144 F 515.632 259.8 133.568 259.8 DL 515.632
261.8 133.568 261.8 DL/F5 8/Courier@0 SF(childdial.c)137.568 268.8 Q F4
(C)47.702 E F5(child_dial)18.29 E(cliargs.c)137.568 277.8 Q F4(P)27.89 E
F5(cli_args)48.542 E(client.c)137.568 286.8 Q F4(P)32.69 E F5
(client_alloc, client_add, client_del, client_sigchld)48.542 E(ctlstr.c)
137.568 295.8 Q F4(C)62.102 E F5(ctl_str)18.29 E(debug.c)137.568 304.8 Q
F4(C)66.902 E F5(DEBUG, DEBUG_NONL)18.29 E(devfile.c)137.568 313.8 Q F4
(P)27.89 E F5(dev_next, dev_rew, dev_find)48.542 E(dialfile.c)137.568
322.8 Q F4(C)52.502 E F5(dial_next, dial_rew, dial_find)18.29 E
(expectstr.c)137.568 331.8 Q F4(C)47.702 E F5
(expect_str, exp_read, sig_alrm)18.29 E(lock.c)137.568 340.8 Q F4(P)
42.29 E F5(find_line, lock_set, lock_rel, is_locked)48.542 E(loop.c)
137.568 349.8 Q F4(P)42.29 E F5(loop, cli_done, child_done)48.542 E
(main.c)137.568 358.8 Q F4(P)42.29 E F5(main)48.542 E(request.c)137.568
367.8 Q F4(P)27.89 E F5(request)48.542 E(sendstr.c)137.568 376.8 Q F4(C)
57.302 E F5(send_str)18.29 E(sigchld.c)137.568 385.8 Q F4(P)27.89 E F5
(sig_chld)48.542 E(sysfile.c)137.568 394.8 Q F4(P)27.89 E F5
(sys_next, sys_rew, sys_posn)48.542 E(ttydial.c)137.568 403.8 Q F4(C)
57.302 E F5(tty_dial)18.29 E(ttyopen.c)137.568 412.8 Q F4(C)57.302 E F5
(tty_open)18.29 E 515.632 416.8 133.568 416.8 DL 256.032 248.8 256.032
416.8 DL 225.78 261.8 225.78 416.8 DL 196.368 248.8 196.368 416.8 DL
515.632 248.8 515.632 416.8 DL 133.568 248.8 133.568 416.8 DL/F6 8
/Palatino-Bold@0 SF(Figure 6)267.98 432.4 Q F4(Sour)6 E
(ce \214les for server)-.144 E(.)-.592 E F5(main)234 451.36 Q 243.6
471.2 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Fg 243.6 471.2 MT -1.8 -7.2 RL 3.6 0
RL CL .1 LW 0 Cg ST .32 LW 243.6 464 243.6 456.8 DL(loop)234 480.16 Q
243.6 500 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Fg 243.6 500 MT -1.8 -7.2 RL 3.6
0 RL CL .1 LW 0 Cg ST .32 LW 243.6 492.8 243.6 485.6 DL(request)226.8
508.96 Q(sig_chld)224.4 559.36 Q 380.4 507.2 MT -7.2 1.8 RL 0 -3.6 RL CL
0 Fg 380.4 507.2 MT -7.2 1.8 RL 0 -3.6 RL CL .1 LW 0 Cg ST .32 LW 373.2
507.2 272.4 507.2 DL(fork)316.8 503.96 Q(child_dial)385.2 508.96 Q 409.2
528.8 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Fg 409.2 528.8 MT -1.8 -7.2 RL 3.6 0
RL CL .1 LW 0 Cg ST .32 LW 409.2 521.6 409.2 514.4 DL(dial_find)387.6
537.76 Q 409.2 557.6 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Fg 409.2 557.6 MT
-1.8 -7.2 RL 3.6 0 RL CL .1 LW 0 Cg ST .32 LW 409.2 550.4 409.2 543.2 DL
(tty_open)390 566.56 Q 409.2 586.4 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Fg
409.2 586.4 MT -1.8 -7.2 RL 3.6 0 RL CL .1 LW 0 Cg ST .32 LW 409.2 579.2
409.2 572 DL(tty_dial)390 595.36 Q 409.2 615.2 MT -1.8 -7.2 RL 3.6 0 RL
CL 0 Fg 409.2 615.2 MT -1.8 -7.2 RL 3.6 0 RL CL .1 LW 0 Cg ST .32 LW
409.2 608 409.2 600.8 DL(send_fd, exit)366.036 622.76 Q(\()-.32 I(0).32
I(\))-.32 I F4(or)2 .32 M F5(writen, exit)373.2 632.76 Q(\()-.32 I(1).32
I(\))-.32 I 243.6 564.8 MT 7.2 1.728 RL -1.656 3.168 RL CL 0 Fg 243.6
564.8 MT 7.2 1.728 RL -1.656 3.168 RL CL .1 LW 0 Cg ST .32 LW 362.4 626
250.008 568.112 DL 303 595.4 EBEGIN
gsave currentpoint 2 copy translate 27.2553 rotate neg exch neg exch translate
EEND/F0 8/Courier@0 SF(SIGCHLD)286.2 592.16 Q 193.2 442.4 EBEGIN
grestore
EEND .32 LW 193.2 507.2 214.8 507.2 DL 193.2 485.6 193.2 507.2 DL 243.6
485.6 MT -7.2 1.8 RL 0 -3.6 RL CL 0 Fg 243.6 485.6 MT -7.2 1.8 RL 0 -3.6
RL CL .1 LW 0 Cg ST .32 LW 236.4 485.6 193.2 485.6 DL/F0 8
/Palatino-Bold@0 SF(Figure 7)238.936 652.4 Q/F1 8/Palatino-Roman@0 SF
(Overview of function calling in server)6 E(.)-.592 E 0 Cg EP
%%Page: 9 9
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
283.35 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(9)18 E .32 LW 97.6
91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6
91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL
119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2
DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6
91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2
147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6
91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL
175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2
DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6
91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2
203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6
91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL
231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2
DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6
91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2
259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6
91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL
287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2
DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6
91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2
315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6
91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL
343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2
DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6
91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2
371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6
91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL
399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2
DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6
91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2
427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6
91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL
455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2
DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6
91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2
483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6
91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL
511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2
DL/F2 10/Palatino-Roman@0 SF(Figur)147.6 123 Q 2.588(e8s)-.18 G .087
(hows the)-2.588 F/F3 10/Courier@0 SF(calld.h)2.587 E F2(header)2.587 E
2.587(,w)-.74 G .087(hich is included by all the server sour)-2.587 F
.087(ce \214les.)-.18 F .557(It includes the standar)129.6 135 R 3.057
(ds)-.18 G .558
(ystem headers, de\214nes some basic constants, and declar)-3.057 F .558
(es the)-.18 F(global variables.)129.6 147 Q .4 LW 134.6 154.2 129.6
154.2 DL 139.6 154.2 134.6 154.2 DL 144.6 154.2 139.6 154.2 DL 149.6
154.2 144.6 154.2 DL 154.6 154.2 149.6 154.2 DL 159.6 154.2 154.6 154.2
DL 164.6 154.2 159.6 154.2 DL 169.6 154.2 164.6 154.2 DL 174.6 154.2
169.6 154.2 DL 179.6 154.2 174.6 154.2 DL 184.6 154.2 179.6 154.2 DL
189.6 154.2 184.6 154.2 DL 194.6 154.2 189.6 154.2 DL 199.6 154.2 194.6
154.2 DL 204.6 154.2 199.6 154.2 DL 209.6 154.2 204.6 154.2 DL 214.6
154.2 209.6 154.2 DL 219.6 154.2 214.6 154.2 DL 224.6 154.2 219.6 154.2
DL 229.6 154.2 224.6 154.2 DL 234.6 154.2 229.6 154.2 DL 239.6 154.2
234.6 154.2 DL 244.6 154.2 239.6 154.2 DL 249.6 154.2 244.6 154.2 DL
254.6 154.2 249.6 154.2 DL 259.6 154.2 254.6 154.2 DL 264.6 154.2 259.6
154.2 DL 269.6 154.2 264.6 154.2 DL 274.6 154.2 269.6 154.2 DL 279.6
154.2 274.6 154.2 DL 284.6 154.2 279.6 154.2 DL 289.6 154.2 284.6 154.2
DL 294.6 154.2 289.6 154.2 DL 299.6 154.2 294.6 154.2 DL 304.6 154.2
299.6 154.2 DL 309.6 154.2 304.6 154.2 DL 314.6 154.2 309.6 154.2 DL
319.6 154.2 314.6 154.2 DL 324.6 154.2 319.6 154.2 DL 329.6 154.2 324.6
154.2 DL 334.6 154.2 329.6 154.2 DL 339.6 154.2 334.6 154.2 DL 344.6
154.2 339.6 154.2 DL 349.6 154.2 344.6 154.2 DL 354.6 154.2 349.6 154.2
DL 359.6 154.2 354.6 154.2 DL 364.6 154.2 359.6 154.2 DL 369.6 154.2
364.6 154.2 DL 374.6 154.2 369.6 154.2 DL 379.6 154.2 374.6 154.2 DL
384.6 154.2 379.6 154.2 DL 389.6 154.2 384.6 154.2 DL 394.6 154.2 389.6
154.2 DL 399.6 154.2 394.6 154.2 DL 404.6 154.2 399.6 154.2 DL 409.6
154.2 404.6 154.2 DL 414.6 154.2 409.6 154.2 DL 419.6 154.2 414.6 154.2
DL 424.6 154.2 419.6 154.2 DL 429.6 154.2 424.6 154.2 DL 434.6 154.2
429.6 154.2 DL 439.6 154.2 434.6 154.2 DL 444.6 154.2 439.6 154.2 DL
449.6 154.2 444.6 154.2 DL 454.6 154.2 449.6 154.2 DL 459.6 154.2 454.6
154.2 DL 464.6 154.2 459.6 154.2 DL 469.6 154.2 464.6 154.2 DL 474.6
154.2 469.6 154.2 DL 479.6 154.2 474.6 154.2 DL 484.6 154.2 479.6 154.2
DL 489.6 154.2 484.6 154.2 DL 494.6 154.2 489.6 154.2 DL 499.6 154.2
494.6 154.2 DL 504.6 154.2 499.6 154.2 DL 509.6 154.2 504.6 154.2 DL
514.6 154.2 509.6 154.2 DL 519.6 154.2 514.6 154.2 DL/F4 9/Courier@0 SF
(#include "apue.h")129.6 163.701 Q(#include <errno.h>)129.6 174.401 Q
(#define CS_CALL "/home/sar/calld")129.6 191.521 Q
(/* well-known name */)16.2 E(#define CL_CALL "call")129.6 202.221 Q
(#define MAXSYSNAME)129.6 212.921 Q(256)10.8 E(#define MAXSPEEDSTR 256)
129.6 223.621 Q(/*)129.6 240.741 Q 5.4(*N)135 251.441 S
(umber of structures to alloc/realloc for Client structs)-5.4 E 5.4(*\()
135 262.141 S(client.c\) and Lock structs \(lock.c\).)-5.4 E(*/)135
272.841 Q(#define NALLOC)129.6 283.541 Q(10)10.8 E(#define WHITE)129.6
300.661 Q 5.4("\\)37.8 G 64.8(t\\n" /*)-5.4 F(for separating tokens */)
5.4 E(#define SYSTEMS)129.6 311.361 Q 43.2("./Systems" /*)27 F
(my own copies for now */)5.4 E(#define DEVICES)129.6 322.061 Q
("./Devices")27 E(#define DIALERS)129.6 332.761 Q("./Dialers")27 E
(extern int)129.6 349.881 Q(clifd;)21.6 E(extern int)129.6 360.581 Q
16.2(Debug; /*)21.6 F(nonzero for dialing debug output */)5.4 E
(extern char)129.6 371.281 Q
(errmsg[]; /* error message string to return to client */)16.2 E
(extern char)129.6 381.981 Q 10.8(*speed; /*)16.2 F
(speed \(actually "class"\) to use */)5.4 E(extern char)129.6 392.681 Q
(*sysname; /* name of system to call */)16.2 E(extern uid_t)129.6
403.381 Q 27(uid; /*)10.8 F(client's uid */)5.4 E
(extern volatile sig_atomic_t)129.6 414.081 Q 16.2(chld_flag; /*)10.8 F
(when SIGCHLD occurs */)5.4 E
(extern enum parity { NONE, EVEN, ODD } parity;)129.6 424.781 Q
(/* specified by client */)10.8 E(typedef struct {)129.6 441.901 Q
(/* one Client struct per connected client */)21.6 E 10.8(int fd;)140.4
452.601 R(/* fd, or -1 if available */)48.6 E(pid_t pid;)140.4 463.301 Q
(/* child pid while dialing */)43.2 E(uid_t uid;)140.4 474.001 Q
(/* client's user ID */)43.2 E 10.8(int childdone;)140.4 484.701 R
(/* nonzero when SIGCHLD from dialing child recvd:)10.8 E 5.4(1m)253.8
495.401 S(eans exit\(0\), 2 means exit\(1\) */)-5.4 E 5.4
(long sysftell;)140.4 506.101 R(/* next line to read in Systems file */)
16.2 E 5.4(long foundone;)140.4 516.801 R
(/* true if we find a matching sysfile entry */)16.2 E 10.8(int Debug;)
140.4 527.501 R(/* option from client */)75.6 E(enum parity parity;)
140.4 538.201 Q(/* option from client */)37.8 E 5.4
(char speed[MAXSPEEDSTR];)140.4 548.901 R(/* option from client */)5.4 E
5.4(char sysname[MAXSYSNAME];/*)140.4 559.601 R(option from client */)
5.4 E 5.4(}C)129.6 570.301 S(lient;)-5.4 E
(/* both manipulated by client_XXX\(\) functions */)129.6 587.421 Q
(extern Client *client;)129.6 598.121 Q
(/* ptr to malloc'ed array of Client structs */)27 E(extern int)129.6
608.821 Q(client_size; /* # entries in client[] array */)21.6 E
(typedef struct {)129.6 625.941 Q
(/* everything for one entry in Systems file */)21.6 E 5.4(char *name;)
140.4 636.641 R(/* system name */)32.4 E 5.4(char *time;)140.4 647.341 R
(/* \(e.g., "Any"\) time to call \(ignored\) */)32.4 E 5.4(char *type;)
140.4 658.041 R(/* \(e.g., "ACU"\) or system name if direct connect */)
32.4 E 0 Cg EP
%%Page: 10 10
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(10)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF 5.4(char *class;)140.4 121.7 R
(/* \(e.g., "9600"\) speed */)27 E 5.4(char *phone;)140.4 132.4 R
(/* phone number or "-" if direct connect */)27 E 5.4(char *login;)140.4
143.1 R(/* uucp login chat \(ignored\) */)27 E 5.4(}S)129.6 153.8 S
(ystems;)-5.4 E(typedef struct {)129.6 170.92 Q
(/* everything for one entry in Devices file */)21.6 E 5.4(char *type;)
140.4 181.62 R(/* \(e.g., "ACU"\) matched by type in Systems */)32.4 E
5.4(char *line;)140.4 192.32 R
(/* \(e.g., "cua0"\) without preceding "/dev/" */)32.4 E 5.4
(char *line2;)140.4 203.02 R(/* \(ignored\) */)27 E 5.4(char *class;)
140.4 213.72 R(/* matched by class in Systems */)27 E 5.4(char *dialer;)
140.4 224.42 R(/* name of dialer in Dialers */)21.6 E 5.4(}D)129.6
235.12 S(evices;)-5.4 E(typedef struct {)129.6 252.24 Q
(/* everything for one entry in Dialers file */)21.6 E 5.4
(char *dialer;)140.4 262.94 R(/* matched by dialer in Devices */)21.6 E
5.4(char *sub;)140.4 273.64 R
(/* phone number substitution string \(ignored\) */)37.8 E 5.4
(char *expsend;)140.4 284.34 R(/* expect/send chat */)16.2 E 5.4(}D)
129.6 295.04 S(ialers;)-5.4 E(extern Systems)129.6 312.16 Q 16.2
(systems; /*)10.8 F(filled in by sys_next\(\) */)5.4 E(extern Devices)
129.6 322.86 Q 16.2(devices; /*)10.8 F(filled in by dev_next\(\) */)5.4
E(extern Dialers)129.6 333.56 Q 16.2(dialers; /*)10.8 F
(filled in by dial_next\(\) */)5.4 E 5.4(void child_dial\(Client)129.6
350.68 R 86.4(*\); /*)5.4 F(childdial.c */)5.4 E 10.8
(int cli_args\(int,)129.6 361.38 R(char **\);)5.4 E(/* cliargs.c */)81 E
10.8(int client_add\(int,)129.6 372.08 R 75.6(uid_t\); /*)5.4 F
(client.c */)5.4 E 5.4(void client_del\(int\);)129.6 382.78 R 5.4
(void client_sigchld\(pid_t,)129.6 393.48 R(int\);)5.4 E 5.4
(void loop\(void\);)129.6 404.18 R(/* loop.c */)145.8 E 5.4
(char *ctl_str\(unsigned)129.6 414.88 R 70.2(char\); /*)5.4 F
(ctlstr.c */)5.4 E 10.8(int dev_find\(Devices)129.6 425.58 R
(*, const Systems *\); /* devfile.c */)5.4 E 10.8(int dev_next\(Devices)
129.6 436.28 R(*\);)5.4 E 5.4(void dev_rew\(void\);)129.6 446.98 R 10.8
(int dial_find\(Dialers)129.6 457.68 R
(*, const Devices *\); /* dialfile.c */)5.4 E 10.8
(int dial_next\(Dialers)129.6 468.38 R(*\);)5.4 E 5.4
(void dial_rew\(void\);)129.6 479.08 R 10.8(int expect_str\(int,)129.6
489.78 R(char *\);)5.4 E(/* expectstr.c */)75.6 E 10.8
(int request\(Client)129.6 500.48 R 102.6(*\); /*)5.4 F(request.c */)5.4
E 10.8(int send_str\(int,)129.6 511.18 R(char *, char *, int\);)5.4 E
(/* sendstr.c */)16.2 E 5.4(void sig_chld\(int\);)129.6 521.88 R
(/* sigchld.c */)129.6 E 5.4(long sys_next\(Systems)129.6 532.58 R 91.8
(*\); /*)5.4 F(sysfile.c */)5.4 E 5.4(void sys_posn\(long\);)129.6
543.28 R 5.4(void sys_rew\(void\);)129.6 553.98 R 10.8
(int tty_open\(char)129.6 564.68 R(*, char *, enum parity, int\);)5.4 E
(/* ttyopen.c */)16.2 E 10.8(int tty_dial\(int,)129.6 575.38 R
(char *, char *, char *, char *\);)5.4 E(/* ttydial.c */)21.6 E
(pid_t is_locked\(char *\);)129.6 586.08 Q(/* lock.c */)108 E 5.4
(void lock_set\(char)129.6 596.78 R(*, pid_t\);)5.4 E 5.4
(void lock_rel\(pid_t\);)129.6 607.48 R 5.4(void DEBUG\(char)129.6
618.18 R(*, ...\);)5.4 E(/* debug.c */)102.6 E 5.4
(void DEBUG_NONL\(char)129.6 628.88 R(*, ...\);)5.4 E .4 LW 134.6
633.681 129.6 633.681 DL 139.6 633.681 134.6 633.681 DL 144.6 633.681
139.6 633.681 DL 149.6 633.681 144.6 633.681 DL 154.6 633.681 149.6
633.681 DL 159.6 633.681 154.6 633.681 DL 164.6 633.681 159.6 633.681 DL
169.6 633.681 164.6 633.681 DL 174.6 633.681 169.6 633.681 DL 179.6
633.681 174.6 633.681 DL 184.6 633.681 179.6 633.681 DL 189.6 633.681
184.6 633.681 DL 194.6 633.681 189.6 633.681 DL 199.6 633.681 194.6
633.681 DL 204.6 633.681 199.6 633.681 DL 209.6 633.681 204.6 633.681 DL
214.6 633.681 209.6 633.681 DL 219.6 633.681 214.6 633.681 DL 224.6
633.681 219.6 633.681 DL 229.6 633.681 224.6 633.681 DL 234.6 633.681
229.6 633.681 DL 239.6 633.681 234.6 633.681 DL 244.6 633.681 239.6
633.681 DL 249.6 633.681 244.6 633.681 DL 254.6 633.681 249.6 633.681 DL
259.6 633.681 254.6 633.681 DL 264.6 633.681 259.6 633.681 DL 269.6
633.681 264.6 633.681 DL 274.6 633.681 269.6 633.681 DL 279.6 633.681
274.6 633.681 DL 284.6 633.681 279.6 633.681 DL 289.6 633.681 284.6
633.681 DL 294.6 633.681 289.6 633.681 DL 299.6 633.681 294.6 633.681 DL
304.6 633.681 299.6 633.681 DL 309.6 633.681 304.6 633.681 DL 314.6
633.681 309.6 633.681 DL 319.6 633.681 314.6 633.681 DL 324.6 633.681
319.6 633.681 DL 329.6 633.681 324.6 633.681 DL 334.6 633.681 329.6
633.681 DL 339.6 633.681 334.6 633.681 DL 344.6 633.681 339.6 633.681 DL
349.6 633.681 344.6 633.681 DL 354.6 633.681 349.6 633.681 DL 359.6
633.681 354.6 633.681 DL 364.6 633.681 359.6 633.681 DL 369.6 633.681
364.6 633.681 DL 374.6 633.681 369.6 633.681 DL 379.6 633.681 374.6
633.681 DL 384.6 633.681 379.6 633.681 DL 389.6 633.681 384.6 633.681 DL
394.6 633.681 389.6 633.681 DL 399.6 633.681 394.6 633.681 DL 404.6
633.681 399.6 633.681 DL 409.6 633.681 404.6 633.681 DL 414.6 633.681
409.6 633.681 DL 419.6 633.681 414.6 633.681 DL 424.6 633.681 419.6
633.681 DL 429.6 633.681 424.6 633.681 DL 434.6 633.681 429.6 633.681 DL
439.6 633.681 434.6 633.681 DL 444.6 633.681 439.6 633.681 DL 449.6
633.681 444.6 633.681 DL 454.6 633.681 449.6 633.681 DL 459.6 633.681
454.6 633.681 DL 464.6 633.681 459.6 633.681 DL 469.6 633.681 464.6
633.681 DL 474.6 633.681 469.6 633.681 DL 479.6 633.681 474.6 633.681 DL
484.6 633.681 479.6 633.681 DL 489.6 633.681 484.6 633.681 DL 494.6
633.681 489.6 633.681 DL 499.6 633.681 494.6 633.681 DL 504.6 633.681
499.6 633.681 DL 509.6 633.681 504.6 633.681 DL 514.6 633.681 509.6
633.681 DL 519.6 633.681 514.6 633.681 DL/F3 8/Palatino-Bold@0 SF
(Figure 8)269.14 649.681 Q/F4 8/Palatino-Roman@0 SF(The)6 E/F5 8
/Courier@0 SF(calld.h)2 E F4(header)2 E 0 Cg EP
%%Page: 11 11
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
279.183 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF -.333(11)18 G .32
LW 97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 10/Palatino-Roman@0 SF 2.768 -.92(We d)129.6 123 T .928
(e\214ne a).92 F/F3 10/Courier@0 SF(Client)3.427 E F2(str)3.427 E(uctur)
-.08 E 3.427(et)-.18 G .927
(hat contains all the information for each client.)-3.427 F .927
(This is)5.927 F 1.254(an expansion of the similar str)129.6 135 R
(uctur)-.08 E 3.754(ei)-.18 G 3.754(nF)-3.754 G(igur)-3.754 E 3.754(e1)
-.18 G 3.754(7.35. In)-3.754 F 1.255(the time between)3.754 F F3(fork)
3.755 E F2 1.255(ing a)B .436(child to dial for a client and that child\
 terminating, we can handle any number of other)129.6 147 R 3.512
(clients. This)129.6 159 R(str)3.512 E(uctur)-.08 E 3.513(ec)-.18 G
1.013(ontains all the information that we need to try to \214nd another)
-3.513 F F3(Systems)129.6 171 Q F2
(\214le entry for that client, and try dialing again.)2.5 E 4.845 -.92
(We a)147.6 183 T 3.005(lso de\214ne one str).92 F(uctur)-.08 E 5.505
(ef)-.18 G 3.005(or all the information for a single entry in the)-5.505
F F3(Systems)129.6 195 Q F2(,)A F3(Devices)2.5 E F2 2.5(,a)C(nd)-2.5 E
F3(Dialers)2.5 E F2(\214les.)2.5 E(Figur)147.6 207 Q 2.555(e9s)-.18 G
.055(hows the)-2.555 F F3(main)2.555 E F2 .055(function for the server)
2.555 F 5.055(.S)-.74 G .055(ince this pr)-5.055 F .055
(ogram is normally r)-.18 F(un)-.08 E .311(as a daemon server)129.6 219
R 2.811(,w)-.74 G 2.811(ep)-2.811 G -.18(ro)-2.811 G .311(vide a).18 F
F3(-d)2.811 E F2 .31(command line option that lets us r)2.811 F .31
(un the pr)-.08 F(ogram)-.18 E(interactively)129.6 231 Q(.)-1.11 E .4 LW
134.6 238.2 129.6 238.2 DL 139.6 238.2 134.6 238.2 DL 144.6 238.2 139.6
238.2 DL 149.6 238.2 144.6 238.2 DL 154.6 238.2 149.6 238.2 DL 159.6
238.2 154.6 238.2 DL 164.6 238.2 159.6 238.2 DL 169.6 238.2 164.6 238.2
DL 174.6 238.2 169.6 238.2 DL 179.6 238.2 174.6 238.2 DL 184.6 238.2
179.6 238.2 DL 189.6 238.2 184.6 238.2 DL 194.6 238.2 189.6 238.2 DL
199.6 238.2 194.6 238.2 DL 204.6 238.2 199.6 238.2 DL 209.6 238.2 204.6
238.2 DL 214.6 238.2 209.6 238.2 DL 219.6 238.2 214.6 238.2 DL 224.6
238.2 219.6 238.2 DL 229.6 238.2 224.6 238.2 DL 234.6 238.2 229.6 238.2
DL 239.6 238.2 234.6 238.2 DL 244.6 238.2 239.6 238.2 DL 249.6 238.2
244.6 238.2 DL 254.6 238.2 249.6 238.2 DL 259.6 238.2 254.6 238.2 DL
264.6 238.2 259.6 238.2 DL 269.6 238.2 264.6 238.2 DL 274.6 238.2 269.6
238.2 DL 279.6 238.2 274.6 238.2 DL 284.6 238.2 279.6 238.2 DL 289.6
238.2 284.6 238.2 DL 294.6 238.2 289.6 238.2 DL 299.6 238.2 294.6 238.2
DL 304.6 238.2 299.6 238.2 DL 309.6 238.2 304.6 238.2 DL 314.6 238.2
309.6 238.2 DL 319.6 238.2 314.6 238.2 DL 324.6 238.2 319.6 238.2 DL
329.6 238.2 324.6 238.2 DL 334.6 238.2 329.6 238.2 DL 339.6 238.2 334.6
238.2 DL 344.6 238.2 339.6 238.2 DL 349.6 238.2 344.6 238.2 DL 354.6
238.2 349.6 238.2 DL 359.6 238.2 354.6 238.2 DL 364.6 238.2 359.6 238.2
DL 369.6 238.2 364.6 238.2 DL 374.6 238.2 369.6 238.2 DL 379.6 238.2
374.6 238.2 DL 384.6 238.2 379.6 238.2 DL 389.6 238.2 384.6 238.2 DL
394.6 238.2 389.6 238.2 DL 399.6 238.2 394.6 238.2 DL 404.6 238.2 399.6
238.2 DL 409.6 238.2 404.6 238.2 DL 414.6 238.2 409.6 238.2 DL 419.6
238.2 414.6 238.2 DL 424.6 238.2 419.6 238.2 DL 429.6 238.2 424.6 238.2
DL 434.6 238.2 429.6 238.2 DL 439.6 238.2 434.6 238.2 DL 444.6 238.2
439.6 238.2 DL 449.6 238.2 444.6 238.2 DL 454.6 238.2 449.6 238.2 DL
459.6 238.2 454.6 238.2 DL 464.6 238.2 459.6 238.2 DL 469.6 238.2 464.6
238.2 DL 474.6 238.2 469.6 238.2 DL 479.6 238.2 474.6 238.2 DL 484.6
238.2 479.6 238.2 DL 489.6 238.2 484.6 238.2 DL 494.6 238.2 489.6 238.2
DL 499.6 238.2 494.6 238.2 DL 504.6 238.2 499.6 238.2 DL 509.6 238.2
504.6 238.2 DL 514.6 238.2 509.6 238.2 DL 519.6 238.2 514.6 238.2 DL/F4
9/Courier@0 SF 16.2(#include "calld.h")129.6 247.701 R 16.2
(#include <syslog.h>)129.6 258.401 R 43.2(int clifd,)129.6 276.591 R
(log_to_stderr, client_size;)5.4 E 43.2(int Debug;)129.6 287.291 R
(/* Debug controlled by client, not cmd line */)10.8 E 37.8
(char errmsg[MAXLINE];)129.6 297.991 R 37.8(char *speed,)129.6 308.691 R
(*sysname;)5.4 E 32.4(uid_t uid;)129.6 319.391 R 27(Client *client)129.6
330.091 R 5.4(=N)5.4 G(ULL;)-5.4 E 21.6(Systems systems;)129.6 340.791 R
21.6(Devices devices;)129.6 351.491 R 21.6(Dialers dialers;)129.6
362.191 R(volatile sig_atomic_t chld_flag;)129.6 372.891 Q
(enum parity parity = NONE;)129.6 383.591 Q(int)129.6 401.781 Q
(main\(int argc, char *argv[]\))129.6 412.481 Q({)129.6 423.181 Q 21.6
(int c;)151.2 433.881 R(log_open\("calld", LOG_PID, LOG_USER\);)151.2
452.071 Q(opterr = 0;)151.2 470.261 Q
(/* don't want getopt\(\) writing to stderr */)27 E
(while \(\(c = getopt\(argc, argv, "d"\)\) != EOF\) {)151.2 480.961 Q
(switch \(c\) {)172.8 491.661 Q(case 'd':)172.8 502.361 Q(/* debug */)
37.8 E(log_to_stderr = 1;)194.4 513.061 Q(break;)194.4 523.761 Q
(case '?':)172.8 541.951 Q
(log_quit\("unrecognized option: -%c", optopt\);)194.4 552.651 Q(})172.8
563.351 Q(})151.2 574.051 Q(if \(log_to_stderr == 0\))151.2 592.241 Q
(daemonize\("calld"\);)172.8 602.941 Q 21.6(loop\(\); /*)151.2 621.131 R
(never returns */)5.4 E(})129.6 631.831 Q 134.6 636.632 129.6 636.632 DL
139.6 636.632 134.6 636.632 DL 144.6 636.632 139.6 636.632 DL 149.6
636.632 144.6 636.632 DL 154.6 636.632 149.6 636.632 DL 159.6 636.632
154.6 636.632 DL 164.6 636.632 159.6 636.632 DL 169.6 636.632 164.6
636.632 DL 174.6 636.632 169.6 636.632 DL 179.6 636.632 174.6 636.632 DL
184.6 636.632 179.6 636.632 DL 189.6 636.632 184.6 636.632 DL 194.6
636.632 189.6 636.632 DL 199.6 636.632 194.6 636.632 DL 204.6 636.632
199.6 636.632 DL 209.6 636.632 204.6 636.632 DL 214.6 636.632 209.6
636.632 DL 219.6 636.632 214.6 636.632 DL 224.6 636.632 219.6 636.632 DL
229.6 636.632 224.6 636.632 DL 234.6 636.632 229.6 636.632 DL 239.6
636.632 234.6 636.632 DL 244.6 636.632 239.6 636.632 DL 249.6 636.632
244.6 636.632 DL 254.6 636.632 249.6 636.632 DL 259.6 636.632 254.6
636.632 DL 264.6 636.632 259.6 636.632 DL 269.6 636.632 264.6 636.632 DL
274.6 636.632 269.6 636.632 DL 279.6 636.632 274.6 636.632 DL 284.6
636.632 279.6 636.632 DL 289.6 636.632 284.6 636.632 DL 294.6 636.632
289.6 636.632 DL 299.6 636.632 294.6 636.632 DL 304.6 636.632 299.6
636.632 DL 309.6 636.632 304.6 636.632 DL 314.6 636.632 309.6 636.632 DL
319.6 636.632 314.6 636.632 DL 324.6 636.632 319.6 636.632 DL 329.6
636.632 324.6 636.632 DL 334.6 636.632 329.6 636.632 DL 339.6 636.632
334.6 636.632 DL 344.6 636.632 339.6 636.632 DL 349.6 636.632 344.6
636.632 DL 354.6 636.632 349.6 636.632 DL 359.6 636.632 354.6 636.632 DL
364.6 636.632 359.6 636.632 DL 369.6 636.632 364.6 636.632 DL 374.6
636.632 369.6 636.632 DL 379.6 636.632 374.6 636.632 DL 384.6 636.632
379.6 636.632 DL 389.6 636.632 384.6 636.632 DL 394.6 636.632 389.6
636.632 DL 399.6 636.632 394.6 636.632 DL 404.6 636.632 399.6 636.632 DL
409.6 636.632 404.6 636.632 DL 414.6 636.632 409.6 636.632 DL 419.6
636.632 414.6 636.632 DL 424.6 636.632 419.6 636.632 DL 429.6 636.632
424.6 636.632 DL 434.6 636.632 429.6 636.632 DL 439.6 636.632 434.6
636.632 DL 444.6 636.632 439.6 636.632 DL 449.6 636.632 444.6 636.632 DL
454.6 636.632 449.6 636.632 DL 459.6 636.632 454.6 636.632 DL 464.6
636.632 459.6 636.632 DL 469.6 636.632 464.6 636.632 DL 474.6 636.632
469.6 636.632 DL 479.6 636.632 474.6 636.632 DL 484.6 636.632 479.6
636.632 DL 489.6 636.632 484.6 636.632 DL 494.6 636.632 489.6 636.632 DL
499.6 636.632 494.6 636.632 DL 504.6 636.632 499.6 636.632 DL 509.6
636.632 504.6 636.632 DL 514.6 636.632 509.6 636.632 DL 519.6 636.632
514.6 636.632 DL/F5 8/Palatino-Bold@0 SF(Figure 9)273.696 652.632 Q/F6 8
/Palatino-Roman@0 SF(The)6 E/F7 8/Courier@0 SF(main)2 E F6(function)2 E
0 Cg EP
%%Page: 12 12
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(12)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF .482(When the)129.6 123 R/F3 10/Courier@0 SF(-d)
2.982 E F2 .482(option is set, all the calls to the)2.982 F F3(log_XXX)
2.983 E F2 .483(functions \(Appendix B\) ar)2.983 F 2.983(es)-.18 G(ent)
-2.983 E(to standar)129.6 135 Q 2.5(de)-.18 G(rr)-2.5 E(or)-.18 E 5(.O)
-.74 G(therwise they ar)-5 E 2.5(el)-.18 G(ogged using)-2.5 E F3(syslog)
2.5 E F2(.)A 1.652(The function)147.6 147 R F3(loop)4.152 E F2 1.651
(is the main loop of the server \(Figur)4.152 F 4.151(e1)-.18 G 4.151
(0\). It)-4.151 F 1.651(multiplexes the)4.151 F
(various descriptors with the)129.6 159 Q F3(select)2.5 E F2(function.)
2.5 E .4 LW 134.6 166.2 129.6 166.2 DL 139.6 166.2 134.6 166.2 DL 144.6
166.2 139.6 166.2 DL 149.6 166.2 144.6 166.2 DL 154.6 166.2 149.6 166.2
DL 159.6 166.2 154.6 166.2 DL 164.6 166.2 159.6 166.2 DL 169.6 166.2
164.6 166.2 DL 174.6 166.2 169.6 166.2 DL 179.6 166.2 174.6 166.2 DL
184.6 166.2 179.6 166.2 DL 189.6 166.2 184.6 166.2 DL 194.6 166.2 189.6
166.2 DL 199.6 166.2 194.6 166.2 DL 204.6 166.2 199.6 166.2 DL 209.6
166.2 204.6 166.2 DL 214.6 166.2 209.6 166.2 DL 219.6 166.2 214.6 166.2
DL 224.6 166.2 219.6 166.2 DL 229.6 166.2 224.6 166.2 DL 234.6 166.2
229.6 166.2 DL 239.6 166.2 234.6 166.2 DL 244.6 166.2 239.6 166.2 DL
249.6 166.2 244.6 166.2 DL 254.6 166.2 249.6 166.2 DL 259.6 166.2 254.6
166.2 DL 264.6 166.2 259.6 166.2 DL 269.6 166.2 264.6 166.2 DL 274.6
166.2 269.6 166.2 DL 279.6 166.2 274.6 166.2 DL 284.6 166.2 279.6 166.2
DL 289.6 166.2 284.6 166.2 DL 294.6 166.2 289.6 166.2 DL 299.6 166.2
294.6 166.2 DL 304.6 166.2 299.6 166.2 DL 309.6 166.2 304.6 166.2 DL
314.6 166.2 309.6 166.2 DL 319.6 166.2 314.6 166.2 DL 324.6 166.2 319.6
166.2 DL 329.6 166.2 324.6 166.2 DL 334.6 166.2 329.6 166.2 DL 339.6
166.2 334.6 166.2 DL 344.6 166.2 339.6 166.2 DL 349.6 166.2 344.6 166.2
DL 354.6 166.2 349.6 166.2 DL 359.6 166.2 354.6 166.2 DL 364.6 166.2
359.6 166.2 DL 369.6 166.2 364.6 166.2 DL 374.6 166.2 369.6 166.2 DL
379.6 166.2 374.6 166.2 DL 384.6 166.2 379.6 166.2 DL 389.6 166.2 384.6
166.2 DL 394.6 166.2 389.6 166.2 DL 399.6 166.2 394.6 166.2 DL 404.6
166.2 399.6 166.2 DL 409.6 166.2 404.6 166.2 DL 414.6 166.2 409.6 166.2
DL 419.6 166.2 414.6 166.2 DL 424.6 166.2 419.6 166.2 DL 429.6 166.2
424.6 166.2 DL 434.6 166.2 429.6 166.2 DL 439.6 166.2 434.6 166.2 DL
444.6 166.2 439.6 166.2 DL 449.6 166.2 444.6 166.2 DL 454.6 166.2 449.6
166.2 DL 459.6 166.2 454.6 166.2 DL 464.6 166.2 459.6 166.2 DL 469.6
166.2 464.6 166.2 DL 474.6 166.2 469.6 166.2 DL 479.6 166.2 474.6 166.2
DL 484.6 166.2 479.6 166.2 DL 489.6 166.2 484.6 166.2 DL 494.6 166.2
489.6 166.2 DL 499.6 166.2 494.6 166.2 DL 504.6 166.2 499.6 166.2 DL
509.6 166.2 504.6 166.2 DL 514.6 166.2 509.6 166.2 DL 519.6 166.2 514.6
166.2 DL/F4 9/Courier@0 SF 16.2(#include "calld.h")129.6 175.701 R 16.2
(#include <errno.h>)129.6 186.401 R(static void cli_done\(int\);)129.6
204.591 Q(static void child_done\(int\);)129.6 215.291 Q(/*)129.6
233.481 Q 5.4(*O)135 244.181 S
(ne bit per client cxn, plus one for listenfd;)-5.4 E 5.4(*m)135 254.881
S(odified by loop\(\) and cli_done\(\))-5.4 E(*/)135 265.581 Q
(static fd_set)129.6 276.281 Q(allset;)16.2 E(void)129.6 294.471 Q
(loop\(void\))129.6 305.171 Q({)129.6 315.871 Q 27(int i,)151.2 326.571
R(n, maxfd, maxi, listenfd, nread;)5.4 E 21.6(char buf[MAXLINE];)151.2
337.271 R 5.4(Client *cliptr;)151.2 347.971 R 16.2(uid_t uid;)151.2
358.671 R 10.8(fd_set rset;)151.2 369.371 R
(if \(signal_intr\(SIGCHLD, sig_chld\) == SIG_ERR\))151.2 387.561 Q
(log_sys\("signal error"\);)172.8 398.261 Q(/*)151.2 416.451 Q 5.4(*O)
156.6 427.151 S(btain descriptor to listen for client requests on.)-5.4
E(*/)156.6 437.851 Q(if \(\(listenfd = serv_listen\(CS_CALL\)\) < 0\))
151.2 448.551 Q(log_sys\("serv_listen error"\);)172.8 459.251 Q
(FD_ZERO\(&allset\);)151.2 477.441 Q(FD_SET\(listenfd, &allset\);)151.2
488.141 Q(maxfd = listenfd;)151.2 498.841 Q(maxi = -1;)151.2 509.541 Q
(for \( ; ; \) {)151.2 527.731 Q(if \(chld_flag\))172.8 538.431 Q
(child_done\(maxi\);)194.4 549.131 Q(rset = allset;)172.8 559.831 Q
(/* rset gets modified each time around */)32.4 E
(if \(\(n = select\(maxfd + 1, &rset, NULL, NULL, NULL\)\) < 0\) {)172.8
570.531 Q(if \(errno == EINTR\) {)194.4 581.231 Q(/*)216 591.931 Q 5.4
(*C)221.4 602.631 S(aught SIGCHLD, find entry with childdone set.)-5.4 E
(*/)221.4 613.331 Q(child_done\(maxi\);)216 624.031 Q 32.4(continue; /*)
216 634.731 R(issue the select again */)5.4 E 5.4(}e)194.4 645.431 S
(lse {)-5.4 E(log_sys\("select error"\);)216 656.131 Q 0 Cg EP
%%Page: 13 13
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(13)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(})194.4 121.7 Q(})172.8 132.4 Q
(if \(FD_ISSET\(listenfd, &rset\)\) {)172.8 150.59 Q(/*)194.4 161.29 Q
5.4(*A)199.8 171.99 S(ccept new client request.)-5.4 E(*/)199.8 182.69 Q
(if \(\(clifd = serv_accept\(listenfd, &uid\)\) < 0\))194.4 193.39 Q
(log_sys\("serv_accept error: %d", clifd\);)216 204.09 Q 5.4(i=c)194.4
214.79 S(lient_add\(clifd, uid\);)-5.4 E(FD_SET\(clifd, &allset\);)194.4
225.49 Q(if \(clifd > maxfd\))194.4 236.19 Q(maxfd = clifd;)216 246.89 Q
(/* max fd for select\(\) */)10.8 E(if \(i > maxi\))194.4 257.59 Q
(maxi = i;)216 268.29 Q(/* max index in client[] array */)37.8 E
(log_msg\("new connection: uid %d, fd %d", uid, clifd\);)194.4 278.99 Q
(continue;)194.4 289.69 Q(})172.8 300.39 Q(/*)172.8 318.58 Q 5.4(*G)
178.2 329.28 S 5.4(ot)-5.4 G(hrough client[] array.)-5.4 E 5.4(*R)178.2
339.98 S(ead any client data that has arrived.)-5.4 E(*/)178.2 350.68 Q
(for \(cliptr = &client[0]; cliptr <= &client[maxi]; cliptr++\) {)172.8
361.38 Q(if \(\(clifd = cliptr->fd\) < 0\))194.4 372.08 Q(continue;)216
382.78 Q(if \(FD_ISSET\(clifd, &rset\)\) {)194.4 393.48 Q(/*)216 404.18
Q 5.4(*R)221.4 414.88 S(ead argument buffer from client.)-5.4 E(*/)221.4
425.58 Q(if \(\(nread = read\(clifd, buf, MAXLINE\)\) < 0\) {)216 436.28
Q(log_sys\("read error on fd %d", clifd\);)237.6 446.98 Q 5.4(}e)216
457.68 S(lse if \(nread == 0\) {)-5.4 E(/*)237.6 468.38 Q 5.4(*T)243
479.08 S(he client has terminated or closed)-5.4 E 5.4(*t)243 489.78 S
(he stream pipe.)-5.4 E(Now we can release)10.8 E 5.4(*i)243 500.48 S
(ts device lock.)-5.4 E(*/)243 511.18 Q
(log_msg\("closed: uid %d, fd %d",)237.6 521.88 Q(cliptr->uid, clifd\);)
248.4 532.58 Q(lock_rel\(cliptr->pid\);)237.6 543.28 Q
(cli_done\(clifd\);)237.6 553.98 Q(continue;)237.6 564.68 Q(})216 575.38
Q(/*)216 593.57 Q 5.4(*D)221.4 604.27 S
(ata has arrived from the client.)-5.4 E 5.4(*P)221.4 614.97 S
(rocess the client's request.)-5.4 E(*/)221.4 625.67 Q
(if \(buf[nread-1] != 0\) {)216 636.37 Q
(log_quit\("request from uid %d not null terminated:")237.6 647.07 Q 5.4
("%)248.4 657.77 S(*.*s", uid, nread, nread, buf\);)-5.4 E 0 Cg EP
%%Page: 14 14
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(14)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(cli_done\(clifd\);)237.6 121.7 Q(continue;)237.6 132.4 Q
(})216 143.1 Q(log_msg\("starting: %s, from uid %d", buf, uid\);)216
153.8 Q(/*)216 171.99 Q 5.4(*P)221.4 182.69 S
(arse the arguments, set options.)-5.4 E(Since)10.8 E 5.4(*w)221.4
193.39 S 5.4(em)-5.4 G(ay need to try calling again for this)-5.4 E 5.4
(*c)221.4 204.09 S(lient, save options in client[] array.)-5.4 E(*/)
221.4 214.79 Q(if \(buf_args\(buf, cli_args\) < 0\))216 225.49 Q
(log_quit\("command line error: %s", buf\);)237.6 236.19 Q
(cliptr->Debug = Debug;)216 246.89 Q(cliptr->parity = parity;)216 257.59
Q(strcpy\(cliptr->sysname, sysname\);)216 268.29 Q
(strcpy\(cliptr->speed, \(speed == NULL\) ? "" : speed\);)216 278.99 Q
(cliptr->childdone = 0;)216 289.69 Q(cliptr->sysftell = 0;)216 300.39 Q
(cliptr->foundone = 0;)216 311.09 Q(if \(request\(cliptr\) < 0\) {)216
329.28 Q(/*)237.6 339.98 Q 5.4(*S)243 350.68 S
(ystem not found, or unable to connect.)-5.4 E(*/)243 361.38 Q
(if \(send_err\(cliptr->fd, -1, errmsg\) < 0\))237.6 372.08 Q
(log_sys\("send_err error"\);)259.2 382.78 Q(cli_done\(clifd\);)237.6
393.48 Q(continue;)237.6 404.18 Q(})216 414.88 Q(/*)216 425.58 Q 5.4(*A)
221.4 436.28 S 5.4(tt)-5.4 G
(his point request\(\) has forked a child that is)-5.4 E 5.4(*t)221.4
446.98 S(rying to dial the remote system.)-5.4 E(We'll find)10.8 E 5.4
(*o)221.4 457.68 S(ut the child's status when it terminates.)-5.4 E(*/)
221.4 468.38 Q(})194.4 479.08 Q(})172.8 489.78 Q(})151.2 500.48 Q(})
129.6 511.18 Q(/*)129.6 529.37 Q 5.4(*G)135 540.07 S 5.4(ot)-5.4 G
(hrough the client[] array looking for clients whose dialing)-5.4 E 5.4
(*c)135 550.77 S(hildren have terminated.)-5.4 E
(This function is called by loop\(\) when)10.8 E 5.4(*c)135 561.47 S
(hld_flag \(the flag set by the SIGCHLD handler\) is nonzero.)-5.4 E(*/)
135 572.17 Q(static void)129.6 582.87 Q(child_done\(int maxi\))129.6
593.57 Q({)129.6 604.27 Q 5.4(Client *cliptr;)151.2 614.97 R(again:)
129.6 633.16 Q(chld_flag = 0;)151.2 643.86 Q
(/* to check when done with loop for more SIGCHLDs */)10.8 E
(for \(cliptr = &client[0]; cliptr <= &client[maxi]; cliptr++\) {)151.2
654.56 Q 0 Cg EP
%%Page: 15 15
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(15)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(if \(\(clifd = cliptr->fd\) < 0\))172.8 121.7
Q(continue;)194.4 132.4 Q(if \(cliptr->childdone\) {)172.8 143.1 Q
(log_msg\("child done: pid %d, status %d",)194.4 153.8 Q
(cliptr->pid, cliptr->childdone-1\);)205.2 164.5 Q(/*)194.4 182.69 Q 5.4
(*I)199.8 193.39 S 5.4(ft)-5.4 G
(he child was successful \(exit\(0\)\), just clear the)-5.4 E 5.4(*f)
199.8 204.09 S 5.4(lag. When)-5.4 F
(the client terminates, we'll read the EOF)5.4 E 5.4(*o)199.8 214.79 S
5.4(nt)-5.4 G(he stream pipe above and release the device lock.)-5.4 E
(*/)199.8 225.49 Q(if \(cliptr->childdone == 1\) {)194.4 236.19 Q
(/* child did exit\(0\) */)16.2 E(cliptr->childdone = 0;)216 246.89 Q
(continue;)216 257.59 Q(})194.4 268.29 Q(/*)194.4 286.48 Q 5.4(*U)199.8
297.18 S(nsuccessful: child did exit\(1\).)-5.4 E(Release the device)
10.8 E 5.4(*l)199.8 307.88 S(ock and try again from where we left off.)
-5.4 E(*/)199.8 318.58 Q(cliptr->childdone = 0;)194.4 329.28 Q 5.4
(lock_rel\(cliptr->pid\); /*)194.4 339.98 R(unlock the device entry */)
5.4 E(if \(request\(cliptr\) < 0\) {)194.4 350.68 Q(/*)216 361.38 Q 5.4
(*S)221.4 372.08 S(till unable, time to give up.)-5.4 E(*/)221.4 382.78
Q(if \(send_err\(cliptr->fd, -1, errmsg\) < 0\))216 393.48 Q
(log_sys\("send_err error"\);)237.6 404.18 Q(cli_done\(clifd\);)216
414.88 Q(continue;)216 425.58 Q(})194.4 436.28 Q(/*)194.4 446.98 Q 5.4
(*r)199.8 457.68 S(equest\(\) has forked another child for this client.)
-5.4 E(*/)199.8 468.38 Q(})172.8 479.08 Q(})151.2 489.78 Q
(if \(chld_flag\))151.2 500.48 Q
(/* additional SIGCHLDs have been caught */)10.8 E
(goto again; /* need to check all childdone flags again */)172.8 511.18
Q(})129.6 521.88 Q(/*)129.6 540.07 Q 5.4(*C)135 550.77 S
(lean up when we're done with a client.)-5.4 E(*/)135 561.47 Q
(static void)129.6 572.17 Q(cli_done\(int clifd\))129.6 582.87 Q({)129.6
593.57 Q 27(client_del\(clifd\); /*)151.2 604.27 R
(delete entry in client[] array */)5.4 E
(FD_CLR\(clifd, &allset\); /* turn off bit in select\(\) set */)151.2
614.97 Q 54(close\(clifd\); /*)151.2 625.67 R
(close our end of stream pipe */)5.4 E(})129.6 636.37 Q .4 LW 134.6
641.171 129.6 641.171 DL 139.6 641.171 134.6 641.171 DL 144.6 641.171
139.6 641.171 DL 149.6 641.171 144.6 641.171 DL 154.6 641.171 149.6
641.171 DL 159.6 641.171 154.6 641.171 DL 164.6 641.171 159.6 641.171 DL
169.6 641.171 164.6 641.171 DL 174.6 641.171 169.6 641.171 DL 179.6
641.171 174.6 641.171 DL 184.6 641.171 179.6 641.171 DL 189.6 641.171
184.6 641.171 DL 194.6 641.171 189.6 641.171 DL 199.6 641.171 194.6
641.171 DL 204.6 641.171 199.6 641.171 DL 209.6 641.171 204.6 641.171 DL
214.6 641.171 209.6 641.171 DL 219.6 641.171 214.6 641.171 DL 224.6
641.171 219.6 641.171 DL 229.6 641.171 224.6 641.171 DL 234.6 641.171
229.6 641.171 DL 239.6 641.171 234.6 641.171 DL 244.6 641.171 239.6
641.171 DL 249.6 641.171 244.6 641.171 DL 254.6 641.171 249.6 641.171 DL
259.6 641.171 254.6 641.171 DL 264.6 641.171 259.6 641.171 DL 269.6
641.171 264.6 641.171 DL 274.6 641.171 269.6 641.171 DL 279.6 641.171
274.6 641.171 DL 284.6 641.171 279.6 641.171 DL 289.6 641.171 284.6
641.171 DL 294.6 641.171 289.6 641.171 DL 299.6 641.171 294.6 641.171 DL
304.6 641.171 299.6 641.171 DL 309.6 641.171 304.6 641.171 DL 314.6
641.171 309.6 641.171 DL 319.6 641.171 314.6 641.171 DL 324.6 641.171
319.6 641.171 DL 329.6 641.171 324.6 641.171 DL 334.6 641.171 329.6
641.171 DL 339.6 641.171 334.6 641.171 DL 344.6 641.171 339.6 641.171 DL
349.6 641.171 344.6 641.171 DL 354.6 641.171 349.6 641.171 DL 359.6
641.171 354.6 641.171 DL 364.6 641.171 359.6 641.171 DL 369.6 641.171
364.6 641.171 DL 374.6 641.171 369.6 641.171 DL 379.6 641.171 374.6
641.171 DL 384.6 641.171 379.6 641.171 DL 389.6 641.171 384.6 641.171 DL
394.6 641.171 389.6 641.171 DL 399.6 641.171 394.6 641.171 DL 404.6
641.171 399.6 641.171 DL 409.6 641.171 404.6 641.171 DL 414.6 641.171
409.6 641.171 DL 419.6 641.171 414.6 641.171 DL 424.6 641.171 419.6
641.171 DL 429.6 641.171 424.6 641.171 DL 434.6 641.171 429.6 641.171 DL
439.6 641.171 434.6 641.171 DL 444.6 641.171 439.6 641.171 DL 449.6
641.171 444.6 641.171 DL 454.6 641.171 449.6 641.171 DL 459.6 641.171
454.6 641.171 DL 464.6 641.171 459.6 641.171 DL 469.6 641.171 464.6
641.171 DL 474.6 641.171 469.6 641.171 DL 479.6 641.171 474.6 641.171 DL
484.6 641.171 479.6 641.171 DL 489.6 641.171 484.6 641.171 DL 494.6
641.171 489.6 641.171 DL 499.6 641.171 494.6 641.171 DL 504.6 641.171
499.6 641.171 DL 509.6 641.171 504.6 641.171 DL 514.6 641.171 509.6
641.171 DL 519.6 641.171 514.6 641.171 DL/F3 8/Palatino-Bold@0 SF
(Figure 10)276.224 657.171 Q/F4 8/Palatino-Roman@0 SF(The)6 E/F5 8
/Courier@0 SF(loop.c)2 E F4(\214le)2 E 0 Cg EP
%%Page: 16 16
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(16)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF(The)129.6 123 Q/F3 10/Courier@0 SF(loop)4.413 E
F2 1.913(function initializes the)4.413 F F3(client)4.413 E F2 1.914
(array and establishes a signal handler for)4.413 F F3(SIGCHLD)129.6 135
Q F2 6.597(.W)C 4.097(ec)-7.517 G(all)-4.097 E F3(signal_intr)4.096 E F2
1.596(instead of)4.096 F F3(signal)4.096 E F2 1.596
(so that any slow system call is)4.096 F(interr)129.6 147 Q 5.929
(upted when our signal handler r)-.08 F 8.429(eturns. The)-.18 F F3
(loop)8.429 E F2 5.929(function then calls)8.429 F F3(serv_listen)129.6
159 Q F2(\(Figur)4.281 E 1.781(es 17.10 and 17.15\).)-.18 F 1.781(The r)
6.781 F 1.781(est of the function is an in\214nite loop)-.18 F
(based on the)129.6 171 Q F3(select)2.5 E F2
(function, that tests for the following two conditions:)2.5 E 6.33
(1. If)147.6 187.8 R 6.715(an)6.715 G 4.215
(ew client connection arrives, we call)-6.715 F F3(serv_accept)6.715 E
F2(\(Figur)6.715 E 4.215(es 17.1)-.18 F(1)-.55 E .401(and 17.16\).)
163.93 199.8 R .401(The function)5.401 F F3(client_add)2.901 E F2(cr)
2.901 E .401(eates an entry in the)-.18 F F3(client)2.901 E F2 .4
(array for)2.9 F(the new client.)163.93 211.8 Q 6.33(2. W)147.6 227.8 R
2.934(et)-.92 G .434(hen go thr)-2.934 F .434(ough the)-.18 F F3(client)
2.934 E F2(array)2.934 E 2.934(,t)-1.11 G 2.934(os)-2.934 G .434
(ee if \(a\) any client has terminated, or)-2.934 F(\(b\) any client r)
163.93 239.8 Q(equests have arrived.)-.18 E .196(When a client terminat\
es \(whether voluntarily or not\) its client-speci\214c s-pipe to)163.93
257.8 R .881(the server is closed, and we r)163.93 269.8 R .881
(ead an end of \214le fr)-.18 F .881(om our end of the s-pipe.)-.18 F
(At)5.882 E .548(this point we can r)163.93 281.8 R .548
(elease any device locks that the client owned and r)-.18 F .547
(elease the)-.18 F(entry in the)163.93 293.8 Q F3(client)2.5 E F2(array)
2.5 E(.)-1.11 E .842(When a r)163.93 311.8 R .842(equest arrives fr)-.18
F .842(om a client, we set things up and call)-.18 F F3(request)3.343 E
F2 5.843(.\()C -.92(We)-5.843 G 2.102(showed the function)163.93 323.8 R
F3(buf_args)4.602 E F2 2.102(in Figur)4.602 F 4.602(e1)-.18 G 4.602
(7.32.\) If)-4.602 F 2.101(the name of the r)4.602 F(emote)-.18 E 1.531
(system is valid and if an available device entry is located,)163.93
335.8 R F3 -1.969(request fork)4.031 F F2 4.031(sa)C(child pr)163.93
347.8 Q(ocess and r)-.18 E(eturns.)-.18 E 1.664(The termination of a ch\
ild is one external event that can happen at any time in this)129.6
364.6 R 3.284(function. If)129.6 376.6 R(we'r)3.284 E 3.284(eb)-.18 G
.784(locked in the)-3.284 F F3(select)3.285 E F2 .785(function, it r)
3.285 F .785(eturns an err)-.18 F .785(or of)-.18 F F3(EINTR)3.285 E F2
.785(in this)3.285 F 3.046(case. Since)129.6 388.6 R .546
(the signal can also happen at other points in the)3.046 F F3(loop)3.045
E F2 .545(function, we test the)3.045 F(\215ag)129.6 400.6 Q F3
(chld_flag)3.83 E F2 1.33(each time thr)3.83 F 1.331
(ough the loop befor)-.18 F 3.831(ec)-.18 G(alling)-3.831 E F3(select)
3.831 E F2 6.331(.I)C 3.831(ft)-6.331 G 1.331(he signal has)-3.831 F
(occurr)129.6 412.6 Q(ed, we call the function)-.18 E F3(child_done)2.5
E F2(to pr)2.5 E(ocess the termination.)-.18 E 1.254
(This function goes thr)147.6 424.6 R 1.254(ough the)-.18 F F3(client)
3.754 E F2(array)3.754 E 3.754(,e)-1.11 G 1.253(xamining the)-3.754 F F3
(childdone)3.753 E F2 1.253(\215ag for)3.753 F .193(each valid entry)
129.6 436.6 R 5.193(.I)-1.11 G 2.693(ft)-5.193 G .194
(he child was successful, ther)-2.693 F .194
(e's nothing else to do at this point.)-.18 F(But)5.194 E .373
(if the child terminated with an)129.6 448.6 R F3(exit)2.873 E F2 .372
(status of 1, we call)2.872 F F3(request)2.872 E F2 .372
(to try to \214nd another)2.872 F F3(Systems)129.6 460.6 Q F2
(\214le entry for this client.)2.5 E(Figur)147.6 472.6 Q 2.927(e1)-.18 G
2.927(1s)-3.477 G .427(hows the function)-2.927 F F3(cli_args)2.928 E F2
2.928(,w)C .428(hich is called by)-2.928 F F3(buf_args)2.928 E F2 .428
(in the)2.928 F F3(loop)2.928 E F2 .513(function when a client r)129.6
484.6 R .513(equest arrives.)-.18 F 3.013(It pr)5.513 F .513
(ocesses the command)-.18 F(-)-.9 I .512(line ar).9 J .512(guments fr)
-.18 F(om)-.18 E(the client.)129.6 496.6 Q .4 LW 134.6 503.8 129.6 503.8
DL 139.6 503.8 134.6 503.8 DL 144.6 503.8 139.6 503.8 DL 149.6 503.8
144.6 503.8 DL 154.6 503.8 149.6 503.8 DL 159.6 503.8 154.6 503.8 DL
164.6 503.8 159.6 503.8 DL 169.6 503.8 164.6 503.8 DL 174.6 503.8 169.6
503.8 DL 179.6 503.8 174.6 503.8 DL 184.6 503.8 179.6 503.8 DL 189.6
503.8 184.6 503.8 DL 194.6 503.8 189.6 503.8 DL 199.6 503.8 194.6 503.8
DL 204.6 503.8 199.6 503.8 DL 209.6 503.8 204.6 503.8 DL 214.6 503.8
209.6 503.8 DL 219.6 503.8 214.6 503.8 DL 224.6 503.8 219.6 503.8 DL
229.6 503.8 224.6 503.8 DL 234.6 503.8 229.6 503.8 DL 239.6 503.8 234.6
503.8 DL 244.6 503.8 239.6 503.8 DL 249.6 503.8 244.6 503.8 DL 254.6
503.8 249.6 503.8 DL 259.6 503.8 254.6 503.8 DL 264.6 503.8 259.6 503.8
DL 269.6 503.8 264.6 503.8 DL 274.6 503.8 269.6 503.8 DL 279.6 503.8
274.6 503.8 DL 284.6 503.8 279.6 503.8 DL 289.6 503.8 284.6 503.8 DL
294.6 503.8 289.6 503.8 DL 299.6 503.8 294.6 503.8 DL 304.6 503.8 299.6
503.8 DL 309.6 503.8 304.6 503.8 DL 314.6 503.8 309.6 503.8 DL 319.6
503.8 314.6 503.8 DL 324.6 503.8 319.6 503.8 DL 329.6 503.8 324.6 503.8
DL 334.6 503.8 329.6 503.8 DL 339.6 503.8 334.6 503.8 DL 344.6 503.8
339.6 503.8 DL 349.6 503.8 344.6 503.8 DL 354.6 503.8 349.6 503.8 DL
359.6 503.8 354.6 503.8 DL 364.6 503.8 359.6 503.8 DL 369.6 503.8 364.6
503.8 DL 374.6 503.8 369.6 503.8 DL 379.6 503.8 374.6 503.8 DL 384.6
503.8 379.6 503.8 DL 389.6 503.8 384.6 503.8 DL 394.6 503.8 389.6 503.8
DL 399.6 503.8 394.6 503.8 DL 404.6 503.8 399.6 503.8 DL 409.6 503.8
404.6 503.8 DL 414.6 503.8 409.6 503.8 DL 419.6 503.8 414.6 503.8 DL
424.6 503.8 419.6 503.8 DL 429.6 503.8 424.6 503.8 DL 434.6 503.8 429.6
503.8 DL 439.6 503.8 434.6 503.8 DL 444.6 503.8 439.6 503.8 DL 449.6
503.8 444.6 503.8 DL 454.6 503.8 449.6 503.8 DL 459.6 503.8 454.6 503.8
DL 464.6 503.8 459.6 503.8 DL 469.6 503.8 464.6 503.8 DL 474.6 503.8
469.6 503.8 DL 479.6 503.8 474.6 503.8 DL 484.6 503.8 479.6 503.8 DL
489.6 503.8 484.6 503.8 DL 494.6 503.8 489.6 503.8 DL 499.6 503.8 494.6
503.8 DL 504.6 503.8 499.6 503.8 DL 509.6 503.8 504.6 503.8 DL 514.6
503.8 509.6 503.8 DL 519.6 503.8 514.6 503.8 DL/F4 9/Courier@0 SF 16.2
(#include "calld.h")129.6 513.301 R(/*)129.6 530.421 Q 5.4(*T)135
541.121 S
(his function is called by buf_args\(\), which is called by loop\(\).)
-5.4 E 5.4(*b)135 551.821 S
(uf_args\(\) has broken up the client's buffer into an argv[] style)-5.4
E 5.4(*a)135 562.521 S(rray, which is now processed.)-5.4 E(*/)135
573.221 Q(int)129.6 583.921 Q(cli_args\(int argc, char **argv\))129.6
594.621 Q({)129.6 605.321 Q 21.6(int c;)151.2 616.021 R
(if \(argc < 2 || strcmp\(argv[0], CL_CALL\) != 0\) {)151.2 633.141 Q
(strcpy\(errmsg, "usage: call <options> <hostname>"\);)172.8 643.841 Q
(return\(-1\);)172.8 654.541 Q 0 Cg EP
%%Page: 17 17
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(17)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(})151.2 121.7 Q(Debug = 0;)151.2 132.4 Q
(/* option defaults */)32.4 E(parity = NONE;)151.2 143.1 Q
(speed = NULL;)151.2 153.8 Q(opterr = 0;)151.2 164.5 Q
(/* don't want getopt\(\) writing to stderr */)27 E(optind = 1;)151.2
175.2 Q(/* since we call getopt\(\) multiple times */)27 E
(while \(\(c = getopt\(argc, argv, "des:o"\)\) != EOF\) {)151.2 185.9 Q
(switch \(c\) {)172.8 196.6 Q(case 'd':)172.8 207.3 Q(Debug = 1;)194.4
218 Q(/* client wants DEBUG\(\) output */)10.8 E(break;)194.4 228.7 Q
(case 'e':)172.8 245.82 Q(/* even parity */)37.8 E(parity = EVEN;)194.4
256.52 Q(break;)194.4 267.22 Q(case 'o':)172.8 284.34 Q
(/* odd parity */)37.8 E(parity = ODD;)194.4 295.04 Q(break;)194.4
305.74 Q(case 's':)172.8 322.86 Q(/* speed */)37.8 E(speed = optarg;)
194.4 333.56 Q(break;)194.4 344.26 Q(case '?':)172.8 361.38 Q
(sprintf\(errmsg, "unrecognized option: -%c\\n", optopt\);)194.4 372.08
Q(return\(-1\);)194.4 382.78 Q(})172.8 393.48 Q(})151.2 404.18 Q
(if \(optind >= argc\) {)151.2 414.88 Q
(sprintf\(errmsg, "missing <hostname> to call\\n"\);)172.8 425.58 Q
(return\(-1\);)172.8 436.28 Q(})151.2 446.98 Q(sysname = argv[optind];)
151.2 457.68 Q(/* name of host to call */)27 E(return\(0\);)151.2 468.38
Q(})129.6 479.08 Q .4 LW 134.6 483.881 129.6 483.881 DL 139.6 483.881
134.6 483.881 DL 144.6 483.881 139.6 483.881 DL 149.6 483.881 144.6
483.881 DL 154.6 483.881 149.6 483.881 DL 159.6 483.881 154.6 483.881 DL
164.6 483.881 159.6 483.881 DL 169.6 483.881 164.6 483.881 DL 174.6
483.881 169.6 483.881 DL 179.6 483.881 174.6 483.881 DL 184.6 483.881
179.6 483.881 DL 189.6 483.881 184.6 483.881 DL 194.6 483.881 189.6
483.881 DL 199.6 483.881 194.6 483.881 DL 204.6 483.881 199.6 483.881 DL
209.6 483.881 204.6 483.881 DL 214.6 483.881 209.6 483.881 DL 219.6
483.881 214.6 483.881 DL 224.6 483.881 219.6 483.881 DL 229.6 483.881
224.6 483.881 DL 234.6 483.881 229.6 483.881 DL 239.6 483.881 234.6
483.881 DL 244.6 483.881 239.6 483.881 DL 249.6 483.881 244.6 483.881 DL
254.6 483.881 249.6 483.881 DL 259.6 483.881 254.6 483.881 DL 264.6
483.881 259.6 483.881 DL 269.6 483.881 264.6 483.881 DL 274.6 483.881
269.6 483.881 DL 279.6 483.881 274.6 483.881 DL 284.6 483.881 279.6
483.881 DL 289.6 483.881 284.6 483.881 DL 294.6 483.881 289.6 483.881 DL
299.6 483.881 294.6 483.881 DL 304.6 483.881 299.6 483.881 DL 309.6
483.881 304.6 483.881 DL 314.6 483.881 309.6 483.881 DL 319.6 483.881
314.6 483.881 DL 324.6 483.881 319.6 483.881 DL 329.6 483.881 324.6
483.881 DL 334.6 483.881 329.6 483.881 DL 339.6 483.881 334.6 483.881 DL
344.6 483.881 339.6 483.881 DL 349.6 483.881 344.6 483.881 DL 354.6
483.881 349.6 483.881 DL 359.6 483.881 354.6 483.881 DL 364.6 483.881
359.6 483.881 DL 369.6 483.881 364.6 483.881 DL 374.6 483.881 369.6
483.881 DL 379.6 483.881 374.6 483.881 DL 384.6 483.881 379.6 483.881 DL
389.6 483.881 384.6 483.881 DL 394.6 483.881 389.6 483.881 DL 399.6
483.881 394.6 483.881 DL 404.6 483.881 399.6 483.881 DL 409.6 483.881
404.6 483.881 DL 414.6 483.881 409.6 483.881 DL 419.6 483.881 414.6
483.881 DL 424.6 483.881 419.6 483.881 DL 429.6 483.881 424.6 483.881 DL
434.6 483.881 429.6 483.881 DL 439.6 483.881 434.6 483.881 DL 444.6
483.881 439.6 483.881 DL 449.6 483.881 444.6 483.881 DL 454.6 483.881
449.6 483.881 DL 459.6 483.881 454.6 483.881 DL 464.6 483.881 459.6
483.881 DL 469.6 483.881 464.6 483.881 DL 474.6 483.881 469.6 483.881 DL
479.6 483.881 474.6 483.881 DL 484.6 483.881 479.6 483.881 DL 489.6
483.881 484.6 483.881 DL 494.6 483.881 489.6 483.881 DL 499.6 483.881
494.6 483.881 DL 504.6 483.881 499.6 483.881 DL 509.6 483.881 504.6
483.881 DL 514.6 483.881 509.6 483.881 DL 519.6 483.881 514.6 483.881 DL
/F3 8/Palatino-Bold@0 SF(Figure 1)262.244 499.881 Q(1)-.296 E/F4 8
/Palatino-Roman@0 SF(The)6 E/F5 8/Courier@0 SF(cli_args)2 E F4(function)
2 E/F6 10/Palatino-Roman@0 SF 1.935
(Note that this function sets global variables based on the command)
129.6 523.881 R(-)-.9 I 1.936(line ar).9 J(guments,)-.18 E(which)129.6
535.881 Q/F7 10/Courier@0 SF(loop)4.286 E F6 1.786
(then copies into the appr)4.286 F 1.785(opriate entry in the)-.18 F F7
(client)4.285 E F6(array)4.285 E 4.285(,s)-1.11 G 1.785(ince these)
-4.285 F(options af)129.6 547.881 Q(fect only a single client's r)-.18 E
(equest.)-.18 E(Figur)147.6 559.881 Q 2.59(e1)-.18 G 2.59(2s)-2.59 G .09
(hows the \214le)-2.59 F F7(client.c)2.59 E F6 2.59(,w)C .09
(hich de\214nes the functions that manipulate the)-2.59 F F7(client)
129.6 571.881 Q F6(array)3.217 E 5.717(.T)-1.11 G .717(he only dif)
-5.717 F(fer)-.18 E .717(ence between Figur)-.18 F 3.216(e1)-.18 G 3.216
(2a)-3.216 G .716(nd Figur)-3.216 F 3.216(e1)-.18 G .716
(7.36 is that we now)-3.216 F(have to look up an entry based on the pr)
129.6 583.881 Q(ocess ID \(in the function)-.18 E F7(client_sigchld)2.5
E F6(\).)A 134.6 591.081 129.6 591.081 DL 139.6 591.081 134.6 591.081 DL
144.6 591.081 139.6 591.081 DL 149.6 591.081 144.6 591.081 DL 154.6
591.081 149.6 591.081 DL 159.6 591.081 154.6 591.081 DL 164.6 591.081
159.6 591.081 DL 169.6 591.081 164.6 591.081 DL 174.6 591.081 169.6
591.081 DL 179.6 591.081 174.6 591.081 DL 184.6 591.081 179.6 591.081 DL
189.6 591.081 184.6 591.081 DL 194.6 591.081 189.6 591.081 DL 199.6
591.081 194.6 591.081 DL 204.6 591.081 199.6 591.081 DL 209.6 591.081
204.6 591.081 DL 214.6 591.081 209.6 591.081 DL 219.6 591.081 214.6
591.081 DL 224.6 591.081 219.6 591.081 DL 229.6 591.081 224.6 591.081 DL
234.6 591.081 229.6 591.081 DL 239.6 591.081 234.6 591.081 DL 244.6
591.081 239.6 591.081 DL 249.6 591.081 244.6 591.081 DL 254.6 591.081
249.6 591.081 DL 259.6 591.081 254.6 591.081 DL 264.6 591.081 259.6
591.081 DL 269.6 591.081 264.6 591.081 DL 274.6 591.081 269.6 591.081 DL
279.6 591.081 274.6 591.081 DL 284.6 591.081 279.6 591.081 DL 289.6
591.081 284.6 591.081 DL 294.6 591.081 289.6 591.081 DL 299.6 591.081
294.6 591.081 DL 304.6 591.081 299.6 591.081 DL 309.6 591.081 304.6
591.081 DL 314.6 591.081 309.6 591.081 DL 319.6 591.081 314.6 591.081 DL
324.6 591.081 319.6 591.081 DL 329.6 591.081 324.6 591.081 DL 334.6
591.081 329.6 591.081 DL 339.6 591.081 334.6 591.081 DL 344.6 591.081
339.6 591.081 DL 349.6 591.081 344.6 591.081 DL 354.6 591.081 349.6
591.081 DL 359.6 591.081 354.6 591.081 DL 364.6 591.081 359.6 591.081 DL
369.6 591.081 364.6 591.081 DL 374.6 591.081 369.6 591.081 DL 379.6
591.081 374.6 591.081 DL 384.6 591.081 379.6 591.081 DL 389.6 591.081
384.6 591.081 DL 394.6 591.081 389.6 591.081 DL 399.6 591.081 394.6
591.081 DL 404.6 591.081 399.6 591.081 DL 409.6 591.081 404.6 591.081 DL
414.6 591.081 409.6 591.081 DL 419.6 591.081 414.6 591.081 DL 424.6
591.081 419.6 591.081 DL 429.6 591.081 424.6 591.081 DL 434.6 591.081
429.6 591.081 DL 439.6 591.081 434.6 591.081 DL 444.6 591.081 439.6
591.081 DL 449.6 591.081 444.6 591.081 DL 454.6 591.081 449.6 591.081 DL
459.6 591.081 454.6 591.081 DL 464.6 591.081 459.6 591.081 DL 469.6
591.081 464.6 591.081 DL 474.6 591.081 469.6 591.081 DL 479.6 591.081
474.6 591.081 DL 484.6 591.081 479.6 591.081 DL 489.6 591.081 484.6
591.081 DL 494.6 591.081 489.6 591.081 DL 499.6 591.081 494.6 591.081 DL
504.6 591.081 499.6 591.081 DL 509.6 591.081 504.6 591.081 DL 514.6
591.081 509.6 591.081 DL 519.6 591.081 514.6 591.081 DL F2 16.2
(#include "calld.h")129.6 600.582 R(static void)129.6 617.702 Q 27
(client_alloc\(void\) /*)129.6 628.402 R
(alloc more entries in the client[] array */)5.4 E({)129.6 639.102 Q
21.6(int i;)151.2 649.802 R 0 Cg EP
%%Page: 18 18
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(18)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(if \(client == NULL\))151.2 121.7 Q
(client = malloc\(NALLOC * sizeof\(Client\)\);)172.8 132.4 Q(else)151.2
143.1 Q(client = realloc\(client,)172.8 153.8 Q
(\(client_size + NALLOC\) * sizeof\(Client\)\);)183.6 164.5 Q
(if \(client == NULL\))151.2 175.2 Q
(err_sys\("can't alloc for client array"\);)172.8 185.9 Q(/*)151.2
203.02 Q 5.4(*H)156.6 213.72 S(ave to initialize the new entries.)-5.4 E
(*/)156.6 224.42 Q
(for \(i = client_size; i < client_size + NALLOC; i++\))151.2 235.12 Q
(client[i].fd = -1;)172.8 245.82 Q(/* fd of -1 means entry available */)
10.8 E(client_size += NALLOC;)151.2 256.52 Q(})129.6 267.22 Q(/*)129.6
284.34 Q 5.4(*C)135 295.04 S
(alled by loop\(\) when connection request from a new client arrives.)
-5.4 E(*/)135 305.74 Q(int)129.6 316.44 Q
(client_add\(int fd, uid_t uid\))129.6 327.14 Q({)129.6 337.84 Q 21.6
(int i;)151.2 348.54 R(if \(client == NULL\))151.2 365.66 Q
(/* first time we're called */)27 E(client_alloc\(\);)172.8 376.36 Q
(again:)129.6 387.06 Q(for \(i = 0; i < client_size; i++\) {)151.2
397.76 Q(if \(client[i].fd == -1\) {)172.8 408.46 Q
(/* find an available entry */)16.2 E(client[i].fd = fd;)194.4 419.16 Q
(client[i].uid = uid;)194.4 429.86 Q 5.4(return\(i\); /*)194.4 440.56 R
(return index in client[] array */)5.4 E(})172.8 451.26 Q(})151.2 461.96
Q(/*)151.2 479.08 Q 5.4(*C)156.6 489.78 S
(lient array full, time to realloc for more.)-5.4 E(*/)156.6 500.48 Q
(client_alloc\(\);)151.2 511.18 Q(goto again;)151.2 521.88 Q
(/* and search again \(will work this time\) */)27 E(})129.6 532.58 Q
(/*)129.6 549.7 Q 5.4(*C)135 560.4 S
(alled by loop\(\) when we're done with a client.)-5.4 E(*/)135 571.1 Q
(void)129.6 581.8 Q(client_del\(int fd\))129.6 592.5 Q({)129.6 603.2 Q
21.6(int i;)151.2 613.9 R(for \(i = 0; i < client_size; i++\) {)151.2
631.02 Q(if \(client[i].fd == fd\) {)172.8 641.72 Q(client[i].fd = -1;)
194.4 652.42 Q 0 Cg EP
%%Page: 19 19
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(19)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(return;)194.4 121.7 Q(})172.8 132.4 Q(})151.2
143.1 Q(log_quit\("can't find client entry for fd %d", fd\);)151.2 153.8
Q(})129.6 164.5 Q(/*)129.6 181.62 Q 5.4(*F)135 192.32 S
(ind the client entry corresponding to a process ID.)-5.4 E 5.4(*T)135
203.02 S(his function is called by the sig_chld\(\) signal)-5.4 E 5.4
(*h)135 213.72 S(andler only after a child has terminated.)-5.4 E(*/)135
224.42 Q(void)129.6 235.12 Q(client_sigchld\(pid_t pid, int stat\))129.6
245.82 Q({)129.6 256.52 Q 21.6(int i;)151.2 267.22 R
(for \(i = 0; i < client_size; i++\) {)151.2 284.34 Q
(if \(client[i].pid == pid\) {)172.8 295.04 Q
(client[i].childdone = stat; /* child's exit\(\) status +1 */)194.4
305.74 Q(return;)194.4 316.44 Q(})172.8 327.14 Q(})151.2 337.84 Q
(log_quit\("can't find client entry for pid %d", pid\);)151.2 348.54 Q
(})129.6 359.24 Q .4 LW 134.6 364.041 129.6 364.041 DL 139.6 364.041
134.6 364.041 DL 144.6 364.041 139.6 364.041 DL 149.6 364.041 144.6
364.041 DL 154.6 364.041 149.6 364.041 DL 159.6 364.041 154.6 364.041 DL
164.6 364.041 159.6 364.041 DL 169.6 364.041 164.6 364.041 DL 174.6
364.041 169.6 364.041 DL 179.6 364.041 174.6 364.041 DL 184.6 364.041
179.6 364.041 DL 189.6 364.041 184.6 364.041 DL 194.6 364.041 189.6
364.041 DL 199.6 364.041 194.6 364.041 DL 204.6 364.041 199.6 364.041 DL
209.6 364.041 204.6 364.041 DL 214.6 364.041 209.6 364.041 DL 219.6
364.041 214.6 364.041 DL 224.6 364.041 219.6 364.041 DL 229.6 364.041
224.6 364.041 DL 234.6 364.041 229.6 364.041 DL 239.6 364.041 234.6
364.041 DL 244.6 364.041 239.6 364.041 DL 249.6 364.041 244.6 364.041 DL
254.6 364.041 249.6 364.041 DL 259.6 364.041 254.6 364.041 DL 264.6
364.041 259.6 364.041 DL 269.6 364.041 264.6 364.041 DL 274.6 364.041
269.6 364.041 DL 279.6 364.041 274.6 364.041 DL 284.6 364.041 279.6
364.041 DL 289.6 364.041 284.6 364.041 DL 294.6 364.041 289.6 364.041 DL
299.6 364.041 294.6 364.041 DL 304.6 364.041 299.6 364.041 DL 309.6
364.041 304.6 364.041 DL 314.6 364.041 309.6 364.041 DL 319.6 364.041
314.6 364.041 DL 324.6 364.041 319.6 364.041 DL 329.6 364.041 324.6
364.041 DL 334.6 364.041 329.6 364.041 DL 339.6 364.041 334.6 364.041 DL
344.6 364.041 339.6 364.041 DL 349.6 364.041 344.6 364.041 DL 354.6
364.041 349.6 364.041 DL 359.6 364.041 354.6 364.041 DL 364.6 364.041
359.6 364.041 DL 369.6 364.041 364.6 364.041 DL 374.6 364.041 369.6
364.041 DL 379.6 364.041 374.6 364.041 DL 384.6 364.041 379.6 364.041 DL
389.6 364.041 384.6 364.041 DL 394.6 364.041 389.6 364.041 DL 399.6
364.041 394.6 364.041 DL 404.6 364.041 399.6 364.041 DL 409.6 364.041
404.6 364.041 DL 414.6 364.041 409.6 364.041 DL 419.6 364.041 414.6
364.041 DL 424.6 364.041 419.6 364.041 DL 429.6 364.041 424.6 364.041 DL
434.6 364.041 429.6 364.041 DL 439.6 364.041 434.6 364.041 DL 444.6
364.041 439.6 364.041 DL 449.6 364.041 444.6 364.041 DL 454.6 364.041
449.6 364.041 DL 459.6 364.041 454.6 364.041 DL 464.6 364.041 459.6
364.041 DL 469.6 364.041 464.6 364.041 DL 474.6 364.041 469.6 364.041 DL
479.6 364.041 474.6 364.041 DL 484.6 364.041 479.6 364.041 DL 489.6
364.041 484.6 364.041 DL 494.6 364.041 489.6 364.041 DL 499.6 364.041
494.6 364.041 DL 504.6 364.041 499.6 364.041 DL 509.6 364.041 504.6
364.041 DL 514.6 364.041 509.6 364.041 DL 519.6 364.041 514.6 364.041 DL
/F3 8/Palatino-Bold@0 SF(Figure 12)271.424 380.041 Q/F4 8
/Palatino-Roman@0 SF(The)6 E/F5 8/Courier@0 SF(client.c)2 E F4(\214le)2
E/F6 10/Palatino-Roman@0 SF(Figur)147.6 404.041 Q 3.112(e1)-.18 G 3.112
(3s)-3.112 G .612(hows the \214le)-3.112 F/F7 10/Courier@0 SF(lock.c)
3.112 E F6 5.612(.T)C .612(he functions in this \214le manage the)-5.612
F F7(lock)3.113 E F6(array)3.113 E 2.604(for the par)129.6 416.041 R
5.104(ent. As)-.18 F 2.604(with the)5.104 F F7(client)5.104 E F6 2.604
(functions, we call)5.104 F F7(realloc)5.104 E F6 2.603
(to allocate space)5.104 F(dynamically for the)129.6 428.041 Q F7(lock)
2.5 E F6(array to avoid compile-time limits.)2.5 E 134.6 435.241 129.6
435.241 DL 139.6 435.241 134.6 435.241 DL 144.6 435.241 139.6 435.241 DL
149.6 435.241 144.6 435.241 DL 154.6 435.241 149.6 435.241 DL 159.6
435.241 154.6 435.241 DL 164.6 435.241 159.6 435.241 DL 169.6 435.241
164.6 435.241 DL 174.6 435.241 169.6 435.241 DL 179.6 435.241 174.6
435.241 DL 184.6 435.241 179.6 435.241 DL 189.6 435.241 184.6 435.241 DL
194.6 435.241 189.6 435.241 DL 199.6 435.241 194.6 435.241 DL 204.6
435.241 199.6 435.241 DL 209.6 435.241 204.6 435.241 DL 214.6 435.241
209.6 435.241 DL 219.6 435.241 214.6 435.241 DL 224.6 435.241 219.6
435.241 DL 229.6 435.241 224.6 435.241 DL 234.6 435.241 229.6 435.241 DL
239.6 435.241 234.6 435.241 DL 244.6 435.241 239.6 435.241 DL 249.6
435.241 244.6 435.241 DL 254.6 435.241 249.6 435.241 DL 259.6 435.241
254.6 435.241 DL 264.6 435.241 259.6 435.241 DL 269.6 435.241 264.6
435.241 DL 274.6 435.241 269.6 435.241 DL 279.6 435.241 274.6 435.241 DL
284.6 435.241 279.6 435.241 DL 289.6 435.241 284.6 435.241 DL 294.6
435.241 289.6 435.241 DL 299.6 435.241 294.6 435.241 DL 304.6 435.241
299.6 435.241 DL 309.6 435.241 304.6 435.241 DL 314.6 435.241 309.6
435.241 DL 319.6 435.241 314.6 435.241 DL 324.6 435.241 319.6 435.241 DL
329.6 435.241 324.6 435.241 DL 334.6 435.241 329.6 435.241 DL 339.6
435.241 334.6 435.241 DL 344.6 435.241 339.6 435.241 DL 349.6 435.241
344.6 435.241 DL 354.6 435.241 349.6 435.241 DL 359.6 435.241 354.6
435.241 DL 364.6 435.241 359.6 435.241 DL 369.6 435.241 364.6 435.241 DL
374.6 435.241 369.6 435.241 DL 379.6 435.241 374.6 435.241 DL 384.6
435.241 379.6 435.241 DL 389.6 435.241 384.6 435.241 DL 394.6 435.241
389.6 435.241 DL 399.6 435.241 394.6 435.241 DL 404.6 435.241 399.6
435.241 DL 409.6 435.241 404.6 435.241 DL 414.6 435.241 409.6 435.241 DL
419.6 435.241 414.6 435.241 DL 424.6 435.241 419.6 435.241 DL 429.6
435.241 424.6 435.241 DL 434.6 435.241 429.6 435.241 DL 439.6 435.241
434.6 435.241 DL 444.6 435.241 439.6 435.241 DL 449.6 435.241 444.6
435.241 DL 454.6 435.241 449.6 435.241 DL 459.6 435.241 454.6 435.241 DL
464.6 435.241 459.6 435.241 DL 469.6 435.241 464.6 435.241 DL 474.6
435.241 469.6 435.241 DL 479.6 435.241 474.6 435.241 DL 484.6 435.241
479.6 435.241 DL 489.6 435.241 484.6 435.241 DL 494.6 435.241 489.6
435.241 DL 499.6 435.241 494.6 435.241 DL 504.6 435.241 499.6 435.241 DL
509.6 435.241 504.6 435.241 DL 514.6 435.241 509.6 435.241 DL 519.6
435.241 514.6 435.241 DL F2 16.2(#include "calld.h")129.6 444.742 R
(typedef struct {)129.6 461.862 Q 5.4(char *line; /*)140.4 472.562 R
(points to malloc\(\)ed area */)5.4 E
(/* we lock by line \(device name\) */)216 483.262 Q(pid_t pid;)140.4
493.962 Q(/* but unlock by process ID */)21.6 E
(/* pid of 0 means available */)216 504.662 Q 5.4(}L)129.6 515.362 S
(ock;)-5.4 E(static Lock *lock = NULL;)129.6 526.062 Q
(/* the malloc'ed/realloc'ed array */)16.2 E(static int)129.6 536.762 Q
21.6(lock_size; /*)16.2 F(#entries in lock[] */)5.4 E(static int)129.6
547.462 Q 37.8(nlocks; /*)16.2 F(#entries currently used in lock[] */)
5.4 E(/*)129.6 564.582 Q 5.4(*F)135 575.282 S
(ind the entry in lock[] for the specified device \(line\).)-5.4 E 5.4
(*I)135 585.982 S 5.4(fw)-5.4 G 5.4(ed)-5.4 G
(on't find it, create a new entry at the end of the)-5.4 E 5.4(*l)135
596.682 S(ock[] array for the new device.)-5.4 E
(This is how all the possible)10.8 E 5.4(*d)135 607.382 S
(evices get added to the lock[] array over time.)-5.4 E(*/)135 618.082 Q
(static Lock *)129.6 628.782 Q(find_line\(char *line\))129.6 639.482 Q
({)129.6 650.182 Q 0 Cg EP
%%Page: 20 20
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(20)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF 21.6(int i;)151.2 121.7 R 16.2(Lock *lptr;)151.2 132.4 R
(for \(i = 0; i < nlocks; i++\) {)151.2 149.52 Q
(if \(strcmp\(line, lock[i].line\) == 0\))172.8 160.22 Q 10.8
(return\(&lock[i]\); /*)194.4 170.92 R(found entry for device */)5.4 E
(})151.2 181.62 Q(/*)151.2 198.74 Q 5.4(*E)156.6 209.44 S
(ntry not found.)-5.4 E(This device has never been locked before.)10.8 E
5.4(*A)156.6 220.14 S(dd a new entry to lock[] array.)-5.4 E(*/)156.6
230.84 Q(if \(nlocks >= lock_size\) {)151.2 241.54 Q
(/* lock[] array is full */)10.8 E(if \(lock == NULL\))172.8 252.24 Q
(/* first time through */)37.8 E
(lock = malloc\(NALLOC * sizeof\(Lock\)\);)194.4 262.94 Q(else)172.8
273.64 Q
(lock = realloc\(lock, \(lock_size + NALLOC\) * sizeof\(Lock\)\);)194.4
284.34 Q(if \(lock == NULL\))172.8 295.04 Q
(err_sys\("can't alloc for lock array"\);)194.4 305.74 Q
(lock_size += NALLOC;)172.8 316.44 Q(})151.2 327.14 Q
(lptr = &lock[nlocks++];)151.2 344.26 Q
(if \(\(lptr->line = malloc\(strlen\(line\) + 1\)\) == NULL\))151.2
354.96 Q(log_sys\("malloc error"\);)172.8 365.66 Q
(strcpy\(lptr->line, line\);)151.2 376.36 Q
(/* copy caller's line name */)16.2 E 5.4(lptr->pid =)151.2 387.06 R(0;)
5.4 E(return\(lptr\);)151.2 397.76 Q(})129.6 408.46 Q(void)129.6 425.58
Q(lock_set\(char *line, pid_t pid\))129.6 436.28 Q({)129.6 446.98 Q 16.2
(Lock *lptr;)151.2 457.68 R
(log_msg\("locking %s for pid %d", line, pid\);)151.2 474.8 Q
(lptr = find_line\(line\);)151.2 485.5 Q 5.4(lptr->pid =)151.2 496.2 R
(pid;)5.4 E(})129.6 506.9 Q(void)129.6 524.02 Q(lock_rel\(pid_t pid\))
129.6 534.72 Q({)129.6 545.42 Q 16.2(Lock *lptr;)151.2 556.12 R
(for \(lptr = &lock[0]; lptr < &lock[nlocks]; lptr++\) {)151.2 573.24 Q
(if \(lptr->pid == pid\) {)172.8 583.94 Q
(log_msg\("unlocking %s for pid %d", lptr->line, pid\);)194.4 594.64 Q
5.4(lptr->pid =)194.4 605.34 R(0;)5.4 E(return;)194.4 616.04 Q(})172.8
626.74 Q(})151.2 637.44 Q
(log_msg\("can't find lock for pid = %d", pid\);)151.2 648.14 Q 0 Cg EP
%%Page: 21 21
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(21)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(})129.6 121.7 Q(pid_t)129.6 138.82 Q
(is_locked\(char *line\))129.6 149.52 Q({)129.6 160.22 Q 10.8
(return\(find_line\(line\)->pid\); /*)151.2 170.92 R
(nonzero pid means locked */)5.4 E(})129.6 181.62 Q .4 LW 134.6 186.421
129.6 186.421 DL 139.6 186.421 134.6 186.421 DL 144.6 186.421 139.6
186.421 DL 149.6 186.421 144.6 186.421 DL 154.6 186.421 149.6 186.421 DL
159.6 186.421 154.6 186.421 DL 164.6 186.421 159.6 186.421 DL 169.6
186.421 164.6 186.421 DL 174.6 186.421 169.6 186.421 DL 179.6 186.421
174.6 186.421 DL 184.6 186.421 179.6 186.421 DL 189.6 186.421 184.6
186.421 DL 194.6 186.421 189.6 186.421 DL 199.6 186.421 194.6 186.421 DL
204.6 186.421 199.6 186.421 DL 209.6 186.421 204.6 186.421 DL 214.6
186.421 209.6 186.421 DL 219.6 186.421 214.6 186.421 DL 224.6 186.421
219.6 186.421 DL 229.6 186.421 224.6 186.421 DL 234.6 186.421 229.6
186.421 DL 239.6 186.421 234.6 186.421 DL 244.6 186.421 239.6 186.421 DL
249.6 186.421 244.6 186.421 DL 254.6 186.421 249.6 186.421 DL 259.6
186.421 254.6 186.421 DL 264.6 186.421 259.6 186.421 DL 269.6 186.421
264.6 186.421 DL 274.6 186.421 269.6 186.421 DL 279.6 186.421 274.6
186.421 DL 284.6 186.421 279.6 186.421 DL 289.6 186.421 284.6 186.421 DL
294.6 186.421 289.6 186.421 DL 299.6 186.421 294.6 186.421 DL 304.6
186.421 299.6 186.421 DL 309.6 186.421 304.6 186.421 DL 314.6 186.421
309.6 186.421 DL 319.6 186.421 314.6 186.421 DL 324.6 186.421 319.6
186.421 DL 329.6 186.421 324.6 186.421 DL 334.6 186.421 329.6 186.421 DL
339.6 186.421 334.6 186.421 DL 344.6 186.421 339.6 186.421 DL 349.6
186.421 344.6 186.421 DL 354.6 186.421 349.6 186.421 DL 359.6 186.421
354.6 186.421 DL 364.6 186.421 359.6 186.421 DL 369.6 186.421 364.6
186.421 DL 374.6 186.421 369.6 186.421 DL 379.6 186.421 374.6 186.421 DL
384.6 186.421 379.6 186.421 DL 389.6 186.421 384.6 186.421 DL 394.6
186.421 389.6 186.421 DL 399.6 186.421 394.6 186.421 DL 404.6 186.421
399.6 186.421 DL 409.6 186.421 404.6 186.421 DL 414.6 186.421 409.6
186.421 DL 419.6 186.421 414.6 186.421 DL 424.6 186.421 419.6 186.421 DL
429.6 186.421 424.6 186.421 DL 434.6 186.421 429.6 186.421 DL 439.6
186.421 434.6 186.421 DL 444.6 186.421 439.6 186.421 DL 449.6 186.421
444.6 186.421 DL 454.6 186.421 449.6 186.421 DL 459.6 186.421 454.6
186.421 DL 464.6 186.421 459.6 186.421 DL 469.6 186.421 464.6 186.421 DL
474.6 186.421 469.6 186.421 DL 479.6 186.421 474.6 186.421 DL 484.6
186.421 479.6 186.421 DL 489.6 186.421 484.6 186.421 DL 494.6 186.421
489.6 186.421 DL 499.6 186.421 494.6 186.421 DL 504.6 186.421 499.6
186.421 DL 509.6 186.421 504.6 186.421 DL 514.6 186.421 509.6 186.421 DL
519.6 186.421 514.6 186.421 DL/F3 8/Palatino-Bold@0 SF(Figure 13)229.336
202.421 Q/F4 8/Palatino-Roman@0 SF
(Functions for managing client device locks)6 E/F5 10/Palatino-Roman@0
SF 1.593(Each entry in the)129.6 226.421 R/F6 10/Courier@0 SF(lock)4.093
E F5 1.594(array is associated with a single)4.094 F/F7 10
/Palatino-Italic@0 SF(line)4.094 E F5 1.594(\(the second \214eld in the)
4.094 F F6(Devices)129.6 238.421 Q F5 3.25(\214le\). Since)3.25 F .75
(these locking functions don't know all the dif)3.25 F(fer)-.18 E(ent)
-.18 E F7(line)3.25 E F5 .75(values in)3.25 F .895
(this data \214le, new entries in the)129.6 250.421 R F6(lock)3.396 E F5
.896(array ar)3.396 F 3.396(ec)-.18 G -.18(re)-3.396 G .896
(ated whenever a new).18 F F7(line)3.396 E F5 .896(is locked)3.396 F
(the \214rst time.)129.6 262.421 Q(The function)5 E F6(find_line)2.5 E
F5(handles this.)2.5 E 2.045(The next thr)147.6 274.421 R 2.045(ee sour)
-.18 F 2.045(ce \214les handle the thr)-.18 F 2.045(ee data \214les:)
-.18 F F6(Systems)4.545 E F5(,)A F6(Devices)4.545 E F5 4.545(,a)C(nd)
-4.545 E F6(Dialers)129.6 286.421 Q F5 6.422(.E)C 1.422
(ach \214le has a)-6.422 F F6(XXX_next)3.922 E F5 1.422(function that r)
3.922 F 1.422(eads the next line of the \214le and)-.18 F(br)129.6
298.421 Q 1.519(eaks it up into \214elds.)-.18 F 1.519
(The ISO C function)6.519 F F6(strtok)4.019 E F5 1.519(is called to br)
4.019 F 1.518(eak the lines into)-.18 F 2.5(\214elds. The)129.6 310.421
R(functions in Figur)2.5 E 2.5(e1)-.18 G 2.5(4h)-2.5 G(andle the)-2.5 E
F6(Systems)2.5 E F5(\214le.)2.5 E 134.6 317.621 129.6 317.621 DL 139.6
317.621 134.6 317.621 DL 144.6 317.621 139.6 317.621 DL 149.6 317.621
144.6 317.621 DL 154.6 317.621 149.6 317.621 DL 159.6 317.621 154.6
317.621 DL 164.6 317.621 159.6 317.621 DL 169.6 317.621 164.6 317.621 DL
174.6 317.621 169.6 317.621 DL 179.6 317.621 174.6 317.621 DL 184.6
317.621 179.6 317.621 DL 189.6 317.621 184.6 317.621 DL 194.6 317.621
189.6 317.621 DL 199.6 317.621 194.6 317.621 DL 204.6 317.621 199.6
317.621 DL 209.6 317.621 204.6 317.621 DL 214.6 317.621 209.6 317.621 DL
219.6 317.621 214.6 317.621 DL 224.6 317.621 219.6 317.621 DL 229.6
317.621 224.6 317.621 DL 234.6 317.621 229.6 317.621 DL 239.6 317.621
234.6 317.621 DL 244.6 317.621 239.6 317.621 DL 249.6 317.621 244.6
317.621 DL 254.6 317.621 249.6 317.621 DL 259.6 317.621 254.6 317.621 DL
264.6 317.621 259.6 317.621 DL 269.6 317.621 264.6 317.621 DL 274.6
317.621 269.6 317.621 DL 279.6 317.621 274.6 317.621 DL 284.6 317.621
279.6 317.621 DL 289.6 317.621 284.6 317.621 DL 294.6 317.621 289.6
317.621 DL 299.6 317.621 294.6 317.621 DL 304.6 317.621 299.6 317.621 DL
309.6 317.621 304.6 317.621 DL 314.6 317.621 309.6 317.621 DL 319.6
317.621 314.6 317.621 DL 324.6 317.621 319.6 317.621 DL 329.6 317.621
324.6 317.621 DL 334.6 317.621 329.6 317.621 DL 339.6 317.621 334.6
317.621 DL 344.6 317.621 339.6 317.621 DL 349.6 317.621 344.6 317.621 DL
354.6 317.621 349.6 317.621 DL 359.6 317.621 354.6 317.621 DL 364.6
317.621 359.6 317.621 DL 369.6 317.621 364.6 317.621 DL 374.6 317.621
369.6 317.621 DL 379.6 317.621 374.6 317.621 DL 384.6 317.621 379.6
317.621 DL 389.6 317.621 384.6 317.621 DL 394.6 317.621 389.6 317.621 DL
399.6 317.621 394.6 317.621 DL 404.6 317.621 399.6 317.621 DL 409.6
317.621 404.6 317.621 DL 414.6 317.621 409.6 317.621 DL 419.6 317.621
414.6 317.621 DL 424.6 317.621 419.6 317.621 DL 429.6 317.621 424.6
317.621 DL 434.6 317.621 429.6 317.621 DL 439.6 317.621 434.6 317.621 DL
444.6 317.621 439.6 317.621 DL 449.6 317.621 444.6 317.621 DL 454.6
317.621 449.6 317.621 DL 459.6 317.621 454.6 317.621 DL 464.6 317.621
459.6 317.621 DL 469.6 317.621 464.6 317.621 DL 474.6 317.621 469.6
317.621 DL 479.6 317.621 474.6 317.621 DL 484.6 317.621 479.6 317.621 DL
489.6 317.621 484.6 317.621 DL 494.6 317.621 489.6 317.621 DL 499.6
317.621 494.6 317.621 DL 504.6 317.621 499.6 317.621 DL 509.6 317.621
504.6 317.621 DL 514.6 317.621 509.6 317.621 DL 519.6 317.621 514.6
317.621 DL F2 16.2(#include "calld.h")129.6 327.122 R
(static FILE *fpsys = NULL;)129.6 345.312 Q(static int)129.6 356.012 Q
43.2(syslineno; /*)16.2 F(for error messages */)5.4 E(static char)129.6
366.712 Q(sysline[MAXLINE];)10.8 E
(/* can't be automatic; sys_next\(\) returns pointers into here */)172.8
377.412 Q(/*)129.6 395.602 Q 5.4(*R)135 406.302 S
(ead and break apart a line in the Systems file.)-5.4 E(*/)135 417.002 Q
124.2(long /*)129.6 427.702 R(return >0 if OK, -1 on EOF */)5.4 E
(sys_next\(Systems *sysptr\))129.6 438.402 Q
(/* structure is filled in with pointers */)16.2 E({)129.6 449.102 Q
(if \(fpsys == NULL\) {)151.2 459.802 Q
(if \(\(fpsys = fopen\(SYSTEMS, "r"\)\) == NULL\))172.8 470.502 Q
(log_sys\("can't open %s", SYSTEMS\);)194.4 481.202 Q(syslineno = 0;)
172.8 491.902 Q(})151.2 502.602 Q(again:)129.6 520.792 Q
(if \(fgets\(sysline, MAXLINE, fpsys\) == NULL\))151.2 531.492 Q 21.6
(return\(-1\); /*)172.8 542.192 R(EOF */)5.4 E(syslineno++;)151.2
552.892 Q(if \(\(sysptr->name = strtok\(sysline, WHITE\)\) == NULL\) {)
151.2 563.592 Q(if \(sysline[0] == '\\n'\))172.8 574.292 Q(goto again;)
194.4 584.992 Q(/* ignore empty line */)27 E
(log_quit\("missing `name' in Systems file, line %d", syslineno\);)172.8
595.692 Q(})151.2 606.392 Q(if \(sysptr->name[0] == '#'\))151.2 617.092
Q(goto again;)172.8 627.792 Q(/* ignore comment line */)48.6 E
(if \(\(sysptr->time = strtok\(NULL, WHITE\)\) == NULL\))151.2 638.492 Q
(log_quit\("missing `time' in Systems file, line %d", syslineno\);)172.8
649.192 Q 0 Cg EP
%%Page: 22 22
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(22)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(if \(\(sysptr->type = strtok\(NULL, WHITE\)\) == NULL\))
151.2 121.7 Q
(log_quit\("missing `type' in Systems file, line %d", syslineno\);)172.8
132.4 Q(if \(\(sysptr->class = strtok\(NULL, WHITE\)\) == NULL\))151.2
143.1 Q
(log_quit\("missing `class' in Systems file, line %d", syslineno\);)
172.8 153.8 Q(if \(\(sysptr->phone = strtok\(NULL, WHITE\)\) == NULL\))
151.2 164.5 Q
(log_quit\("missing `phone' in Systems file, line %d", syslineno\);)
172.8 175.2 Q(if \(\(sysptr->login = strtok\(NULL, "\\n"\)\) == NULL\))
151.2 185.9 Q
(log_quit\("missing `login' in Systems file, line %d", syslineno\);)
172.8 196.6 Q 10.8(return\(ftell\(fpsys\)\); /*)151.2 214.79 R
(return the position in Systems file */)5.4 E(})129.6 225.49 Q(void)
129.6 243.68 Q(sys_rew\(void\))129.6 254.38 Q({)129.6 265.08 Q
(if \(fpsys != NULL\))151.2 275.78 Q(rewind\(fpsys\);)172.8 286.48 Q
(syslineno = 0;)151.2 297.18 Q(})129.6 307.88 Q(void)129.6 326.07 Q
(sys_posn\(long posn\))129.6 336.77 Q(/* position Systems file */)27 E
({)129.6 347.47 Q(if \(posn == 0\))151.2 358.17 Q(sys_rew\(\);)172.8
368.87 Q(else if \(fseek\(fpsys, posn, SEEK_SET\) != 0\))151.2 379.57 Q
(log_sys\("fseek error"\);)172.8 390.27 Q(})129.6 400.97 Q .4 LW 134.6
405.771 129.6 405.771 DL 139.6 405.771 134.6 405.771 DL 144.6 405.771
139.6 405.771 DL 149.6 405.771 144.6 405.771 DL 154.6 405.771 149.6
405.771 DL 159.6 405.771 154.6 405.771 DL 164.6 405.771 159.6 405.771 DL
169.6 405.771 164.6 405.771 DL 174.6 405.771 169.6 405.771 DL 179.6
405.771 174.6 405.771 DL 184.6 405.771 179.6 405.771 DL 189.6 405.771
184.6 405.771 DL 194.6 405.771 189.6 405.771 DL 199.6 405.771 194.6
405.771 DL 204.6 405.771 199.6 405.771 DL 209.6 405.771 204.6 405.771 DL
214.6 405.771 209.6 405.771 DL 219.6 405.771 214.6 405.771 DL 224.6
405.771 219.6 405.771 DL 229.6 405.771 224.6 405.771 DL 234.6 405.771
229.6 405.771 DL 239.6 405.771 234.6 405.771 DL 244.6 405.771 239.6
405.771 DL 249.6 405.771 244.6 405.771 DL 254.6 405.771 249.6 405.771 DL
259.6 405.771 254.6 405.771 DL 264.6 405.771 259.6 405.771 DL 269.6
405.771 264.6 405.771 DL 274.6 405.771 269.6 405.771 DL 279.6 405.771
274.6 405.771 DL 284.6 405.771 279.6 405.771 DL 289.6 405.771 284.6
405.771 DL 294.6 405.771 289.6 405.771 DL 299.6 405.771 294.6 405.771 DL
304.6 405.771 299.6 405.771 DL 309.6 405.771 304.6 405.771 DL 314.6
405.771 309.6 405.771 DL 319.6 405.771 314.6 405.771 DL 324.6 405.771
319.6 405.771 DL 329.6 405.771 324.6 405.771 DL 334.6 405.771 329.6
405.771 DL 339.6 405.771 334.6 405.771 DL 344.6 405.771 339.6 405.771 DL
349.6 405.771 344.6 405.771 DL 354.6 405.771 349.6 405.771 DL 359.6
405.771 354.6 405.771 DL 364.6 405.771 359.6 405.771 DL 369.6 405.771
364.6 405.771 DL 374.6 405.771 369.6 405.771 DL 379.6 405.771 374.6
405.771 DL 384.6 405.771 379.6 405.771 DL 389.6 405.771 384.6 405.771 DL
394.6 405.771 389.6 405.771 DL 399.6 405.771 394.6 405.771 DL 404.6
405.771 399.6 405.771 DL 409.6 405.771 404.6 405.771 DL 414.6 405.771
409.6 405.771 DL 419.6 405.771 414.6 405.771 DL 424.6 405.771 419.6
405.771 DL 429.6 405.771 424.6 405.771 DL 434.6 405.771 429.6 405.771 DL
439.6 405.771 434.6 405.771 DL 444.6 405.771 439.6 405.771 DL 449.6
405.771 444.6 405.771 DL 454.6 405.771 449.6 405.771 DL 459.6 405.771
454.6 405.771 DL 464.6 405.771 459.6 405.771 DL 469.6 405.771 464.6
405.771 DL 474.6 405.771 469.6 405.771 DL 479.6 405.771 474.6 405.771 DL
484.6 405.771 479.6 405.771 DL 489.6 405.771 484.6 405.771 DL 494.6
405.771 489.6 405.771 DL 499.6 405.771 494.6 405.771 DL 504.6 405.771
499.6 405.771 DL 509.6 405.771 504.6 405.771 DL 514.6 405.771 509.6
405.771 DL 519.6 405.771 514.6 405.771 DL/F3 8/Palatino-Bold@0 SF
(Figure 14)249.748 421.771 Q/F4 8/Palatino-Roman@0 SF(Functions to r)6 E
(ead)-.144 E/F5 8/Courier@0 SF(Systems)2 E F4(\214le)2 E/F6 10
/Palatino-Roman@0 SF(The function)129.6 445.771 Q/F7 10/Courier@0 SF
(sys_next)2.5 E F6(is called by)2.5 E F7(request)2.5 E F6(to r)2.5 E
(ead the next entry in the \214le.)-.18 E 4.765 -.92(We h)147.6 457.771
T 2.925(ave to r).92 F 2.925
(emember our position in this \214le for each client \(the)-.18 F F7
(sysftell)5.426 E F6 1.942(member of the)129.6 469.771 R F7(Client)4.442
E F6(str)4.442 E(uctur)-.08 E 4.442(e\). This)-.18 F 1.942
(is so that if a child fails to dial the r)4.442 F(emote)-.18 E .746
(system, we can pick up wher)129.6 481.771 R 3.246(ew)-.18 G 3.246(el)
-3.246 G .746(eft of)-3.246 F 3.246(fi)-.18 G 3.246(nt)-3.246 G(he)
-3.246 E F7(Systems)3.246 E F6 .746
(\214le \(for that client\), to try to)3.246 F 2.713
(\214nd another entry for the r)129.6 493.771 R 2.712(emote system.)-.18
F 2.712(The position is obtained by calling the)7.712 F(standar)129.6
505.771 Q 2.5(dI)-.18 G(/O function)-2.5 E F7(ftell)2.5 E F6(and r)2.5 E
(eset using)-.18 E F7(fseek)2.5 E F6(.)A(Figur)147.6 517.771 Q 2.5(e1)
-.18 G 2.5(5c)-2.5 G(ontains the functions for r)-2.5 E(eading the)-.18
E F7(Devices)2.5 E F6(\214le.)2.5 E 134.6 524.971 129.6 524.971 DL 139.6
524.971 134.6 524.971 DL 144.6 524.971 139.6 524.971 DL 149.6 524.971
144.6 524.971 DL 154.6 524.971 149.6 524.971 DL 159.6 524.971 154.6
524.971 DL 164.6 524.971 159.6 524.971 DL 169.6 524.971 164.6 524.971 DL
174.6 524.971 169.6 524.971 DL 179.6 524.971 174.6 524.971 DL 184.6
524.971 179.6 524.971 DL 189.6 524.971 184.6 524.971 DL 194.6 524.971
189.6 524.971 DL 199.6 524.971 194.6 524.971 DL 204.6 524.971 199.6
524.971 DL 209.6 524.971 204.6 524.971 DL 214.6 524.971 209.6 524.971 DL
219.6 524.971 214.6 524.971 DL 224.6 524.971 219.6 524.971 DL 229.6
524.971 224.6 524.971 DL 234.6 524.971 229.6 524.971 DL 239.6 524.971
234.6 524.971 DL 244.6 524.971 239.6 524.971 DL 249.6 524.971 244.6
524.971 DL 254.6 524.971 249.6 524.971 DL 259.6 524.971 254.6 524.971 DL
264.6 524.971 259.6 524.971 DL 269.6 524.971 264.6 524.971 DL 274.6
524.971 269.6 524.971 DL 279.6 524.971 274.6 524.971 DL 284.6 524.971
279.6 524.971 DL 289.6 524.971 284.6 524.971 DL 294.6 524.971 289.6
524.971 DL 299.6 524.971 294.6 524.971 DL 304.6 524.971 299.6 524.971 DL
309.6 524.971 304.6 524.971 DL 314.6 524.971 309.6 524.971 DL 319.6
524.971 314.6 524.971 DL 324.6 524.971 319.6 524.971 DL 329.6 524.971
324.6 524.971 DL 334.6 524.971 329.6 524.971 DL 339.6 524.971 334.6
524.971 DL 344.6 524.971 339.6 524.971 DL 349.6 524.971 344.6 524.971 DL
354.6 524.971 349.6 524.971 DL 359.6 524.971 354.6 524.971 DL 364.6
524.971 359.6 524.971 DL 369.6 524.971 364.6 524.971 DL 374.6 524.971
369.6 524.971 DL 379.6 524.971 374.6 524.971 DL 384.6 524.971 379.6
524.971 DL 389.6 524.971 384.6 524.971 DL 394.6 524.971 389.6 524.971 DL
399.6 524.971 394.6 524.971 DL 404.6 524.971 399.6 524.971 DL 409.6
524.971 404.6 524.971 DL 414.6 524.971 409.6 524.971 DL 419.6 524.971
414.6 524.971 DL 424.6 524.971 419.6 524.971 DL 429.6 524.971 424.6
524.971 DL 434.6 524.971 429.6 524.971 DL 439.6 524.971 434.6 524.971 DL
444.6 524.971 439.6 524.971 DL 449.6 524.971 444.6 524.971 DL 454.6
524.971 449.6 524.971 DL 459.6 524.971 454.6 524.971 DL 464.6 524.971
459.6 524.971 DL 469.6 524.971 464.6 524.971 DL 474.6 524.971 469.6
524.971 DL 479.6 524.971 474.6 524.971 DL 484.6 524.971 479.6 524.971 DL
489.6 524.971 484.6 524.971 DL 494.6 524.971 489.6 524.971 DL 499.6
524.971 494.6 524.971 DL 504.6 524.971 499.6 524.971 DL 509.6 524.971
504.6 524.971 DL 514.6 524.971 509.6 524.971 DL 519.6 524.971 514.6
524.971 DL F2 16.2(#include "calld.h")129.6 534.472 R
(static FILE *fpdev = NULL;)129.6 552.662 Q(static int)129.6 563.362 Q
48.6(devlineno; /*)10.8 F(for error messages */)5.4 E
(static char devline[MAXLINE];)129.6 574.062 Q
(/* can't be automatic; dev_next\(\) returns pointers into here */)172.8
584.762 Q(/*)129.6 602.952 Q 5.4(*R)135 613.652 S
(ead and break apart a line in the Devices file.)-5.4 E(*/)135 624.352 Q
(int)129.6 635.052 Q(dev_next\(Devices *devptr\))129.6 645.752 Q
(/* pointers in structure are filled in */)16.2 E({)129.6 656.452 Q 0 Cg
EP
%%Page: 23 23
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(23)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(if \(fpdev == NULL\) {)151.2 121.7 Q
(if \(\(fpdev = fopen\(DEVICES, "r"\)\) == NULL\))172.8 132.4 Q
(log_sys\("can't open %s", DEVICES\);)194.4 143.1 Q(devlineno = 0;)172.8
153.8 Q(})151.2 164.5 Q(again:)129.6 182.69 Q
(if \(fgets\(devline, MAXLINE, fpdev\) == NULL\))151.2 193.39 Q 21.6
(return\(-1\); /*)172.8 204.09 R(EOF */)5.4 E(devlineno++;)151.2 214.79
Q(if \(\(devptr->type = strtok\(devline, WHITE\)\) == NULL\) {)151.2
225.49 Q(if \(devline[0] == '\\n'\))172.8 236.19 Q(goto again;)194.4
246.89 Q(/* ignore empty line */)27 E
(log_quit\("missing `type' in Devices file, line %d",)172.8 257.59 Q
(devlineno\);)183.6 268.29 Q(})151.2 278.99 Q
(if \(devptr->type[0] == '#'\))151.2 289.69 Q(goto again;)172.8 300.39 Q
(/* ignore comment line */)48.6 E
(if \(\(devptr->line = strtok\(NULL, WHITE\)\) == NULL\))151.2 311.09 Q
(log_quit\("missing `line' in Devices file, line %d",)172.8 321.79 Q
(devlineno\);)183.6 332.49 Q
(if \(\(devptr->line2 = strtok\(NULL, WHITE\)\) == NULL\))151.2 343.19 Q
(log_quit\("missing `line2' in Devices file, line %d",)172.8 353.89 Q
(devlineno\);)183.6 364.59 Q
(if \(\(devptr->class = strtok\(NULL, WHITE\)\) == NULL\))151.2 375.29 Q
(log_quit\("missing `class' in Devices file, line %d",)172.8 385.99 Q
(devlineno\);)183.6 396.69 Q
(if \(\(devptr->dialer = strtok\(NULL, WHITE\)\) == NULL\))151.2 407.39
Q(log_quit\("missing `dialer' in Devices file, line %d",)172.8 418.09 Q
(devlineno\);)183.6 428.79 Q(return\(0\);)151.2 446.98 Q(})129.6 457.68
Q(void)129.6 475.87 Q(dev_rew\(void\))129.6 486.57 Q({)129.6 497.27 Q
(if \(fpdev != NULL\))151.2 507.97 Q(rewind\(fpdev\);)172.8 518.67 Q
(devlineno = 0;)151.2 529.37 Q(})129.6 540.07 Q(/*)129.6 558.26 Q 5.4
(*F)135 568.96 S(ind a match of type and class.)-5.4 E(*/)135 579.66 Q
(int)129.6 590.36 Q(dev_find\(Devices *devptr, const Systems *sysptr\))
129.6 601.06 Q({)129.6 611.76 Q(dev_rew\(\);)151.2 622.46 Q
(while \(dev_next\(devptr\) >= 0\) {)151.2 633.16 Q
(if \(strcmp\(sysptr->type, devptr->type\) == 0 &&)172.8 643.86 Q
(strcmp\(sysptr->class, devptr->class\) == 0\))194.4 654.56 Q 0 Cg EP
%%Page: 24 24
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(24)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF 27(return\(0\); /*)216 121.7 R(found a device match */)
5.4 E(})151.2 132.4 Q
(sprintf\(errmsg, "device `%s'/`%s' not found\\n", sysptr->type,)151.2
143.1 Q(sysptr->class\);)162 153.8 Q(return\(-1\);)151.2 164.5 Q(})129.6
175.2 Q .4 LW 134.6 180.001 129.6 180.001 DL 139.6 180.001 134.6 180.001
DL 144.6 180.001 139.6 180.001 DL 149.6 180.001 144.6 180.001 DL 154.6
180.001 149.6 180.001 DL 159.6 180.001 154.6 180.001 DL 164.6 180.001
159.6 180.001 DL 169.6 180.001 164.6 180.001 DL 174.6 180.001 169.6
180.001 DL 179.6 180.001 174.6 180.001 DL 184.6 180.001 179.6 180.001 DL
189.6 180.001 184.6 180.001 DL 194.6 180.001 189.6 180.001 DL 199.6
180.001 194.6 180.001 DL 204.6 180.001 199.6 180.001 DL 209.6 180.001
204.6 180.001 DL 214.6 180.001 209.6 180.001 DL 219.6 180.001 214.6
180.001 DL 224.6 180.001 219.6 180.001 DL 229.6 180.001 224.6 180.001 DL
234.6 180.001 229.6 180.001 DL 239.6 180.001 234.6 180.001 DL 244.6
180.001 239.6 180.001 DL 249.6 180.001 244.6 180.001 DL 254.6 180.001
249.6 180.001 DL 259.6 180.001 254.6 180.001 DL 264.6 180.001 259.6
180.001 DL 269.6 180.001 264.6 180.001 DL 274.6 180.001 269.6 180.001 DL
279.6 180.001 274.6 180.001 DL 284.6 180.001 279.6 180.001 DL 289.6
180.001 284.6 180.001 DL 294.6 180.001 289.6 180.001 DL 299.6 180.001
294.6 180.001 DL 304.6 180.001 299.6 180.001 DL 309.6 180.001 304.6
180.001 DL 314.6 180.001 309.6 180.001 DL 319.6 180.001 314.6 180.001 DL
324.6 180.001 319.6 180.001 DL 329.6 180.001 324.6 180.001 DL 334.6
180.001 329.6 180.001 DL 339.6 180.001 334.6 180.001 DL 344.6 180.001
339.6 180.001 DL 349.6 180.001 344.6 180.001 DL 354.6 180.001 349.6
180.001 DL 359.6 180.001 354.6 180.001 DL 364.6 180.001 359.6 180.001 DL
369.6 180.001 364.6 180.001 DL 374.6 180.001 369.6 180.001 DL 379.6
180.001 374.6 180.001 DL 384.6 180.001 379.6 180.001 DL 389.6 180.001
384.6 180.001 DL 394.6 180.001 389.6 180.001 DL 399.6 180.001 394.6
180.001 DL 404.6 180.001 399.6 180.001 DL 409.6 180.001 404.6 180.001 DL
414.6 180.001 409.6 180.001 DL 419.6 180.001 414.6 180.001 DL 424.6
180.001 419.6 180.001 DL 429.6 180.001 424.6 180.001 DL 434.6 180.001
429.6 180.001 DL 439.6 180.001 434.6 180.001 DL 444.6 180.001 439.6
180.001 DL 449.6 180.001 444.6 180.001 DL 454.6 180.001 449.6 180.001 DL
459.6 180.001 454.6 180.001 DL 464.6 180.001 459.6 180.001 DL 469.6
180.001 464.6 180.001 DL 474.6 180.001 469.6 180.001 DL 479.6 180.001
474.6 180.001 DL 484.6 180.001 479.6 180.001 DL 489.6 180.001 484.6
180.001 DL 494.6 180.001 489.6 180.001 DL 499.6 180.001 494.6 180.001 DL
504.6 180.001 499.6 180.001 DL 509.6 180.001 504.6 180.001 DL 514.6
180.001 509.6 180.001 DL 519.6 180.001 514.6 180.001 DL/F3 8
/Palatino-Bold@0 SF(Figure 15)242.424 196.001 Q/F4 8/Palatino-Roman@0 SF
(Functions for r)6 E(eading)-.144 E/F5 8/Courier@0 SF(Devices)2 E F4
(\214le)2 E/F6 10/Palatino-Roman@0 SF -.92(We)129.6 220.001 S 1.262
('ll see that the).92 F/F7 10/Courier@0 SF(request)3.762 E F6 1.262
(function calls)3.762 F F7(dev_find)3.762 E F6 1.262
(to locate an entry with)3.762 F/F8 10/Palatino-Italic@0 SF(type)3.763 E
F6(and)3.763 E F8(class)129.6 232.001 Q F6
(\214elds that match an entry in the)2.5 E F7(Systems)2.5 E F6(\214le.)
2.5 E(Figur)147.6 244.001 Q 2.5(e1)-.18 G 2.5(6c)-2.5 G
(ontains the functions for r)-2.5 E(eading the)-.18 E F7(Dialers)2.5 E
F6(\214le.)2.5 E 134.6 251.201 129.6 251.201 DL 139.6 251.201 134.6
251.201 DL 144.6 251.201 139.6 251.201 DL 149.6 251.201 144.6 251.201 DL
154.6 251.201 149.6 251.201 DL 159.6 251.201 154.6 251.201 DL 164.6
251.201 159.6 251.201 DL 169.6 251.201 164.6 251.201 DL 174.6 251.201
169.6 251.201 DL 179.6 251.201 174.6 251.201 DL 184.6 251.201 179.6
251.201 DL 189.6 251.201 184.6 251.201 DL 194.6 251.201 189.6 251.201 DL
199.6 251.201 194.6 251.201 DL 204.6 251.201 199.6 251.201 DL 209.6
251.201 204.6 251.201 DL 214.6 251.201 209.6 251.201 DL 219.6 251.201
214.6 251.201 DL 224.6 251.201 219.6 251.201 DL 229.6 251.201 224.6
251.201 DL 234.6 251.201 229.6 251.201 DL 239.6 251.201 234.6 251.201 DL
244.6 251.201 239.6 251.201 DL 249.6 251.201 244.6 251.201 DL 254.6
251.201 249.6 251.201 DL 259.6 251.201 254.6 251.201 DL 264.6 251.201
259.6 251.201 DL 269.6 251.201 264.6 251.201 DL 274.6 251.201 269.6
251.201 DL 279.6 251.201 274.6 251.201 DL 284.6 251.201 279.6 251.201 DL
289.6 251.201 284.6 251.201 DL 294.6 251.201 289.6 251.201 DL 299.6
251.201 294.6 251.201 DL 304.6 251.201 299.6 251.201 DL 309.6 251.201
304.6 251.201 DL 314.6 251.201 309.6 251.201 DL 319.6 251.201 314.6
251.201 DL 324.6 251.201 319.6 251.201 DL 329.6 251.201 324.6 251.201 DL
334.6 251.201 329.6 251.201 DL 339.6 251.201 334.6 251.201 DL 344.6
251.201 339.6 251.201 DL 349.6 251.201 344.6 251.201 DL 354.6 251.201
349.6 251.201 DL 359.6 251.201 354.6 251.201 DL 364.6 251.201 359.6
251.201 DL 369.6 251.201 364.6 251.201 DL 374.6 251.201 369.6 251.201 DL
379.6 251.201 374.6 251.201 DL 384.6 251.201 379.6 251.201 DL 389.6
251.201 384.6 251.201 DL 394.6 251.201 389.6 251.201 DL 399.6 251.201
394.6 251.201 DL 404.6 251.201 399.6 251.201 DL 409.6 251.201 404.6
251.201 DL 414.6 251.201 409.6 251.201 DL 419.6 251.201 414.6 251.201 DL
424.6 251.201 419.6 251.201 DL 429.6 251.201 424.6 251.201 DL 434.6
251.201 429.6 251.201 DL 439.6 251.201 434.6 251.201 DL 444.6 251.201
439.6 251.201 DL 449.6 251.201 444.6 251.201 DL 454.6 251.201 449.6
251.201 DL 459.6 251.201 454.6 251.201 DL 464.6 251.201 459.6 251.201 DL
469.6 251.201 464.6 251.201 DL 474.6 251.201 469.6 251.201 DL 479.6
251.201 474.6 251.201 DL 484.6 251.201 479.6 251.201 DL 489.6 251.201
484.6 251.201 DL 494.6 251.201 489.6 251.201 DL 499.6 251.201 494.6
251.201 DL 504.6 251.201 499.6 251.201 DL 509.6 251.201 504.6 251.201 DL
514.6 251.201 509.6 251.201 DL 519.6 251.201 514.6 251.201 DL F2 16.2
(#include "calld.h")129.6 260.702 R(static FILE *fpdial = NULL;)129.6
278.892 Q(static int)129.6 289.592 Q 43.2(diallineno; /*)10.8 F
(for error messages */)5.4 E(static char dialline[MAXLINE];)129.6
300.292 Q
(/* can't be automatic; dial_next\(\) returns pointers into here */)
172.8 310.992 Q(/*)129.6 329.182 Q 5.4(*R)135 339.882 S
(ead and break apart a line in the Dialers file.)-5.4 E(*/)135 350.582 Q
(int)129.6 361.282 Q(dial_next\(Dialers *dialptr\) /* pointers in struc\
ture are filled in */)129.6 371.982 Q({)129.6 382.682 Q
(if \(fpdial == NULL\) {)151.2 393.382 Q
(if \(\(fpdial = fopen\(DIALERS, "r"\)\) == NULL\))172.8 404.082 Q
(log_sys\("can't open %s", DIALERS\);)194.4 414.782 Q(diallineno = 0;)
172.8 425.482 Q(})151.2 436.182 Q(again:)129.6 454.372 Q
(if \(fgets\(dialline, MAXLINE, fpdial\) == NULL\))151.2 465.072 Q 21.6
(return\(-1\); /*)172.8 475.772 R(EOF */)5.4 E(diallineno++;)151.2
486.472 Q
(if \(\(dialptr->dialer = strtok\(dialline, WHITE\)\) == NULL\) {)151.2
497.172 Q(if \(dialline[0] == '\\n'\))172.8 507.872 Q(goto again;)194.4
518.572 Q(/* ignore empty line */)27 E
(log_quit\("missing `dialer' in Dialers file, line %d",)172.8 529.272 Q
(diallineno\);)183.6 539.972 Q(})151.2 550.672 Q
(if \(dialptr->dialer[0] == '#'\))151.2 561.372 Q(goto again;)172.8
572.072 Q(/* ignore comment line */)48.6 E
(if \(\(dialptr->sub = strtok\(NULL, WHITE\)\) == NULL\))151.2 582.772 Q
(log_quit\("missing `sub' in Dialers file, line %d",)172.8 593.472 Q
(diallineno\);)183.6 604.172 Q
(if \(\(dialptr->expsend = strtok\(NULL, "\\n"\)\) == NULL\))151.2
614.872 Q(log_quit\("missing `expsend' in Dialers file, line %d",)172.8
625.572 Q(diallineno\);)183.6 636.272 Q(return\(0\);)151.2 654.462 Q 0
Cg EP
%%Page: 25 25
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(25)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(})129.6 121.7 Q(void)129.6 139.89 Q
(dial_rew\(void\))129.6 150.59 Q({)129.6 161.29 Q(if \(fpdial != NULL\))
151.2 171.99 Q(rewind\(fpdial\);)172.8 182.69 Q(diallineno = 0;)151.2
193.39 Q(})129.6 204.09 Q(/*)129.6 222.28 Q 5.4(*F)135 232.98 S
(ind a dialer match.)-5.4 E(*/)135 243.68 Q(int)129.6 254.38 Q
(dial_find\(Dialers *dialptr, const Devices *devptr\))129.6 265.08 Q({)
129.6 275.78 Q(dial_rew\(\);)151.2 286.48 Q
(while \(dial_next\(dialptr\) >= 0\) {)151.2 297.18 Q
(if \(strcmp\(dialptr->dialer, devptr->dialer\) == 0\))172.8 307.88 Q 27
(return\(0\); /*)194.4 318.58 R(found a dialer match */)5.4 E(})151.2
329.28 Q
(sprintf\(errmsg, "dialer `%s' not found\\n", dialptr->dialer\);)151.2
339.98 Q(return\(-1\);)151.2 350.68 Q(})129.6 361.38 Q .4 LW 134.6
366.181 129.6 366.181 DL 139.6 366.181 134.6 366.181 DL 144.6 366.181
139.6 366.181 DL 149.6 366.181 144.6 366.181 DL 154.6 366.181 149.6
366.181 DL 159.6 366.181 154.6 366.181 DL 164.6 366.181 159.6 366.181 DL
169.6 366.181 164.6 366.181 DL 174.6 366.181 169.6 366.181 DL 179.6
366.181 174.6 366.181 DL 184.6 366.181 179.6 366.181 DL 189.6 366.181
184.6 366.181 DL 194.6 366.181 189.6 366.181 DL 199.6 366.181 194.6
366.181 DL 204.6 366.181 199.6 366.181 DL 209.6 366.181 204.6 366.181 DL
214.6 366.181 209.6 366.181 DL 219.6 366.181 214.6 366.181 DL 224.6
366.181 219.6 366.181 DL 229.6 366.181 224.6 366.181 DL 234.6 366.181
229.6 366.181 DL 239.6 366.181 234.6 366.181 DL 244.6 366.181 239.6
366.181 DL 249.6 366.181 244.6 366.181 DL 254.6 366.181 249.6 366.181 DL
259.6 366.181 254.6 366.181 DL 264.6 366.181 259.6 366.181 DL 269.6
366.181 264.6 366.181 DL 274.6 366.181 269.6 366.181 DL 279.6 366.181
274.6 366.181 DL 284.6 366.181 279.6 366.181 DL 289.6 366.181 284.6
366.181 DL 294.6 366.181 289.6 366.181 DL 299.6 366.181 294.6 366.181 DL
304.6 366.181 299.6 366.181 DL 309.6 366.181 304.6 366.181 DL 314.6
366.181 309.6 366.181 DL 319.6 366.181 314.6 366.181 DL 324.6 366.181
319.6 366.181 DL 329.6 366.181 324.6 366.181 DL 334.6 366.181 329.6
366.181 DL 339.6 366.181 334.6 366.181 DL 344.6 366.181 339.6 366.181 DL
349.6 366.181 344.6 366.181 DL 354.6 366.181 349.6 366.181 DL 359.6
366.181 354.6 366.181 DL 364.6 366.181 359.6 366.181 DL 369.6 366.181
364.6 366.181 DL 374.6 366.181 369.6 366.181 DL 379.6 366.181 374.6
366.181 DL 384.6 366.181 379.6 366.181 DL 389.6 366.181 384.6 366.181 DL
394.6 366.181 389.6 366.181 DL 399.6 366.181 394.6 366.181 DL 404.6
366.181 399.6 366.181 DL 409.6 366.181 404.6 366.181 DL 414.6 366.181
409.6 366.181 DL 419.6 366.181 414.6 366.181 DL 424.6 366.181 419.6
366.181 DL 429.6 366.181 424.6 366.181 DL 434.6 366.181 429.6 366.181 DL
439.6 366.181 434.6 366.181 DL 444.6 366.181 439.6 366.181 DL 449.6
366.181 444.6 366.181 DL 454.6 366.181 449.6 366.181 DL 459.6 366.181
454.6 366.181 DL 464.6 366.181 459.6 366.181 DL 469.6 366.181 464.6
366.181 DL 474.6 366.181 469.6 366.181 DL 479.6 366.181 474.6 366.181 DL
484.6 366.181 479.6 366.181 DL 489.6 366.181 484.6 366.181 DL 494.6
366.181 489.6 366.181 DL 499.6 366.181 494.6 366.181 DL 504.6 366.181
499.6 366.181 DL 509.6 366.181 504.6 366.181 DL 514.6 366.181 509.6
366.181 DL 519.6 366.181 514.6 366.181 DL/F3 8/Palatino-Bold@0 SF
(Figure 16)242.424 382.181 Q/F4 8/Palatino-Roman@0 SF(Functions for r)6
E(eading)-.144 E/F5 8/Courier@0 SF(Dialers)2 E F4(\214le)2 E/F6 10
/Palatino-Roman@0 SF -.92(We)129.6 406.181 S .566('ll see that the).92 F
/F7 10/Courier@0 SF(child_dial)3.066 E F6 .566(function calls)3.066 F F7
(dial_find)3.066 E F6 .565(to \214nd an entry with a)3.066 F/F8 10
/Palatino-Italic@0 SF(dialer)3.065 E F6
(\214eld that matches a particular device.)129.6 418.181 Q .272(Note fr)
147.6 430.181 R .272(om Figur)-.18 F 2.772(e6t)-.18 G .272(hat the)
-2.772 F F7(Systems)2.772 E F6(and)2.772 E F7(Devices)2.772 E F6 .272
(\214les ar)2.772 F 2.772(eh)-.18 G .273(andled by the par)-2.772 F
(ent,)-.18 E .581(while the)129.6 442.181 R F7(Dialers)3.081 E F6 .58
(\214le is handled by the child.)3.081 F .58
(This was one of the design goals)5.58 F .833<8a74>.833 G(he)-.833 E
(par)129.6 454.181 Q 1.396
(ent \214nds a matching device that is not locked and)-.18 F F7(fork)
3.896 E F6 3.896(sac)C 1.397(hild to do the actual)-3.896 F(dialing.)
129.6 466.181 Q 1.845 -.92(We l)147.6 478.181 T .005(ook at the).92 F F7
(request)2.505 E F6 .005(function in Figur)2.505 F 2.504(e1)-.18 G 2.504
(7. It)-2.504 F .004(was called by the)2.504 F F7(loop)2.504 E F6 .004
(function to)2.504 F .061
(try to locate an unlocked device for the speci\214ed r)129.6 490.181 R
.061(emote host.)-.18 F 1.901 -.92(To d)5.061 H 2.562(ot).92 G .062
(his it goes thr)-2.562 F(ough)-.18 E(the)129.6 502.181 Q F7(Systems)
3.751 E F6 1.251(\214le, then the)3.751 F F7(Devices)3.751 E F6 3.751
(\214le. If)3.751 F 3.751(am)3.751 G 1.25(atch is found, a child is)
-3.751 F F7(fork)3.75 E F6 3.75(ed. W)B(e)-.92 E 1.009
(allow the client to specify a speed, in addition to the name of the r)
129.6 514.181 R 1.01(emote system.)-.18 F(For)6.01 E(example, with the)
129.6 526.181 Q F7(Systems)2.5 E F6(\214le in Figur)2.5 E 2.5(e2)-.18 G
2.5(,t)-2.5 G(he client's r)-2.5 E(equest can look like)-.18 E F2
(call -s 9600 host1)147.6 542.881 Q F6(which causes us to ignor)129.6
560.881 Q 2.5(et)-.18 G(he other two entries for)-2.5 E F7(host1)2.5 E
F6(in Figur)2.5 E 2.5(e2)-.18 G(.)-2.5 E 2.383(Note that we can't r)
147.6 572.881 R(ecor)-.18 E 4.882(dt)-.18 G 2.382(he device lock using)
-4.882 F F7(lock_set)4.882 E F6 2.382(until we know the)4.882 F(pr)129.6
584.881 Q .945(ocess ID of the child \(i.e., after the)-.18 F F7(fork)
3.445 E F6 .946(\), but we have to test whether the device is)B 1.264
(locked befor)129.6 596.881 R 3.764(et)-.18 G(he)-3.764 E F7(fork)3.764
E F6 6.264(.S)C 1.264
(ince we don't want the child starting until we have set the)-6.264 F
1.848(lock, we use the)129.6 608.881 R F7(TELL_WAIT)4.348 E F6 1.848
(functions \(Figur)4.348 F 4.348(e1)-.18 G 1.848(0.24\) to synchr)-4.348
F 1.849(onize the par)-.18 F 1.849(ent and)-.18 F 2.872(child. Also)
129.6 620.881 R .372(note that although the test)2.872 F F7(is_locked)
2.871 E F6 .371(and the actual setting of the lock by)2.871 F F7
(set_lock)129.6 632.881 Q F6(ar)3.5 E 3.5(et)-.18 G 1.001(wo separate o\
perations \(i.e., not a single atomic operation\), we do not)-3.5 F
1.958(have a race condition.)129.6 644.881 R 1.957(This is because)6.957
F F7(request)4.457 E F6 1.957(is called only by the single par)4.457 F
(ent)-.18 E(server daemon)129.6 656.881 Q .833<8a69>.833 G 2.5(ti)-.833
G 2.5(sn)-2.5 G(ot called by multiple pr)-2.5 E(ocesses.)-.18 E 0 Cg EP
%%Page: 26 26
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(26)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF(If)147.6 123 Q/F3 10/Courier@0 SF(request)2.608 E
F2 -.18(re)2.608 G .108(turns 0, a child was).18 F F3(fork)2.609 E F2
.109(ed to start the dial; otherwise it r)B(eturns)-.18 E/F4 10/Symbol
SF(-)2.609 E F2 2.609(1t)C(o)-2.609 E 2.279
(indicate that either the name of the r)129.6 135 R 2.278
(emote system wasn't valid or all the possible)-.18 F(devices for the r)
129.6 147 Q(emote system wer)-.18 E 2.5(el)-.18 G(ocked.)-2.5 E .4 LW
134.6 154.2 129.6 154.2 DL 139.6 154.2 134.6 154.2 DL 144.6 154.2 139.6
154.2 DL 149.6 154.2 144.6 154.2 DL 154.6 154.2 149.6 154.2 DL 159.6
154.2 154.6 154.2 DL 164.6 154.2 159.6 154.2 DL 169.6 154.2 164.6 154.2
DL 174.6 154.2 169.6 154.2 DL 179.6 154.2 174.6 154.2 DL 184.6 154.2
179.6 154.2 DL 189.6 154.2 184.6 154.2 DL 194.6 154.2 189.6 154.2 DL
199.6 154.2 194.6 154.2 DL 204.6 154.2 199.6 154.2 DL 209.6 154.2 204.6
154.2 DL 214.6 154.2 209.6 154.2 DL 219.6 154.2 214.6 154.2 DL 224.6
154.2 219.6 154.2 DL 229.6 154.2 224.6 154.2 DL 234.6 154.2 229.6 154.2
DL 239.6 154.2 234.6 154.2 DL 244.6 154.2 239.6 154.2 DL 249.6 154.2
244.6 154.2 DL 254.6 154.2 249.6 154.2 DL 259.6 154.2 254.6 154.2 DL
264.6 154.2 259.6 154.2 DL 269.6 154.2 264.6 154.2 DL 274.6 154.2 269.6
154.2 DL 279.6 154.2 274.6 154.2 DL 284.6 154.2 279.6 154.2 DL 289.6
154.2 284.6 154.2 DL 294.6 154.2 289.6 154.2 DL 299.6 154.2 294.6 154.2
DL 304.6 154.2 299.6 154.2 DL 309.6 154.2 304.6 154.2 DL 314.6 154.2
309.6 154.2 DL 319.6 154.2 314.6 154.2 DL 324.6 154.2 319.6 154.2 DL
329.6 154.2 324.6 154.2 DL 334.6 154.2 329.6 154.2 DL 339.6 154.2 334.6
154.2 DL 344.6 154.2 339.6 154.2 DL 349.6 154.2 344.6 154.2 DL 354.6
154.2 349.6 154.2 DL 359.6 154.2 354.6 154.2 DL 364.6 154.2 359.6 154.2
DL 369.6 154.2 364.6 154.2 DL 374.6 154.2 369.6 154.2 DL 379.6 154.2
374.6 154.2 DL 384.6 154.2 379.6 154.2 DL 389.6 154.2 384.6 154.2 DL
394.6 154.2 389.6 154.2 DL 399.6 154.2 394.6 154.2 DL 404.6 154.2 399.6
154.2 DL 409.6 154.2 404.6 154.2 DL 414.6 154.2 409.6 154.2 DL 419.6
154.2 414.6 154.2 DL 424.6 154.2 419.6 154.2 DL 429.6 154.2 424.6 154.2
DL 434.6 154.2 429.6 154.2 DL 439.6 154.2 434.6 154.2 DL 444.6 154.2
439.6 154.2 DL 449.6 154.2 444.6 154.2 DL 454.6 154.2 449.6 154.2 DL
459.6 154.2 454.6 154.2 DL 464.6 154.2 459.6 154.2 DL 469.6 154.2 464.6
154.2 DL 474.6 154.2 469.6 154.2 DL 479.6 154.2 474.6 154.2 DL 484.6
154.2 479.6 154.2 DL 489.6 154.2 484.6 154.2 DL 494.6 154.2 489.6 154.2
DL 499.6 154.2 494.6 154.2 DL 504.6 154.2 499.6 154.2 DL 509.6 154.2
504.6 154.2 DL 514.6 154.2 509.6 154.2 DL 519.6 154.2 514.6 154.2 DL/F5
9/Courier@0 SF 16.2(#include "calld.h")129.6 163.701 R 129.6(int /*)
129.6 180.821 R(return 0 if OK, -1 on error */)5.4 E
(request\(Client *cliptr\))129.6 191.521 Q({)129.6 202.221 Q 10.8
(pid_t pid;)151.2 212.921 R(/*)151.2 230.041 Q 5.4(*P)156.6 240.741 S
(osition where this client left off last \(or rewind\).)-5.4 E(*/)156.6
251.441 Q(errmsg[0] = 0;)151.2 262.141 Q(sys_posn\(cliptr->sysftell\);)
151.2 272.841 Q
(while \(\(cliptr->sysftell = sys_next\(&systems\)\) >= 0\) {)151.2
283.541 Q(if \(strcmp\(cliptr->sysname, systems.name\) == 0\) {)172.8
294.241 Q(/*)194.4 304.941 Q 5.4(*S)199.8 315.641 S(ystem match;)-5.4 E
5.4(*i)199.8 326.341 S 5.4(fc)-5.4 G
(lient specified a speed, it must match too.)-5.4 E(*/)199.8 337.041 Q
(if \(cliptr->speed[0] != 0 &&)194.4 347.741 Q
(strcmp\(cliptr->speed, systems.class\) != 0\))216 358.441 Q 10.8
(continue; /*)237.6 369.141 R(speeds don't match */)5.4 E
(DEBUG\("trying sys: %s, %s, %s, %s", systems.name,)194.4 386.261 Q
(systems.type, systems.class, systems.phone\);)205.2 396.961 Q
(cliptr->foundone++;)194.4 407.661 Q
(if \(dev_find\(&devices, &systems\) < 0\))194.4 418.361 Q(break;)216
429.061 Q(DEBUG\("trying dev: %s, %s, %s, %s", devices.type,)194.4
446.181 Q(devices.line, devices.class, devices.dialer\);)205.2 456.881 Q
(if \(\(pid = is_locked\(devices.line\)\) != 0\) {)194.4 467.581 Q
(sprintf\(errmsg, "device `%s' already locked by pid %d\\n",)216 478.281
Q(devices.line, pid\);)226.8 488.981 Q 10.8(continue; /*)216 499.681 R
(look for another entry in Systems file */)5.4 E(})194.4 510.381 Q(/*)
194.4 527.501 Q 5.4(*W)199.8 538.201 S
(e've found a device that's not locked.)-5.4 E 5.4(*f)199.8 548.901 S
(ork\(\) a child to to the actual dialing.)-5.4 E(*/)199.8 559.601 Q
(TELL_WAIT\(\);)194.4 570.301 Q(if \(\(cliptr->pid = fork\(\)\) < 0\) {)
194.4 581.001 Q(log_sys\("fork error"\);)216 591.701 Q 5.4(}e)194.4
602.401 S(lse if \(cliptr->pid == 0\) {)-5.4 E(/* child */)10.8 E 27
(WAIT_PARENT\(\); /*)216 613.101 R(let parent set lock */)5.4 E
(child_dial\(cliptr\); /* never returns */)216 623.801 Q(})194.4 634.501
Q(/* parent */)194.4 651.621 Q 0 Cg EP
%%Page: 27 27
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(27)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(lock_set\(devices.line, cliptr->pid\);)194.4
121.7 Q(/*)194.4 138.82 Q 5.4(*L)199.8 149.52 S
(et child resume, now that lock is set.)-5.4 E(*/)199.8 160.22 Q
(TELL_CHILD\(cliptr->pid\);)194.4 170.92 Q 5.4(return\(0\); /*)194.4
181.62 R(we've started a child */)5.4 E(})172.8 192.32 Q(})151.2 203.02
Q(/*)151.2 220.14 Q 5.4(*R)156.6 230.84 S(eached EOF on Systems file.)
-5.4 E(*/)156.6 241.54 Q(if \(cliptr->foundone == 0\))151.2 252.24 Q
(sprintf\(errmsg, "system `%s' not found\\n", cliptr->sysname\);)172.8
262.94 Q(else if \(errmsg[0] == 0\))151.2 273.64 Q
(sprintf\(errmsg, "unable to connect to system `%s'\\n",)172.8 284.34 Q
(cliptr->sysname\);)183.6 295.04 Q 21.6(return\(-1\); /*)151.2 305.74 R
(also, cliptr->sysftell is -1 */)5.4 E(})129.6 316.44 Q .4 LW 134.6
321.241 129.6 321.241 DL 139.6 321.241 134.6 321.241 DL 144.6 321.241
139.6 321.241 DL 149.6 321.241 144.6 321.241 DL 154.6 321.241 149.6
321.241 DL 159.6 321.241 154.6 321.241 DL 164.6 321.241 159.6 321.241 DL
169.6 321.241 164.6 321.241 DL 174.6 321.241 169.6 321.241 DL 179.6
321.241 174.6 321.241 DL 184.6 321.241 179.6 321.241 DL 189.6 321.241
184.6 321.241 DL 194.6 321.241 189.6 321.241 DL 199.6 321.241 194.6
321.241 DL 204.6 321.241 199.6 321.241 DL 209.6 321.241 204.6 321.241 DL
214.6 321.241 209.6 321.241 DL 219.6 321.241 214.6 321.241 DL 224.6
321.241 219.6 321.241 DL 229.6 321.241 224.6 321.241 DL 234.6 321.241
229.6 321.241 DL 239.6 321.241 234.6 321.241 DL 244.6 321.241 239.6
321.241 DL 249.6 321.241 244.6 321.241 DL 254.6 321.241 249.6 321.241 DL
259.6 321.241 254.6 321.241 DL 264.6 321.241 259.6 321.241 DL 269.6
321.241 264.6 321.241 DL 274.6 321.241 269.6 321.241 DL 279.6 321.241
274.6 321.241 DL 284.6 321.241 279.6 321.241 DL 289.6 321.241 284.6
321.241 DL 294.6 321.241 289.6 321.241 DL 299.6 321.241 294.6 321.241 DL
304.6 321.241 299.6 321.241 DL 309.6 321.241 304.6 321.241 DL 314.6
321.241 309.6 321.241 DL 319.6 321.241 314.6 321.241 DL 324.6 321.241
319.6 321.241 DL 329.6 321.241 324.6 321.241 DL 334.6 321.241 329.6
321.241 DL 339.6 321.241 334.6 321.241 DL 344.6 321.241 339.6 321.241 DL
349.6 321.241 344.6 321.241 DL 354.6 321.241 349.6 321.241 DL 359.6
321.241 354.6 321.241 DL 364.6 321.241 359.6 321.241 DL 369.6 321.241
364.6 321.241 DL 374.6 321.241 369.6 321.241 DL 379.6 321.241 374.6
321.241 DL 384.6 321.241 379.6 321.241 DL 389.6 321.241 384.6 321.241 DL
394.6 321.241 389.6 321.241 DL 399.6 321.241 394.6 321.241 DL 404.6
321.241 399.6 321.241 DL 409.6 321.241 404.6 321.241 DL 414.6 321.241
409.6 321.241 DL 419.6 321.241 414.6 321.241 DL 424.6 321.241 419.6
321.241 DL 429.6 321.241 424.6 321.241 DL 434.6 321.241 429.6 321.241 DL
439.6 321.241 434.6 321.241 DL 444.6 321.241 439.6 321.241 DL 449.6
321.241 444.6 321.241 DL 454.6 321.241 449.6 321.241 DL 459.6 321.241
454.6 321.241 DL 464.6 321.241 459.6 321.241 DL 469.6 321.241 464.6
321.241 DL 474.6 321.241 469.6 321.241 DL 479.6 321.241 474.6 321.241 DL
484.6 321.241 479.6 321.241 DL 489.6 321.241 484.6 321.241 DL 494.6
321.241 489.6 321.241 DL 499.6 321.241 494.6 321.241 DL 504.6 321.241
499.6 321.241 DL 509.6 321.241 504.6 321.241 DL 514.6 321.241 509.6
321.241 DL 519.6 321.241 514.6 321.241 DL/F3 8/Palatino-Bold@0 SF
(Figure 17)264.496 337.241 Q/F4 8/Palatino-Roman@0 SF(The)6 E/F5 8
/Courier@0 SF(request)2 E F4(function)2 E/F6 10/Palatino-Roman@0 SF
1.837(The last of the par)147.6 361.241 R 1.837
(ent-speci\214c functions is)-.18 F/F7 10/Courier@0 SF(sig_chld)4.338 E
F6 4.338(,t)C 1.838(he signal handler for the)-4.338 F F7(SIGCHLD)129.6
373.241 Q F6 2.5(signal. This)2.5 F(is shown in Figur)2.5 E 2.5(e1)-.18
G(8.)-2.5 E 134.6 380.441 129.6 380.441 DL 139.6 380.441 134.6 380.441
DL 144.6 380.441 139.6 380.441 DL 149.6 380.441 144.6 380.441 DL 154.6
380.441 149.6 380.441 DL 159.6 380.441 154.6 380.441 DL 164.6 380.441
159.6 380.441 DL 169.6 380.441 164.6 380.441 DL 174.6 380.441 169.6
380.441 DL 179.6 380.441 174.6 380.441 DL 184.6 380.441 179.6 380.441 DL
189.6 380.441 184.6 380.441 DL 194.6 380.441 189.6 380.441 DL 199.6
380.441 194.6 380.441 DL 204.6 380.441 199.6 380.441 DL 209.6 380.441
204.6 380.441 DL 214.6 380.441 209.6 380.441 DL 219.6 380.441 214.6
380.441 DL 224.6 380.441 219.6 380.441 DL 229.6 380.441 224.6 380.441 DL
234.6 380.441 229.6 380.441 DL 239.6 380.441 234.6 380.441 DL 244.6
380.441 239.6 380.441 DL 249.6 380.441 244.6 380.441 DL 254.6 380.441
249.6 380.441 DL 259.6 380.441 254.6 380.441 DL 264.6 380.441 259.6
380.441 DL 269.6 380.441 264.6 380.441 DL 274.6 380.441 269.6 380.441 DL
279.6 380.441 274.6 380.441 DL 284.6 380.441 279.6 380.441 DL 289.6
380.441 284.6 380.441 DL 294.6 380.441 289.6 380.441 DL 299.6 380.441
294.6 380.441 DL 304.6 380.441 299.6 380.441 DL 309.6 380.441 304.6
380.441 DL 314.6 380.441 309.6 380.441 DL 319.6 380.441 314.6 380.441 DL
324.6 380.441 319.6 380.441 DL 329.6 380.441 324.6 380.441 DL 334.6
380.441 329.6 380.441 DL 339.6 380.441 334.6 380.441 DL 344.6 380.441
339.6 380.441 DL 349.6 380.441 344.6 380.441 DL 354.6 380.441 349.6
380.441 DL 359.6 380.441 354.6 380.441 DL 364.6 380.441 359.6 380.441 DL
369.6 380.441 364.6 380.441 DL 374.6 380.441 369.6 380.441 DL 379.6
380.441 374.6 380.441 DL 384.6 380.441 379.6 380.441 DL 389.6 380.441
384.6 380.441 DL 394.6 380.441 389.6 380.441 DL 399.6 380.441 394.6
380.441 DL 404.6 380.441 399.6 380.441 DL 409.6 380.441 404.6 380.441 DL
414.6 380.441 409.6 380.441 DL 419.6 380.441 414.6 380.441 DL 424.6
380.441 419.6 380.441 DL 429.6 380.441 424.6 380.441 DL 434.6 380.441
429.6 380.441 DL 439.6 380.441 434.6 380.441 DL 444.6 380.441 439.6
380.441 DL 449.6 380.441 444.6 380.441 DL 454.6 380.441 449.6 380.441 DL
459.6 380.441 454.6 380.441 DL 464.6 380.441 459.6 380.441 DL 469.6
380.441 464.6 380.441 DL 474.6 380.441 469.6 380.441 DL 479.6 380.441
474.6 380.441 DL 484.6 380.441 479.6 380.441 DL 489.6 380.441 484.6
380.441 DL 494.6 380.441 489.6 380.441 DL 499.6 380.441 494.6 380.441 DL
504.6 380.441 499.6 380.441 DL 509.6 380.441 504.6 380.441 DL 514.6
380.441 509.6 380.441 DL 519.6 380.441 514.6 380.441 DL F2 16.2
(#include "calld.h")129.6 389.942 R 16.2(#include <sys/wait.h>)129.6
400.642 R(/*)129.6 417.762 Q 5.4(*S)135 428.462 S
(IGCHLD handler, invoked when a child terminates.)-5.4 E 5.4(*P)135
439.162 S(robably interrupts accept\(\) in serv_accept\(\).)-5.4 E(*/)
135 449.862 Q(void)129.6 460.562 Q(sig_chld\(int signo\))129.6 471.262 Q
({)129.6 481.962 Q 21.6(int stat,)151.2 492.662 R(errno_save;)5.4 E 10.8
(pid_t pid;)151.2 503.362 R(errno_save = errno;)151.2 520.482 Q
(/* log_msg\(\) might change errno */)27 E(chld_flag = 1;)151.2 531.182
Q(if \(\(pid = waitpid\(-1, &stat, 0\)\) <= 0\))151.2 541.882 Q
(log_sys\("waitpid error"\);)172.8 552.582 Q(if \(WIFEXITED\(stat\) != \
0\) /* set client childdone status for loop */)151.2 569.702 Q
(client_sigchld\(pid, WEXITSTATUS\(stat\)+1\);)172.8 580.402 Q(else)
151.2 591.102 Q
(log_msg\("child %d terminated abnormally: %04x", pid, stat\);)172.8
601.802 Q(errno = errno_save;)151.2 618.922 Q(})129.6 629.622 Q 134.6
634.423 129.6 634.423 DL 139.6 634.423 134.6 634.423 DL 144.6 634.423
139.6 634.423 DL 149.6 634.423 144.6 634.423 DL 154.6 634.423 149.6
634.423 DL 159.6 634.423 154.6 634.423 DL 164.6 634.423 159.6 634.423 DL
169.6 634.423 164.6 634.423 DL 174.6 634.423 169.6 634.423 DL 179.6
634.423 174.6 634.423 DL 184.6 634.423 179.6 634.423 DL 189.6 634.423
184.6 634.423 DL 194.6 634.423 189.6 634.423 DL 199.6 634.423 194.6
634.423 DL 204.6 634.423 199.6 634.423 DL 209.6 634.423 204.6 634.423 DL
214.6 634.423 209.6 634.423 DL 219.6 634.423 214.6 634.423 DL 224.6
634.423 219.6 634.423 DL 229.6 634.423 224.6 634.423 DL 234.6 634.423
229.6 634.423 DL 239.6 634.423 234.6 634.423 DL 244.6 634.423 239.6
634.423 DL 249.6 634.423 244.6 634.423 DL 254.6 634.423 249.6 634.423 DL
259.6 634.423 254.6 634.423 DL 264.6 634.423 259.6 634.423 DL 269.6
634.423 264.6 634.423 DL 274.6 634.423 269.6 634.423 DL 279.6 634.423
274.6 634.423 DL 284.6 634.423 279.6 634.423 DL 289.6 634.423 284.6
634.423 DL 294.6 634.423 289.6 634.423 DL 299.6 634.423 294.6 634.423 DL
304.6 634.423 299.6 634.423 DL 309.6 634.423 304.6 634.423 DL 314.6
634.423 309.6 634.423 DL 319.6 634.423 314.6 634.423 DL 324.6 634.423
319.6 634.423 DL 329.6 634.423 324.6 634.423 DL 334.6 634.423 329.6
634.423 DL 339.6 634.423 334.6 634.423 DL 344.6 634.423 339.6 634.423 DL
349.6 634.423 344.6 634.423 DL 354.6 634.423 349.6 634.423 DL 359.6
634.423 354.6 634.423 DL 364.6 634.423 359.6 634.423 DL 369.6 634.423
364.6 634.423 DL 374.6 634.423 369.6 634.423 DL 379.6 634.423 374.6
634.423 DL 384.6 634.423 379.6 634.423 DL 389.6 634.423 384.6 634.423 DL
394.6 634.423 389.6 634.423 DL 399.6 634.423 394.6 634.423 DL 404.6
634.423 399.6 634.423 DL 409.6 634.423 404.6 634.423 DL 414.6 634.423
409.6 634.423 DL 419.6 634.423 414.6 634.423 DL 424.6 634.423 419.6
634.423 DL 429.6 634.423 424.6 634.423 DL 434.6 634.423 429.6 634.423 DL
439.6 634.423 434.6 634.423 DL 444.6 634.423 439.6 634.423 DL 449.6
634.423 444.6 634.423 DL 454.6 634.423 449.6 634.423 DL 459.6 634.423
454.6 634.423 DL 464.6 634.423 459.6 634.423 DL 469.6 634.423 464.6
634.423 DL 474.6 634.423 469.6 634.423 DL 479.6 634.423 474.6 634.423 DL
484.6 634.423 479.6 634.423 DL 489.6 634.423 484.6 634.423 DL 494.6
634.423 489.6 634.423 DL 499.6 634.423 494.6 634.423 DL 504.6 634.423
499.6 634.423 DL 509.6 634.423 504.6 634.423 DL 514.6 634.423 509.6
634.423 DL 519.6 634.423 514.6 634.423 DL F3(Figure 18)251.588 650.423 Q
F4(The)6 E F5(sig_chld)2 E F4(signal handler)2 E 0 Cg EP
%%Page: 28 28
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(28)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF 1.333(When a child terminates we must r)129.6 123
R(ecor)-.18 E 3.833(di)-.18 G 1.333(ts termination status and pr)-3.833
F 1.332(ocess ID in the)-.18 F(appr)129.6 135 Q 3.943
(opriate entry in the)-.18 F/F3 10/Courier@0 SF(client)6.443 E F2(array)
6.443 E 8.943(.W)-1.11 G 6.443(ec)-9.863 G 3.943(all the function)-6.443
F F3(client_sigchld)6.443 E F2(\(Figur)129.6 147 Q 2.5(e1)-.18 G
(2\) to do this.)-2.5 E 2.563(Note that we ar)147.6 159 R 5.063(ev)-.18
G 2.563(iolating one of our earlier r)-5.063 F 2.562(ules fr)-.08 F
2.562(om Chapter 10)-.18 F .896 .833(\212a s).833 H(ignal)-.833 E .541
(handler should only set a global variable and nothing else.)129.6 171 R
(Her)5.542 E 3.042(ew)-.18 G 3.042(ec)-3.042 G(all)-3.042 E F3(waitpid)
3.042 E F2(and)3.042 E 1.644(the function)129.6 183 R F3(client_sigchld)
4.144 E F2(\(Figur)4.144 E 4.144(e1)-.18 G 4.143(2\). This)-4.144 F
1.643(latter function is signal safe.)4.143 F 1.643(All it)6.643 F .626
(does is r)129.6 195 R(ecor)-.18 E 3.126(di)-.18 G .626
(nformation in an entry in the)-3.126 F F3(client)3.126 E F2 -1.667
(array \212 it)3.126 F .626(doesn't cr)3.126 F .626(eate or delete)-.18
F(entries \(which would be nonr)129.6 207 Q
(eentrant\) and it doesn't call any system functions.)-.18 E F3(waitpid)
147.6 219 Q F2 1.693(is de\214ned by POSIX.1 to be signal safe \(Figur)
4.193 F 4.193(e1)-.18 G 4.193(0.4\). If)-4.193 F 1.692(we didn't call)
4.193 F F3(waitpid)129.6 231 Q F2(fr)5.148 E 2.648
(om the signal handler)-.18 F 5.148(,t)-.74 G 2.648(he par)-5.148 F
2.649(ent would have to call it when the \215ag)-.18 F F3(chld_flag)
129.6 243 Q F2 .79(was nonzer)3.29 F 3.29(o. But)-.18 F .79(since numer)
3.29 F .79(ous childr)-.18 F .79(en can terminate befor)-.18 F 3.29(et)
-.18 G .79(he main)-3.29 F 3.805(loop gets a chance to look at)129.6 255
R F3(chld_flag)6.305 E F2 6.305(,w)C 6.306(ew)-6.305 G 3.806
(ould either need to incr)-6.306 F(ement)-.18 E F3(chld_flag)129.6 267 Q
F2 1.507
(each time a child terminated \(so the main loop would know how many)
4.007 F .886(times to call)129.6 279 R F3(waitpid)3.386 E F2 3.386(\)o)C
3.386(rc)-3.386 G(all)-3.386 E F3(waitpid)3.387 E F2 .887
(in a loop, with the)3.387 F F3(WNOHANG)3.387 E F2 .887(\215ag \(Figur)
3.387 F 3.387(e8)-.18 G(.7\).)-3.387 E 2.873
(The simplest solution is to call)129.6 291 R F3(waitpid)5.373 E F2(fr)
5.373 E 2.873(om the signal handler)-.18 F 5.373(,a)-.74 G 2.873(nd r)
-5.373 F(ecor)-.18 E 5.373(dt)-.18 G(he)-5.373 E(information in the)
129.6 303 Q F3(client)2.5 E F2(array)2.5 E(.)-1.11 E 2.001 -.92(We n)
147.6 315 T .161(ow pr).92 F .161(oceed to the functions that ar)-.18 F
2.661(ec)-.18 G .161(alled by the child as part of its attempt to)-2.661
F .98(dial the r)129.6 327 R .98(emote system.)-.18 F .979
(Everything starts for the child after the)5.979 F F3(fork)3.479 E F2
(when)3.479 E F3(request)3.479 E F2(calls)129.6 339 Q F3(child_dial)2.5
E F2(\(Figur)2.5 E 2.5(e1)-.18 G(9\).)-2.5 E .4 LW 134.6 346.2 129.6
346.2 DL 139.6 346.2 134.6 346.2 DL 144.6 346.2 139.6 346.2 DL 149.6
346.2 144.6 346.2 DL 154.6 346.2 149.6 346.2 DL 159.6 346.2 154.6 346.2
DL 164.6 346.2 159.6 346.2 DL 169.6 346.2 164.6 346.2 DL 174.6 346.2
169.6 346.2 DL 179.6 346.2 174.6 346.2 DL 184.6 346.2 179.6 346.2 DL
189.6 346.2 184.6 346.2 DL 194.6 346.2 189.6 346.2 DL 199.6 346.2 194.6
346.2 DL 204.6 346.2 199.6 346.2 DL 209.6 346.2 204.6 346.2 DL 214.6
346.2 209.6 346.2 DL 219.6 346.2 214.6 346.2 DL 224.6 346.2 219.6 346.2
DL 229.6 346.2 224.6 346.2 DL 234.6 346.2 229.6 346.2 DL 239.6 346.2
234.6 346.2 DL 244.6 346.2 239.6 346.2 DL 249.6 346.2 244.6 346.2 DL
254.6 346.2 249.6 346.2 DL 259.6 346.2 254.6 346.2 DL 264.6 346.2 259.6
346.2 DL 269.6 346.2 264.6 346.2 DL 274.6 346.2 269.6 346.2 DL 279.6
346.2 274.6 346.2 DL 284.6 346.2 279.6 346.2 DL 289.6 346.2 284.6 346.2
DL 294.6 346.2 289.6 346.2 DL 299.6 346.2 294.6 346.2 DL 304.6 346.2
299.6 346.2 DL 309.6 346.2 304.6 346.2 DL 314.6 346.2 309.6 346.2 DL
319.6 346.2 314.6 346.2 DL 324.6 346.2 319.6 346.2 DL 329.6 346.2 324.6
346.2 DL 334.6 346.2 329.6 346.2 DL 339.6 346.2 334.6 346.2 DL 344.6
346.2 339.6 346.2 DL 349.6 346.2 344.6 346.2 DL 354.6 346.2 349.6 346.2
DL 359.6 346.2 354.6 346.2 DL 364.6 346.2 359.6 346.2 DL 369.6 346.2
364.6 346.2 DL 374.6 346.2 369.6 346.2 DL 379.6 346.2 374.6 346.2 DL
384.6 346.2 379.6 346.2 DL 389.6 346.2 384.6 346.2 DL 394.6 346.2 389.6
346.2 DL 399.6 346.2 394.6 346.2 DL 404.6 346.2 399.6 346.2 DL 409.6
346.2 404.6 346.2 DL 414.6 346.2 409.6 346.2 DL 419.6 346.2 414.6 346.2
DL 424.6 346.2 419.6 346.2 DL 429.6 346.2 424.6 346.2 DL 434.6 346.2
429.6 346.2 DL 439.6 346.2 434.6 346.2 DL 444.6 346.2 439.6 346.2 DL
449.6 346.2 444.6 346.2 DL 454.6 346.2 449.6 346.2 DL 459.6 346.2 454.6
346.2 DL 464.6 346.2 459.6 346.2 DL 469.6 346.2 464.6 346.2 DL 474.6
346.2 469.6 346.2 DL 479.6 346.2 474.6 346.2 DL 484.6 346.2 479.6 346.2
DL 489.6 346.2 484.6 346.2 DL 494.6 346.2 489.6 346.2 DL 499.6 346.2
494.6 346.2 DL 504.6 346.2 499.6 346.2 DL 509.6 346.2 504.6 346.2 DL
514.6 346.2 509.6 346.2 DL 519.6 346.2 514.6 346.2 DL/F4 9/Courier@0 SF
16.2(#include "calld.h")129.6 355.701 R(/*)129.6 372.821 Q 5.4(*T)135
383.521 S(he child does the actual dialing and sends the fd back to)-5.4
E 5.4(*t)135 394.221 S(he client.)-5.4 E
(This function can't return to caller; it must exit.)10.8 E 5.4(*I)135
404.921 S 5.4(fs)-5.4 G(uccessful, exit\(0\), else exit\(1\).)-5.4 E 5.4
(*T)135 415.621 S
(he child uses the following global variables, which are just)-5.4 E 5.4
(*i)135 426.321 S 5.4(nt)-5.4 G
(he copy of the data space from the parent:)-5.4 E 32.4(*c)135 437.021 S
(liptr->fd \(to send DEBUG\(\) output and fd back to client\),)-32.4 E
32.4(*c)135 447.721 S
(liptr->Debug \(for all DEBUG\(\) output\), cliptr->parity,)-32.4 E 32.4
(*s)135 458.421 S(ystems, devices, dialers.)-32.4 E(*/)135 469.121 Q
(void)129.6 479.821 Q(child_dial\(Client *cliptr\))129.6 490.521 Q({)
129.6 501.221 Q 21.6(int fd,)151.2 511.921 R(n;)5.4 E
(Debug = cliptr->Debug;)151.2 529.041 Q
(DEBUG\("child, pid %d", getpid\(\)\);)151.2 539.741 Q
(if \(strcmp\(devices.dialer, "direct"\) == 0\) { /* direct tty line */)
151.2 556.861 Q
(fd = tty_open\(systems.class, devices.line, cliptr->parity, 0\);)172.8
567.561 Q(if \(fd < 0\))172.8 578.261 Q(goto die;)194.4 588.961 Q 5.4
(}e)151.2 599.661 S(lse {)-5.4 E(/* else assume dialing is needed */)
64.8 E(if \(dial_find\(&dialers, &devices\) < 0\))172.8 610.361 Q
(goto die;)194.4 621.061 Q
(fd = tty_open\(systems.class, devices.line, cliptr->parity, 1\);)172.8
631.761 Q(if \(fd < 0\))172.8 642.461 Q(goto die;)194.4 653.161 Q 0 Cg
EP
%%Page: 29 29
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(29)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF
(if \(tty_dial\(fd, systems.phone, dialers.dialer,)172.8 121.7 Q
(dialers.sub, dialers.expsend\) < 0\))183.6 132.4 Q(goto die;)194.4
143.1 Q(})151.2 153.8 Q(DEBUG\("done"\);)151.2 164.5 Q(/*)151.2 181.62 Q
5.4(*S)156.6 192.32 S(end the open descriptor to client.)-5.4 E(*/)156.6
203.02 Q(if \(send_fd\(cliptr->fd, fd\) < 0\))151.2 213.72 Q
(log_sys\("send_fd error"\);)172.8 224.42 Q 16.2(exit\(0\); /*)151.2
235.12 R(parent will see this */)5.4 E(die:)129.6 252.24 Q(/*)151.2
262.94 Q 5.4(*T)156.6 273.64 S
(he child can't call send_err\(\) as that would send the final)-5.4 E
5.4(*2)156.6 284.34 S(-byte protocol to the client.)-5.4 E
(We just send our error message)10.8 E 5.4(*b)156.6 295.04 S
(ack to the client.)-5.4 E(If the parent finally gives up, it'll)10.8 E
5.4(*c)156.6 305.74 S(all send_err\(\).)-5.4 E(*/)156.6 316.44 Q 5.4
(n=s)151.2 327.14 S(trlen\(errmsg\);)-5.4 E
(if \(writen\(cliptr->fd, errmsg, n\) != n\) /* send error to client */)
151.2 337.84 Q(log_sys\("writen error"\);)172.8 348.54 Q 16.2
(exit\(1\); /*)151.2 359.24 R
(parent will see this, release lock, and try again */)5.4 E(})129.6
369.94 Q .4 LW 134.6 374.741 129.6 374.741 DL 139.6 374.741 134.6
374.741 DL 144.6 374.741 139.6 374.741 DL 149.6 374.741 144.6 374.741 DL
154.6 374.741 149.6 374.741 DL 159.6 374.741 154.6 374.741 DL 164.6
374.741 159.6 374.741 DL 169.6 374.741 164.6 374.741 DL 174.6 374.741
169.6 374.741 DL 179.6 374.741 174.6 374.741 DL 184.6 374.741 179.6
374.741 DL 189.6 374.741 184.6 374.741 DL 194.6 374.741 189.6 374.741 DL
199.6 374.741 194.6 374.741 DL 204.6 374.741 199.6 374.741 DL 209.6
374.741 204.6 374.741 DL 214.6 374.741 209.6 374.741 DL 219.6 374.741
214.6 374.741 DL 224.6 374.741 219.6 374.741 DL 229.6 374.741 224.6
374.741 DL 234.6 374.741 229.6 374.741 DL 239.6 374.741 234.6 374.741 DL
244.6 374.741 239.6 374.741 DL 249.6 374.741 244.6 374.741 DL 254.6
374.741 249.6 374.741 DL 259.6 374.741 254.6 374.741 DL 264.6 374.741
259.6 374.741 DL 269.6 374.741 264.6 374.741 DL 274.6 374.741 269.6
374.741 DL 279.6 374.741 274.6 374.741 DL 284.6 374.741 279.6 374.741 DL
289.6 374.741 284.6 374.741 DL 294.6 374.741 289.6 374.741 DL 299.6
374.741 294.6 374.741 DL 304.6 374.741 299.6 374.741 DL 309.6 374.741
304.6 374.741 DL 314.6 374.741 309.6 374.741 DL 319.6 374.741 314.6
374.741 DL 324.6 374.741 319.6 374.741 DL 329.6 374.741 324.6 374.741 DL
334.6 374.741 329.6 374.741 DL 339.6 374.741 334.6 374.741 DL 344.6
374.741 339.6 374.741 DL 349.6 374.741 344.6 374.741 DL 354.6 374.741
349.6 374.741 DL 359.6 374.741 354.6 374.741 DL 364.6 374.741 359.6
374.741 DL 369.6 374.741 364.6 374.741 DL 374.6 374.741 369.6 374.741 DL
379.6 374.741 374.6 374.741 DL 384.6 374.741 379.6 374.741 DL 389.6
374.741 384.6 374.741 DL 394.6 374.741 389.6 374.741 DL 399.6 374.741
394.6 374.741 DL 404.6 374.741 399.6 374.741 DL 409.6 374.741 404.6
374.741 DL 414.6 374.741 409.6 374.741 DL 419.6 374.741 414.6 374.741 DL
424.6 374.741 419.6 374.741 DL 429.6 374.741 424.6 374.741 DL 434.6
374.741 429.6 374.741 DL 439.6 374.741 434.6 374.741 DL 444.6 374.741
439.6 374.741 DL 449.6 374.741 444.6 374.741 DL 454.6 374.741 449.6
374.741 DL 459.6 374.741 454.6 374.741 DL 464.6 374.741 459.6 374.741 DL
469.6 374.741 464.6 374.741 DL 474.6 374.741 469.6 374.741 DL 479.6
374.741 474.6 374.741 DL 484.6 374.741 479.6 374.741 DL 489.6 374.741
484.6 374.741 DL 494.6 374.741 489.6 374.741 DL 499.6 374.741 494.6
374.741 DL 504.6 374.741 499.6 374.741 DL 509.6 374.741 504.6 374.741 DL
514.6 374.741 509.6 374.741 DL 519.6 374.741 514.6 374.741 DL/F3 8
/Palatino-Bold@0 SF(Figure 19)257.296 390.741 Q/F4 8/Palatino-Roman@0 SF
(The)6 E/F5 8/Courier@0 SF(child_dial)2 E F4(function)2 E/F6 10
/Palatino-Roman@0 SF 1.056(If the device being used is dir)129.6 414.741
R 1.056(ectly connected, just the function)-.18 F/F7 10/Courier@0 SF
(tty_open)3.557 E F6 1.057(is called to)3.557 F 1.655
(open the terminal device and set all the appr)129.6 426.741 R 1.654
(opriate terminal parameters.)-.18 F 1.654(But if the)6.654 F 1.56
(device is a modem, thr)129.6 438.741 R 1.561(ee functions ar)-.18 F
4.061(ec)-.18 G(alled:)-4.061 E F7(dial_find)4.061 E F6 1.561
(\(to locate the appr)4.061 F(opriate)-.18 E(entry in the)129.6 450.741
Q F7(Dialers)2.5 E F6(\214le\),)2.5 E F7(tty_open)2.5 E F6 2.5(,a)C(nd)
-2.5 E F7(tty_dial)2.5 E F6(\(to do the actual dialing\).)2.5 E(If)147.6
462.741 Q F7(child_dial)4.064 E F6 1.564(is successful, it r)4.064 F
1.564(eturns the \214le descriptor to the client by calling)-.18 F F7
(send_fd)129.6 474.741 Q F6(\(Figur)4.42 E 1.921
(es 17.20 and 17.22\) and calls)-.18 F F7(exit\(0\))4.421 E F6 6.921(.O)
C 1.921(therwise it sends an err)-6.921 F(or)-.18 E 2.207
(message back to the client acr)129.6 486.741 R 2.207
(oss the s-pipe and calls)-.18 F F7(exit\(1\))4.706 E F6 7.206(.T)C
2.206(he client-speci\214c)-7.206 F .343(s-pipe is duplicated acr)129.6
498.741 R .343(oss the)-.18 F F7(fork)2.843 E F6 2.843(,s)C 2.843(ot)
-2.843 G .344(he child can send either the descriptor or err)-2.843 F
(or)-.18 E(message dir)129.6 510.741 Q(ectly back to the client.)-.18 E
134.6 523.941 129.6 523.941 DL 139.6 523.941 134.6 523.941 DL 144.6
523.941 139.6 523.941 DL 149.6 523.941 144.6 523.941 DL 154.6 523.941
149.6 523.941 DL 159.6 523.941 154.6 523.941 DL 164.6 523.941 159.6
523.941 DL 169.6 523.941 164.6 523.941 DL 174.6 523.941 169.6 523.941 DL
179.6 523.941 174.6 523.941 DL 184.6 523.941 179.6 523.941 DL 189.6
523.941 184.6 523.941 DL 194.6 523.941 189.6 523.941 DL 199.6 523.941
194.6 523.941 DL 204.6 523.941 199.6 523.941 DL 209.6 523.941 204.6
523.941 DL 214.6 523.941 209.6 523.941 DL 219.6 523.941 214.6 523.941 DL
224.6 523.941 219.6 523.941 DL 229.6 523.941 224.6 523.941 DL 234.6
523.941 229.6 523.941 DL 239.6 523.941 234.6 523.941 DL 244.6 523.941
239.6 523.941 DL 249.6 523.941 244.6 523.941 DL 254.6 523.941 249.6
523.941 DL 259.6 523.941 254.6 523.941 DL 264.6 523.941 259.6 523.941 DL
269.6 523.941 264.6 523.941 DL 274.6 523.941 269.6 523.941 DL 279.6
523.941 274.6 523.941 DL 284.6 523.941 279.6 523.941 DL 289.6 523.941
284.6 523.941 DL 294.6 523.941 289.6 523.941 DL 299.6 523.941 294.6
523.941 DL 304.6 523.941 299.6 523.941 DL 309.6 523.941 304.6 523.941 DL
314.6 523.941 309.6 523.941 DL 319.6 523.941 314.6 523.941 DL 324.6
523.941 319.6 523.941 DL 329.6 523.941 324.6 523.941 DL 334.6 523.941
329.6 523.941 DL 339.6 523.941 334.6 523.941 DL 344.6 523.941 339.6
523.941 DL 349.6 523.941 344.6 523.941 DL 354.6 523.941 349.6 523.941 DL
359.6 523.941 354.6 523.941 DL 364.6 523.941 359.6 523.941 DL 369.6
523.941 364.6 523.941 DL 374.6 523.941 369.6 523.941 DL 379.6 523.941
374.6 523.941 DL 384.6 523.941 379.6 523.941 DL 389.6 523.941 384.6
523.941 DL 394.6 523.941 389.6 523.941 DL 399.6 523.941 394.6 523.941 DL
404.6 523.941 399.6 523.941 DL 409.6 523.941 404.6 523.941 DL 414.6
523.941 409.6 523.941 DL 419.6 523.941 414.6 523.941 DL 424.6 523.941
419.6 523.941 DL 429.6 523.941 424.6 523.941 DL 434.6 523.941 429.6
523.941 DL 439.6 523.941 434.6 523.941 DL 444.6 523.941 439.6 523.941 DL
449.6 523.941 444.6 523.941 DL 454.6 523.941 449.6 523.941 DL 459.6
523.941 454.6 523.941 DL 464.6 523.941 459.6 523.941 DL 469.6 523.941
464.6 523.941 DL 474.6 523.941 469.6 523.941 DL 479.6 523.941 474.6
523.941 DL 484.6 523.941 479.6 523.941 DL 489.6 523.941 484.6 523.941 DL
494.6 523.941 489.6 523.941 DL 499.6 523.941 494.6 523.941 DL 504.6
523.941 499.6 523.941 DL 509.6 523.941 504.6 523.941 DL 514.6 523.941
509.6 523.941 DL 519.6 523.941 514.6 523.941 DL F2 16.2
(#include "calld.h")129.6 533.442 R 16.2(#include <stdarg.h>)129.6
544.142 R(/*)129.6 561.262 Q 5.4(*N)135 571.962 S
(ote that all debug output goes back to the client.)-5.4 E(*/)135
582.662 Q(void)129.6 593.362 Q(DEBUG\(char *fmt, ...\))129.6 604.062 Q
(/* debug output, newline at end */)37.8 E({)129.6 614.762 Q
(va_list args;)151.2 625.462 Q 16.2(char line[MAXLINE];)151.2 636.162 R
21.6(int n;)151.2 646.862 R 0 Cg EP
%%Page: 30 30
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(30)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(if \(Debug == 0\))151.2 121.7 Q(return;)172.8 132.4 Q
(va_start\(args, fmt\);)151.2 143.1 Q(vsprintf\(line, fmt, args\);)151.2
153.8 Q(strcat\(line, "\\n"\);)151.2 164.5 Q(va_end\(args\);)151.2 175.2
Q 5.4(n=s)151.2 185.9 S(trlen\(line\);)-5.4 E
(if \(writen\(clifd, line, n\) != n\))151.2 196.6 Q
(log_sys\("writen error"\);)172.8 207.3 Q(})129.6 218 Q(void)129.6
235.12 Q(DEBUG_NONL\(char *fmt, ...\))129.6 245.82 Q
(/* debug output, NO newline at end */)10.8 E({)129.6 256.52 Q
(va_list args;)151.2 267.22 Q 16.2(char line[MAXLINE];)151.2 277.92 R
21.6(int n;)151.2 288.62 R(if \(Debug == 0\))151.2 305.74 Q(return;)
172.8 316.44 Q(va_start\(args, fmt\);)151.2 327.14 Q
(vsprintf\(line, fmt, args\);)151.2 337.84 Q(va_end\(args\);)151.2
348.54 Q 5.4(n=s)151.2 359.24 S(trlen\(line\);)-5.4 E
(if \(writen\(clifd, line, n\) != n\))151.2 369.94 Q
(log_sys\("writen error"\);)172.8 380.64 Q(})129.6 391.34 Q .4 LW 134.6
396.141 129.6 396.141 DL 139.6 396.141 134.6 396.141 DL 144.6 396.141
139.6 396.141 DL 149.6 396.141 144.6 396.141 DL 154.6 396.141 149.6
396.141 DL 159.6 396.141 154.6 396.141 DL 164.6 396.141 159.6 396.141 DL
169.6 396.141 164.6 396.141 DL 174.6 396.141 169.6 396.141 DL 179.6
396.141 174.6 396.141 DL 184.6 396.141 179.6 396.141 DL 189.6 396.141
184.6 396.141 DL 194.6 396.141 189.6 396.141 DL 199.6 396.141 194.6
396.141 DL 204.6 396.141 199.6 396.141 DL 209.6 396.141 204.6 396.141 DL
214.6 396.141 209.6 396.141 DL 219.6 396.141 214.6 396.141 DL 224.6
396.141 219.6 396.141 DL 229.6 396.141 224.6 396.141 DL 234.6 396.141
229.6 396.141 DL 239.6 396.141 234.6 396.141 DL 244.6 396.141 239.6
396.141 DL 249.6 396.141 244.6 396.141 DL 254.6 396.141 249.6 396.141 DL
259.6 396.141 254.6 396.141 DL 264.6 396.141 259.6 396.141 DL 269.6
396.141 264.6 396.141 DL 274.6 396.141 269.6 396.141 DL 279.6 396.141
274.6 396.141 DL 284.6 396.141 279.6 396.141 DL 289.6 396.141 284.6
396.141 DL 294.6 396.141 289.6 396.141 DL 299.6 396.141 294.6 396.141 DL
304.6 396.141 299.6 396.141 DL 309.6 396.141 304.6 396.141 DL 314.6
396.141 309.6 396.141 DL 319.6 396.141 314.6 396.141 DL 324.6 396.141
319.6 396.141 DL 329.6 396.141 324.6 396.141 DL 334.6 396.141 329.6
396.141 DL 339.6 396.141 334.6 396.141 DL 344.6 396.141 339.6 396.141 DL
349.6 396.141 344.6 396.141 DL 354.6 396.141 349.6 396.141 DL 359.6
396.141 354.6 396.141 DL 364.6 396.141 359.6 396.141 DL 369.6 396.141
364.6 396.141 DL 374.6 396.141 369.6 396.141 DL 379.6 396.141 374.6
396.141 DL 384.6 396.141 379.6 396.141 DL 389.6 396.141 384.6 396.141 DL
394.6 396.141 389.6 396.141 DL 399.6 396.141 394.6 396.141 DL 404.6
396.141 399.6 396.141 DL 409.6 396.141 404.6 396.141 DL 414.6 396.141
409.6 396.141 DL 419.6 396.141 414.6 396.141 DL 424.6 396.141 419.6
396.141 DL 429.6 396.141 424.6 396.141 DL 434.6 396.141 429.6 396.141 DL
439.6 396.141 434.6 396.141 DL 444.6 396.141 439.6 396.141 DL 449.6
396.141 444.6 396.141 DL 454.6 396.141 449.6 396.141 DL 459.6 396.141
454.6 396.141 DL 464.6 396.141 459.6 396.141 DL 469.6 396.141 464.6
396.141 DL 474.6 396.141 469.6 396.141 DL 479.6 396.141 474.6 396.141 DL
484.6 396.141 479.6 396.141 DL 489.6 396.141 484.6 396.141 DL 494.6
396.141 489.6 396.141 DL 499.6 396.141 494.6 396.141 DL 504.6 396.141
499.6 396.141 DL 509.6 396.141 504.6 396.141 DL 514.6 396.141 509.6
396.141 DL 519.6 396.141 514.6 396.141 DL/F3 8/Palatino-Bold@0 SF
(Figure 20)267.496 412.141 Q/F4 8/Palatino-Roman@0 SF
(Debugging functions)6 E/F5 10/Palatino-Roman@0 SF 1.88
(The client can send a)147.6 436.141 R/F6 10/Courier@0 SF(-d)4.38 E F5
1.88(option in its command to the server)4.38 F 4.38(,a)-.74 G 1.88
(nd this sets the)-4.38 F 2.436(client-speci\214c variable)129.6 448.141
R F6(Debug)4.937 E F5 7.437(.T)C 2.437(his \215ag is used in Figur)
-7.437 F 4.937(e2)-.18 G 4.937(0b)-4.937 G 4.937(yt)-4.937 G 2.437
(he two functions)-4.937 F F6(DEBUG)129.6 460.141 Q F5(and)5.584 E F6
(DEBUG_NONL)5.584 E F5 3.084
(to send debugging information back to the client.)5.584 F(This)8.083 E
1.316(information is useful when dialing pr)129.6 472.141 R 1.316
(oblems ar)-.18 F 3.816(ee)-.18 G(ncounter)-3.816 E 1.317
(ed for a particular system.)-.18 F 1.688(These two functions ar)129.6
484.141 R 4.188(ec)-.18 G 1.688(alled pr)-4.188 F 1.687
(edominantly by the child, although the par)-.18 F 1.687(ent also)-.18 F
(calls them fr)129.6 496.141 Q(om the)-.18 E F6(request)2.5 E F5
(function \(Figur)2.5 E 2.5(e1)-.18 G(7\).)-2.5 E(Figur)147.6 508.141 Q
3.439(e2)-.18 G 3.439(1s)-3.439 G .939(hows the)-3.439 F F6(tty_open)
3.439 E F5 3.439(function. It)3.439 F .939
(is called for both modem devices and)3.439 F(dir)129.6 520.141 Q 1.716
(ect connect devices to open the terminal and set its modes.)-.18 F(The)
6.715 E/F7 10/Palatino-Italic@0 SF(class)4.215 E F5 1.715
(\214eld of the)4.215 F F6(Systems)129.6 532.141 Q F5(and)4.761 E F6
(Devices)4.761 E F5 2.262
(\214le speci\214ed the line speed, and the client can specify the)4.761
F(parity)129.6 544.141 Q(.)-1.11 E 134.6 551.341 129.6 551.341 DL 139.6
551.341 134.6 551.341 DL 144.6 551.341 139.6 551.341 DL 149.6 551.341
144.6 551.341 DL 154.6 551.341 149.6 551.341 DL 159.6 551.341 154.6
551.341 DL 164.6 551.341 159.6 551.341 DL 169.6 551.341 164.6 551.341 DL
174.6 551.341 169.6 551.341 DL 179.6 551.341 174.6 551.341 DL 184.6
551.341 179.6 551.341 DL 189.6 551.341 184.6 551.341 DL 194.6 551.341
189.6 551.341 DL 199.6 551.341 194.6 551.341 DL 204.6 551.341 199.6
551.341 DL 209.6 551.341 204.6 551.341 DL 214.6 551.341 209.6 551.341 DL
219.6 551.341 214.6 551.341 DL 224.6 551.341 219.6 551.341 DL 229.6
551.341 224.6 551.341 DL 234.6 551.341 229.6 551.341 DL 239.6 551.341
234.6 551.341 DL 244.6 551.341 239.6 551.341 DL 249.6 551.341 244.6
551.341 DL 254.6 551.341 249.6 551.341 DL 259.6 551.341 254.6 551.341 DL
264.6 551.341 259.6 551.341 DL 269.6 551.341 264.6 551.341 DL 274.6
551.341 269.6 551.341 DL 279.6 551.341 274.6 551.341 DL 284.6 551.341
279.6 551.341 DL 289.6 551.341 284.6 551.341 DL 294.6 551.341 289.6
551.341 DL 299.6 551.341 294.6 551.341 DL 304.6 551.341 299.6 551.341 DL
309.6 551.341 304.6 551.341 DL 314.6 551.341 309.6 551.341 DL 319.6
551.341 314.6 551.341 DL 324.6 551.341 319.6 551.341 DL 329.6 551.341
324.6 551.341 DL 334.6 551.341 329.6 551.341 DL 339.6 551.341 334.6
551.341 DL 344.6 551.341 339.6 551.341 DL 349.6 551.341 344.6 551.341 DL
354.6 551.341 349.6 551.341 DL 359.6 551.341 354.6 551.341 DL 364.6
551.341 359.6 551.341 DL 369.6 551.341 364.6 551.341 DL 374.6 551.341
369.6 551.341 DL 379.6 551.341 374.6 551.341 DL 384.6 551.341 379.6
551.341 DL 389.6 551.341 384.6 551.341 DL 394.6 551.341 389.6 551.341 DL
399.6 551.341 394.6 551.341 DL 404.6 551.341 399.6 551.341 DL 409.6
551.341 404.6 551.341 DL 414.6 551.341 409.6 551.341 DL 419.6 551.341
414.6 551.341 DL 424.6 551.341 419.6 551.341 DL 429.6 551.341 424.6
551.341 DL 434.6 551.341 429.6 551.341 DL 439.6 551.341 434.6 551.341 DL
444.6 551.341 439.6 551.341 DL 449.6 551.341 444.6 551.341 DL 454.6
551.341 449.6 551.341 DL 459.6 551.341 454.6 551.341 DL 464.6 551.341
459.6 551.341 DL 469.6 551.341 464.6 551.341 DL 474.6 551.341 469.6
551.341 DL 479.6 551.341 474.6 551.341 DL 484.6 551.341 479.6 551.341 DL
489.6 551.341 484.6 551.341 DL 494.6 551.341 489.6 551.341 DL 499.6
551.341 494.6 551.341 DL 504.6 551.341 499.6 551.341 DL 509.6 551.341
504.6 551.341 DL 514.6 551.341 509.6 551.341 DL 519.6 551.341 514.6
551.341 DL F2 16.2(#include "calld.h")129.6 560.842 R 16.2
(#include <fcntl.h>)129.6 571.542 R(/*)129.6 588.662 Q 5.4(*O)135
599.362 S(pen the terminal line.)-5.4 E(*/)135 610.062 Q(int)129.6
620.762 Q
(tty_open\(char *class, char *line, enum parity parity, int modem\))
129.6 631.462 Q({)129.6 642.162 Q 64.8(int fd,)151.2 652.862 R(baud;)5.4
E 0 Cg EP
%%Page: 31 31
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(31)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF 59.4(char devname[100];)151.2 121.7 R
(struct termios)151.2 132.4 Q(term;)10.8 E(/*)151.2 149.52 Q 5.4(*F)
156.6 160.22 S(irst open the device.)-5.4 E(*/)156.6 170.92 Q
(strcpy\(devname, "/dev/"\);)151.2 181.62 Q(strcat\(devname, line\);)
151.2 192.32 Q
(if \(\(fd = open\(devname, O_RDWR | O_NONBLOCK\)\) < 0\) {)151.2 203.02
Q(sprintf\(errmsg, "can't open %s: %s\\n",)172.8 213.72 Q
(devname, strerror\(errno\)\);)183.6 224.42 Q(return\(-1\);)172.8 235.12
Q(})151.2 245.82 Q(if \(isatty\(fd\) == 0\) {)151.2 256.52 Q
(sprintf\(errmsg, "%s is not a tty\\n", devname\);)172.8 267.22 Q
(return\(-1\);)172.8 277.92 Q(})151.2 288.62 Q(/*)151.2 305.74 Q 5.4(*F)
156.6 316.44 S(etch then set modem's terminal status.)-5.4 E(*/)156.6
327.14 Q(if \(tcgetattr\(fd, &term\) < 0\))151.2 337.84 Q
(log_sys\("tcgetattr error"\);)172.8 348.54 Q(if \(parity == NONE\))
151.2 365.66 Q(term.c_cflag = CS8;)172.8 376.36 Q
(else if \(parity == EVEN\))151.2 387.06 Q(term.c_cflag = CS7 | PARENB;)
172.8 397.76 Q(else if \(parity == ODD\))151.2 408.46 Q
(term.c_cflag = CS7 | PARENB | PARODD;)172.8 419.16 Q(else)151.2 429.86
Q(log_quit\("unknown parity"\);)172.8 440.56 Q(term.c_cflag |= CREAD |)
151.2 451.26 Q(/* enable receiver */)48.6 E 48.6(HUPCL; /*)237.6 461.96
R(lower modem lines on last close */)5.4 E
(/* 1 stop bit \(since CSTOPB off\) */)324 472.66 Q(if \(modem == 0\))
151.2 483.36 Q(term.c_cflag |= CLOCAL;)172.8 494.06 Q
(/* ignore modem status lines */)27 E 5.4(term.c_oflag =)151.2 511.18 R
70.2(0; /*)5.4 F(turn off all output processing */)5.4 E 5.4
(term.c_iflag =)151.2 521.88 R(IXON | IXOFF |)5.4 E
(/* Xon/Xoff flow control \(default\) */)10.8 E(IGNBRK |)237.6 532.58 Q
(/* ignore breaks */)43.2 E(ISTRIP |)237.6 543.28 Q
(/* strip input to 7 bits */)43.2 E 43.2(IGNPAR; /*)237.6 553.98 R
(ignore input parity errors */)5.4 E 5.4(term.c_lflag =)151.2 564.68 R
27(0; /*)5.4 F(everything off in local flag:)5.4 E
(disables canonical mode, disables)297 575.38 Q
(signal generation, disables echo */)297 586.08 Q 5.4(term.c_cc[VMIN] =)
151.2 596.78 R 10.8(1; /*)5.4 F 5.4(1b)5.4 G(yte at a time, no timer */)
-5.4 E(term.c_cc[VTIME] = 0;)151.2 607.48 Q
(if \(strcmp\(class, "38400"\) == 0\) {)151.2 624.6 Q(baud = B38400;)
172.8 635.3 Q 5.4(}e)151.2 646 S
(lse if \(strcmp\(class, "19200"\) == 0\) {)-5.4 E(baud = B19200;)172.8
656.7 Q 0 Cg EP
%%Page: 32 32
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(32)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF 5.4(}e)151.2 121.7 S
(lse if \(strcmp\(class, "9600"\) == 0\) {)-5.4 E(baud = B9600;)172.8
132.4 Q 5.4(}e)151.2 143.1 S(lse if \(strcmp\(class, "4800"\) == 0\) {)
-5.4 E(baud = B4800;)172.8 153.8 Q 5.4(}e)151.2 164.5 S
(lse if \(strcmp\(class, "2400"\) == 0\) {)-5.4 E(baud = B2400;)172.8
175.2 Q 5.4(}e)151.2 185.9 S(lse if \(strcmp\(class, "1800"\) == 0\) {)
-5.4 E(baud = B1800;)172.8 196.6 Q 5.4(}e)151.2 207.3 S
(lse if \(strcmp\(class, "1200"\) == 0\) {)-5.4 E(baud = B1200;)172.8
218 Q 5.4(}e)151.2 228.7 S(lse if \(strcmp\(class, "600"\) == 0\) {)-5.4
E(baud = B600;)172.8 239.4 Q 5.4(}e)151.2 250.1 S
(lse if \(strcmp\(class, "300"\) == 0\) {)-5.4 E(baud = B300;)172.8
260.8 Q 5.4(}e)151.2 271.5 S(lse if \(strcmp\(class, "200"\) == 0\) {)
-5.4 E(baud = B200;)172.8 282.2 Q 5.4(}e)151.2 292.9 S
(lse if \(strcmp\(class, "150"\) == 0\) {)-5.4 E(baud = B150;)172.8
303.6 Q 5.4(}e)151.2 314.3 S(lse if \(strcmp\(class, "134"\) == 0\) {)
-5.4 E(baud = B134;)172.8 325 Q 5.4(}e)151.2 335.7 S
(lse if \(strcmp\(class, "110"\) == 0\) {)-5.4 E(baud = B110;)172.8
346.4 Q 5.4(}e)151.2 357.1 S(lse if \(strcmp\(class, "75"\) == 0\) {)
-5.4 E(baud = B75;)172.8 367.8 Q 5.4(}e)151.2 378.5 S
(lse if \(strcmp\(class, "50"\) == 0\) {)-5.4 E(baud = B50;)172.8 389.2
Q 5.4(}e)151.2 399.9 S(lse {)-5.4 E
(sprintf\(errmsg, "invalid baud rate: %s\\n", class\);)172.8 410.6 Q
(return\(-1\);)172.8 421.3 Q(})151.2 432 Q(cfsetispeed\(&term, baud\);)
151.2 442.7 Q(cfsetospeed\(&term, baud\);)151.2 453.4 Q
(if \(tcsetattr\(fd, TCSANOW, &term\) < 0\))151.2 470.52 Q
(/* set attributes */)10.8 E(log_sys\("tcsetattr error"\);)172.8 481.22
Q(DEBUG\("tty open"\);)151.2 498.34 Q(clr_fl\(fd, O_NONBLOCK\);)151.2
509.04 Q(/* turn off nonblocking */)27 E(return\(fd\);)151.2 519.74 Q(})
129.6 530.44 Q .4 LW 134.6 535.241 129.6 535.241 DL 139.6 535.241 134.6
535.241 DL 144.6 535.241 139.6 535.241 DL 149.6 535.241 144.6 535.241 DL
154.6 535.241 149.6 535.241 DL 159.6 535.241 154.6 535.241 DL 164.6
535.241 159.6 535.241 DL 169.6 535.241 164.6 535.241 DL 174.6 535.241
169.6 535.241 DL 179.6 535.241 174.6 535.241 DL 184.6 535.241 179.6
535.241 DL 189.6 535.241 184.6 535.241 DL 194.6 535.241 189.6 535.241 DL
199.6 535.241 194.6 535.241 DL 204.6 535.241 199.6 535.241 DL 209.6
535.241 204.6 535.241 DL 214.6 535.241 209.6 535.241 DL 219.6 535.241
214.6 535.241 DL 224.6 535.241 219.6 535.241 DL 229.6 535.241 224.6
535.241 DL 234.6 535.241 229.6 535.241 DL 239.6 535.241 234.6 535.241 DL
244.6 535.241 239.6 535.241 DL 249.6 535.241 244.6 535.241 DL 254.6
535.241 249.6 535.241 DL 259.6 535.241 254.6 535.241 DL 264.6 535.241
259.6 535.241 DL 269.6 535.241 264.6 535.241 DL 274.6 535.241 269.6
535.241 DL 279.6 535.241 274.6 535.241 DL 284.6 535.241 279.6 535.241 DL
289.6 535.241 284.6 535.241 DL 294.6 535.241 289.6 535.241 DL 299.6
535.241 294.6 535.241 DL 304.6 535.241 299.6 535.241 DL 309.6 535.241
304.6 535.241 DL 314.6 535.241 309.6 535.241 DL 319.6 535.241 314.6
535.241 DL 324.6 535.241 319.6 535.241 DL 329.6 535.241 324.6 535.241 DL
334.6 535.241 329.6 535.241 DL 339.6 535.241 334.6 535.241 DL 344.6
535.241 339.6 535.241 DL 349.6 535.241 344.6 535.241 DL 354.6 535.241
349.6 535.241 DL 359.6 535.241 354.6 535.241 DL 364.6 535.241 359.6
535.241 DL 369.6 535.241 364.6 535.241 DL 374.6 535.241 369.6 535.241 DL
379.6 535.241 374.6 535.241 DL 384.6 535.241 379.6 535.241 DL 389.6
535.241 384.6 535.241 DL 394.6 535.241 389.6 535.241 DL 399.6 535.241
394.6 535.241 DL 404.6 535.241 399.6 535.241 DL 409.6 535.241 404.6
535.241 DL 414.6 535.241 409.6 535.241 DL 419.6 535.241 414.6 535.241 DL
424.6 535.241 419.6 535.241 DL 429.6 535.241 424.6 535.241 DL 434.6
535.241 429.6 535.241 DL 439.6 535.241 434.6 535.241 DL 444.6 535.241
439.6 535.241 DL 449.6 535.241 444.6 535.241 DL 454.6 535.241 449.6
535.241 DL 459.6 535.241 454.6 535.241 DL 464.6 535.241 459.6 535.241 DL
469.6 535.241 464.6 535.241 DL 474.6 535.241 469.6 535.241 DL 479.6
535.241 474.6 535.241 DL 484.6 535.241 479.6 535.241 DL 489.6 535.241
484.6 535.241 DL 494.6 535.241 489.6 535.241 DL 499.6 535.241 494.6
535.241 DL 504.6 535.241 499.6 535.241 DL 509.6 535.241 504.6 535.241 DL
514.6 535.241 509.6 535.241 DL 519.6 535.241 514.6 535.241 DL/F3 8
/Palatino-Bold@0 SF(Figure 21)262.096 551.241 Q/F4 8/Palatino-Roman@0 SF
(The)6 E/F5 8/Courier@0 SF(tty_open)2 E F4(function)2 E/F6 10
/Palatino-Roman@0 SF -.92(We)129.6 575.241 S/F7 10/Courier@0 SF(open)
4.865 E F6 1.444
(the terminal device with the nonblocking \215ag, as sometimes the)3.945
F F7(open)3.944 E F6 1.444(of a)3.944 F 1.885
(terminal connected to a modem doesn't r)129.6 587.241 R 1.885
(eturn until the modem's carrier is pr)-.18 F(esent.)-.18 E 1.04
(Since we ar)129.6 599.241 R 3.54(ed)-.18 G 1.04
(ialing out and not dialing in, we don't want to wait.)-3.54 F 1.039
(At the end of the)6.039 F 3.495(function we call the)129.6 611.241 R F7
(clr_fl)5.996 E F6 3.496(function to clear the nonblocking mode.)5.996 F
3.496(The only)8.496 F(dif)129.6 623.241 Q(fer)-.18 E .352
(ence between a modem and a dir)-.18 F .352(ect connect line in the)-.18
F F7(tty_open)2.852 E F6 .352(function is that)2.852 F(we set the)129.6
635.241 Q F7(CLOCAL)2.5 E F6(bit for a dir)2.5 E(ect connect line.)-.18
E 1.004(The details of dialing a modem takes place in the)147.6 647.241
R F7(tty_dial)3.505 E F6 1.005(function \(Figur)3.505 F 3.505(e2)-.18 G
(2\).)-3.505 E
(This function is only called for modem lines, not for dir)129.6 659.241
Q(ect connect lines.)-.18 E 0 Cg EP
%%Page: 33 33
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(33)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL .4 LW 134.6 123 129.6 123 DL 139.6 123 134.6 123 DL 144.6 123
139.6 123 DL 149.6 123 144.6 123 DL 154.6 123 149.6 123 DL 159.6 123
154.6 123 DL 164.6 123 159.6 123 DL 169.6 123 164.6 123 DL 174.6 123
169.6 123 DL 179.6 123 174.6 123 DL 184.6 123 179.6 123 DL 189.6 123
184.6 123 DL 194.6 123 189.6 123 DL 199.6 123 194.6 123 DL 204.6 123
199.6 123 DL 209.6 123 204.6 123 DL 214.6 123 209.6 123 DL 219.6 123
214.6 123 DL 224.6 123 219.6 123 DL 229.6 123 224.6 123 DL 234.6 123
229.6 123 DL 239.6 123 234.6 123 DL 244.6 123 239.6 123 DL 249.6 123
244.6 123 DL 254.6 123 249.6 123 DL 259.6 123 254.6 123 DL 264.6 123
259.6 123 DL 269.6 123 264.6 123 DL 274.6 123 269.6 123 DL 279.6 123
274.6 123 DL 284.6 123 279.6 123 DL 289.6 123 284.6 123 DL 294.6 123
289.6 123 DL 299.6 123 294.6 123 DL 304.6 123 299.6 123 DL 309.6 123
304.6 123 DL 314.6 123 309.6 123 DL 319.6 123 314.6 123 DL 324.6 123
319.6 123 DL 329.6 123 324.6 123 DL 334.6 123 329.6 123 DL 339.6 123
334.6 123 DL 344.6 123 339.6 123 DL 349.6 123 344.6 123 DL 354.6 123
349.6 123 DL 359.6 123 354.6 123 DL 364.6 123 359.6 123 DL 369.6 123
364.6 123 DL 374.6 123 369.6 123 DL 379.6 123 374.6 123 DL 384.6 123
379.6 123 DL 389.6 123 384.6 123 DL 394.6 123 389.6 123 DL 399.6 123
394.6 123 DL 404.6 123 399.6 123 DL 409.6 123 404.6 123 DL 414.6 123
409.6 123 DL 419.6 123 414.6 123 DL 424.6 123 419.6 123 DL 429.6 123
424.6 123 DL 434.6 123 429.6 123 DL 439.6 123 434.6 123 DL 444.6 123
439.6 123 DL 449.6 123 444.6 123 DL 454.6 123 449.6 123 DL 459.6 123
454.6 123 DL 464.6 123 459.6 123 DL 469.6 123 464.6 123 DL 474.6 123
469.6 123 DL 479.6 123 474.6 123 DL 484.6 123 479.6 123 DL 489.6 123
484.6 123 DL 494.6 123 489.6 123 DL 499.6 123 494.6 123 DL 504.6 123
499.6 123 DL 509.6 123 504.6 123 DL 514.6 123 509.6 123 DL 519.6 123
514.6 123 DL/F2 9/Courier@0 SF 16.2(#include "calld.h")129.6 132.501 R
(int)129.6 150.691 Q(tty_dial\(int fd, char *phone, char *dialer, char \
*sub, char *expsend\))129.6 161.391 Q({)129.6 172.091 Q 16.2(char *ptr;)
151.2 182.791 R(ptr = strtok\(expsend, WHITE\);)151.2 200.981 Q
(/* first expect string */)16.2 E(for \( ; ; \) {)151.2 211.681 Q
(DEBUG_NONL\("expect = %s\\nread: ", ptr\);)172.8 222.381 Q
(if \(expect_str\(fd, ptr\) < 0\))172.8 233.081 Q(return\(-1\);)194.4
243.781 Q(if \(\(ptr = strtok\(NULL, WHITE\)\) == NULL\))172.8 261.971 Q
27(return\(0\); /*)194.4 272.671 R(at the end of the expect/send */)5.4
E(DEBUG_NONL\("send = %s\\nwrite: ", ptr\);)172.8 283.371 Q
(if \(send_str\(fd, ptr, phone, 0\) < 0\))172.8 294.071 Q(return\(-1\);)
194.4 304.771 Q(if \(\(ptr = strtok\(NULL, WHITE\)\) == NULL\))172.8
322.961 Q 27(return\(0\); /*)194.4 333.661 R
(at the end of the expect/send */)5.4 E(})151.2 344.361 Q(})129.6
355.061 Q 134.6 359.862 129.6 359.862 DL 139.6 359.862 134.6 359.862 DL
144.6 359.862 139.6 359.862 DL 149.6 359.862 144.6 359.862 DL 154.6
359.862 149.6 359.862 DL 159.6 359.862 154.6 359.862 DL 164.6 359.862
159.6 359.862 DL 169.6 359.862 164.6 359.862 DL 174.6 359.862 169.6
359.862 DL 179.6 359.862 174.6 359.862 DL 184.6 359.862 179.6 359.862 DL
189.6 359.862 184.6 359.862 DL 194.6 359.862 189.6 359.862 DL 199.6
359.862 194.6 359.862 DL 204.6 359.862 199.6 359.862 DL 209.6 359.862
204.6 359.862 DL 214.6 359.862 209.6 359.862 DL 219.6 359.862 214.6
359.862 DL 224.6 359.862 219.6 359.862 DL 229.6 359.862 224.6 359.862 DL
234.6 359.862 229.6 359.862 DL 239.6 359.862 234.6 359.862 DL 244.6
359.862 239.6 359.862 DL 249.6 359.862 244.6 359.862 DL 254.6 359.862
249.6 359.862 DL 259.6 359.862 254.6 359.862 DL 264.6 359.862 259.6
359.862 DL 269.6 359.862 264.6 359.862 DL 274.6 359.862 269.6 359.862 DL
279.6 359.862 274.6 359.862 DL 284.6 359.862 279.6 359.862 DL 289.6
359.862 284.6 359.862 DL 294.6 359.862 289.6 359.862 DL 299.6 359.862
294.6 359.862 DL 304.6 359.862 299.6 359.862 DL 309.6 359.862 304.6
359.862 DL 314.6 359.862 309.6 359.862 DL 319.6 359.862 314.6 359.862 DL
324.6 359.862 319.6 359.862 DL 329.6 359.862 324.6 359.862 DL 334.6
359.862 329.6 359.862 DL 339.6 359.862 334.6 359.862 DL 344.6 359.862
339.6 359.862 DL 349.6 359.862 344.6 359.862 DL 354.6 359.862 349.6
359.862 DL 359.6 359.862 354.6 359.862 DL 364.6 359.862 359.6 359.862 DL
369.6 359.862 364.6 359.862 DL 374.6 359.862 369.6 359.862 DL 379.6
359.862 374.6 359.862 DL 384.6 359.862 379.6 359.862 DL 389.6 359.862
384.6 359.862 DL 394.6 359.862 389.6 359.862 DL 399.6 359.862 394.6
359.862 DL 404.6 359.862 399.6 359.862 DL 409.6 359.862 404.6 359.862 DL
414.6 359.862 409.6 359.862 DL 419.6 359.862 414.6 359.862 DL 424.6
359.862 419.6 359.862 DL 429.6 359.862 424.6 359.862 DL 434.6 359.862
429.6 359.862 DL 439.6 359.862 434.6 359.862 DL 444.6 359.862 439.6
359.862 DL 449.6 359.862 444.6 359.862 DL 454.6 359.862 449.6 359.862 DL
459.6 359.862 454.6 359.862 DL 464.6 359.862 459.6 359.862 DL 469.6
359.862 464.6 359.862 DL 474.6 359.862 469.6 359.862 DL 479.6 359.862
474.6 359.862 DL 484.6 359.862 479.6 359.862 DL 489.6 359.862 484.6
359.862 DL 494.6 359.862 489.6 359.862 DL 499.6 359.862 494.6 359.862 DL
504.6 359.862 499.6 359.862 DL 509.6 359.862 504.6 359.862 DL 514.6
359.862 509.6 359.862 DL 519.6 359.862 514.6 359.862 DL/F3 8
/Palatino-Bold@0 SF(Figure 22)262.096 375.862 Q/F4 8/Palatino-Roman@0 SF
(The)6 E/F5 8/Courier@0 SF(tty_dial)2 E F4(function)2 E/F6 10
/Palatino-Roman@0 SF(The)129.6 399.862 Q/F7 10/Courier@0 SF(tty_dial)
3.187 E F6 .686(function just calls one function to handle the expect s\
tring and another)3.187 F .591(to handle the send string.)129.6 411.862
R 2.431 -.92(We a)5.591 H .951 -.18(re d).92 H .591(one when ther).18 F
3.091(ea)-.18 G .951 -.18(re n)-3.091 H 3.091(om).18 G(or)-3.091 E 3.092
(es)-.18 G .592(end or expect strings.)-3.092 F
(\(Note that we do not handle the)129.6 423.862 Q/F8 10
/Palatino-Italic@0 SF(sub)2.5 E F6(string fr)2.5 E(om Figur)-.18 E 2.5
(e4)-.18 G(.\))-2.5 E(Figur)147.6 435.862 Q 3.017(e2)-.18 G 3.017(3s)
-3.017 G .516(hows the function)-3.017 F F7(send_str)3.016 E F6 .516
(that outputs the send strings.)3.016 F 2.356 -.92(To k)5.516 H .516
(eep the).92 F 3.185(size of this example manageable, we have not imple\
mented every special escape)129.6 447.862 R -1.667(sequence \212 we)
129.6 459.862 R 1.567(have implemented enough to use the pr)4.067 F
1.567(ogram with the)-.18 F F7(Dialers)4.066 E F6(\214le)4.066 E
(shown in Figur)129.6 471.862 Q 2.5(e4)-.18 G(.)-2.5 E 134.6 479.062
129.6 479.062 DL 139.6 479.062 134.6 479.062 DL 144.6 479.062 139.6
479.062 DL 149.6 479.062 144.6 479.062 DL 154.6 479.062 149.6 479.062 DL
159.6 479.062 154.6 479.062 DL 164.6 479.062 159.6 479.062 DL 169.6
479.062 164.6 479.062 DL 174.6 479.062 169.6 479.062 DL 179.6 479.062
174.6 479.062 DL 184.6 479.062 179.6 479.062 DL 189.6 479.062 184.6
479.062 DL 194.6 479.062 189.6 479.062 DL 199.6 479.062 194.6 479.062 DL
204.6 479.062 199.6 479.062 DL 209.6 479.062 204.6 479.062 DL 214.6
479.062 209.6 479.062 DL 219.6 479.062 214.6 479.062 DL 224.6 479.062
219.6 479.062 DL 229.6 479.062 224.6 479.062 DL 234.6 479.062 229.6
479.062 DL 239.6 479.062 234.6 479.062 DL 244.6 479.062 239.6 479.062 DL
249.6 479.062 244.6 479.062 DL 254.6 479.062 249.6 479.062 DL 259.6
479.062 254.6 479.062 DL 264.6 479.062 259.6 479.062 DL 269.6 479.062
264.6 479.062 DL 274.6 479.062 269.6 479.062 DL 279.6 479.062 274.6
479.062 DL 284.6 479.062 279.6 479.062 DL 289.6 479.062 284.6 479.062 DL
294.6 479.062 289.6 479.062 DL 299.6 479.062 294.6 479.062 DL 304.6
479.062 299.6 479.062 DL 309.6 479.062 304.6 479.062 DL 314.6 479.062
309.6 479.062 DL 319.6 479.062 314.6 479.062 DL 324.6 479.062 319.6
479.062 DL 329.6 479.062 324.6 479.062 DL 334.6 479.062 329.6 479.062 DL
339.6 479.062 334.6 479.062 DL 344.6 479.062 339.6 479.062 DL 349.6
479.062 344.6 479.062 DL 354.6 479.062 349.6 479.062 DL 359.6 479.062
354.6 479.062 DL 364.6 479.062 359.6 479.062 DL 369.6 479.062 364.6
479.062 DL 374.6 479.062 369.6 479.062 DL 379.6 479.062 374.6 479.062 DL
384.6 479.062 379.6 479.062 DL 389.6 479.062 384.6 479.062 DL 394.6
479.062 389.6 479.062 DL 399.6 479.062 394.6 479.062 DL 404.6 479.062
399.6 479.062 DL 409.6 479.062 404.6 479.062 DL 414.6 479.062 409.6
479.062 DL 419.6 479.062 414.6 479.062 DL 424.6 479.062 419.6 479.062 DL
429.6 479.062 424.6 479.062 DL 434.6 479.062 429.6 479.062 DL 439.6
479.062 434.6 479.062 DL 444.6 479.062 439.6 479.062 DL 449.6 479.062
444.6 479.062 DL 454.6 479.062 449.6 479.062 DL 459.6 479.062 454.6
479.062 DL 464.6 479.062 459.6 479.062 DL 469.6 479.062 464.6 479.062 DL
474.6 479.062 469.6 479.062 DL 479.6 479.062 474.6 479.062 DL 484.6
479.062 479.6 479.062 DL 489.6 479.062 484.6 479.062 DL 494.6 479.062
489.6 479.062 DL 499.6 479.062 494.6 479.062 DL 504.6 479.062 499.6
479.062 DL 509.6 479.062 504.6 479.062 DL 514.6 479.062 509.6 479.062 DL
519.6 479.062 514.6 479.062 DL F2 16.2(#include "calld.h")129.6 488.563
R(int)129.6 507.823 Q
(send_str\(int fd, char *ptr, char *phone, int echocheck\))129.6 518.523
Q({)129.6 529.223 Q 16.2(char c,)151.2 539.923 R(tempc;)5.4 E(/*)151.2
559.183 Q 5.4(*G)156.6 569.883 S 5.4(ot)-5.4 G
(hough send string, converting escape sequences on the fly.)-5.4 E(*/)
156.6 580.583 Q(while \(\(c = *ptr++\) != 0\) {)151.2 591.283 Q
(if \(c == '\\\\'\) {)172.8 601.983 Q(if \(*ptr == 0\) {)194.4 612.683 Q
(sprintf\(errmsg, "backslash at end of send string\\n"\);)216 623.383 Q
(return\(-1\);)216 634.083 Q(})194.4 644.783 Q 5.4(c=*)194.4 655.483 S
21.6(ptr++; /*)-5.4 F(char following backslash */)5.4 E 0 Cg EP
%%Page: 34 34
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(34)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(switch \(c\) {)194.4 121.7 Q(case 'c':)194.4 132.4 Q
(/* no CR, if at end of string */)37.8 E(if \(*ptr == 0\))216 143.1 Q
(goto returnok;)237.6 153.8 Q 10.8(continue; /*)216 164.5 R
(ignore if not at end of string */)5.4 E(case 'd':)194.4 183.76 Q
(/* 2 second delay */)37.8 E(DEBUG_NONL\("<delay>"\);)216 194.46 Q
(sleep\(2\);)216 205.16 Q(continue;)216 215.86 Q(case 'p':)194.4 235.12
Q(/* 0.25 second pause */)37.8 E(DEBUG_NONL\("<pause>"\);)216 245.82 Q
10.8(sleep_us\(250000\); /*)216 256.52 R(Exercise 14.6 */)5.4 E
(continue;)216 267.22 Q(case 'e':)194.4 286.48 Q
(DEBUG_NONL\("<echo check off>"\);)216 297.18 Q(echocheck = 0;)216
307.88 Q(continue;)216 318.58 Q(case 'E':)194.4 337.84 Q
(DEBUG_NONL\("<echo check on>"\);)216 348.54 Q(echocheck = 1;)216 359.24
Q(continue;)216 369.94 Q(case 'T':)194.4 389.2 Q
(/* output phone number */)37.8 E
(send_str\(fd, phone, phone, echocheck\);)216 399.9 Q(/* recursive */)
10.8 E(continue;)216 410.6 Q(case 'r':)194.4 429.86 Q 5.4(c=')216 440.56
S(\\r';)-5.4 E(break;)216 451.26 Q(case 's':)194.4 470.52 Q 5.4(c='')216
481.22 S(;)-5.4 E(break;)216 491.92 Q
(/* room for lots more case statements ... */)216 502.62 Q(default:)
194.4 521.88 Q(sprintf\(errmsg, "unknown send escape char: \\\\%s\\n",)
216 532.58 Q(ctl_str\(c\)\);)226.8 543.28 Q(return\(-1\);)216 553.98 Q
(})194.4 564.68 Q(})172.8 575.38 Q(DEBUG_NONL\("%s", ctl_str\(c\)\);)
172.8 594.64 Q(if \(write\(fd, &c, 1\) != 1\))172.8 605.34 Q
(log_sys\("write error"\);)194.4 616.04 Q(if \(echocheck\) {)172.8
626.74 Q(/* wait for char to be echoed */)43.2 E(do {)194.4 637.44 Q
(if \(read\(fd, &tempc, 1\) != 1\))216 648.14 Q 0 Cg EP
%%Page: 35 35
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(35)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(log_sys\("read error"\);)237.6 121.7 Q
(DEBUG_NONL\("{%s}", ctl_str\(tempc\)\);)216 132.4 Q 5.4(}w)194.4 143.1
S(hile \(tempc != c\);)-5.4 E(})172.8 153.8 Q(})151.2 164.5 Q 5.4(c=')
151.2 175.2 S 10.8(\\r'; /*)-5.4 F
(if no \\c at end of string, CR written at end */)5.4 E
(DEBUG_NONL\("%s", ctl_str\(c\)\);)151.2 185.9 Q
(if \(write\(fd, &c, 1\) != 1\))151.2 196.6 Q(log_sys\("write error"\);)
172.8 207.3 Q(returnok:)129.6 226.56 Q(DEBUG\(""\);)151.2 237.26 Q
(return\(0\);)151.2 247.96 Q(})129.6 258.66 Q .4 LW 134.6 263.461 129.6
263.461 DL 139.6 263.461 134.6 263.461 DL 144.6 263.461 139.6 263.461 DL
149.6 263.461 144.6 263.461 DL 154.6 263.461 149.6 263.461 DL 159.6
263.461 154.6 263.461 DL 164.6 263.461 159.6 263.461 DL 169.6 263.461
164.6 263.461 DL 174.6 263.461 169.6 263.461 DL 179.6 263.461 174.6
263.461 DL 184.6 263.461 179.6 263.461 DL 189.6 263.461 184.6 263.461 DL
194.6 263.461 189.6 263.461 DL 199.6 263.461 194.6 263.461 DL 204.6
263.461 199.6 263.461 DL 209.6 263.461 204.6 263.461 DL 214.6 263.461
209.6 263.461 DL 219.6 263.461 214.6 263.461 DL 224.6 263.461 219.6
263.461 DL 229.6 263.461 224.6 263.461 DL 234.6 263.461 229.6 263.461 DL
239.6 263.461 234.6 263.461 DL 244.6 263.461 239.6 263.461 DL 249.6
263.461 244.6 263.461 DL 254.6 263.461 249.6 263.461 DL 259.6 263.461
254.6 263.461 DL 264.6 263.461 259.6 263.461 DL 269.6 263.461 264.6
263.461 DL 274.6 263.461 269.6 263.461 DL 279.6 263.461 274.6 263.461 DL
284.6 263.461 279.6 263.461 DL 289.6 263.461 284.6 263.461 DL 294.6
263.461 289.6 263.461 DL 299.6 263.461 294.6 263.461 DL 304.6 263.461
299.6 263.461 DL 309.6 263.461 304.6 263.461 DL 314.6 263.461 309.6
263.461 DL 319.6 263.461 314.6 263.461 DL 324.6 263.461 319.6 263.461 DL
329.6 263.461 324.6 263.461 DL 334.6 263.461 329.6 263.461 DL 339.6
263.461 334.6 263.461 DL 344.6 263.461 339.6 263.461 DL 349.6 263.461
344.6 263.461 DL 354.6 263.461 349.6 263.461 DL 359.6 263.461 354.6
263.461 DL 364.6 263.461 359.6 263.461 DL 369.6 263.461 364.6 263.461 DL
374.6 263.461 369.6 263.461 DL 379.6 263.461 374.6 263.461 DL 384.6
263.461 379.6 263.461 DL 389.6 263.461 384.6 263.461 DL 394.6 263.461
389.6 263.461 DL 399.6 263.461 394.6 263.461 DL 404.6 263.461 399.6
263.461 DL 409.6 263.461 404.6 263.461 DL 414.6 263.461 409.6 263.461 DL
419.6 263.461 414.6 263.461 DL 424.6 263.461 419.6 263.461 DL 429.6
263.461 424.6 263.461 DL 434.6 263.461 429.6 263.461 DL 439.6 263.461
434.6 263.461 DL 444.6 263.461 439.6 263.461 DL 449.6 263.461 444.6
263.461 DL 454.6 263.461 449.6 263.461 DL 459.6 263.461 454.6 263.461 DL
464.6 263.461 459.6 263.461 DL 469.6 263.461 464.6 263.461 DL 474.6
263.461 469.6 263.461 DL 479.6 263.461 474.6 263.461 DL 484.6 263.461
479.6 263.461 DL 489.6 263.461 484.6 263.461 DL 494.6 263.461 489.6
263.461 DL 499.6 263.461 494.6 263.461 DL 504.6 263.461 499.6 263.461 DL
509.6 263.461 504.6 263.461 DL 514.6 263.461 509.6 263.461 DL 519.6
263.461 514.6 263.461 DL/F3 8/Palatino-Bold@0 SF(Figure 23)262.096
279.461 Q/F4 8/Palatino-Roman@0 SF(The)6 E/F5 8/Courier@0 SF(send_str)2
E F4(function)2 E/F6 10/Courier@0 SF(send_str)147.6 303.461 Q/F7 10
/Palatino-Roman@0 SF 1.513(calls the function)4.013 F F6(ctl_str)4.013 E
F7 1.514(to convert ASCII contr)4.014 F 1.514(ol characters into a)-.18
F(printable version.)129.6 315.461 Q(Figur)5 E 2.5(e2)-.18 G 2.5(4s)-2.5
G(hows the)-2.5 E F6(ctl_str)2.5 E F7(function.)2.5 E 134.6 322.661
129.6 322.661 DL 139.6 322.661 134.6 322.661 DL 144.6 322.661 139.6
322.661 DL 149.6 322.661 144.6 322.661 DL 154.6 322.661 149.6 322.661 DL
159.6 322.661 154.6 322.661 DL 164.6 322.661 159.6 322.661 DL 169.6
322.661 164.6 322.661 DL 174.6 322.661 169.6 322.661 DL 179.6 322.661
174.6 322.661 DL 184.6 322.661 179.6 322.661 DL 189.6 322.661 184.6
322.661 DL 194.6 322.661 189.6 322.661 DL 199.6 322.661 194.6 322.661 DL
204.6 322.661 199.6 322.661 DL 209.6 322.661 204.6 322.661 DL 214.6
322.661 209.6 322.661 DL 219.6 322.661 214.6 322.661 DL 224.6 322.661
219.6 322.661 DL 229.6 322.661 224.6 322.661 DL 234.6 322.661 229.6
322.661 DL 239.6 322.661 234.6 322.661 DL 244.6 322.661 239.6 322.661 DL
249.6 322.661 244.6 322.661 DL 254.6 322.661 249.6 322.661 DL 259.6
322.661 254.6 322.661 DL 264.6 322.661 259.6 322.661 DL 269.6 322.661
264.6 322.661 DL 274.6 322.661 269.6 322.661 DL 279.6 322.661 274.6
322.661 DL 284.6 322.661 279.6 322.661 DL 289.6 322.661 284.6 322.661 DL
294.6 322.661 289.6 322.661 DL 299.6 322.661 294.6 322.661 DL 304.6
322.661 299.6 322.661 DL 309.6 322.661 304.6 322.661 DL 314.6 322.661
309.6 322.661 DL 319.6 322.661 314.6 322.661 DL 324.6 322.661 319.6
322.661 DL 329.6 322.661 324.6 322.661 DL 334.6 322.661 329.6 322.661 DL
339.6 322.661 334.6 322.661 DL 344.6 322.661 339.6 322.661 DL 349.6
322.661 344.6 322.661 DL 354.6 322.661 349.6 322.661 DL 359.6 322.661
354.6 322.661 DL 364.6 322.661 359.6 322.661 DL 369.6 322.661 364.6
322.661 DL 374.6 322.661 369.6 322.661 DL 379.6 322.661 374.6 322.661 DL
384.6 322.661 379.6 322.661 DL 389.6 322.661 384.6 322.661 DL 394.6
322.661 389.6 322.661 DL 399.6 322.661 394.6 322.661 DL 404.6 322.661
399.6 322.661 DL 409.6 322.661 404.6 322.661 DL 414.6 322.661 409.6
322.661 DL 419.6 322.661 414.6 322.661 DL 424.6 322.661 419.6 322.661 DL
429.6 322.661 424.6 322.661 DL 434.6 322.661 429.6 322.661 DL 439.6
322.661 434.6 322.661 DL 444.6 322.661 439.6 322.661 DL 449.6 322.661
444.6 322.661 DL 454.6 322.661 449.6 322.661 DL 459.6 322.661 454.6
322.661 DL 464.6 322.661 459.6 322.661 DL 469.6 322.661 464.6 322.661 DL
474.6 322.661 469.6 322.661 DL 479.6 322.661 474.6 322.661 DL 484.6
322.661 479.6 322.661 DL 489.6 322.661 484.6 322.661 DL 494.6 322.661
489.6 322.661 DL 499.6 322.661 494.6 322.661 DL 504.6 322.661 499.6
322.661 DL 509.6 322.661 504.6 322.661 DL 514.6 322.661 509.6 322.661 DL
519.6 322.661 514.6 322.661 DL F2 16.2(#include "calld.h")129.6 332.162
R(/*)129.6 351.422 Q 5.4(*M)135 362.122 S
(ake a printable string of the character "c", which may be a)-5.4 E 5.4
(*c)135 372.822 S(ontrol character.)-5.4 E(Works only with ASCII.)10.8 E
(*/)135 383.522 Q(char *)129.6 394.222 Q(ctl_str\(unsigned char c\))
129.6 404.922 Q({)129.6 415.622 Q(static char tempstr[6];)151.2 426.322
Q(/* biggest is "\\177" + null */)27 E 5.4(c&)151.2 445.582 S 5.4(=2)
-5.4 G(55;)-5.4 E(if \(c == 0\))151.2 456.282 Q 48.6
(return\("\\\\0"\); /*)172.8 466.982 R(really shouldn't see a null */)
5.4 E(else if \(c < 040\))151.2 477.682 Q
(sprintf\(tempstr, "^%c", c + 'A' - 1\);)172.8 488.382 Q
(else if \(c == 0177\))151.2 499.082 Q(return\("DEL"\);)172.8 509.782 Q
(else if \(c > 0177\))151.2 520.482 Q
(sprintf\(tempstr, "\\\\%03o", c\);)172.8 531.182 Q(else)151.2 541.882 Q
(sprintf\(tempstr, "%c", c\);)172.8 552.582 Q(return\(tempstr\);)151.2
563.282 Q(})129.6 573.982 Q 134.6 578.783 129.6 578.783 DL 139.6 578.783
134.6 578.783 DL 144.6 578.783 139.6 578.783 DL 149.6 578.783 144.6
578.783 DL 154.6 578.783 149.6 578.783 DL 159.6 578.783 154.6 578.783 DL
164.6 578.783 159.6 578.783 DL 169.6 578.783 164.6 578.783 DL 174.6
578.783 169.6 578.783 DL 179.6 578.783 174.6 578.783 DL 184.6 578.783
179.6 578.783 DL 189.6 578.783 184.6 578.783 DL 194.6 578.783 189.6
578.783 DL 199.6 578.783 194.6 578.783 DL 204.6 578.783 199.6 578.783 DL
209.6 578.783 204.6 578.783 DL 214.6 578.783 209.6 578.783 DL 219.6
578.783 214.6 578.783 DL 224.6 578.783 219.6 578.783 DL 229.6 578.783
224.6 578.783 DL 234.6 578.783 229.6 578.783 DL 239.6 578.783 234.6
578.783 DL 244.6 578.783 239.6 578.783 DL 249.6 578.783 244.6 578.783 DL
254.6 578.783 249.6 578.783 DL 259.6 578.783 254.6 578.783 DL 264.6
578.783 259.6 578.783 DL 269.6 578.783 264.6 578.783 DL 274.6 578.783
269.6 578.783 DL 279.6 578.783 274.6 578.783 DL 284.6 578.783 279.6
578.783 DL 289.6 578.783 284.6 578.783 DL 294.6 578.783 289.6 578.783 DL
299.6 578.783 294.6 578.783 DL 304.6 578.783 299.6 578.783 DL 309.6
578.783 304.6 578.783 DL 314.6 578.783 309.6 578.783 DL 319.6 578.783
314.6 578.783 DL 324.6 578.783 319.6 578.783 DL 329.6 578.783 324.6
578.783 DL 334.6 578.783 329.6 578.783 DL 339.6 578.783 334.6 578.783 DL
344.6 578.783 339.6 578.783 DL 349.6 578.783 344.6 578.783 DL 354.6
578.783 349.6 578.783 DL 359.6 578.783 354.6 578.783 DL 364.6 578.783
359.6 578.783 DL 369.6 578.783 364.6 578.783 DL 374.6 578.783 369.6
578.783 DL 379.6 578.783 374.6 578.783 DL 384.6 578.783 379.6 578.783 DL
389.6 578.783 384.6 578.783 DL 394.6 578.783 389.6 578.783 DL 399.6
578.783 394.6 578.783 DL 404.6 578.783 399.6 578.783 DL 409.6 578.783
404.6 578.783 DL 414.6 578.783 409.6 578.783 DL 419.6 578.783 414.6
578.783 DL 424.6 578.783 419.6 578.783 DL 429.6 578.783 424.6 578.783 DL
434.6 578.783 429.6 578.783 DL 439.6 578.783 434.6 578.783 DL 444.6
578.783 439.6 578.783 DL 449.6 578.783 444.6 578.783 DL 454.6 578.783
449.6 578.783 DL 459.6 578.783 454.6 578.783 DL 464.6 578.783 459.6
578.783 DL 469.6 578.783 464.6 578.783 DL 474.6 578.783 469.6 578.783 DL
479.6 578.783 474.6 578.783 DL 484.6 578.783 479.6 578.783 DL 489.6
578.783 484.6 578.783 DL 494.6 578.783 489.6 578.783 DL 499.6 578.783
494.6 578.783 DL 504.6 578.783 499.6 578.783 DL 509.6 578.783 504.6
578.783 DL 514.6 578.783 509.6 578.783 DL 519.6 578.783 514.6 578.783 DL
F3(Figure 24)264.496 594.783 Q F4(The)6 E F5(ctl_str)2 E F4(function)2 E
F7 .657(The har)147.6 618.783 R .657
(dest part of dialing the modem is r)-.18 F .657
(ecognizing the expect strings.)-.18 F(Figur)5.657 E 3.156(e2)-.18 G(5)
-3.156 E 1.685(shows the function)129.6 630.783 R F6(expect_str)4.185 E
F7 1.685(that does this.)4.185 F 1.686
(\(As with the send strings, we have)6.685 F
(implemented only a subset of all the possible featur)129.6 642.783 Q
(es pr)-.18 E(ovided by the)-.18 E F6(Dialers)2.5 E F7(\214le.\))2.5 E 0
Cg EP
%%Page: 36 36
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(36)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL .4
LW 134.6 123 129.6 123 DL 139.6 123 134.6 123 DL 144.6 123 139.6 123 DL
149.6 123 144.6 123 DL 154.6 123 149.6 123 DL 159.6 123 154.6 123 DL
164.6 123 159.6 123 DL 169.6 123 164.6 123 DL 174.6 123 169.6 123 DL
179.6 123 174.6 123 DL 184.6 123 179.6 123 DL 189.6 123 184.6 123 DL
194.6 123 189.6 123 DL 199.6 123 194.6 123 DL 204.6 123 199.6 123 DL
209.6 123 204.6 123 DL 214.6 123 209.6 123 DL 219.6 123 214.6 123 DL
224.6 123 219.6 123 DL 229.6 123 224.6 123 DL 234.6 123 229.6 123 DL
239.6 123 234.6 123 DL 244.6 123 239.6 123 DL 249.6 123 244.6 123 DL
254.6 123 249.6 123 DL 259.6 123 254.6 123 DL 264.6 123 259.6 123 DL
269.6 123 264.6 123 DL 274.6 123 269.6 123 DL 279.6 123 274.6 123 DL
284.6 123 279.6 123 DL 289.6 123 284.6 123 DL 294.6 123 289.6 123 DL
299.6 123 294.6 123 DL 304.6 123 299.6 123 DL 309.6 123 304.6 123 DL
314.6 123 309.6 123 DL 319.6 123 314.6 123 DL 324.6 123 319.6 123 DL
329.6 123 324.6 123 DL 334.6 123 329.6 123 DL 339.6 123 334.6 123 DL
344.6 123 339.6 123 DL 349.6 123 344.6 123 DL 354.6 123 349.6 123 DL
359.6 123 354.6 123 DL 364.6 123 359.6 123 DL 369.6 123 364.6 123 DL
374.6 123 369.6 123 DL 379.6 123 374.6 123 DL 384.6 123 379.6 123 DL
389.6 123 384.6 123 DL 394.6 123 389.6 123 DL 399.6 123 394.6 123 DL
404.6 123 399.6 123 DL 409.6 123 404.6 123 DL 414.6 123 409.6 123 DL
419.6 123 414.6 123 DL 424.6 123 419.6 123 DL 429.6 123 424.6 123 DL
434.6 123 429.6 123 DL 439.6 123 434.6 123 DL 444.6 123 439.6 123 DL
449.6 123 444.6 123 DL 454.6 123 449.6 123 DL 459.6 123 454.6 123 DL
464.6 123 459.6 123 DL 469.6 123 464.6 123 DL 474.6 123 469.6 123 DL
479.6 123 474.6 123 DL 484.6 123 479.6 123 DL 489.6 123 484.6 123 DL
494.6 123 489.6 123 DL 499.6 123 494.6 123 DL 504.6 123 499.6 123 DL
509.6 123 504.6 123 DL 514.6 123 509.6 123 DL 519.6 123 514.6 123 DL/F2
9/Courier@0 SF 16.2(#include "calld.h")129.6 132.501 R(#define EXPALRM)
129.6 149.621 Q 48.6(45 /*)27 F(alarm time to read expect string */)5.4
E(static int)129.6 166.741 Q(expalarm = EXPALRM;)32.4 E
(static volatile sig_atomic_t)129.6 177.441 Q(caught_alrm;)21.6 E 48.6
(size_t /*)129.6 194.561 R
(read one byte, handle timeout errors & DEBUG */)5.4 E
(exp_read\(int fd, char *buf\))129.6 205.261 Q({)129.6 215.961 Q
(if \(caught_alrm\) {)151.2 226.661 Q
(/* test flag before blocking in read */)10.8 E
(DEBUG\("\\nread timeout"\);)172.8 237.361 Q(return\(-1\);)172.8 248.061
Q(})151.2 258.761 Q(if \(read\(fd, buf, 1\) == 1\) {)151.2 269.461 Q
(DEBUG_NONL\("%s", ctl_str\(*buf\)\);)172.8 280.161 Q(return\(1\);)172.8
290.861 Q(})151.2 301.561 Q(if \(errno == EINTR && caught_alrm\))151.2
312.261 Q(DEBUG\("\\nread timeout"\);)172.8 322.961 Q(else)151.2 333.661
Q(log_sys\("read error"\);)172.8 344.361 Q(return\(-1\);)151.2 355.061 Q
(})129.6 365.761 Q(static void)129.6 382.881 Q(sig_alrm\(int signo\))
129.6 393.581 Q({)129.6 404.281 Q(caught_alrm = 1;)151.2 414.981 Q(})
129.6 425.681 Q 108(int /*)129.6 442.801 R
(return 0 if got it, -1 if not */)5.4 E(expect_str\(int fd, char *ptr\))
129.6 453.501 Q({)129.6 464.201 Q 16.2(char expstr[MAXLINE],)151.2
474.901 R(inbuf[MAXLINE];)5.4 E 16.2(char c;)151.2 485.601 R 16.2
(char *src,)151.2 496.301 R(*dst, *inptr, *cmpptr;)5.4 E 21.6(int i,)
151.2 507.001 R(matchlen;)5.4 E(if \(strcmp\(ptr, "\\"\\""\) == 0\))
151.2 524.121 Q(goto returnok;)172.8 534.821 Q
(/* special case of "" \(expect nothing\) */)32.4 E(/*)151.2 551.941 Q
5.4(*C)156.6 562.641 S(opy expect string, converting escape sequences.)
-5.4 E(*/)156.6 573.341 Q
(for \(src = ptr, dst = expstr; \(c = *src++\) != 0; \) {)151.2 584.041
Q(if \(c == '\\\\'\) {)172.8 594.741 Q(if \(*src == 0\) {)194.4 605.441
Q(sprintf\(errmsg, "invalid expect string: %s\\n", ptr\);)216 616.141 Q
(return\(-1\);)216 626.841 Q(})194.4 637.541 Q 5.4(c=*)194.4 648.241 S
21.6(src++; /*)-5.4 F(char following backslash */)5.4 E 0 Cg EP
%%Page: 37 37
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 6)93.6 84 R 2.25(Server Sour)
278.85 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(37)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(switch \(c\) {)194.4 121.7 Q(case 'r':)194.4
132.4 Q 5.4(c=')216 143.1 S(\\r';)-5.4 E(break;)216 153.8 Q(case 's':)
194.4 170.92 Q 5.4(c='')216 181.62 S(;)-5.4 E(break;)216 192.32 Q
(/* room for lots more case statements ... */)216 203.02 Q(default:)
194.4 220.14 Q
(sprintf\(errmsg, "unknown expect escape char: \\\\%s\\n",)216 230.84 Q
(ctl_str\(c\)\);)226.8 241.54 Q(return\(-1\);)216 252.24 Q(})194.4
262.94 Q(})172.8 273.64 Q(*dst++ = c;)172.8 284.34 Q(})151.2 295.04 Q
(*dst = 0;)151.2 305.74 Q(matchlen = strlen\(expstr\);)151.2 316.44 Q
(if \(signal\(SIGALRM, sig_alrm\) == SIG_ERR\))151.2 327.14 Q
(log_quit\("signal error"\);)172.8 337.84 Q(caught_alrm = 0;)151.2
348.54 Q(alarm\(expalarm\);)151.2 365.66 Q(do {)151.2 376.36 Q
(if \(exp_read\(fd, &c\) < 0\))172.8 387.06 Q(return\(-1\);)194.4 397.76
Q 5.4(}w)151.2 408.46 S(hile \(c != expstr[0]\);)-5.4 E
(/* skip until first chars equal */)16.2 E(cmpptr = inptr = inbuf;)151.2
419.16 Q(*inptr = c;)151.2 429.86 Q(for \(i = 1; i < matchlen; i++\) {)
151.2 440.56 Q(/* read matchlen chars */)21.6 E(inptr++;)172.8 451.26 Q
(if \(exp_read\(fd, inptr\) < 0\))172.8 461.96 Q(return\(-1\);)194.4
472.66 Q(})151.2 483.36 Q(for \( ; ; \) {)151.2 494.06 Q
(/* keep reading until we have a match */)37.8 E
(if \(strncmp\(cmpptr, expstr, matchlen\) == 0\))172.8 504.76 Q 27
(break; /*)194.4 515.46 R(have a match */)5.4 E(inptr++;)172.8 526.16 Q
(if \(exp_read\(fd, inptr\) < 0\))172.8 536.86 Q(return\(-1\);)194.4
547.56 Q(cmpptr++;)172.8 558.26 Q(})151.2 568.96 Q(returnok:)129.6
586.08 Q(alarm\(0\);)151.2 596.78 Q(DEBUG\("\\nexpect: got it"\);)151.2
607.48 Q(return\(0\);)151.2 618.18 Q(})129.6 628.88 Q .4 LW 134.6
633.681 129.6 633.681 DL 139.6 633.681 134.6 633.681 DL 144.6 633.681
139.6 633.681 DL 149.6 633.681 144.6 633.681 DL 154.6 633.681 149.6
633.681 DL 159.6 633.681 154.6 633.681 DL 164.6 633.681 159.6 633.681 DL
169.6 633.681 164.6 633.681 DL 174.6 633.681 169.6 633.681 DL 179.6
633.681 174.6 633.681 DL 184.6 633.681 179.6 633.681 DL 189.6 633.681
184.6 633.681 DL 194.6 633.681 189.6 633.681 DL 199.6 633.681 194.6
633.681 DL 204.6 633.681 199.6 633.681 DL 209.6 633.681 204.6 633.681 DL
214.6 633.681 209.6 633.681 DL 219.6 633.681 214.6 633.681 DL 224.6
633.681 219.6 633.681 DL 229.6 633.681 224.6 633.681 DL 234.6 633.681
229.6 633.681 DL 239.6 633.681 234.6 633.681 DL 244.6 633.681 239.6
633.681 DL 249.6 633.681 244.6 633.681 DL 254.6 633.681 249.6 633.681 DL
259.6 633.681 254.6 633.681 DL 264.6 633.681 259.6 633.681 DL 269.6
633.681 264.6 633.681 DL 274.6 633.681 269.6 633.681 DL 279.6 633.681
274.6 633.681 DL 284.6 633.681 279.6 633.681 DL 289.6 633.681 284.6
633.681 DL 294.6 633.681 289.6 633.681 DL 299.6 633.681 294.6 633.681 DL
304.6 633.681 299.6 633.681 DL 309.6 633.681 304.6 633.681 DL 314.6
633.681 309.6 633.681 DL 319.6 633.681 314.6 633.681 DL 324.6 633.681
319.6 633.681 DL 329.6 633.681 324.6 633.681 DL 334.6 633.681 329.6
633.681 DL 339.6 633.681 334.6 633.681 DL 344.6 633.681 339.6 633.681 DL
349.6 633.681 344.6 633.681 DL 354.6 633.681 349.6 633.681 DL 359.6
633.681 354.6 633.681 DL 364.6 633.681 359.6 633.681 DL 369.6 633.681
364.6 633.681 DL 374.6 633.681 369.6 633.681 DL 379.6 633.681 374.6
633.681 DL 384.6 633.681 379.6 633.681 DL 389.6 633.681 384.6 633.681 DL
394.6 633.681 389.6 633.681 DL 399.6 633.681 394.6 633.681 DL 404.6
633.681 399.6 633.681 DL 409.6 633.681 404.6 633.681 DL 414.6 633.681
409.6 633.681 DL 419.6 633.681 414.6 633.681 DL 424.6 633.681 419.6
633.681 DL 429.6 633.681 424.6 633.681 DL 434.6 633.681 429.6 633.681 DL
439.6 633.681 434.6 633.681 DL 444.6 633.681 439.6 633.681 DL 449.6
633.681 444.6 633.681 DL 454.6 633.681 449.6 633.681 DL 459.6 633.681
454.6 633.681 DL 464.6 633.681 459.6 633.681 DL 469.6 633.681 464.6
633.681 DL 474.6 633.681 469.6 633.681 DL 479.6 633.681 474.6 633.681 DL
484.6 633.681 479.6 633.681 DL 489.6 633.681 484.6 633.681 DL 494.6
633.681 489.6 633.681 DL 499.6 633.681 494.6 633.681 DL 504.6 633.681
499.6 633.681 DL 509.6 633.681 504.6 633.681 DL 514.6 633.681 509.6
633.681 DL 519.6 633.681 514.6 633.681 DL/F3 8/Palatino-Bold@0 SF
(Figure 25)222.888 649.681 Q/F4 8/Palatino-Roman@0 SF(Functions to r)6 E
(ead and r)-.144 E(ecognize expect strings)-.144 E 0 Cg EP
%%Page: 38 38
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(38)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
10/Palatino-Roman@0 SF 5.286 -.92(We \214)129.6 123 T 3.446
(rst copy the expect string, converting the special characters.).92 F
3.445(Our matching)8.445 F 1.625(technique is to r)129.6 135 R 1.625
(ead characters fr)-.18 F 1.626
(om the modem until the character matches the \214rst)-.18 F .732
(character of the expect string.)129.6 147 R 2.572 -.92(We t)5.732 H
.731(hen r).92 F .731(ead enough characters to equal the number of)-.18
F .256(characters in the expect string.)129.6 159 R(Fr)5.256 E .256
(om that point we continually r)-.18 F .256(ead characters fr)-.18 F
.257(om the)-.18 F .03(modem into the buf)129.6 171 R(fer)-.18 E 2.53
(,c)-.74 G .03
(omparing them against the expect string, until we have a match)-2.53 F
.45(or until the alarm goes of)129.6 183 R 2.95(f. \(Ther)-.18 F 2.95
(ea)-.18 G .81 -.18(re b)-2.95 H .451
(etter algorithms for string matching).18 F .833<8a6f>.833 G .451
(urs was)-.833 F .933(chosen to simplify the coding.)129.6 195 R .933
(The number of characters r)5.933 F .933(eturned by the modem that)-.18
F(ar)129.6 207 Q 2.558(ec)-.18 G(ompar)-2.558 E .058
(ed to the expect string is usually on the or)-.18 F .059
(der of 50, and the size of the expect)-.18 F(string is often ar)129.6
219 Q(ound 10)-.18 E<89>.833 -.9 M(20 characters.\)).833 .9 M .194(Note\
 that we have to set an alarm each time we try to match an expect strin\
g, as the)147.6 231 R .924
(alarm is the only way we can determine that we didn't r)129.6 243 R
.924(eceive what we wer)-.18 F 3.424(ew)-.18 G(aiting)-3.424 E(for)129.6
255 Q(.)-.74 E .587(This completes the server daemon.)147.6 267 R .587
(All it does is open a terminal device and dial a)5.587 F 4.553
(modem. What)129.6 279 R 2.054
(happens with the terminal device after it is opened depends on the)
4.553 F 4.148(client. W)129.6 291 R 1.647
(e'll now examine a client that pr)-.92 F 1.647
(ovides an interface similar to)-.18 F/F3 10/Courier@0 SF(cu)4.147 E F2
(and)4.147 E F3(tip)4.147 E F2(,)A(allowing us to dial a r)129.6 303 Q
(emote system and log in.)-.18 E/F4 12/Helvetica-Bold@0 SF 29.328(7C)
93.6 334.2 S 3.336(lient Design)-29.328 F F2 1.433(The interface betwee\
n the client and server is only about a dozen lines of code.)129.6 355.8
R(The)6.433 E 1.712
(client formats a command line, sends it to the server)129.6 367.8 R
4.212(,a)-.74 G 1.712(nd r)-4.212 F 1.712(eceives back either a \214le)
-.18 F 1.687(descriptor or an err)129.6 379.8 R 1.688(or indication.)
-.18 F 1.688(The r)6.688 F 1.688
(est of the client design depends on what the)-.18 F .662
(client wants to do with the r)129.6 391.8 R .662(eturned descriptor)
-.18 F 5.662(.I)-.74 G 3.162(nt)-5.662 G .662
(his section we'll outline the design)-3.162 F .144(of the)129.6 403.8 R
F3(call)2.644 E F2 .144(client that works like the familiar)2.644 F F3
(cu)2.644 E F2(and)2.644 E F3(tip)2.644 E F2(pr)2.644 E 2.644
(ograms. It)-.18 F .145(allows us to call)2.644 F 3.246(ar)129.6 415.8 S
.746(emote system and log in to it.)-3.426 F .745(The r)5.745 F .745
(emote system need not be a UNIX system)-.18 F .833<8a77>.833 G(e)-.833
E .717(can use it to communicate with any system or device that's conne\
cted to the host with)129.6 427.8 R(an RS)129.6 439.8 Q(-)-.9 I
(232 serial connection.).9 I/F5 10/Helvetica-Bold@0 SF -.6(Te)93.6 463.8
S(rminal Line Disciplines).6 E F2 .994(In Figur)129.6 487.8 R .993
(es 14.20 and 14.21 we gave an overview of the)-.18 F F3(telnet)3.493 E
F2(pr)3.493 E .993(ogram, which has a)-.18 F 2.793(similar str)129.6
499.8 R(uctur)-.08 E 5.293(et)-.18 G 5.293(ot)-5.293 G 2.793
(he modem dialer)-5.293 F 7.793(.F)-.74 G(igur)-7.793 E 5.293(e2)-.18 G
5.293(6i)-5.293 G 5.293(sa)-5.293 G 5.293(ne)-5.293 G 2.793
(xpansion of Figur)-5.293 F 5.294(e1)-.18 G(4.20,)-5.294 E -.18(re)129.6
511.8 S 1.493(cognizing that ther).18 F 3.993(ea)-.18 G 1.853 -.18(re t)
-3.993 H 1.492(wo line disciplines between the user and the modem and)
.18 F .942(assuming that we'r)129.6 523.8 R 3.442(eu)-.18 G .942
(sing the pr)-3.442 F .942(ogram to dial into a r)-.18 F .942
(emote UNIX host.)-.18 F .943(\(Recall fr)5.943 F(om)-.18 E 1.341
(the output of Figur)129.6 535.8 R 3.841(e1)-.18 G 1.341
(4.18 that for a STREAMS)-3.841 F(-)-.9 I 1.341
(based terminal system, Figur).9 J 3.84(e2)-.18 G 3.84(6i)-3.84 G 3.84
(sa)-3.84 G 7.054(simpli\214cation. Ther)129.6 547.8 R 7.054(em)-.18 G
4.554(ay be multiple STREAMS modules making up the line)-7.054 F .977
(discipline and multiple modules making up the terminal device driver)
129.6 559.8 R 5.976(.W)-.74 G 3.476(ea)-6.896 G .976(lso don't)-3.476 F
(explicitly show the str)129.6 571.8 Q(eam head.\))-.18 E 2.063
(The two dotted boxes in Figur)147.6 583.8 R 4.563(e2)-.18 G 4.563(6a)
-4.563 G 2.063(bove the modem on the local system wer)-4.563 F(e)-.18 E
.211(established by the server)129.6 595.8 R('s).74 E F3(tty_open)2.711
E F2 .211(function \(Figur)2.711 F 2.711(e2)-.18 G 2.711(1\). That)
-2.711 F .21(function set the dotted)2.711 F 1.337
(terminal line discipline module to noncanonical \(i.e., raw\) mode.)
129.6 607.8 R 1.338(The modem on the)6.338 F .035
(local system was dialed by the server)129.6 619.8 R('s).74 E F3
(tty_dial)2.535 E F2 .034(function \(Figur)2.535 F 2.534(e2)-.18 G 2.534
(2\). The)-2.534 F .034(two arr)2.534 F(ows)-.18 E .294
(between the dotted terminal line discipline box and the)129.6 631.8 R
F3(call)2.795 E F2(pr)2.795 E .295(ocess corr)-.18 F .295(espond to the)
-.18 F 1.747(descriptor r)129.6 643.8 R 1.747(eturned by the server)-.18
F 6.747(.\()-.74 G 3.587 -.92(We s)-6.747 H 1.747
(how the single descriptor as two arr).92 F 1.746(ows, to)-.18 F -.18
(re)129.6 655.8 S(iterate the fact that it's a full-duplex descriptor)
.18 E(.\))-.74 E 0 Cg EP
%%Page: 39 39
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 7)93.6 84 R 2.25(Client Design)
304.707 F/F1 9/Palatino-Bold@0 SF(39)18 E .32 LW 97.6 91.2 93.6 91.2 DL
99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2 103.6 91.2 DL
111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6 91.2 115.6 91.2
DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL 131.6 91.2 127.6
91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2 DL 143.6 91.2
139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6 91.2 DL 155.6
91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2 159.6 91.2 DL
167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6 91.2 171.6 91.2
DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL 187.6 91.2 183.6
91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2 DL 199.6 91.2
195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6 91.2 DL 211.6
91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2 215.6 91.2 DL
223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6 91.2 227.6 91.2
DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL 243.6 91.2 239.6
91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2 DL 255.6 91.2
251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6 91.2 DL 267.6
91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2 271.6 91.2 DL
279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6 91.2 283.6 91.2
DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL 299.6 91.2 295.6
91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2 DL 311.6 91.2
307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6 91.2 DL 323.6
91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2 327.6 91.2 DL
335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6 91.2 339.6 91.2
DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL 355.6 91.2 351.6
91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2 DL 367.6 91.2
363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6 91.2 DL 379.6
91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2 383.6 91.2 DL
391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6 91.2 395.6 91.2
DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL 411.6 91.2 407.6
91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2 DL 423.6 91.2
419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6 91.2 DL 435.6
91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2 439.6 91.2 DL
447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6 91.2 451.6 91.2
DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL 467.6 91.2 463.6
91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2 DL 479.6 91.2
475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6 91.2 DL 491.6
91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2 495.6 91.2 DL
503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6 91.2 507.6 91.2
DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL 249 265 MT 0 -25.2
RL -57.6 0 RL 0 25.2 RL CL ST/F2 8/Palatino-Roman@0 SF(terminal)205.212
249.16 Q(device driver)196.78 259.16 Q 1.2 LW 270.6 265 270.6 265 DL
274.2 265 274.2 265 DL 277.8 265 277.8 265 DL 281.4 265 281.4 265 DL 285
265 285 265 DL 288.6 265 288.6 265 DL 292.2 265 292.2 265 DL 295.8 265
295.8 265 DL 299.4 265 299.4 265 DL 303 265 303 265 DL 306.6 265 306.6
265 DL 310.2 265 310.2 265 DL 313.8 265 313.8 265 DL 317.4 265 317.4 265
DL 321 265 321 265 DL 324.6 265 324.6 265 DL 328.2 265 328.2 265 DL
328.2 265 328.2 265 DL 328.2 261.4 328.2 261.4 DL 328.2 257.8 328.2
257.8 DL 328.2 254.2 328.2 254.2 DL 328.2 250.6 328.2 250.6 DL 328.2 247
328.2 247 DL 328.2 243.4 328.2 243.4 DL 328.2 239.8 328.2 239.8 DL 328.2
239.8 328.2 239.8 DL 324.6 239.8 324.6 239.8 DL 321 239.8 321 239.8 DL
317.4 239.8 317.4 239.8 DL 313.8 239.8 313.8 239.8 DL 310.2 239.8 310.2
239.8 DL 306.6 239.8 306.6 239.8 DL 303 239.8 303 239.8 DL 299.4 239.8
299.4 239.8 DL 295.8 239.8 295.8 239.8 DL 292.2 239.8 292.2 239.8 DL
288.6 239.8 288.6 239.8 DL 285 239.8 285 239.8 DL 281.4 239.8 281.4
239.8 DL 277.8 239.8 277.8 239.8 DL 274.2 239.8 274.2 239.8 DL 270.6
239.8 270.6 239.8 DL 270.6 239.8 270.6 239.8 DL 270.6 243.4 270.6 243.4
DL 270.6 247 270.6 247 DL 270.6 250.6 270.6 250.6 DL 270.6 254.2 270.6
254.2 DL 270.6 257.8 270.6 257.8 DL 270.6 261.4 270.6 261.4 DL 270.6 265
270.6 265 DL(terminal)284.412 249.16 Q(device driver)275.98 259.16 Q
457.8 265 MT 0 -25.2 RL -57.6 0 RL 0 25.2 RL CL .32 LW ST(terminal)
414.012 249.16 Q(device driver)405.58 259.16 Q 249 218.2 MT 0 -28.8 RL
-57.6 0 RL 0 28.8 RL CL ST(terminal)205.212 195.56 Q(line discipline)
195.408 205.56 Q(\(noncanonical\))193.976 215.56 Q 1.2 LW 270.6 218.2
270.6 218.2 DL 274.2 218.2 274.2 218.2 DL 277.8 218.2 277.8 218.2 DL
281.4 218.2 281.4 218.2 DL 285 218.2 285 218.2 DL 288.6 218.2 288.6
218.2 DL 292.2 218.2 292.2 218.2 DL 295.8 218.2 295.8 218.2 DL 299.4
218.2 299.4 218.2 DL 303 218.2 303 218.2 DL 306.6 218.2 306.6 218.2 DL
310.2 218.2 310.2 218.2 DL 313.8 218.2 313.8 218.2 DL 317.4 218.2 317.4
218.2 DL 321 218.2 321 218.2 DL 324.6 218.2 324.6 218.2 DL 328.2 218.2
328.2 218.2 DL 328.2 218.2 328.2 218.2 DL 328.2 214.6 328.2 214.6 DL
328.2 211 328.2 211 DL 328.2 207.4 328.2 207.4 DL 328.2 203.8 328.2
203.8 DL 328.2 200.2 328.2 200.2 DL 328.2 196.6 328.2 196.6 DL 328.2 193
328.2 193 DL 328.2 189.4 328.2 189.4 DL 328.2 189.4 328.2 189.4 DL 324.6
189.4 324.6 189.4 DL 321 189.4 321 189.4 DL 317.4 189.4 317.4 189.4 DL
313.8 189.4 313.8 189.4 DL 310.2 189.4 310.2 189.4 DL 306.6 189.4 306.6
189.4 DL 303 189.4 303 189.4 DL 299.4 189.4 299.4 189.4 DL 295.8 189.4
295.8 189.4 DL 292.2 189.4 292.2 189.4 DL 288.6 189.4 288.6 189.4 DL 285
189.4 285 189.4 DL 281.4 189.4 281.4 189.4 DL 277.8 189.4 277.8 189.4 DL
274.2 189.4 274.2 189.4 DL 270.6 189.4 270.6 189.4 DL 270.6 189.4 270.6
189.4 DL 270.6 193 270.6 193 DL 270.6 196.6 270.6 196.6 DL 270.6 200.2
270.6 200.2 DL 270.6 203.8 270.6 203.8 DL 270.6 207.4 270.6 207.4 DL
270.6 211 270.6 211 DL 270.6 214.6 270.6 214.6 DL 270.6 218.2 270.6
218.2 DL(terminal)284.412 195.56 Q(line discipline)274.608 205.56 Q
(\(noncanonical\))273.176 215.56 Q 457.8 218.2 MT 0 -28.8 RL -57.6 0 RL
0 28.8 RL CL .32 LW ST(terminal)414.012 195.56 Q(line discipline)404.208
205.56 Q(\(canonical\))409.616 215.56 Q 177 275.8 177 279.4 DL 177
268.312 177 271.912 DL 177 260.824 177 264.424 DL 177 253.336 177
256.936 DL 177 245.92 177 249.52 DL 177 238.432 177 242.032 DL 177
230.944 177 234.544 DL 177 223.456 177 227.056 DL 177 215.968 177
219.568 DL 177 208.48 177 212.08 DL 177 201.064 177 204.664 DL 177
193.576 177 197.176 DL 177 186.088 177 189.688 DL 177 178.6 177 182.2 DL
180.6 178.6 177 178.6 DL 187.656 178.6 184.056 178.6 DL 194.712 178.6
191.112 178.6 DL 201.696 178.6 198.096 178.6 DL 208.752 178.6 205.152
178.6 DL 215.808 178.6 212.208 178.6 DL 222.864 178.6 219.264 178.6 DL
229.92 178.6 226.32 178.6 DL 236.976 178.6 233.376 178.6 DL 243.96 178.6
240.36 178.6 DL 251.016 178.6 247.416 178.6 DL 258.072 178.6 254.472
178.6 DL 265.128 178.6 261.528 178.6 DL 272.184 178.6 268.584 178.6 DL
279.24 178.6 275.64 178.6 DL 286.224 178.6 282.624 178.6 DL 293.28 178.6
289.68 178.6 DL 300.336 178.6 296.736 178.6 DL 307.392 178.6 303.792
178.6 DL 314.448 178.6 310.848 178.6 DL 321.504 178.6 317.904 178.6 DL
328.488 178.6 324.888 178.6 DL 335.544 178.6 331.944 178.6 DL 342.6
178.6 339 178.6 DL 342.6 182.2 342.6 178.6 DL 342.6 189.688 342.6
186.088 DL 342.6 197.176 342.6 193.576 DL 342.6 204.664 342.6 201.064 DL
342.6 212.08 342.6 208.48 DL 342.6 219.568 342.6 215.968 DL 342.6
227.056 342.6 223.456 DL 342.6 234.544 342.6 230.944 DL 342.6 242.032
342.6 238.432 DL 342.6 249.52 342.6 245.92 DL 342.6 256.936 342.6
253.336 DL 342.6 264.424 342.6 260.824 DL 342.6 271.912 342.6 268.312 DL
342.6 279.4 342.6 275.8 DL 339 279.4 342.6 279.4 DL 331.944 279.4
335.544 279.4 DL 324.888 279.4 328.488 279.4 DL 317.904 279.4 321.504
279.4 DL 310.848 279.4 314.448 279.4 DL 303.792 279.4 307.392 279.4 DL
296.736 279.4 300.336 279.4 DL 289.68 279.4 293.28 279.4 DL 282.624
279.4 286.224 279.4 DL 275.64 279.4 279.24 279.4 DL 268.584 279.4
272.184 279.4 DL 261.528 279.4 265.128 279.4 DL 254.472 279.4 258.072
279.4 DL 247.416 279.4 251.016 279.4 DL 240.36 279.4 243.96 279.4 DL
233.376 279.4 236.976 279.4 DL 226.32 279.4 229.92 279.4 DL 219.264
279.4 222.864 279.4 DL 212.208 279.4 215.808 279.4 DL 205.152 279.4
208.752 279.4 DL 198.096 279.4 201.696 279.4 DL 191.112 279.4 194.712
279.4 DL 184.056 279.4 187.656 279.4 DL 177 279.4 180.6 279.4 DL/F3 8
/Palatino-Italic@0 SF(local system)240.284 286.16 Q F2(kernel)152.744
230.76 Q 385.8 275.8 385.8 279.4 DL 385.8 268.312 385.8 271.912 DL 385.8
260.824 385.8 264.424 DL 385.8 253.336 385.8 256.936 DL 385.8 245.92
385.8 249.52 DL 385.8 238.432 385.8 242.032 DL 385.8 230.944 385.8
234.544 DL 385.8 223.456 385.8 227.056 DL 385.8 215.968 385.8 219.568 DL
385.8 208.48 385.8 212.08 DL 385.8 201.064 385.8 204.664 DL 385.8
193.576 385.8 197.176 DL 385.8 186.088 385.8 189.688 DL 385.8 178.6
385.8 182.2 DL 389.4 178.6 385.8 178.6 DL 396.312 178.6 392.712 178.6 DL
403.224 178.6 399.624 178.6 DL 410.136 178.6 406.536 178.6 DL 416.976
178.6 413.376 178.6 DL 423.888 178.6 420.288 178.6 DL 430.8 178.6 427.2
178.6 DL 437.712 178.6 434.112 178.6 DL 444.624 178.6 441.024 178.6 DL
451.536 178.6 447.936 178.6 DL 458.376 178.6 454.776 178.6 DL 465.288
178.6 461.688 178.6 DL 472.2 178.6 468.6 178.6 DL 472.2 182.2 472.2
178.6 DL 472.2 189.688 472.2 186.088 DL 472.2 197.176 472.2 193.576 DL
472.2 204.664 472.2 201.064 DL 472.2 212.08 472.2 208.48 DL 472.2
219.568 472.2 215.968 DL 472.2 227.056 472.2 223.456 DL 472.2 234.544
472.2 230.944 DL 472.2 242.032 472.2 238.432 DL 472.2 249.52 472.2
245.92 DL 472.2 256.936 472.2 253.336 DL 472.2 264.424 472.2 260.824 DL
472.2 271.912 472.2 268.312 DL 472.2 279.4 472.2 275.8 DL 468.6 279.4
472.2 279.4 DL 461.688 279.4 465.288 279.4 DL 454.776 279.4 458.376
279.4 DL 447.864 279.4 451.464 279.4 DL 441.024 279.4 444.624 279.4 DL
434.112 279.4 437.712 279.4 DL 427.2 279.4 430.8 279.4 DL 420.288 279.4
423.888 279.4 DL 413.376 279.4 416.976 279.4 DL 406.464 279.4 410.064
279.4 DL 399.624 279.4 403.224 279.4 DL 392.712 279.4 396.312 279.4 DL
385.8 279.4 389.4 279.4 DL F3 -.144(re)406.072 286.16 S(mote system).144
E F2(kernel)474.2 230.76 Q 307.824 153.4 MT 0 -25.2 RL -95.976 0 RL 0
25.2 RL CL ST/F4 8/Courier@0 SF(call)236.02 142.56 Q F2(pr)2 E(ocess)
-.144 E 450.6 153.4 MT 0 -25.2 RL -43.2 0 RL 0 25.2 RL CL ST(shell)
420.732 142.56 Q 220.2 265 MT 1.8 7.2 RL -3.6 0 RL CL 0 Fg 220.2 265 MT
1.8 7.2 RL -3.6 0 RL CL .1 LW 0 Cg ST 220.2 293.8 MT -1.8 -7.2 RL 3.6 0
RL CL 0 Fg 220.2 293.8 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Cg ST .32 LW 220.2
286.6 220.2 272.2 DL 43.2 25.2 220.2 306.4 DE ST(user at a)205.292
303.16 Q(terminal)205.212 313.16 Q 210.624 239.8 MT -1.8 -7.2 RL 3.6 0
RL CL 0 Fg 210.624 239.8 MT -1.8 -7.2 RL 3.6 0 RL CL .1 LW 0 Cg ST .32
LW 210.624 232.6 210.624 218.2 DL 229.776 218.2 MT 1.8 7.2 RL -3.6 0 RL
CL 0 Fg 229.776 218.2 MT 1.8 7.2 RL -3.6 0 RL CL .1 LW 0 Cg ST .32 LW
229.776 239.8 229.776 225.4 DL 289.824 239.8 MT -1.8 -7.2 RL 3.6 0 RL CL
0 Fg 289.824 239.8 MT -1.8 -7.2 RL 3.6 0 RL CL .1 LW 0 Cg ST .32 LW
289.824 232.6 289.824 218.2 DL 308.976 218.2 MT 1.8 7.2 RL -3.6 0 RL CL
0 Fg 308.976 218.2 MT 1.8 7.2 RL -3.6 0 RL CL .1 LW 0 Cg ST .32 LW
308.976 239.8 308.976 225.4 DL 419.424 239.8 MT -1.8 -7.2 RL 3.6 0 RL CL
0 Fg 419.424 239.8 MT -1.8 -7.2 RL 3.6 0 RL CL .1 LW 0 Cg ST .32 LW
419.424 232.6 419.424 218.2 DL 438.576 218.2 MT 1.8 7.2 RL -3.6 0 RL CL
0 Fg 438.576 218.2 MT 1.8 7.2 RL -3.6 0 RL CL .1 LW 0 Cg ST .32 LW
438.576 239.8 438.576 225.4 DL 421.8 189.4 MT -1.8 -7.2 RL 3.6 0 RL CL 0
Fg 421.8 189.4 MT -1.8 -7.2 RL 3.6 0 RL CL .1 LW 0 Cg ST .32 LW 421.8
182.2 421.8 153.4 DL F3(stdout, stderr)376.248 163.8 Q 436.2 153.4 MT
1.8 7.2 RL -3.6 0 RL CL 0 Fg 436.2 153.4 MT 1.8 7.2 RL -3.6 0 RL CL .1
LW 0 Cg ST .32 LW 436.2 189.4 436.2 160.6 DL(stdin)440.2 163.8 Q 210.624
189.4 MT 2.016 -7.128 RL 3.168 1.8 RL CL 0 Fg 210.624 189.4 MT 2.016
-7.128 RL 3.168 1.8 RL CL .1 LW 0 Cg ST .32 LW 231 153.4 214.152 183.136
DL 220.776 171.4 EBEGIN
gsave currentpoint 2 copy translate -60.4612 rotate neg exch neg exch translate
EEND/F0 8/Palatino-Italic@0 SF(stdout)216.556 168.16 Q(stderr)220.22
178.16 Q 177 128.2 EBEGIN
grestore
EEND 250.224 153.4 MT -2.016 7.128 RL -3.168 -1.8 RL CL 0 Fg 250.224
153.4 MT -2.016 7.128 RL -3.168 -1.8 RL CL .1 LW 0 Cg ST .32 LW 246.624
159.664 229.776 189.4 DL 240 171.4 EBEGIN
gsave currentpoint 2 copy translate -60.4612 rotate neg exch neg exch translate
EEND/F0 8/Palatino-Italic@0 SF(stdin)237.776 178.16 Q 177 128.2 EBEGIN
grestore
EEND 289.824 189.4 MT -5.112 -5.4 RL 3.168 -1.8 RL CL 0 Fg 289.824 189.4
MT -5.112 -5.4 RL 3.168 -1.8 RL CL .1 LW 0 Cg ST .32 LW 269.376 153.4
286.224 183.136 DL 288.6 153.4 MT 5.112 5.4 RL -3.168 1.8 RL CL 0 Fg
288.6 153.4 MT 5.112 5.4 RL -3.168 1.8 RL CL .1 LW 0 Cg ST .32 LW
292.128 159.664 308.976 189.4 DL 299.4 265 MT 1.8 7.2 RL -3.6 0 RL CL 0
Fg 299.4 265 MT 1.8 7.2 RL -3.6 0 RL CL .1 LW 0 Cg ST 299.4 301 MT -1.8
-7.2 RL 3.6 0 RL CL 0 Fg 299.4 301 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Cg ST
.32 LW 299.4 293.8 299.4 272.2 DL 321 315.4 MT 0 -14.4 RL -43.2 0 RL 0
14.4 RL CL ST/F0 8/Palatino-Roman@0 SF(modem)285.792 309.96 Q 429 265 MT
1.8 7.2 RL -3.6 0 RL CL 0 Fg 429 265 MT 1.8 7.2 RL -3.6 0 RL CL .1 LW 0
Cg ST 429 301 MT -1.8 -7.2 RL 3.6 0 RL CL 0 Fg 429 301 MT -1.8 -7.2 RL
3.6 0 RL CL 0 Cg ST .32 LW 429 293.8 429 272.2 DL 450.6 315.4 MT 0 -14.4
RL -43.2 0 RL 0 14.4 RL CL ST(modem)415.392 309.96 Q 1.2 LW 321 308.2
321 308.2 DL 324.6 308.2 324.6 308.2 DL 328.2 308.2 328.2 308.2 DL 331.8
308.2 331.8 308.2 DL 335.4 308.2 335.4 308.2 DL 339 308.2 339 308.2 DL
342.6 308.2 342.6 308.2 DL 346.2 308.2 346.2 308.2 DL 349.8 308.2 349.8
308.2 DL 353.4 308.2 353.4 308.2 DL 357 308.2 357 308.2 DL 360.6 308.2
360.6 308.2 DL 364.2 308.2 364.2 308.2 DL 367.8 308.2 367.8 308.2 DL
371.4 308.2 371.4 308.2 DL 375 308.2 375 308.2 DL 378.6 308.2 378.6
308.2 DL 382.2 308.2 382.2 308.2 DL 385.8 308.2 385.8 308.2 DL 389.4
308.2 389.4 308.2 DL 393 308.2 393 308.2 DL 396.6 308.2 396.6 308.2 DL
400.2 308.2 400.2 308.2 DL 403.8 308.2 403.8 308.2 DL 407.4 308.2 407.4
308.2 DL/F1 8/Palatino-Bold@0 SF(Figure 26)188.308 344.2 Q F0
(Overview of modem dialer pr)6 E(ocess to log in to r)-.144 E
(emote UNIX host.)-.144 E/F2 10/Palatino-Roman@0 SF 1.236
(The line discipline box beneath the shell on the r)147.6 373 R 1.237
(emote system is set by the login)-.18 F(pr)129.6 385 Q 1.086
(ocess on that system to be in the canonical mode.)-.18 F 1.085
(After we have dialed the r)6.085 F(emote)-.18 E 1.057(system we want t\
he special terminal input characters \(end of \214le, erase line, etc. \
fr)129.6 397 R(om)-.18 E .677(Section 18.3\) r)129.6 409 R .677
(ecognized by the line discipline module on the r)-.18 F .677
(emote host.)-.18 F .676(That means)5.677 F 1.704(we have to set the mo\
de of the line discipline module above the terminal \(standar)129.6 421
R(d)-.18 E(input, standar)129.6 433 Q 2.5(do)-.18 G(utput, and standar)
-2.5 E 2.5(de)-.18 G(rr)-2.5 E(or of the)-.18 E/F3 10/Courier@0 SF(call)
2.5 E F2(pr)2.5 E(ocess\) to noncanonical mode.)-.18 E/F4 10
/Helvetica-Bold@0 SF(One Pr)93.6 457 Q(ocess or T)-.2 E -.2(wo)-.6 G(?)
.2 E F2 .694(In Figur)129.6 481 R 3.194(e2)-.18 G 3.194(6w)-3.194 G
3.194(es)-3.194 G .694(how the)-3.194 F F3(call)3.194 E F2(pr)3.194 E
.694(ocess as a single pr)-.18 F 3.194(ocess. Doing)-.18 F .694(so r)
3.194 F(equir)-.18 E .694(es support)-.18 F 1.432
(for an I/O multiplexing function such as)129.6 493 R F3(select)3.932 E
F2(or)3.932 E F3(poll)3.932 E F2 3.933(,s)C 1.433
(ince two descriptors ar)-3.933 F(e)-.18 E 1.574(being r)129.6 505 R
1.574(ead fr)-.18 F 1.574(om and two descriptors ar)-.18 F 4.074(eb)-.18
G 1.574(eing written to.)-4.074 F 3.413 -.92(We c)6.573 H 1.573
(ould also design the).92 F .888(client as two pr)129.6 517 R .888
(ocesses, a par)-.18 F .889(ent and a child, as we showed in Figur)-.18
F 3.389(e1)-.18 G 3.389(4.21. Figur)-3.389 F 3.389(e2)-.18 G(7)-3.389 E
.644(shows only these two pr)129.6 529 R .643
(ocesses and the line disciplines beneath them.)-.18 F(Historically)
5.643 E(,)-1.11 E F3(cu)3.143 E F2(and)129.6 541 Q F3(tip)3.286 E F2
.786(have always been two pr)3.286 F .786(ocesses, as in Figur)-.18 F
3.286(e2)-.18 G 3.286(7. This)-3.286 F .786(is because early UNIX)3.286
F(systems didn't support an I/O multiplexing function.)129.6 553 Q 1.84
-.92(We c)147.6 565 T(hoose to use a single pr).92 E
(ocess for the following two r)-.18 E(easons.)-.18 E 6.33(1. Having)
147.6 581.8 R .316(two pr)2.816 F .316
(ocesses complicates the termination of the client.)-.18 F .315
(If we terminate)5.315 F .477(the connection by entering)163.93 593.8 R
F3(~.)2.977 E F2 .477
(\(a tilde followed by a period\) at the beginning of)2.977 F 2.729(al)
163.93 605.8 S .229(ine, the child r)-2.729 F .229
(ecognizes this and terminates.)-.18 F .228(The par)5.229 F .228
(ent then has to catch the)-.18 F F3(SIGCHLD)163.93 617.8 Q F2
(signal so that the par)2.5 E(ent can terminate too.)-.18 E 1.098
(If the connection is terminated by the r)163.93 635.8 R 1.098
(emote system or if the line is dr)-.18 F(opped,)-.18 E .494(the par)
163.93 647.8 R .494(ent will detect this by r)-.18 F .493
(eading an end of \214le fr)-.18 F .493(om the modem descriptor)-.18 F
(.)-.74 E(The par)163.93 659.8 Q(ent then has to notify the child, so t\
hat the child can also terminate.)-.18 E 0 Cg EP
%%Page: 40 40
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(40)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL
313.8 236.2 MT 0 -28.8 RL -57.6 0 RL 0 28.8 RL CL ST/F2 8
/Palatino-Roman@0 SF(terminal)270.012 213.56 Q(line discipline)260.208
223.56 Q(\(noncanonical\))258.776 233.56 Q 1.2 LW 335.4 236.2 335.4
236.2 DL 339 236.2 339 236.2 DL 342.6 236.2 342.6 236.2 DL 346.2 236.2
346.2 236.2 DL 349.8 236.2 349.8 236.2 DL 353.4 236.2 353.4 236.2 DL 357
236.2 357 236.2 DL 360.6 236.2 360.6 236.2 DL 364.2 236.2 364.2 236.2 DL
367.8 236.2 367.8 236.2 DL 371.4 236.2 371.4 236.2 DL 375 236.2 375
236.2 DL 378.6 236.2 378.6 236.2 DL 382.2 236.2 382.2 236.2 DL 385.8
236.2 385.8 236.2 DL 389.4 236.2 389.4 236.2 DL 393 236.2 393 236.2 DL
393 236.2 393 236.2 DL 393 232.6 393 232.6 DL 393 229 393 229 DL 393
225.4 393 225.4 DL 393 221.8 393 221.8 DL 393 218.2 393 218.2 DL 393
214.6 393 214.6 DL 393 211 393 211 DL 393 207.4 393 207.4 DL 393 207.4
393 207.4 DL 389.4 207.4 389.4 207.4 DL 385.8 207.4 385.8 207.4 DL 382.2
207.4 382.2 207.4 DL 378.6 207.4 378.6 207.4 DL 375 207.4 375 207.4 DL
371.4 207.4 371.4 207.4 DL 367.8 207.4 367.8 207.4 DL 364.2 207.4 364.2
207.4 DL 360.6 207.4 360.6 207.4 DL 357 207.4 357 207.4 DL 353.4 207.4
353.4 207.4 DL 349.8 207.4 349.8 207.4 DL 346.2 207.4 346.2 207.4 DL
342.6 207.4 342.6 207.4 DL 339 207.4 339 207.4 DL 335.4 207.4 335.4
207.4 DL 335.4 207.4 335.4 207.4 DL 335.4 211 335.4 211 DL 335.4 214.6
335.4 214.6 DL 335.4 218.2 335.4 218.2 DL 335.4 221.8 335.4 221.8 DL
335.4 225.4 335.4 225.4 DL 335.4 229 335.4 229 DL 335.4 232.6 335.4
232.6 DL 335.4 236.2 335.4 236.2 DL(terminal)349.212 213.56 Q
(line discipline)339.408 223.56 Q(\(noncanonical\))337.976 233.56 Q
313.8 164.2 MT 0 -36 RL -43.2 0 RL 0 36 RL CL .32 LW ST/F3 8/Courier@0
SF(call)282.6 142.96 Q F2(par)280.74 152.96 Q(ent)-.144 E 378.6 164.2 MT
0 -36 RL -43.2 0 RL 0 36 RL CL ST F3(call)347.4 142.96 Q F2(child)
348.124 152.96 Q 275.424 207.4 MT -.216 -7.416 RL 3.528 .792 RL CL 0 Fg
275.424 207.4 MT -.216 -7.416 RL 3.528 .792 RL CL .1 LW 0 Cg ST .32 LW
285 164.2 276.936 200.344 DL 280.176 185.8 EBEGIN
gsave currentpoint 2 copy translate -77.4712 rotate neg exch neg exch translate
EEND/F0 8/Palatino-Italic@0 SF(stdout)269.956 182.56 Q(stderr)270.62
192.56 Q 256.2 128.2 EBEGIN
grestore
EEND 364.2 164.2 MT -5.184 5.328 RL -1.872 -3.024 RL CL 0 Fg 364.2 164.2
MT -5.184 5.328 RL -1.872 -3.024 RL CL .1 LW 0 Cg ST .32 LW 358.08
168.016 294.576 207.4 DL 329.424 185.8 EBEGIN
gsave currentpoint 2 copy translate -31.8274 rotate neg exch neg exch translate
EEND/F0 8/Palatino-Italic@0 SF(stdin)313.2 192.56 Q 256.2 128.2 EBEGIN
grestore
EEND 354.624 207.4 MT -2.592 -6.984 RL 3.6 -.432 RL CL 0 Fg 354.624
207.4 MT -2.592 -6.984 RL 3.6 -.432 RL CL .1 LW 0 Cg ST .32 LW 349.8
164.2 353.832 200.272 DL 299.4 164.2 MT 7.128 2.088 RL -1.8 3.096 RL CL
0 Fg 299.4 164.2 MT 7.128 2.088 RL -1.8 3.096 RL CL .1 LW 0 Cg ST .32 LW
305.592 167.8 373.776 207.4 DL/F0 8/Palatino-Bold@0 SF(Figure 27)245.56
261.4 Q/F1 8/Palatino-Roman@0 SF(The)6 E/F2 8/Courier@0 SF(call)2 E F1
(client as two pr)2 E(ocesses.)-.144 E/F3 10/Palatino-Roman@0 SF 1.951
(Using a single pr)163.93 290.2 R 1.952
(ocess obviates the need for one pr)-.18 F 1.952
(ocess notifying the other)-.18 F(when it terminates.)163.93 302.2 Q
6.33(2. W)147.6 318.2 R 3.81(ea)-.92 G 1.67 -.18(re g)-3.81 H 1.309(oin\
g to implement a \214le transfer function in the client, similar to the)
.18 F/F4 10/Courier@0 SF(put)163.93 330.2 Q F3(and)4.156 E F4(take)4.156
E F3 1.656(commands of)4.156 F F4(cu)4.156 E F3(and)4.156 E F4(tip)4.156
E F3 6.656(.W)C 4.156(ee)-7.576 G 1.656(nter these commands on the)
-4.156 F(standar)163.93 342.2 Q 3.173(di)-.18 G .672(nput, on a line th\
at begins with a tilde \(the default escape character\).)-3.173 F 1.432
(These commands ar)163.93 354.2 R 3.932(er)-.18 G 1.432
(ecognized by the child if two pr)-4.112 F 1.433(ocesses ar)-.18 F 3.933
(eb)-.18 G 1.433(eing used)-3.933 F(\(Figur)163.93 366.2 Q 4.688(e2)-.18
G 4.688(7\). But)-4.688 F 2.188(the \214le that's r)4.688 F 2.187
(eceived by the client, in the case of a)-.18 F F4(take)4.687 E F3 2.131
(command, comes acr)163.93 378.2 R 2.132(oss the modem descriptor)-.18 F
4.632(,w)-.74 G 2.132(hich is being)-4.632 F F4(read)4.632 E F3 2.132
(by the)4.632 F(par)163.93 390.2 Q 4.611(ent. This)-.18 F 2.111
(means that to implement the)4.611 F F4(take)4.611 E F3 2.111
(command, the child has to)4.611 F .608(notify the par)163.93 402.2 R
.608(ent so that the par)-.18 F .608(ent stops r)-.18 F .609(eading fr)
-.18 F .609(om the modem.)-.18 F .609(The par)5.609 F(ent)-.18 E 2.29
(is pr)163.93 414.2 R 2.29(obably blocked in a)-.18 F F4(read)4.789 E F3
2.289(on this descriptor)4.789 F 4.789(,s)-.74 G 4.789(oas)-4.789 G
2.289(ignal is r)-4.789 F(equir)-.18 E 2.289(ed to)-.18 F(interr)163.93
426.2 Q 2.16(upt the par)-.08 F(ent's)-.18 E F4(read)4.661 E F3 7.161
(.W)C 2.161(hen the child is done, another noti\214cation is)-7.161 F
-.18(re)163.93 438.2 S(quir).18 E .697(ed to tell the par)-.18 F .697
(ent to r)-.18 F .697(esume r)-.18 F .697(eading fr)-.18 F .696
(om the modem.)-.18 F .696(While possible,)5.696 F
(this scenario quickly becomes messy)163.93 450.2 Q(.)-1.11 E 2.7(As)
129.6 467 S .2(ingle pr)-2.7 F .2(ocess simpli\214es the entir)-.18 F
2.701(ec)-.18 G 2.701(lient. By)-2.701 F .201(using a single pr)2.701 F
.201(ocess, however)-.18 F 2.701(,w)-.74 G 2.701(el)-2.701 G(ose)-2.701
E 2.417(the ability to job-contr)129.6 479 R 2.417
(ol stop only the child.)-.18 F 2.417(The BSD)7.417 F F4(tip)4.917 E F3
(pr)4.917 E 2.417(ogram supports this)-.18 F(featur)129.6 491 Q 3.275
(e. It)-.18 F .775(allows us to stop the child while the par)3.275 F
.775(ent continues r)-.18 F 3.275(unning. This)-.08 F(means)3.275 E .847
(all the terminal input is dir)129.6 503 R .847
(ected back to our shell instead of the child, letting us work)-.18 F
.349
(on the local system, but we'll still see any output generated by the r)
129.6 515 R .349(emote system.)-.18 F(This)5.349 E .07
(is handy if we start a long r)129.6 527 R .07(unning job on the r)-.08
F .07(emote system and want to see any output)-.18 F
(that it generates, while working on the local system.)129.6 539 Q 1.84
-.92(We n)147.6 551 T(ow look at the sour).92 E
(ce code to implement the client.)-.18 E/F5 12/Helvetica-Bold@0 SF
29.328(8C)93.6 582.2 S 3.336(lient Sour)-29.328 F 3.336(ce Code)-.24 F
F3 1.542(The client is smaller than the server)129.6 606.2 R 4.043(,s)
-.74 G 1.543(ince the client doesn't handle all the details of)-4.043 F
.638(connecting the r)129.6 618.2 R .638(emote system)-.18 F .833<8a74>
.833 G .638(he server fr)-.833 F .638(om Section 6 handles this.)-.18 F
.637(About one half)5.638 F
(of the client is needed to handle commands such as)129.6 630.2 Q F4
(take)2.5 E F3(and)2.5 E F4(put)2.5 E F3(.)A(Figur)147.6 642.2 Q 2.5(e2)
-.18 G 2.5(8s)-2.5 G(hows the)-2.5 E F4(call.h)2.5 E F3
(header that is included by all the client sour)2.5 E(ce \214les.)-.18 E
0 Cg EP
%%Page: 41 41
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 8)93.6 84 R 2.25(Client Sour)
280.29 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(41)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL .4 LW 134.6 123 129.6 123 DL 139.6 123 134.6 123 DL 144.6 123
139.6 123 DL 149.6 123 144.6 123 DL 154.6 123 149.6 123 DL 159.6 123
154.6 123 DL 164.6 123 159.6 123 DL 169.6 123 164.6 123 DL 174.6 123
169.6 123 DL 179.6 123 174.6 123 DL 184.6 123 179.6 123 DL 189.6 123
184.6 123 DL 194.6 123 189.6 123 DL 199.6 123 194.6 123 DL 204.6 123
199.6 123 DL 209.6 123 204.6 123 DL 214.6 123 209.6 123 DL 219.6 123
214.6 123 DL 224.6 123 219.6 123 DL 229.6 123 224.6 123 DL 234.6 123
229.6 123 DL 239.6 123 234.6 123 DL 244.6 123 239.6 123 DL 249.6 123
244.6 123 DL 254.6 123 249.6 123 DL 259.6 123 254.6 123 DL 264.6 123
259.6 123 DL 269.6 123 264.6 123 DL 274.6 123 269.6 123 DL 279.6 123
274.6 123 DL 284.6 123 279.6 123 DL 289.6 123 284.6 123 DL 294.6 123
289.6 123 DL 299.6 123 294.6 123 DL 304.6 123 299.6 123 DL 309.6 123
304.6 123 DL 314.6 123 309.6 123 DL 319.6 123 314.6 123 DL 324.6 123
319.6 123 DL 329.6 123 324.6 123 DL 334.6 123 329.6 123 DL 339.6 123
334.6 123 DL 344.6 123 339.6 123 DL 349.6 123 344.6 123 DL 354.6 123
349.6 123 DL 359.6 123 354.6 123 DL 364.6 123 359.6 123 DL 369.6 123
364.6 123 DL 374.6 123 369.6 123 DL 379.6 123 374.6 123 DL 384.6 123
379.6 123 DL 389.6 123 384.6 123 DL 394.6 123 389.6 123 DL 399.6 123
394.6 123 DL 404.6 123 399.6 123 DL 409.6 123 404.6 123 DL 414.6 123
409.6 123 DL 419.6 123 414.6 123 DL 424.6 123 419.6 123 DL 429.6 123
424.6 123 DL 434.6 123 429.6 123 DL 439.6 123 434.6 123 DL 444.6 123
439.6 123 DL 449.6 123 444.6 123 DL 454.6 123 449.6 123 DL 459.6 123
454.6 123 DL 464.6 123 459.6 123 DL 469.6 123 464.6 123 DL 474.6 123
469.6 123 DL 479.6 123 474.6 123 DL 484.6 123 479.6 123 DL 489.6 123
484.6 123 DL 494.6 123 489.6 123 DL 499.6 123 494.6 123 DL 504.6 123
499.6 123 DL 509.6 123 504.6 123 DL 514.6 123 509.6 123 DL 519.6 123
514.6 123 DL/F2 9/Courier@0 SF(#include "apue.h")129.6 132.501 Q
(#include <errno.h>)129.6 143.201 Q(#include <sys/time.h>)129.6 153.901
Q(#define CS_CALL "/home/sar/calld")129.6 172.091 Q
(/* well-known server name */)16.2 E(#define CL_CALL "call")129.6
182.791 Q(/* command for server */)75.6 E(extern char)129.6 200.981 Q
10.8(escapec; /*)10.8 F(tilde for local commands */)5.4 E
(extern char *src;)129.6 211.681 Q(/* for take and put commands */)37.8
E(extern char *dst;)129.6 222.381 Q(/* for take and put commands */)37.8
E 21.6(int call\(const)129.6 240.571 R(char *\);)5.4 E 21.6
(int doescape\(int\);)129.6 251.271 R 16.2(void loop\(int\);)129.6
261.971 R 21.6(int prompt_read\(char)129.6 272.671 R
(*, int \(*\)\(int, char **\)\);)5.4 E 16.2(void put\(int\);)129.6
283.371 R 16.2(void take\(int\);)129.6 294.071 R 21.6
(int take_put_args\(int,)129.6 304.771 R(char **\);)5.4 E 134.6 309.572
129.6 309.572 DL 139.6 309.572 134.6 309.572 DL 144.6 309.572 139.6
309.572 DL 149.6 309.572 144.6 309.572 DL 154.6 309.572 149.6 309.572 DL
159.6 309.572 154.6 309.572 DL 164.6 309.572 159.6 309.572 DL 169.6
309.572 164.6 309.572 DL 174.6 309.572 169.6 309.572 DL 179.6 309.572
174.6 309.572 DL 184.6 309.572 179.6 309.572 DL 189.6 309.572 184.6
309.572 DL 194.6 309.572 189.6 309.572 DL 199.6 309.572 194.6 309.572 DL
204.6 309.572 199.6 309.572 DL 209.6 309.572 204.6 309.572 DL 214.6
309.572 209.6 309.572 DL 219.6 309.572 214.6 309.572 DL 224.6 309.572
219.6 309.572 DL 229.6 309.572 224.6 309.572 DL 234.6 309.572 229.6
309.572 DL 239.6 309.572 234.6 309.572 DL 244.6 309.572 239.6 309.572 DL
249.6 309.572 244.6 309.572 DL 254.6 309.572 249.6 309.572 DL 259.6
309.572 254.6 309.572 DL 264.6 309.572 259.6 309.572 DL 269.6 309.572
264.6 309.572 DL 274.6 309.572 269.6 309.572 DL 279.6 309.572 274.6
309.572 DL 284.6 309.572 279.6 309.572 DL 289.6 309.572 284.6 309.572 DL
294.6 309.572 289.6 309.572 DL 299.6 309.572 294.6 309.572 DL 304.6
309.572 299.6 309.572 DL 309.6 309.572 304.6 309.572 DL 314.6 309.572
309.6 309.572 DL 319.6 309.572 314.6 309.572 DL 324.6 309.572 319.6
309.572 DL 329.6 309.572 324.6 309.572 DL 334.6 309.572 329.6 309.572 DL
339.6 309.572 334.6 309.572 DL 344.6 309.572 339.6 309.572 DL 349.6
309.572 344.6 309.572 DL 354.6 309.572 349.6 309.572 DL 359.6 309.572
354.6 309.572 DL 364.6 309.572 359.6 309.572 DL 369.6 309.572 364.6
309.572 DL 374.6 309.572 369.6 309.572 DL 379.6 309.572 374.6 309.572 DL
384.6 309.572 379.6 309.572 DL 389.6 309.572 384.6 309.572 DL 394.6
309.572 389.6 309.572 DL 399.6 309.572 394.6 309.572 DL 404.6 309.572
399.6 309.572 DL 409.6 309.572 404.6 309.572 DL 414.6 309.572 409.6
309.572 DL 419.6 309.572 414.6 309.572 DL 424.6 309.572 419.6 309.572 DL
429.6 309.572 424.6 309.572 DL 434.6 309.572 429.6 309.572 DL 439.6
309.572 434.6 309.572 DL 444.6 309.572 439.6 309.572 DL 449.6 309.572
444.6 309.572 DL 454.6 309.572 449.6 309.572 DL 459.6 309.572 454.6
309.572 DL 464.6 309.572 459.6 309.572 DL 469.6 309.572 464.6 309.572 DL
474.6 309.572 469.6 309.572 DL 479.6 309.572 474.6 309.572 DL 484.6
309.572 479.6 309.572 DL 489.6 309.572 484.6 309.572 DL 494.6 309.572
489.6 309.572 DL 499.6 309.572 494.6 309.572 DL 504.6 309.572 499.6
309.572 DL 509.6 309.572 504.6 309.572 DL 514.6 309.572 509.6 309.572 DL
519.6 309.572 514.6 309.572 DL/F3 8/Palatino-Bold@0 SF(Figure 28)269.54
325.572 Q/F4 8/Palatino-Roman@0 SF(The)6 E/F5 8/Courier@0 SF(call.h)2 E
F4(header)2 E/F6 10/Palatino-Roman@0 SF .761
(The command for the server and the server)129.6 349.572 R .761
('s well-known name have to corr).74 F .761(espond to)-.18 F
(the values in Figur)129.6 361.572 Q 2.5(e8)-.18 G(.)-2.5 E(Figur)147.6
373.572 Q 2.5(e2)-.18 G 2.5(9s)-2.5 G(hows the)-2.5 E/F7 10/Courier@0 SF
(main)2.5 E F6(function.)2.5 E 134.6 380.772 129.6 380.772 DL 139.6
380.772 134.6 380.772 DL 144.6 380.772 139.6 380.772 DL 149.6 380.772
144.6 380.772 DL 154.6 380.772 149.6 380.772 DL 159.6 380.772 154.6
380.772 DL 164.6 380.772 159.6 380.772 DL 169.6 380.772 164.6 380.772 DL
174.6 380.772 169.6 380.772 DL 179.6 380.772 174.6 380.772 DL 184.6
380.772 179.6 380.772 DL 189.6 380.772 184.6 380.772 DL 194.6 380.772
189.6 380.772 DL 199.6 380.772 194.6 380.772 DL 204.6 380.772 199.6
380.772 DL 209.6 380.772 204.6 380.772 DL 214.6 380.772 209.6 380.772 DL
219.6 380.772 214.6 380.772 DL 224.6 380.772 219.6 380.772 DL 229.6
380.772 224.6 380.772 DL 234.6 380.772 229.6 380.772 DL 239.6 380.772
234.6 380.772 DL 244.6 380.772 239.6 380.772 DL 249.6 380.772 244.6
380.772 DL 254.6 380.772 249.6 380.772 DL 259.6 380.772 254.6 380.772 DL
264.6 380.772 259.6 380.772 DL 269.6 380.772 264.6 380.772 DL 274.6
380.772 269.6 380.772 DL 279.6 380.772 274.6 380.772 DL 284.6 380.772
279.6 380.772 DL 289.6 380.772 284.6 380.772 DL 294.6 380.772 289.6
380.772 DL 299.6 380.772 294.6 380.772 DL 304.6 380.772 299.6 380.772 DL
309.6 380.772 304.6 380.772 DL 314.6 380.772 309.6 380.772 DL 319.6
380.772 314.6 380.772 DL 324.6 380.772 319.6 380.772 DL 329.6 380.772
324.6 380.772 DL 334.6 380.772 329.6 380.772 DL 339.6 380.772 334.6
380.772 DL 344.6 380.772 339.6 380.772 DL 349.6 380.772 344.6 380.772 DL
354.6 380.772 349.6 380.772 DL 359.6 380.772 354.6 380.772 DL 364.6
380.772 359.6 380.772 DL 369.6 380.772 364.6 380.772 DL 374.6 380.772
369.6 380.772 DL 379.6 380.772 374.6 380.772 DL 384.6 380.772 379.6
380.772 DL 389.6 380.772 384.6 380.772 DL 394.6 380.772 389.6 380.772 DL
399.6 380.772 394.6 380.772 DL 404.6 380.772 399.6 380.772 DL 409.6
380.772 404.6 380.772 DL 414.6 380.772 409.6 380.772 DL 419.6 380.772
414.6 380.772 DL 424.6 380.772 419.6 380.772 DL 429.6 380.772 424.6
380.772 DL 434.6 380.772 429.6 380.772 DL 439.6 380.772 434.6 380.772 DL
444.6 380.772 439.6 380.772 DL 449.6 380.772 444.6 380.772 DL 454.6
380.772 449.6 380.772 DL 459.6 380.772 454.6 380.772 DL 464.6 380.772
459.6 380.772 DL 469.6 380.772 464.6 380.772 DL 474.6 380.772 469.6
380.772 DL 479.6 380.772 474.6 380.772 DL 484.6 380.772 479.6 380.772 DL
489.6 380.772 484.6 380.772 DL 494.6 380.772 489.6 380.772 DL 499.6
380.772 494.6 380.772 DL 504.6 380.772 499.6 380.772 DL 509.6 380.772
504.6 380.772 DL 514.6 380.772 509.6 380.772 DL 519.6 380.772 514.6
380.772 DL F2 16.2(#include "call.h")129.6 390.273 R 21.6(char escapec)
129.6 407.393 R 5.4(=')5.4 G(~';)-5.4 E 16.2(char *src;)129.6 418.093 R
16.2(char *dst;)129.6 428.793 R(static void usage\(char *\);)129.6
445.913 Q(int)129.6 463.033 Q(main\(int argc, char *argv[]\))129.6
473.733 Q({)129.6 484.433 Q 43.2(int c,)151.2 495.133 R(remfd, debug;)
5.4 E 37.8(char args[MAXLINE];)151.2 505.833 R(args[0] = 0;)151.2
522.953 Q(/* build arg list for conn server here */)21.6 E(opterr = 0;)
151.2 533.653 Q(/* don't want getopt\(\) writing to stderr */)27 E
(while \(\(c = getopt\(argc, argv, "des:o"\)\) != EOF\) {)151.2 544.353
Q(switch \(c\) {)172.8 555.053 Q(case 'd':)172.8 565.753 Q(/* debug */)
37.8 E(debug = 1;)194.4 576.453 Q(strcat\(args, "-d "\);)194.4 587.153 Q
(break;)194.4 597.853 Q(case 'e':)172.8 614.973 Q(/* even parity */)37.8
E(strcat\(args, "-e "\);)194.4 625.673 Q(break;)194.4 636.373 Q
(case 'o':)172.8 653.493 Q(/* odd parity */)37.8 E 0 Cg EP
%%Page: 42 42
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(42)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(strcat\(args, "-o "\);)194.4 121.7 Q(break;)194.4 132.4 Q
(case 's':)172.8 149.52 Q(/* speed */)37.8 E(strcat\(args, "-s "\);)
194.4 160.22 Q(strcat\(args, optarg\);)194.4 170.92 Q
(strcat\(args, " "\);)194.4 181.62 Q(break;)194.4 192.32 Q(case '?':)
172.8 209.44 Q(usage\("unrecognized option"\);)194.4 220.14 Q(})172.8
230.84 Q(})151.2 241.54 Q(if \(optind < argc\))151.2 252.24 Q
(strcat\(args, argv[optind]\); /* name of host to call */)172.8 262.94 Q
(else)151.2 273.64 Q(usage\("missing <hostname> to call"\);)172.8 284.34
Q(if \(\(remfd = call\(args\)\) < 0\))151.2 301.46 Q
(/* place the call */)16.2 E 16.2(exit\(1\); /*)172.8 312.16 R
(call\(\) prints reason for failure */)5.4 E(printf\("Connected\\n"\);)
151.2 322.86 Q(if \(tty_raw\(STDIN_FILENO\) < 0\))151.2 333.56 Q
(/* user's tty to raw mode */)10.8 E(err_sys\("tty_raw error"\);)172.8
344.26 Q(if \(atexit\(tty_atexit\) < 0\))151.2 354.96 Q
(/* reset user's tty on exit */)27 E(err_sys\("atexit error"\);)172.8
365.66 Q 102.6(loop\(remfd\); /*)151.2 382.78 R(and do it */)5.4 E
(printf\("Disconnected\\n\\r"\);)151.2 399.9 Q(exit\(0\);)151.2 410.6 Q
(})129.6 421.3 Q(static void)129.6 438.42 Q(usage\(char *msg\))129.6
449.12 Q({)129.6 459.82 Q
(err_quit\("%s\\nusage: call -d -e -o -s<speed> <hostname>", msg\);)
151.2 470.52 Q(})129.6 481.22 Q .4 LW 134.6 486.021 129.6 486.021 DL
139.6 486.021 134.6 486.021 DL 144.6 486.021 139.6 486.021 DL 149.6
486.021 144.6 486.021 DL 154.6 486.021 149.6 486.021 DL 159.6 486.021
154.6 486.021 DL 164.6 486.021 159.6 486.021 DL 169.6 486.021 164.6
486.021 DL 174.6 486.021 169.6 486.021 DL 179.6 486.021 174.6 486.021 DL
184.6 486.021 179.6 486.021 DL 189.6 486.021 184.6 486.021 DL 194.6
486.021 189.6 486.021 DL 199.6 486.021 194.6 486.021 DL 204.6 486.021
199.6 486.021 DL 209.6 486.021 204.6 486.021 DL 214.6 486.021 209.6
486.021 DL 219.6 486.021 214.6 486.021 DL 224.6 486.021 219.6 486.021 DL
229.6 486.021 224.6 486.021 DL 234.6 486.021 229.6 486.021 DL 239.6
486.021 234.6 486.021 DL 244.6 486.021 239.6 486.021 DL 249.6 486.021
244.6 486.021 DL 254.6 486.021 249.6 486.021 DL 259.6 486.021 254.6
486.021 DL 264.6 486.021 259.6 486.021 DL 269.6 486.021 264.6 486.021 DL
274.6 486.021 269.6 486.021 DL 279.6 486.021 274.6 486.021 DL 284.6
486.021 279.6 486.021 DL 289.6 486.021 284.6 486.021 DL 294.6 486.021
289.6 486.021 DL 299.6 486.021 294.6 486.021 DL 304.6 486.021 299.6
486.021 DL 309.6 486.021 304.6 486.021 DL 314.6 486.021 309.6 486.021 DL
319.6 486.021 314.6 486.021 DL 324.6 486.021 319.6 486.021 DL 329.6
486.021 324.6 486.021 DL 334.6 486.021 329.6 486.021 DL 339.6 486.021
334.6 486.021 DL 344.6 486.021 339.6 486.021 DL 349.6 486.021 344.6
486.021 DL 354.6 486.021 349.6 486.021 DL 359.6 486.021 354.6 486.021 DL
364.6 486.021 359.6 486.021 DL 369.6 486.021 364.6 486.021 DL 374.6
486.021 369.6 486.021 DL 379.6 486.021 374.6 486.021 DL 384.6 486.021
379.6 486.021 DL 389.6 486.021 384.6 486.021 DL 394.6 486.021 389.6
486.021 DL 399.6 486.021 394.6 486.021 DL 404.6 486.021 399.6 486.021 DL
409.6 486.021 404.6 486.021 DL 414.6 486.021 409.6 486.021 DL 419.6
486.021 414.6 486.021 DL 424.6 486.021 419.6 486.021 DL 429.6 486.021
424.6 486.021 DL 434.6 486.021 429.6 486.021 DL 439.6 486.021 434.6
486.021 DL 444.6 486.021 439.6 486.021 DL 449.6 486.021 444.6 486.021 DL
454.6 486.021 449.6 486.021 DL 459.6 486.021 454.6 486.021 DL 464.6
486.021 459.6 486.021 DL 469.6 486.021 464.6 486.021 DL 474.6 486.021
469.6 486.021 DL 479.6 486.021 474.6 486.021 DL 484.6 486.021 479.6
486.021 DL 489.6 486.021 484.6 486.021 DL 494.6 486.021 489.6 486.021 DL
499.6 486.021 494.6 486.021 DL 504.6 486.021 499.6 486.021 DL 509.6
486.021 504.6 486.021 DL 514.6 486.021 509.6 486.021 DL 519.6 486.021
514.6 486.021 DL/F3 8/Palatino-Bold@0 SF(Figure 29)271.696 502.021 Q/F4
8/Palatino-Roman@0 SF(The)6 E/F5 8/Courier@0 SF(main)2 E F4(function)2 E
/F6 10/Palatino-Roman@0 SF(The)129.6 526.021 Q/F7 10/Courier@0 SF(main)
4.032 E F6 1.532(function pr)4.032 F 1.532(ocesses the command)-.18 F(-)
-.9 I 1.532(line ar).9 J 1.532(guments, saving them in the array)-.18 F
F7(args)129.6 538.021 Q F6 2.604(,w)C .104(hich is sent to the server)
-2.604 F 5.104(.T)-.74 G .104(he function)-5.104 F F7(call)2.604 E F6
.104(contacts the server and r)2.604 F .104(eturns the)-.18 F
(\214le descriptor to the r)129.6 550.021 Q(emote system.)-.18 E 1.795
(The line discipline module above the terminal \(Figur)147.6 562.021 R
4.295(e2)-.18 G 1.795(6\) is set to noncanonical)-4.295 F 1.869
(mode using the)129.6 574.021 R F7(tty_raw)4.369 E F6 1.869
(function \(Figur)4.369 F 4.369(e1)-.18 G 4.369(8.20\). T)-4.369 F 4.369
(or)-.92 G 1.869(eset the terminal when we'r)-4.549 F(e)-.18 E
(done we establish the function)129.6 586.021 Q F7(tty_atexit)2.5 E F6
(as an exit handler)2.5 E(.)-.74 E .466(The function)147.6 598.021 R F7
(loop)2.966 E F6 .465
(is then called to copy everything that we type at the terminal to)2.966
F(the modem and everything fr)129.6 610.021 Q
(om the modem to the terminal.)-.18 E(The)147.6 622.021 Q F7(call)2.833
E F6 .333(function in Figur)2.833 F 2.833(e3)-.18 G 2.833(0c)-2.833 G
.334(ontacts the server to obtain a \214le descriptor for the)-2.833 F
3.291(modem. As)129.6 634.021 R .791(we said earlier)3.291 F 3.291(,i)
-.74 G 3.291(tt)-3.291 G .79
(akes only a dozen lines of code to contact the server to)-3.291 F
(obtain the descriptor)129.6 646.021 Q(.)-.74 E 0 Cg EP
%%Page: 43 43
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 8)93.6 84 R 2.25(Client Sour)
280.29 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(43)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL .4 LW 134.6 123 129.6 123 DL 139.6 123 134.6 123 DL 144.6 123
139.6 123 DL 149.6 123 144.6 123 DL 154.6 123 149.6 123 DL 159.6 123
154.6 123 DL 164.6 123 159.6 123 DL 169.6 123 164.6 123 DL 174.6 123
169.6 123 DL 179.6 123 174.6 123 DL 184.6 123 179.6 123 DL 189.6 123
184.6 123 DL 194.6 123 189.6 123 DL 199.6 123 194.6 123 DL 204.6 123
199.6 123 DL 209.6 123 204.6 123 DL 214.6 123 209.6 123 DL 219.6 123
214.6 123 DL 224.6 123 219.6 123 DL 229.6 123 224.6 123 DL 234.6 123
229.6 123 DL 239.6 123 234.6 123 DL 244.6 123 239.6 123 DL 249.6 123
244.6 123 DL 254.6 123 249.6 123 DL 259.6 123 254.6 123 DL 264.6 123
259.6 123 DL 269.6 123 264.6 123 DL 274.6 123 269.6 123 DL 279.6 123
274.6 123 DL 284.6 123 279.6 123 DL 289.6 123 284.6 123 DL 294.6 123
289.6 123 DL 299.6 123 294.6 123 DL 304.6 123 299.6 123 DL 309.6 123
304.6 123 DL 314.6 123 309.6 123 DL 319.6 123 314.6 123 DL 324.6 123
319.6 123 DL 329.6 123 324.6 123 DL 334.6 123 329.6 123 DL 339.6 123
334.6 123 DL 344.6 123 339.6 123 DL 349.6 123 344.6 123 DL 354.6 123
349.6 123 DL 359.6 123 354.6 123 DL 364.6 123 359.6 123 DL 369.6 123
364.6 123 DL 374.6 123 369.6 123 DL 379.6 123 374.6 123 DL 384.6 123
379.6 123 DL 389.6 123 384.6 123 DL 394.6 123 389.6 123 DL 399.6 123
394.6 123 DL 404.6 123 399.6 123 DL 409.6 123 404.6 123 DL 414.6 123
409.6 123 DL 419.6 123 414.6 123 DL 424.6 123 419.6 123 DL 429.6 123
424.6 123 DL 434.6 123 429.6 123 DL 439.6 123 434.6 123 DL 444.6 123
439.6 123 DL 449.6 123 444.6 123 DL 454.6 123 449.6 123 DL 459.6 123
454.6 123 DL 464.6 123 459.6 123 DL 469.6 123 464.6 123 DL 474.6 123
469.6 123 DL 479.6 123 474.6 123 DL 484.6 123 479.6 123 DL 489.6 123
484.6 123 DL 494.6 123 489.6 123 DL 499.6 123 494.6 123 DL 504.6 123
499.6 123 DL 509.6 123 504.6 123 DL 514.6 123 509.6 123 DL 519.6 123
514.6 123 DL/F2 9/Courier@0 SF 16.2(#include "call.h")129.6 132.501 R
16.2(#include <sys/uio.h>)129.6 143.201 R(/* struct iovec */)27 E(/*)
129.6 160.321 Q 5.4(*P)135 171.021 S
(lace the call by sending the "args" to the calling server,)-5.4 E 5.4
(*a)135 181.721 S(nd reading a file descriptor back.)-5.4 E(*/)135
192.421 Q(int)129.6 203.121 Q(call\(const char *args\))129.6 213.821 Q
({)129.6 224.521 Q 64.8(int csfd,)151.2 235.221 R(len;)5.4 E
(struct iovec)151.2 245.921 Q(iov[2];)21.6 E(/*)151.2 263.041 Q 5.4(*C)
156.6 273.741 S(reate connection to connection server.)-5.4 E(*/)156.6
284.441 Q(if \(\(csfd = cli_conn\(CS_CALL\)\) < 0\))151.2 295.141 Q
(err_sys\("cli_conn error"\);)172.8 305.841 Q
(iov[0].iov_base = CL_CALL " ";)151.2 322.961 Q 5.4(iov[0].iov_len =)
151.2 333.661 R(strlen\(CL_CALL\) + 1;)5.4 E
(iov[1].iov_base = \(char *\) args;)151.2 344.361 Q
(/* null at end of args always sent */)151.2 355.061 Q 5.4
(iov[1].iov_len =)151.2 365.761 R(strlen\(args\) + 1;)5.4 E
(len = iov[0].iov_len + iov[1].iov_len;)151.2 376.461 Q
(if \(writev\(csfd, &iov[0], 2\) != len\))151.2 387.161 Q
(err_sys\("writev error"\);)172.8 397.861 Q(/*)151.2 414.981 Q 5.4(*R)
156.6 425.681 S(ead back the descriptor.)-5.4 E
(Returned errors are handled)10.8 E 5.4(*b)156.6 436.381 S 5.4(yw)-5.4 G
(rite\(\).)-5.4 E(*/)156.6 447.081 Q(return\(recv_fd\(csfd, write\)\);)
151.2 457.781 Q(})129.6 468.481 Q 134.6 473.282 129.6 473.282 DL 139.6
473.282 134.6 473.282 DL 144.6 473.282 139.6 473.282 DL 149.6 473.282
144.6 473.282 DL 154.6 473.282 149.6 473.282 DL 159.6 473.282 154.6
473.282 DL 164.6 473.282 159.6 473.282 DL 169.6 473.282 164.6 473.282 DL
174.6 473.282 169.6 473.282 DL 179.6 473.282 174.6 473.282 DL 184.6
473.282 179.6 473.282 DL 189.6 473.282 184.6 473.282 DL 194.6 473.282
189.6 473.282 DL 199.6 473.282 194.6 473.282 DL 204.6 473.282 199.6
473.282 DL 209.6 473.282 204.6 473.282 DL 214.6 473.282 209.6 473.282 DL
219.6 473.282 214.6 473.282 DL 224.6 473.282 219.6 473.282 DL 229.6
473.282 224.6 473.282 DL 234.6 473.282 229.6 473.282 DL 239.6 473.282
234.6 473.282 DL 244.6 473.282 239.6 473.282 DL 249.6 473.282 244.6
473.282 DL 254.6 473.282 249.6 473.282 DL 259.6 473.282 254.6 473.282 DL
264.6 473.282 259.6 473.282 DL 269.6 473.282 264.6 473.282 DL 274.6
473.282 269.6 473.282 DL 279.6 473.282 274.6 473.282 DL 284.6 473.282
279.6 473.282 DL 289.6 473.282 284.6 473.282 DL 294.6 473.282 289.6
473.282 DL 299.6 473.282 294.6 473.282 DL 304.6 473.282 299.6 473.282 DL
309.6 473.282 304.6 473.282 DL 314.6 473.282 309.6 473.282 DL 319.6
473.282 314.6 473.282 DL 324.6 473.282 319.6 473.282 DL 329.6 473.282
324.6 473.282 DL 334.6 473.282 329.6 473.282 DL 339.6 473.282 334.6
473.282 DL 344.6 473.282 339.6 473.282 DL 349.6 473.282 344.6 473.282 DL
354.6 473.282 349.6 473.282 DL 359.6 473.282 354.6 473.282 DL 364.6
473.282 359.6 473.282 DL 369.6 473.282 364.6 473.282 DL 374.6 473.282
369.6 473.282 DL 379.6 473.282 374.6 473.282 DL 384.6 473.282 379.6
473.282 DL 389.6 473.282 384.6 473.282 DL 394.6 473.282 389.6 473.282 DL
399.6 473.282 394.6 473.282 DL 404.6 473.282 399.6 473.282 DL 409.6
473.282 404.6 473.282 DL 414.6 473.282 409.6 473.282 DL 419.6 473.282
414.6 473.282 DL 424.6 473.282 419.6 473.282 DL 429.6 473.282 424.6
473.282 DL 434.6 473.282 429.6 473.282 DL 439.6 473.282 434.6 473.282 DL
444.6 473.282 439.6 473.282 DL 449.6 473.282 444.6 473.282 DL 454.6
473.282 449.6 473.282 DL 459.6 473.282 454.6 473.282 DL 464.6 473.282
459.6 473.282 DL 469.6 473.282 464.6 473.282 DL 474.6 473.282 469.6
473.282 DL 479.6 473.282 474.6 473.282 DL 484.6 473.282 479.6 473.282 DL
489.6 473.282 484.6 473.282 DL 494.6 473.282 489.6 473.282 DL 499.6
473.282 494.6 473.282 DL 504.6 473.282 499.6 473.282 DL 509.6 473.282
504.6 473.282 DL 514.6 473.282 509.6 473.282 DL 519.6 473.282 514.6
473.282 DL/F3 8/Palatino-Bold@0 SF(Figure 30)271.696 489.282 Q/F4 8
/Palatino-Roman@0 SF(The)6 E/F5 8/Courier@0 SF(call)2 E F4(function)2 E
/F6 10/Palatino-Roman@0 SF 1.575(The function)147.6 513.282 R/F7 10
/Courier@0 SF(loop)4.075 E F6 1.576
(handles the I/O multiplexing between the two input str)4.075 F(eams)
-.18 E .867(and the two output str)129.6 525.282 R 3.367(eams. W)-.18 F
3.367(ec)-.92 G .866(an use either)-3.367 F F7(poll)3.366 E F6(or)3.366
E F7(select)3.366 E F6 3.366(,d)C .866(epending what the)-3.366 F
(local system pr)129.6 537.282 Q 2.5(ovides. Figur)-.18 F 2.5(e3)-.18 G
2.5(1s)-2.5 G(hows an implementation using)-2.5 E F7(poll)2.5 E F6(.)A
134.6 544.482 129.6 544.482 DL 139.6 544.482 134.6 544.482 DL 144.6
544.482 139.6 544.482 DL 149.6 544.482 144.6 544.482 DL 154.6 544.482
149.6 544.482 DL 159.6 544.482 154.6 544.482 DL 164.6 544.482 159.6
544.482 DL 169.6 544.482 164.6 544.482 DL 174.6 544.482 169.6 544.482 DL
179.6 544.482 174.6 544.482 DL 184.6 544.482 179.6 544.482 DL 189.6
544.482 184.6 544.482 DL 194.6 544.482 189.6 544.482 DL 199.6 544.482
194.6 544.482 DL 204.6 544.482 199.6 544.482 DL 209.6 544.482 204.6
544.482 DL 214.6 544.482 209.6 544.482 DL 219.6 544.482 214.6 544.482 DL
224.6 544.482 219.6 544.482 DL 229.6 544.482 224.6 544.482 DL 234.6
544.482 229.6 544.482 DL 239.6 544.482 234.6 544.482 DL 244.6 544.482
239.6 544.482 DL 249.6 544.482 244.6 544.482 DL 254.6 544.482 249.6
544.482 DL 259.6 544.482 254.6 544.482 DL 264.6 544.482 259.6 544.482 DL
269.6 544.482 264.6 544.482 DL 274.6 544.482 269.6 544.482 DL 279.6
544.482 274.6 544.482 DL 284.6 544.482 279.6 544.482 DL 289.6 544.482
284.6 544.482 DL 294.6 544.482 289.6 544.482 DL 299.6 544.482 294.6
544.482 DL 304.6 544.482 299.6 544.482 DL 309.6 544.482 304.6 544.482 DL
314.6 544.482 309.6 544.482 DL 319.6 544.482 314.6 544.482 DL 324.6
544.482 319.6 544.482 DL 329.6 544.482 324.6 544.482 DL 334.6 544.482
329.6 544.482 DL 339.6 544.482 334.6 544.482 DL 344.6 544.482 339.6
544.482 DL 349.6 544.482 344.6 544.482 DL 354.6 544.482 349.6 544.482 DL
359.6 544.482 354.6 544.482 DL 364.6 544.482 359.6 544.482 DL 369.6
544.482 364.6 544.482 DL 374.6 544.482 369.6 544.482 DL 379.6 544.482
374.6 544.482 DL 384.6 544.482 379.6 544.482 DL 389.6 544.482 384.6
544.482 DL 394.6 544.482 389.6 544.482 DL 399.6 544.482 394.6 544.482 DL
404.6 544.482 399.6 544.482 DL 409.6 544.482 404.6 544.482 DL 414.6
544.482 409.6 544.482 DL 419.6 544.482 414.6 544.482 DL 424.6 544.482
419.6 544.482 DL 429.6 544.482 424.6 544.482 DL 434.6 544.482 429.6
544.482 DL 439.6 544.482 434.6 544.482 DL 444.6 544.482 439.6 544.482 DL
449.6 544.482 444.6 544.482 DL 454.6 544.482 449.6 544.482 DL 459.6
544.482 454.6 544.482 DL 464.6 544.482 459.6 544.482 DL 469.6 544.482
464.6 544.482 DL 474.6 544.482 469.6 544.482 DL 479.6 544.482 474.6
544.482 DL 484.6 544.482 479.6 544.482 DL 489.6 544.482 484.6 544.482 DL
494.6 544.482 489.6 544.482 DL 499.6 544.482 494.6 544.482 DL 504.6
544.482 499.6 544.482 DL 509.6 544.482 504.6 544.482 DL 514.6 544.482
509.6 544.482 DL 519.6 544.482 514.6 544.482 DL F2 16.2
(#include "call.h")129.6 553.983 R 16.2(#include <poll.h>)129.6 564.683
R(#define BUFFSIZE)129.6 580.733 Q(512)21.6 E(/*)129.6 596.783 Q 5.4(*C)
135 607.483 S(opy everything from stdin to "remfd",)-5.4 E 5.4(*a)135
618.183 S(nd everything from "remfd" to stdout.)-5.4 E(*/)135 628.883 Q
(void)129.6 639.583 Q(loop\(int remfd\))129.6 650.283 Q 0 Cg EP
%%Page: 44 44
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(44)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF({)129.6 121.7 Q 64.8(int bol,)151.2 132.4 R(n, nread;)5.4
E 59.4(char c;)151.2 143.1 R 59.4(char buff[BUFFSIZE];)151.2 153.8 R
(struct pollfd)151.2 164.5 Q(fds[2];)16.2 E(/*)151.2 180.55 Q 5.4(*S)
156.6 191.25 S
(et stdout unbuffered for printfs in take\(\) and put\(\).)-5.4 E(*/)
156.6 201.95 Q(setbuf\(stdout, NULL\);)151.2 212.65 Q
(fds[0].fd = STDIN_FILENO;)151.2 223.35 Q(/* user's terminal input */)
16.2 E(fds[0].events = POLLIN;)151.2 234.05 Q(fds[1].fd = remfd;)151.2
244.75 Q(/* input from remote \(modem\) */)54 E(fds[1].events = POLLIN;)
151.2 255.45 Q(for \( ; ; \) {)151.2 271.5 Q
(if \(poll\(fds, 2, -1\) <= 0\))172.8 282.2 Q(err_sys\("poll error"\);)
194.4 292.9 Q(if \(fds[0].revents & POLLIN\) {)172.8 303.6 Q
(/* data to read on stdin */)10.8 E
(if \(read\(STDIN_FILENO, &c, 1\) != 1\))194.4 314.3 Q
(err_sys\("read error from stdin"\);)216 325 Q
(if \(c == escapec && bol\) {)194.4 335.7 Q
(if \(\(n = doescape\(remfd\)\) < 0\))216 346.4 Q 27(break; /*)237.6
357.1 R(user wants to terminate */)5.4 E(else if \(n == 0\))216 367.8 Q
10.8(continue; /*)237.6 378.5 R(escape seq has been processed */)5.4 E
(/* else char following escape wasn't special, */)216 394.55 Q
(/* so return and echo it below. */)216 405.25 Q 5.4(c=n)216 415.95 S(;)
-5.4 E(})194.4 426.65 Q(if \(c == '\\r' || c == '\\n'\))194.4 437.35 Q
(bol = 1;)216 448.05 Q(else)194.4 458.75 Q(bol = 0;)216 469.45 Q
(if \(write\(remfd, &c, 1\) != 1\))194.4 480.15 Q
(err_sys\("write error"\);)216 490.85 Q(})172.8 501.55 Q
(if \(fds[0].revents & POLLHUP\))172.8 512.25 Q 27(break; /*)194.4
522.95 R(stdin hangup -> done */)5.4 E(if \(fds[1].revents & POLLIN\) {)
172.8 533.65 Q(/* data to read from remote */)10.8 E
(if \(\(nread = read\(remfd, buff, BUFFSIZE\)\) <= 0\))194.4 544.35 Q 27
(break; /*)216 555.05 R(error or EOF, terminate */)5.4 E
(if \(writen\(STDOUT_FILENO, buff, nread\) != nread\))194.4 565.75 Q
(err_sys\("writen error to stdout"\);)216 576.45 Q(})172.8 587.15 Q
(if \(fds[1].revents & POLLHUP\))172.8 597.85 Q 27(break; /*)194.4
608.55 R(modem hangup -> done */)5.4 E(})151.2 619.25 Q(})129.6 629.95 Q
.4 LW 134.6 634.751 129.6 634.751 DL 139.6 634.751 134.6 634.751 DL
144.6 634.751 139.6 634.751 DL 149.6 634.751 144.6 634.751 DL 154.6
634.751 149.6 634.751 DL 159.6 634.751 154.6 634.751 DL 164.6 634.751
159.6 634.751 DL 169.6 634.751 164.6 634.751 DL 174.6 634.751 169.6
634.751 DL 179.6 634.751 174.6 634.751 DL 184.6 634.751 179.6 634.751 DL
189.6 634.751 184.6 634.751 DL 194.6 634.751 189.6 634.751 DL 199.6
634.751 194.6 634.751 DL 204.6 634.751 199.6 634.751 DL 209.6 634.751
204.6 634.751 DL 214.6 634.751 209.6 634.751 DL 219.6 634.751 214.6
634.751 DL 224.6 634.751 219.6 634.751 DL 229.6 634.751 224.6 634.751 DL
234.6 634.751 229.6 634.751 DL 239.6 634.751 234.6 634.751 DL 244.6
634.751 239.6 634.751 DL 249.6 634.751 244.6 634.751 DL 254.6 634.751
249.6 634.751 DL 259.6 634.751 254.6 634.751 DL 264.6 634.751 259.6
634.751 DL 269.6 634.751 264.6 634.751 DL 274.6 634.751 269.6 634.751 DL
279.6 634.751 274.6 634.751 DL 284.6 634.751 279.6 634.751 DL 289.6
634.751 284.6 634.751 DL 294.6 634.751 289.6 634.751 DL 299.6 634.751
294.6 634.751 DL 304.6 634.751 299.6 634.751 DL 309.6 634.751 304.6
634.751 DL 314.6 634.751 309.6 634.751 DL 319.6 634.751 314.6 634.751 DL
324.6 634.751 319.6 634.751 DL 329.6 634.751 324.6 634.751 DL 334.6
634.751 329.6 634.751 DL 339.6 634.751 334.6 634.751 DL 344.6 634.751
339.6 634.751 DL 349.6 634.751 344.6 634.751 DL 354.6 634.751 349.6
634.751 DL 359.6 634.751 354.6 634.751 DL 364.6 634.751 359.6 634.751 DL
369.6 634.751 364.6 634.751 DL 374.6 634.751 369.6 634.751 DL 379.6
634.751 374.6 634.751 DL 384.6 634.751 379.6 634.751 DL 389.6 634.751
384.6 634.751 DL 394.6 634.751 389.6 634.751 DL 399.6 634.751 394.6
634.751 DL 404.6 634.751 399.6 634.751 DL 409.6 634.751 404.6 634.751 DL
414.6 634.751 409.6 634.751 DL 419.6 634.751 414.6 634.751 DL 424.6
634.751 419.6 634.751 DL 429.6 634.751 424.6 634.751 DL 434.6 634.751
429.6 634.751 DL 439.6 634.751 434.6 634.751 DL 444.6 634.751 439.6
634.751 DL 449.6 634.751 444.6 634.751 DL 454.6 634.751 449.6 634.751 DL
459.6 634.751 454.6 634.751 DL 464.6 634.751 459.6 634.751 DL 469.6
634.751 464.6 634.751 DL 474.6 634.751 469.6 634.751 DL 479.6 634.751
474.6 634.751 DL 484.6 634.751 479.6 634.751 DL 489.6 634.751 484.6
634.751 DL 494.6 634.751 489.6 634.751 DL 499.6 634.751 494.6 634.751 DL
504.6 634.751 499.6 634.751 DL 509.6 634.751 504.6 634.751 DL 514.6
634.751 509.6 634.751 DL 519.6 634.751 514.6 634.751 DL/F3 8
/Palatino-Bold@0 SF(Figure 31)227.896 650.751 Q/F4 8/Palatino-Roman@0 SF
(The)6 E/F5 8/Courier@0 SF(loop)2 E F4(function using the)2 E F5(poll)2
E F4(function)2 E 0 Cg EP
%%Page: 45 45
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 8)93.6 84 R 2.25(Client Sour)
280.29 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(45)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 10/Palatino-Roman@0 SF .646
(The basic loop of this function just waits for data to appear fr)129.6
123 R .647(om either the terminal or)-.18 F 1.008(the modem.)129.6 135 R
1.008(When data is)6.008 F/F3 10/Courier@0 SF(read)3.508 E F2(fr)3.507 E
1.007(om the terminal, it's just copied to the modem and)-.18 F .63
(vice versa.)129.6 147 R .63(The only complication is to r)5.63 F .63
(ecognize the escape character \(the tilde\) as the)-.18 F
(\214rst character of a line.)129.6 159 Q .778(Note that we)147.6 171 R
F3(read)3.278 E F2 .778(one character at a time fr)3.278 F .778
(om the terminal \(standar)-.18 F 3.277(di)-.18 G .777(nput\), but)
-3.277 F 1.309(up to one buf)129.6 183 R 1.309(fer at a time fr)-.18 F
1.309(om the modem.)-.18 F 1.31(One r)6.309 F 1.31
(eason for the single character at a)-.18 F .981(time fr)129.6 195 R
.981(om the terminal is because we have to look at every character to k\
now when a)-.18 F .673(new line begins, to r)129.6 207 R .673
(ecognize the special commands.)-.18 F .673(Although this character)
5.673 F(-at-a-time)-.18 E .579
(I/O is expensive in terms of CPU time \(r)129.6 219 R .579(ecall Figur)
-.18 F 3.079(e3)-.18 G .579(.5\), ther)-3.079 F 3.079(ei)-.18 G 3.078
(su)-3.079 G .578(sually far less input)-3.078 F(fr)129.6 231 Q 1.537
(om the terminal than fr)-.18 F 1.537(om the r)-.18 F 1.537
(emote system.)-.18 F 1.537(\(In r)6.537 F 1.537
(emote login sessions using this)-.18 F(pr)129.6 243 Q .396
(ogram measur)-.18 F .396(ed by the author)-.18 F 2.896(,t)-.74 G(her)
-2.896 E 2.895(ea)-.18 G .755 -.18(re a)-2.895 H -.18(ro).18 G .395
(und 100 characters output by the r).18 F(emote)-.18 E
(host for every character input.\))129.6 255 Q 1.762
(When the escape character is seen,)147.6 267 R F3(doescape)4.262 E F2
1.763(is called to pr)4.263 F 1.763(ocess the command)-.18 F(\(Figur)
129.6 279 Q 3.42(e3)-.18 G 3.42(2\). W)-3.42 F 3.42(es)-.92 G .92
(upport only \214ve commands.)-3.42 F .92(Simple commands ar)5.92 F 3.42
(eh)-.18 G .92(andled dir)-3.42 F(ectly)-.18 E .65
(in this function, while the mor)129.6 291 R 3.15(ec)-.18 G(omplicated)
-3.15 E F3(take)3.15 E F2(and)3.15 E F3(put)3.15 E F2 .65(commands ar)
3.15 F 3.15(eh)-.18 G .65(andled by)-3.15 F(separate functions \()129.6
303 Q F3(take)A F2(and)2.5 E F3(put)2.5 E F2(\).)A 8.83<8341>147.6 319.8
S .717(period terminates the client.)-5.612 F .717
(For some devices, such as a laser printer)5.717 F 3.217(,t)-.74 G .717
(his is)-3.217 F .746(the only way to terminate the client.)162.49 331.8
R .746(When we'r)5.746 F 3.246(el)-.18 G .746(ogged into a r)-3.246 F
.747(emote system,)-.18 F 1.587(such as in Figur)162.49 343.8 R 4.086
(e2)-.18 G 1.586(6, logging out fr)-4.086 F 1.586
(om that system usually causes the r)-.18 F(emote)-.18 E .615
(modem to dr)162.49 355.8 R .616
(op the phone line, causing a hangup to be r)-.18 F .616
(eceived on the modem)-.18 F(descriptor by the)162.49 367.8 Q F3(loop)
2.5 E F2(function.)2.5 E 8.83<8349>147.6 383.8 S 6.741(ft)-8.83 G 4.241
(he system supports job contr)-6.741 F 4.241(ol we r)-.18 F 4.241
(ecognize the job-contr)-.18 F 4.241(ol suspend)-.18 F .547
(character and suspend the client.)162.49 395.8 R .548
(Note that it is simpler for us to r)5.548 F .548(ecognize this)-.18 F
1.044(character dir)162.49 407.8 R 1.044
(ectly and stop ourselves than to have the line discipline r)-.18 F
(ecognize)-.18 E .237(the character and generate the)162.49 419.8 R F3
(SIGSTOP)2.737 E F2 .237(signal \(compar)2.737 F 2.737(ew)-.18 G .238
(ith Figur)-2.737 F 2.738(e1)-.18 G 2.738(0.30\). W)-2.738 F(e)-.92 E
1.628(have to r)162.49 431.8 R 1.628(eset the terminal mode befor)-.18 F
4.127(es)-.18 G 1.627(topping ourselves, and r)-4.127 F 1.627
(eset it when)-.18 F(we'r)162.49 443.8 Q 2.5(ec)-.18 G(ontinued.)-2.5 E
8.83<8341>147.6 459.8 S 3.24
(pound sign generates a BREAK on the modem descriptor)-3.09 F 8.24(.W)
-.74 G 5.74(eu)-9.16 G 3.24(se the)-5.74 F(POSIX.1)162.49 471.8 Q F3
(tcsendbreak)2.687 E F2 .187(function to do this \(Section 18.8\).)2.687
F .187(The BREAK condition)5.187 F 2.486(often causes the r)162.49 483.8
R 2.486(emote system's)-.18 F F3(getty)4.986 E F2(or)4.986 E F3(ttymon)
4.986 E F2(pr)4.987 E 2.487(ogram to switch line)-.18 F
(speeds \(Section 9.2\).)162.49 495.8 Q 8.83<8354>147.6 511.8 S(he)-8.83
E F3(take)3.072 E F2(and)3.072 E F3(put)3.072 E F2 .572(commands r)3.072
F(equir)-.18 E 3.072(es)-.18 G .572(eparate functions to be called.)
-3.072 F .571(The way)5.571 F 1.568
(to distinguish between the two commands is to r)162.49 523.8 R 1.569
(emember that the command)-.18 F 1.876(describes what the client is doi\
ng on the local system: taking a \214le fr)162.49 535.8 R 1.876(om the)
-.18 F -.18(re)162.49 547.8 S(mote system or putting a \214le to the r)
.18 E(emote system.)-.18 E .4 LW 152.6 559.8 147.6 559.8 DL 154.6 559.8
149.6 559.8 DL 159.6 559.8 154.6 559.8 DL 164.6 559.8 159.6 559.8 DL
169.6 559.8 164.6 559.8 DL 174.6 559.8 169.6 559.8 DL 179.6 559.8 174.6
559.8 DL 184.6 559.8 179.6 559.8 DL 189.6 559.8 184.6 559.8 DL 194.6
559.8 189.6 559.8 DL 199.6 559.8 194.6 559.8 DL 204.6 559.8 199.6 559.8
DL 209.6 559.8 204.6 559.8 DL 214.6 559.8 209.6 559.8 DL 219.6 559.8
214.6 559.8 DL 224.6 559.8 219.6 559.8 DL 229.6 559.8 224.6 559.8 DL
234.6 559.8 229.6 559.8 DL 239.6 559.8 234.6 559.8 DL 244.6 559.8 239.6
559.8 DL 249.6 559.8 244.6 559.8 DL 254.6 559.8 249.6 559.8 DL 259.6
559.8 254.6 559.8 DL 264.6 559.8 259.6 559.8 DL 269.6 559.8 264.6 559.8
DL 274.6 559.8 269.6 559.8 DL 279.6 559.8 274.6 559.8 DL 284.6 559.8
279.6 559.8 DL 289.6 559.8 284.6 559.8 DL 294.6 559.8 289.6 559.8 DL
299.6 559.8 294.6 559.8 DL 304.6 559.8 299.6 559.8 DL 309.6 559.8 304.6
559.8 DL 314.6 559.8 309.6 559.8 DL 319.6 559.8 314.6 559.8 DL 324.6
559.8 319.6 559.8 DL 329.6 559.8 324.6 559.8 DL 334.6 559.8 329.6 559.8
DL 339.6 559.8 334.6 559.8 DL 344.6 559.8 339.6 559.8 DL 349.6 559.8
344.6 559.8 DL 354.6 559.8 349.6 559.8 DL 359.6 559.8 354.6 559.8 DL
364.6 559.8 359.6 559.8 DL 369.6 559.8 364.6 559.8 DL 374.6 559.8 369.6
559.8 DL 379.6 559.8 374.6 559.8 DL 384.6 559.8 379.6 559.8 DL 389.6
559.8 384.6 559.8 DL 394.6 559.8 389.6 559.8 DL 399.6 559.8 394.6 559.8
DL 404.6 559.8 399.6 559.8 DL 409.6 559.8 404.6 559.8 DL 414.6 559.8
409.6 559.8 DL 419.6 559.8 414.6 559.8 DL 424.6 559.8 419.6 559.8 DL
429.6 559.8 424.6 559.8 DL 434.6 559.8 429.6 559.8 DL 439.6 559.8 434.6
559.8 DL 444.6 559.8 439.6 559.8 DL 449.6 559.8 444.6 559.8 DL 454.6
559.8 449.6 559.8 DL 459.6 559.8 454.6 559.8 DL 464.6 559.8 459.6 559.8
DL 469.6 559.8 464.6 559.8 DL 474.6 559.8 469.6 559.8 DL 479.6 559.8
474.6 559.8 DL 484.6 559.8 479.6 559.8 DL 489.6 559.8 484.6 559.8 DL
494.6 559.8 489.6 559.8 DL 499.6 559.8 494.6 559.8 DL 504.6 559.8 499.6
559.8 DL 509.6 559.8 504.6 559.8 DL 514.6 559.8 509.6 559.8 DL 519.6
559.8 514.6 559.8 DL/F4 9/Courier@0 SF 16.2(#include "call.h")147.6
569.301 R(/*)147.6 586.421 Q 5.4(*C)153 597.121 S
(alled when first character of a line is the escape character)-5.4 E 5.4
(*\()153 607.821 S 5.4(tilde\). Read)-5.4 F
(the next character and process.)5.4 E(Return -1)10.8 E 5.4(*i)153
618.521 S 5.4(fn)-5.4 G
(ext character is "terminate" character, 0 if next character)-5.4 E 5.4
(*i)153 629.221 S 5.4(sv)-5.4 G
(alid command character \(that's been processed\), or next)-5.4 E 5.4
(*c)153 639.921 S
(haracter itself \(if the next character is not special\).)-5.4 E(*/)153
650.621 Q 0 Cg EP
%%Page: 46 46
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(46)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(int)147.6 121.7 Q(doescape\(int remfd\))147.6 132.4 Q({)
147.6 143.1 Q 16.2(char c;)169.2 153.8 R
(if \(read\(STDIN_FILENO, &c, 1\) != 1\))169.2 170.92 Q
(/* next input char */)27 E(err_sys\("read error from stdin"\);)190.8
181.62 Q(if \(c == escapec\) {)169.2 198.74 Q
(/* two in a row -> process as one */)27 E(return\(escapec\);)190.8
209.44 Q 5.4(}e)169.2 220.14 S(lse if \(c == '.'\) {)-5.4 E
(/* terminate */)10.8 E(write\(STDOUT_FILENO, "~.\\n\\r", 4\);)190.8
230.84 Q(return\(-1\);)190.8 241.54 Q 5.4(#ifdef VSUSP)147.6 258.66 R
5.4(}e)169.2 269.36 S
(lse if \(c == tty_termios\(\)->c_cc[VSUSP]\) { /* suspend client */)
-5.4 E 16.2(tty_reset\(STDIN_FILENO\); /*)190.8 280.06 R
(restore tty mode */)5.4 E(kill\(getpid\(\), SIGTSTP\);)190.8 290.76 Q
(/* suspend ourself */)21.6 E 27(tty_raw\(STDIN_FILENO\); /*)190.8
301.46 R(and reset tty to raw */)5.4 E(return\(0\);)190.8 312.16 Q
(#endif)147.6 322.86 Q 5.4(}e)169.2 339.98 S(lse if \(c == '#'\) {)-5.4
E(/* generate break */)10.8 E(tcsendbreak\(remfd, 0\);)190.8 350.68 Q
(return\(0\);)190.8 361.38 Q 5.4(}e)169.2 372.08 S
(lse if \(c == 't'\) {)-5.4 E(/* take a file from remote host */)10.8 E
(take\(remfd\);)190.8 382.78 Q(return\(0\);)190.8 393.48 Q 5.4(}e)169.2
404.18 S(lse if \(c == 'p'\) {)-5.4 E(/* put a file to remote host */)
10.8 E(put\(remfd\);)190.8 414.88 Q(return\(0\);)190.8 425.58 Q(})169.2
436.28 Q 48.6(return\(c\); /*)169.2 453.4 R(not a special character */)
5.4 E(})147.6 464.1 Q .4 LW 152.6 468.901 147.6 468.901 DL 154.6 468.901
149.6 468.901 DL 159.6 468.901 154.6 468.901 DL 164.6 468.901 159.6
468.901 DL 169.6 468.901 164.6 468.901 DL 174.6 468.901 169.6 468.901 DL
179.6 468.901 174.6 468.901 DL 184.6 468.901 179.6 468.901 DL 189.6
468.901 184.6 468.901 DL 194.6 468.901 189.6 468.901 DL 199.6 468.901
194.6 468.901 DL 204.6 468.901 199.6 468.901 DL 209.6 468.901 204.6
468.901 DL 214.6 468.901 209.6 468.901 DL 219.6 468.901 214.6 468.901 DL
224.6 468.901 219.6 468.901 DL 229.6 468.901 224.6 468.901 DL 234.6
468.901 229.6 468.901 DL 239.6 468.901 234.6 468.901 DL 244.6 468.901
239.6 468.901 DL 249.6 468.901 244.6 468.901 DL 254.6 468.901 249.6
468.901 DL 259.6 468.901 254.6 468.901 DL 264.6 468.901 259.6 468.901 DL
269.6 468.901 264.6 468.901 DL 274.6 468.901 269.6 468.901 DL 279.6
468.901 274.6 468.901 DL 284.6 468.901 279.6 468.901 DL 289.6 468.901
284.6 468.901 DL 294.6 468.901 289.6 468.901 DL 299.6 468.901 294.6
468.901 DL 304.6 468.901 299.6 468.901 DL 309.6 468.901 304.6 468.901 DL
314.6 468.901 309.6 468.901 DL 319.6 468.901 314.6 468.901 DL 324.6
468.901 319.6 468.901 DL 329.6 468.901 324.6 468.901 DL 334.6 468.901
329.6 468.901 DL 339.6 468.901 334.6 468.901 DL 344.6 468.901 339.6
468.901 DL 349.6 468.901 344.6 468.901 DL 354.6 468.901 349.6 468.901 DL
359.6 468.901 354.6 468.901 DL 364.6 468.901 359.6 468.901 DL 369.6
468.901 364.6 468.901 DL 374.6 468.901 369.6 468.901 DL 379.6 468.901
374.6 468.901 DL 384.6 468.901 379.6 468.901 DL 389.6 468.901 384.6
468.901 DL 394.6 468.901 389.6 468.901 DL 399.6 468.901 394.6 468.901 DL
404.6 468.901 399.6 468.901 DL 409.6 468.901 404.6 468.901 DL 414.6
468.901 409.6 468.901 DL 419.6 468.901 414.6 468.901 DL 424.6 468.901
419.6 468.901 DL 429.6 468.901 424.6 468.901 DL 434.6 468.901 429.6
468.901 DL 439.6 468.901 434.6 468.901 DL 444.6 468.901 439.6 468.901 DL
449.6 468.901 444.6 468.901 DL 454.6 468.901 449.6 468.901 DL 459.6
468.901 454.6 468.901 DL 464.6 468.901 459.6 468.901 DL 469.6 468.901
464.6 468.901 DL 474.6 468.901 469.6 468.901 DL 479.6 468.901 474.6
468.901 DL 484.6 468.901 479.6 468.901 DL 489.6 468.901 484.6 468.901 DL
494.6 468.901 489.6 468.901 DL 499.6 468.901 494.6 468.901 DL 504.6
468.901 499.6 468.901 DL 509.6 468.901 504.6 468.901 DL 514.6 468.901
509.6 468.901 DL 519.6 468.901 514.6 468.901 DL/F3 8/Palatino-Bold@0 SF
(Figure 32)271.096 484.901 Q/F4 8/Palatino-Roman@0 SF(The)6 E/F5 8
/Courier@0 SF(doescape)2 E F4(function)2 E/F6 10/Palatino-Roman@0 SF
(Figur)147.6 520.901 Q 4.375(e3)-.18 G 4.375(3s)-4.375 G 1.875
(hows the code r)-4.375 F(equir)-.18 E 1.875(ed to handle the)-.18 F/F7
10/Courier@0 SF(take)4.375 E F6 4.375(command. The)4.375 F(function)
4.375 E F7(take)129.6 532.901 Q F6 2.478(\214rst calls)4.978 F F7
(prompt_read)4.978 E F6 2.478(\(which we show in Figur)4.978 F 4.978(e3)
-.18 G 2.477(4\) to echo)-4.978 F F7(~[take])4.977 E F6(in)4.977 E -.18
(re)129.6 544.901 S 1.28(sponse to the).18 F F7(~t)3.78 E F6 3.78
(command. The)3.78 F F7(prompt_read)3.78 E F6 1.28(function then r)3.78
F 1.28(eads a line of input)-.18 F 3.032(containing the sour)129.6
556.901 R 3.032(ce pathname \(the \214le on the r)-.18 F 3.031
(emote host\) and the destination)-.18 F 1.436
(pathname \(the \214le on the local host\) fr)129.6 568.901 R 1.436
(om the terminal.)-.18 F 1.436(The r)6.436 F 1.436(esults ar)-.18 F
3.936(es)-.18 G(tor)-3.936 E 1.436(ed in the)-.18 F(global variables)
129.6 580.901 Q F7(src)2.5 E F6(and)2.5 E F7(dst)2.5 E F6(.)A 134.6
588.101 129.6 588.101 DL 139.6 588.101 134.6 588.101 DL 144.6 588.101
139.6 588.101 DL 149.6 588.101 144.6 588.101 DL 154.6 588.101 149.6
588.101 DL 159.6 588.101 154.6 588.101 DL 164.6 588.101 159.6 588.101 DL
169.6 588.101 164.6 588.101 DL 174.6 588.101 169.6 588.101 DL 179.6
588.101 174.6 588.101 DL 184.6 588.101 179.6 588.101 DL 189.6 588.101
184.6 588.101 DL 194.6 588.101 189.6 588.101 DL 199.6 588.101 194.6
588.101 DL 204.6 588.101 199.6 588.101 DL 209.6 588.101 204.6 588.101 DL
214.6 588.101 209.6 588.101 DL 219.6 588.101 214.6 588.101 DL 224.6
588.101 219.6 588.101 DL 229.6 588.101 224.6 588.101 DL 234.6 588.101
229.6 588.101 DL 239.6 588.101 234.6 588.101 DL 244.6 588.101 239.6
588.101 DL 249.6 588.101 244.6 588.101 DL 254.6 588.101 249.6 588.101 DL
259.6 588.101 254.6 588.101 DL 264.6 588.101 259.6 588.101 DL 269.6
588.101 264.6 588.101 DL 274.6 588.101 269.6 588.101 DL 279.6 588.101
274.6 588.101 DL 284.6 588.101 279.6 588.101 DL 289.6 588.101 284.6
588.101 DL 294.6 588.101 289.6 588.101 DL 299.6 588.101 294.6 588.101 DL
304.6 588.101 299.6 588.101 DL 309.6 588.101 304.6 588.101 DL 314.6
588.101 309.6 588.101 DL 319.6 588.101 314.6 588.101 DL 324.6 588.101
319.6 588.101 DL 329.6 588.101 324.6 588.101 DL 334.6 588.101 329.6
588.101 DL 339.6 588.101 334.6 588.101 DL 344.6 588.101 339.6 588.101 DL
349.6 588.101 344.6 588.101 DL 354.6 588.101 349.6 588.101 DL 359.6
588.101 354.6 588.101 DL 364.6 588.101 359.6 588.101 DL 369.6 588.101
364.6 588.101 DL 374.6 588.101 369.6 588.101 DL 379.6 588.101 374.6
588.101 DL 384.6 588.101 379.6 588.101 DL 389.6 588.101 384.6 588.101 DL
394.6 588.101 389.6 588.101 DL 399.6 588.101 394.6 588.101 DL 404.6
588.101 399.6 588.101 DL 409.6 588.101 404.6 588.101 DL 414.6 588.101
409.6 588.101 DL 419.6 588.101 414.6 588.101 DL 424.6 588.101 419.6
588.101 DL 429.6 588.101 424.6 588.101 DL 434.6 588.101 429.6 588.101 DL
439.6 588.101 434.6 588.101 DL 444.6 588.101 439.6 588.101 DL 449.6
588.101 444.6 588.101 DL 454.6 588.101 449.6 588.101 DL 459.6 588.101
454.6 588.101 DL 464.6 588.101 459.6 588.101 DL 469.6 588.101 464.6
588.101 DL 474.6 588.101 469.6 588.101 DL 479.6 588.101 474.6 588.101 DL
484.6 588.101 479.6 588.101 DL 489.6 588.101 484.6 588.101 DL 494.6
588.101 489.6 588.101 DL 499.6 588.101 494.6 588.101 DL 504.6 588.101
499.6 588.101 DL 509.6 588.101 504.6 588.101 DL 514.6 588.101 509.6
588.101 DL 519.6 588.101 514.6 588.101 DL F2 16.2(#include "call.h")
129.6 597.602 R(#define CTRLA)129.6 615.792 Q 21.6(001 /*)16.2 F
(eof designator for take */)5.4 E(static int)129.6 633.982 Q
(rem_read\(int\);)37.8 E(static char)129.6 644.682 Q(rem_buf[MAXLINE];)
32.4 E(static char)129.6 655.382 Q(*rem_ptr;)27 E 0 Cg EP
%%Page: 47 47
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 8)93.6 84 R 2.25(Client Sour)
280.29 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(47)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF(static int)129.6 121.7 Q(rem_cnt = 0;)37.8 E
(/*)129.6 139.89 Q 5.4(*C)135 150.59 S(opy a file from remote to local.)
-5.4 E(*/)135 161.29 Q(void)129.6 171.99 Q(take\(int remfd\))129.6
182.69 Q({)129.6 193.39 Q 21.6(int n,)151.2 204.09 R(linecnt;)5.4 E 16.2
(char c;)151.2 214.79 R 16.2(char cmd[MAXLINE];)151.2 225.49 R 16.2
(FILE *fpout;)151.2 236.19 R
(if \(prompt_read\("~[take] ", take_put_args\) < 0\) {)151.2 254.38 Q
(printf\("usage: [take] <sourcefile> <destfile>\\n\\r"\);)172.8 265.08 Q
(return;)172.8 275.78 Q(})151.2 286.48 Q(/*)151.2 304.67 Q 5.4(*O)156.6
315.37 S(pen local output file.)-5.4 E(*/)156.6 326.07 Q
(if \(\(fpout = fopen\(dst, "w"\)\) == NULL\) {)151.2 336.77 Q
(err_ret\("can't open %s for writing", dst\);)172.8 347.47 Q
(putc\('\\r', stderr\);)172.8 358.17 Q(fflush\(stderr\);)172.8 368.87 Q
(return;)172.8 379.57 Q(})151.2 390.27 Q(/*)151.2 408.46 Q 5.4(*S)156.6
419.16 S(end cat/echo command to remote host.)-5.4 E(*/)156.6 429.86 Q
(sprintf\(cmd, "cat %s; echo %c\\r", src, CTRLA\);)151.2 440.56 Q 5.4
(n=s)151.2 451.26 S(trlen\(cmd\);)-5.4 E
(if \(write\(remfd, cmd, n\) != n\))151.2 461.96 Q
(err_sys\("write error"\);)172.8 472.66 Q(/*)151.2 490.85 Q 5.4(*R)156.6
501.55 S(ead echo of cat/echo command line from remote host)-5.4 E(*/)
156.6 512.25 Q(rem_cnt = 0;)151.2 522.95 Q
(/* initialize rem_read\(\) */)43.2 E(for \( ; ; \) {)151.2 533.65 Q
(if \(\(c = rem_read\(remfd\)\) == 0\))172.8 544.35 Q 21.6(return; /*)
194.4 555.05 R(line has dropped */)5.4 E(if \(c == '\\n'\))172.8 565.75
Q 27(break; /*)194.4 576.45 R(end of echo line */)5.4 E(})151.2 587.15 Q
(/*)151.2 605.34 Q 5.4(*R)156.6 616.04 S(ead file from remote host.)-5.4
E(*/)156.6 626.74 Q(linecnt = 0;)151.2 637.44 Q(for \( ; ; \) {)151.2
648.14 Q 0 Cg EP
%%Page: 48 48
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(48)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(if \(\(c = rem_read\(remfd\)\) == 0\))172.8 121.7 Q 48.6
(break; /*)194.4 132.4 R(line has dropped */)5.4 E(if \(c == CTRLA\))
172.8 143.1 Q 48.6(break; /*)194.4 153.8 R(all done */)5.4 E
(if \(c == '\\r'\))172.8 164.5 Q 32.4(continue; /*)194.4 175.2 R
(ignore returns */)5.4 E(if \(c == '\\n'\))172.8 185.9 Q
(/* but newlines are written to file */)32.4 E
(printf\("\\r%d", ++linecnt\);)194.4 196.6 Q
(if \(putc\(c, fpout\) == EOF\))172.8 207.3 Q 48.6(break; /*)194.4 218 R
(output error */)5.4 E(})151.2 228.7 Q
(if \(ferror\(fpout\) || fclose\(fpout\) == EOF\) {)151.2 239.4 Q
(err_msg\("output error to local file"\);)172.8 250.1 Q
(putc\('\\r', stderr\);)172.8 260.8 Q(fflush\(stderr\);)172.8 271.5 Q(})
151.2 282.2 Q 5.4(c=')151.2 292.9 S(\\n';)-5.4 E(write\(remfd, &c, 1\);)
151.2 303.6 Q(})129.6 314.3 Q(/*)129.6 332.49 Q 5.4(*R)135 343.19 S
(ead from remote.)-5.4 E(Read up to MAXLINE, but parcel out one)10.8 E
5.4(*c)135 353.89 S(haracter at a time.)-5.4 E(*/)135 364.59 Q(int)129.6
375.29 Q(rem_read\(int remfd\))129.6 385.99 Q({)129.6 396.69 Q
(if \(rem_cnt <= 0\) {)151.2 407.39 Q
(if \(\(rem_cnt = read\(remfd, rem_buf, MAXLINE\)\) < 0\))172.8 418.09 Q
(err_sys\("read error"\);)194.4 428.79 Q(else if \(rem_cnt == 0\))172.8
439.49 Q(return\(0\);)194.4 450.19 Q(rem_ptr = rem_buf;)172.8 460.89 Q
(})151.2 471.59 Q(rem_cnt--;)151.2 482.29 Q
(return\(*rem_ptr++ & 0177\);)151.2 492.99 Q(})129.6 503.69 Q .4 LW
134.6 508.491 129.6 508.491 DL 139.6 508.491 134.6 508.491 DL 144.6
508.491 139.6 508.491 DL 149.6 508.491 144.6 508.491 DL 154.6 508.491
149.6 508.491 DL 159.6 508.491 154.6 508.491 DL 164.6 508.491 159.6
508.491 DL 169.6 508.491 164.6 508.491 DL 174.6 508.491 169.6 508.491 DL
179.6 508.491 174.6 508.491 DL 184.6 508.491 179.6 508.491 DL 189.6
508.491 184.6 508.491 DL 194.6 508.491 189.6 508.491 DL 199.6 508.491
194.6 508.491 DL 204.6 508.491 199.6 508.491 DL 209.6 508.491 204.6
508.491 DL 214.6 508.491 209.6 508.491 DL 219.6 508.491 214.6 508.491 DL
224.6 508.491 219.6 508.491 DL 229.6 508.491 224.6 508.491 DL 234.6
508.491 229.6 508.491 DL 239.6 508.491 234.6 508.491 DL 244.6 508.491
239.6 508.491 DL 249.6 508.491 244.6 508.491 DL 254.6 508.491 249.6
508.491 DL 259.6 508.491 254.6 508.491 DL 264.6 508.491 259.6 508.491 DL
269.6 508.491 264.6 508.491 DL 274.6 508.491 269.6 508.491 DL 279.6
508.491 274.6 508.491 DL 284.6 508.491 279.6 508.491 DL 289.6 508.491
284.6 508.491 DL 294.6 508.491 289.6 508.491 DL 299.6 508.491 294.6
508.491 DL 304.6 508.491 299.6 508.491 DL 309.6 508.491 304.6 508.491 DL
314.6 508.491 309.6 508.491 DL 319.6 508.491 314.6 508.491 DL 324.6
508.491 319.6 508.491 DL 329.6 508.491 324.6 508.491 DL 334.6 508.491
329.6 508.491 DL 339.6 508.491 334.6 508.491 DL 344.6 508.491 339.6
508.491 DL 349.6 508.491 344.6 508.491 DL 354.6 508.491 349.6 508.491 DL
359.6 508.491 354.6 508.491 DL 364.6 508.491 359.6 508.491 DL 369.6
508.491 364.6 508.491 DL 374.6 508.491 369.6 508.491 DL 379.6 508.491
374.6 508.491 DL 384.6 508.491 379.6 508.491 DL 389.6 508.491 384.6
508.491 DL 394.6 508.491 389.6 508.491 DL 399.6 508.491 394.6 508.491 DL
404.6 508.491 399.6 508.491 DL 409.6 508.491 404.6 508.491 DL 414.6
508.491 409.6 508.491 DL 419.6 508.491 414.6 508.491 DL 424.6 508.491
419.6 508.491 DL 429.6 508.491 424.6 508.491 DL 434.6 508.491 429.6
508.491 DL 439.6 508.491 434.6 508.491 DL 444.6 508.491 439.6 508.491 DL
449.6 508.491 444.6 508.491 DL 454.6 508.491 449.6 508.491 DL 459.6
508.491 454.6 508.491 DL 464.6 508.491 459.6 508.491 DL 469.6 508.491
464.6 508.491 DL 474.6 508.491 469.6 508.491 DL 479.6 508.491 474.6
508.491 DL 484.6 508.491 479.6 508.491 DL 489.6 508.491 484.6 508.491 DL
494.6 508.491 489.6 508.491 DL 499.6 508.491 494.6 508.491 DL 504.6
508.491 499.6 508.491 DL 509.6 508.491 504.6 508.491 DL 514.6 508.491
509.6 508.491 DL 519.6 508.491 514.6 508.491 DL/F3 8/Palatino-Bold@0 SF
(Figure 33)249.968 524.491 Q/F4 8/Palatino-Roman@0 SF(Pr)6 E
(ocessing the)-.144 E/F5 8/Courier@0 SF(take)2 E F4(command)2 E/F6 10
/Palatino-Roman@0 SF 2.567(After the)147.6 548.491 R/F7 10/Courier@0 SF
(take)5.067 E F6 2.566
(function opens the local \214le for writing it sends the following)
5.066 F(command to the r)129.6 560.491 Q(emote host:)-.18 E F7(cat)147.6
578.491 Q/F8 10/Palatino-Italic@0 SF(sour)2.5 E(ce\214le)-.18 E F7 6(;e)
2.5 G(cho ^A)-6 E F6 1.058(This causes the r)129.6 596.491 R 1.058
(emote host to execute the)-.18 F F7(cat)3.559 E F6 1.059
(command, followed by an echo of the)3.559 F 1.887(ASCII Contr)129.6
608.491 R(ol)-.18 E(-)-.9 I 4.387(Ac).9 K(haracter)-4.387 E 6.887(.W)
-.74 G 4.387(el)-7.807 G 1.887(ook for this Contr)-4.387 F(ol)-.18 E(-)
-.9 I 4.387(Ai).9 K 4.387(na)-4.387 G 1.887(ll the characters that ar)
-4.387 F(e)-.18 E -.18(re)129.6 620.491 S 1.437(turned by the r).18 F
1.437
(emote host, and when we encounter it, we know the \214le transfer is)
-.18 F 3.5(complete. Note)129.6 632.491 R 1(that we also have to r)3.5 F
1(ead back the echo of the command line that we)-.18 F 1.238
(send to the r)129.6 644.491 R 1.238(emote host.)-.18 F 1.238
(Only after that echo do we start r)6.238 F 1.238
(eceiving the output of the)-.18 F F7(cat)129.6 656.491 Q F6(command.)
2.5 E 0 Cg EP
%%Page: 49 49
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 8)93.6 84 R 2.25(Client Sour)
280.29 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(49)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 10/Palatino-Roman@0 SF 1.137(While we'r)147.6 123 R 3.637(er)
-.18 G 1.137(eading the r)-3.817 F 1.137
(emote \214le we look for newline characters and count the)-.18 F .663
(lines r)129.6 135 R 3.163(eturned. W)-.18 F 3.164(ed)-.92 G .664
(isplay these at the left mar)-3.164 F .664
(gin, overwriting each line number with)-.18 F .448
(the next \(since we terminate the line in the)129.6 147 R/F3 10
/Courier@0 SF(printf)2.947 E F2 .447(with a carriage r)2.947 F .447
(eturn only and not)-.18 F 3.949(an)129.6 159 S 3.949(ewline\). This)
-3.949 F(pr)3.949 E 1.449
(ovides a visual display on the terminal of the pr)-.18 F(ogr)-.18 E
1.45(ess of the \214le)-.18 F
(transfer and a \214nal line count at the end.)129.6 171 Q .988
(This sour)147.6 183 R .988(ce \214le also contains the function)-.18 F
F3(rem_read)3.488 E F2 3.488(,w)C .987(hich is called to r)-3.488 F .987
(ead each)-.18 F .095(character fr)129.6 195 R .095(om the r)-.18 F .095
(emote host.)-.18 F -.92(We)5.095 G F3(read)3.515 E F2 .095
(up to one buf)2.595 F .096(fer at a time, but r)-.18 F .096
(eturn only one)-.18 F(character at a time to the caller)129.6 207 Q(.)
-.74 E .47(Originally the)147.6 219 R F3(take)2.97 E F2 .469
(command was written to)2.97 F F3(read)2.969 E F2 .469
(one character at a time, similar)2.969 F .176(to what)129.6 231 R F3
(cu)2.676 E F2(and)2.676 E F3(tip)2.676 E F2 .176
(have historically done.)2.676 F .176
(This was OK 23 years ago, when 1200 baud)5.176 F 1.06(modems wer)129.6
243 R 3.56(ec)-.18 G(onsider)-3.56 E 1.06(ed fast.)-.18 F 1.06
(But as modems became faster)6.06 F 3.56(,d)-.74 G 1.06
(elivering characters to)-3.56 F(the terminal device driver at 38400 ba\
ud and above, characters could get lost.)129.6 255 Q .023
(The solution to this pr)147.6 267 R .024(oblem is to code the)-.18 F F3
(rem_read)2.524 E F2 .024(function to r)2.524 F .024(ead up to a buf)
-.18 F(fer)-.18 E(at a time.)129.6 279 Q(Doing this r)5 E
(educes the system CPU time and pr)-.18 E(ovides mor)-.18 E 2.5(er)-.18
G(eliable transfer)-2.68 E(.)-.74 E .41(Note that the number of bytes r)
147.6 291 R .409(eturned by)-.18 F F3(read)2.909 E F2 .409(can be gr)
2.909 F .409(eater than 1 even though)-.18 F .463(the line discipline m\
odule for the modem has its MIN set to 1 and TIME set to 0 by the)129.6
303 R F3(tty_open)129.6 315 Q F2 .855(function \(Figur)3.355 F 3.355(e2)
-.18 G 3.355(1\). This)-3.355 F .855(is case B fr)3.355 F .854
(om Section 18.1)-.18 F 3.354(1. This)-.55 F .854(illustrates that)3.354
F .098(MIN is only a minimum.)129.6 327 R .099(If we ask for mor)5.099 F
2.599(et)-.18 G .099(han the minimum, and the bytes ar)-2.599 F 2.599
(er)-.18 G(eady)-2.779 E .335(to be r)129.6 339 R .335(ead, they'r)-.18
F 2.835(er)-.18 G 2.835(eturned. W)-3.015 F 2.835(ea)-.92 G .695 -.18
(re n)-2.835 H .335(ot r).18 F .334(estricted to character)-.18 F .334
(-at-a-time input when we)-.18 F(set MIN to 1.)129.6 351 Q(Figur)147.6
363 Q 3.456(e3)-.18 G 3.456(4s)-3.456 G .957
(hows the two ancillary functions)-3.456 F F3(take_put_args)3.457 E F2
(and)3.457 E F3(prompt_read)3.457 E F2(.)A 2.443
(The latter is called fr)129.6 375 R 2.443(om both the)-.18 F F3(take)
4.943 E F2(and)4.943 E F3(put)4.943 E F2 2.442
(functions, with the former as an)4.943 F(ar)129.6 387 Q
(gument \(that is then called by the)-.18 E F3(buf_args)2.5 E F2
(function, Figur)2.5 E 2.5(e1)-.18 G(7.32\).)-2.5 E .4 LW 134.6 394.2
129.6 394.2 DL 139.6 394.2 134.6 394.2 DL 144.6 394.2 139.6 394.2 DL
149.6 394.2 144.6 394.2 DL 154.6 394.2 149.6 394.2 DL 159.6 394.2 154.6
394.2 DL 164.6 394.2 159.6 394.2 DL 169.6 394.2 164.6 394.2 DL 174.6
394.2 169.6 394.2 DL 179.6 394.2 174.6 394.2 DL 184.6 394.2 179.6 394.2
DL 189.6 394.2 184.6 394.2 DL 194.6 394.2 189.6 394.2 DL 199.6 394.2
194.6 394.2 DL 204.6 394.2 199.6 394.2 DL 209.6 394.2 204.6 394.2 DL
214.6 394.2 209.6 394.2 DL 219.6 394.2 214.6 394.2 DL 224.6 394.2 219.6
394.2 DL 229.6 394.2 224.6 394.2 DL 234.6 394.2 229.6 394.2 DL 239.6
394.2 234.6 394.2 DL 244.6 394.2 239.6 394.2 DL 249.6 394.2 244.6 394.2
DL 254.6 394.2 249.6 394.2 DL 259.6 394.2 254.6 394.2 DL 264.6 394.2
259.6 394.2 DL 269.6 394.2 264.6 394.2 DL 274.6 394.2 269.6 394.2 DL
279.6 394.2 274.6 394.2 DL 284.6 394.2 279.6 394.2 DL 289.6 394.2 284.6
394.2 DL 294.6 394.2 289.6 394.2 DL 299.6 394.2 294.6 394.2 DL 304.6
394.2 299.6 394.2 DL 309.6 394.2 304.6 394.2 DL 314.6 394.2 309.6 394.2
DL 319.6 394.2 314.6 394.2 DL 324.6 394.2 319.6 394.2 DL 329.6 394.2
324.6 394.2 DL 334.6 394.2 329.6 394.2 DL 339.6 394.2 334.6 394.2 DL
344.6 394.2 339.6 394.2 DL 349.6 394.2 344.6 394.2 DL 354.6 394.2 349.6
394.2 DL 359.6 394.2 354.6 394.2 DL 364.6 394.2 359.6 394.2 DL 369.6
394.2 364.6 394.2 DL 374.6 394.2 369.6 394.2 DL 379.6 394.2 374.6 394.2
DL 384.6 394.2 379.6 394.2 DL 389.6 394.2 384.6 394.2 DL 394.6 394.2
389.6 394.2 DL 399.6 394.2 394.6 394.2 DL 404.6 394.2 399.6 394.2 DL
409.6 394.2 404.6 394.2 DL 414.6 394.2 409.6 394.2 DL 419.6 394.2 414.6
394.2 DL 424.6 394.2 419.6 394.2 DL 429.6 394.2 424.6 394.2 DL 434.6
394.2 429.6 394.2 DL 439.6 394.2 434.6 394.2 DL 444.6 394.2 439.6 394.2
DL 449.6 394.2 444.6 394.2 DL 454.6 394.2 449.6 394.2 DL 459.6 394.2
454.6 394.2 DL 464.6 394.2 459.6 394.2 DL 469.6 394.2 464.6 394.2 DL
474.6 394.2 469.6 394.2 DL 479.6 394.2 474.6 394.2 DL 484.6 394.2 479.6
394.2 DL 489.6 394.2 484.6 394.2 DL 494.6 394.2 489.6 394.2 DL 499.6
394.2 494.6 394.2 DL 504.6 394.2 499.6 394.2 DL 509.6 394.2 504.6 394.2
DL 514.6 394.2 509.6 394.2 DL 519.6 394.2 514.6 394.2 DL/F4 9/Courier@0
SF 16.2(#include "call.h")129.6 403.701 R(/*)129.6 420.821 Q 5.4(*P)135
431.521 S(rocess the argv-style arguments for take or put commands.)-5.4
E(*/)135 442.221 Q(int)129.6 452.921 Q
(take_put_args\(int argc, char **argv\))129.6 463.621 Q({)129.6 474.321
Q(if \(argc == 1\) {)151.2 485.021 Q(src = dst = argv[0];)172.8 495.721
Q(return\(0\);)172.8 506.421 Q 5.4(}e)151.2 517.121 S
(lse if \(argc == 2\) {)-5.4 E(src = argv[0];)172.8 527.821 Q
(dst = argv[1];)172.8 538.521 Q(return\(0\);)172.8 549.221 Q(})151.2
559.921 Q(return\(-1\);)151.2 570.621 Q(})129.6 581.321 Q(/*)129.6
598.441 Q 5.4(*C)135 609.141 S
(an't be automatic; src/dst point into here.)-5.4 E(*/)135 619.841 Q
(static char cmdargs[MAXLINE];)129.6 630.541 Q(/*)129.6 647.661 Q 5.4
(*R)135 658.361 S(ead a line from the user.)-5.4 E
(Call our buf_args\(\) function to)10.8 E 0 Cg EP
%%Page: 50 50
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(50)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF 5.4(*b)135 121.7 S
(reak it into an argv-style array, and call userfunc\(\) to)-5.4 E 5.4
(*p)135 132.4 S(rocess the arguments.)-5.4 E(*/)135 143.1 Q(int)129.6
153.8 Q(prompt_read\(char *prompt, int \(*userfunc\)\(int, char **\)\))
129.6 164.5 Q({)129.6 175.2 Q 21.6(int n;)151.2 185.9 R 16.2(char c,)
151.2 196.6 R(*ptr;)5.4 E 16.2(tty_reset\(STDIN_FILENO\); /*)151.2
213.72 R(allow user's editing chars */)5.4 E 5.4(n=s)151.2 230.84 S
(trlen\(prompt\);)-5.4 E(if \(write\(STDOUT_FILENO, prompt, n\) != n\))
151.2 241.54 Q(err_sys\("write error"\);)172.8 252.24 Q(ptr = cmdargs;)
151.2 269.36 Q(for \( ; ; \) {)151.2 280.06 Q
(if \(\(n = read\(STDIN_FILENO, &c, 1\)\) < 0\))172.8 290.76 Q
(err_sys\("read error"\);)194.4 301.46 Q(else if \(n == 0\))172.8 312.16
Q(break;)194.4 322.86 Q(if \(c == '\\n'\))172.8 333.56 Q(break;)194.4
344.26 Q(if \(ptr < &cmdargs[MAXLINE-2]\))172.8 354.96 Q(*ptr++ = c;)
194.4 365.66 Q(})151.2 376.36 Q(*ptr = 0;)151.2 387.06 Q
(/* null terminate */)37.8 E 27(tty_raw\(STDIN_FILENO\); /*)151.2 404.18
R(reset tty mode to raw */)5.4 E(/*)151.2 421.3 Q 5.4(*R)156.6 432 S
(eturn whatever userfunc\(\) returns.)-5.4 E(*/)156.6 442.7 Q
(return\(buf_args\(cmdargs, userfunc\)\);)151.2 453.4 Q(})129.6 464.1 Q
.4 LW 134.6 468.901 129.6 468.901 DL 139.6 468.901 134.6 468.901 DL
144.6 468.901 139.6 468.901 DL 149.6 468.901 144.6 468.901 DL 154.6
468.901 149.6 468.901 DL 159.6 468.901 154.6 468.901 DL 164.6 468.901
159.6 468.901 DL 169.6 468.901 164.6 468.901 DL 174.6 468.901 169.6
468.901 DL 179.6 468.901 174.6 468.901 DL 184.6 468.901 179.6 468.901 DL
189.6 468.901 184.6 468.901 DL 194.6 468.901 189.6 468.901 DL 199.6
468.901 194.6 468.901 DL 204.6 468.901 199.6 468.901 DL 209.6 468.901
204.6 468.901 DL 214.6 468.901 209.6 468.901 DL 219.6 468.901 214.6
468.901 DL 224.6 468.901 219.6 468.901 DL 229.6 468.901 224.6 468.901 DL
234.6 468.901 229.6 468.901 DL 239.6 468.901 234.6 468.901 DL 244.6
468.901 239.6 468.901 DL 249.6 468.901 244.6 468.901 DL 254.6 468.901
249.6 468.901 DL 259.6 468.901 254.6 468.901 DL 264.6 468.901 259.6
468.901 DL 269.6 468.901 264.6 468.901 DL 274.6 468.901 269.6 468.901 DL
279.6 468.901 274.6 468.901 DL 284.6 468.901 279.6 468.901 DL 289.6
468.901 284.6 468.901 DL 294.6 468.901 289.6 468.901 DL 299.6 468.901
294.6 468.901 DL 304.6 468.901 299.6 468.901 DL 309.6 468.901 304.6
468.901 DL 314.6 468.901 309.6 468.901 DL 319.6 468.901 314.6 468.901 DL
324.6 468.901 319.6 468.901 DL 329.6 468.901 324.6 468.901 DL 334.6
468.901 329.6 468.901 DL 339.6 468.901 334.6 468.901 DL 344.6 468.901
339.6 468.901 DL 349.6 468.901 344.6 468.901 DL 354.6 468.901 349.6
468.901 DL 359.6 468.901 354.6 468.901 DL 364.6 468.901 359.6 468.901 DL
369.6 468.901 364.6 468.901 DL 374.6 468.901 369.6 468.901 DL 379.6
468.901 374.6 468.901 DL 384.6 468.901 379.6 468.901 DL 389.6 468.901
384.6 468.901 DL 394.6 468.901 389.6 468.901 DL 399.6 468.901 394.6
468.901 DL 404.6 468.901 399.6 468.901 DL 409.6 468.901 404.6 468.901 DL
414.6 468.901 409.6 468.901 DL 419.6 468.901 414.6 468.901 DL 424.6
468.901 419.6 468.901 DL 429.6 468.901 424.6 468.901 DL 434.6 468.901
429.6 468.901 DL 439.6 468.901 434.6 468.901 DL 444.6 468.901 439.6
468.901 DL 449.6 468.901 444.6 468.901 DL 454.6 468.901 449.6 468.901 DL
459.6 468.901 454.6 468.901 DL 464.6 468.901 459.6 468.901 DL 469.6
468.901 464.6 468.901 DL 474.6 468.901 469.6 468.901 DL 479.6 468.901
474.6 468.901 DL 484.6 468.901 479.6 468.901 DL 489.6 468.901 484.6
468.901 DL 494.6 468.901 489.6 468.901 DL 499.6 468.901 494.6 468.901 DL
504.6 468.901 499.6 468.901 DL 509.6 468.901 504.6 468.901 DL 514.6
468.901 509.6 468.901 DL 519.6 468.901 514.6 468.901 DL/F3 8
/Palatino-Bold@0 SF(Figure 34)213.228 484.901 Q/F4 8/Palatino-Roman@0 SF
(The)6 E/F5 8/Courier@0 SF(take_put_args)2 E F4(and)2 E F5(prompt_read)2
E F4(functions)2 E/F6 10/Palatino-Roman@0 SF 2.167(The function)129.6
508.901 R/F7 10/Courier@0 SF(prompt_read)4.667 E F6 -.18(re)4.667 G
2.168(ads a line of input fr).18 F 2.168
(om the terminal, and then calls)-.18 F F7(buf_args)129.6 520.901 Q F6
4.122(to split the line into a standar)6.622 F 6.621(da)-.18 G -.18(rg)
-6.621 G 4.121(ument list that is pr).18 F 4.121(ocessed by)-.18 F F7
(take_put_args)129.6 532.901 Q F6 8.377(.N)C 3.377
(ote that the terminal is r)-8.377 F 3.378(eset to canonical mode to r)
-.18 F 3.378(ead the)-.18 F(ar)129.6 544.901 Q
(guments, allowing the use of the standar)-.18 E 2.5(de)-.18 G
(diting characters while entering the line.)-2.5 E .072
(The \214nal client function is)147.6 556.901 R F7(put)2.571 E F6 2.571
(,s)C .071(hown in Figur)-2.571 F 2.571(e3)-.18 G 2.571(5. It)-2.571 F
.071(is called to copy a local \214le to)2.571 F(the r)129.6 568.901 Q
(emote host.)-.18 E 134.6 576.101 129.6 576.101 DL 139.6 576.101 134.6
576.101 DL 144.6 576.101 139.6 576.101 DL 149.6 576.101 144.6 576.101 DL
154.6 576.101 149.6 576.101 DL 159.6 576.101 154.6 576.101 DL 164.6
576.101 159.6 576.101 DL 169.6 576.101 164.6 576.101 DL 174.6 576.101
169.6 576.101 DL 179.6 576.101 174.6 576.101 DL 184.6 576.101 179.6
576.101 DL 189.6 576.101 184.6 576.101 DL 194.6 576.101 189.6 576.101 DL
199.6 576.101 194.6 576.101 DL 204.6 576.101 199.6 576.101 DL 209.6
576.101 204.6 576.101 DL 214.6 576.101 209.6 576.101 DL 219.6 576.101
214.6 576.101 DL 224.6 576.101 219.6 576.101 DL 229.6 576.101 224.6
576.101 DL 234.6 576.101 229.6 576.101 DL 239.6 576.101 234.6 576.101 DL
244.6 576.101 239.6 576.101 DL 249.6 576.101 244.6 576.101 DL 254.6
576.101 249.6 576.101 DL 259.6 576.101 254.6 576.101 DL 264.6 576.101
259.6 576.101 DL 269.6 576.101 264.6 576.101 DL 274.6 576.101 269.6
576.101 DL 279.6 576.101 274.6 576.101 DL 284.6 576.101 279.6 576.101 DL
289.6 576.101 284.6 576.101 DL 294.6 576.101 289.6 576.101 DL 299.6
576.101 294.6 576.101 DL 304.6 576.101 299.6 576.101 DL 309.6 576.101
304.6 576.101 DL 314.6 576.101 309.6 576.101 DL 319.6 576.101 314.6
576.101 DL 324.6 576.101 319.6 576.101 DL 329.6 576.101 324.6 576.101 DL
334.6 576.101 329.6 576.101 DL 339.6 576.101 334.6 576.101 DL 344.6
576.101 339.6 576.101 DL 349.6 576.101 344.6 576.101 DL 354.6 576.101
349.6 576.101 DL 359.6 576.101 354.6 576.101 DL 364.6 576.101 359.6
576.101 DL 369.6 576.101 364.6 576.101 DL 374.6 576.101 369.6 576.101 DL
379.6 576.101 374.6 576.101 DL 384.6 576.101 379.6 576.101 DL 389.6
576.101 384.6 576.101 DL 394.6 576.101 389.6 576.101 DL 399.6 576.101
394.6 576.101 DL 404.6 576.101 399.6 576.101 DL 409.6 576.101 404.6
576.101 DL 414.6 576.101 409.6 576.101 DL 419.6 576.101 414.6 576.101 DL
424.6 576.101 419.6 576.101 DL 429.6 576.101 424.6 576.101 DL 434.6
576.101 429.6 576.101 DL 439.6 576.101 434.6 576.101 DL 444.6 576.101
439.6 576.101 DL 449.6 576.101 444.6 576.101 DL 454.6 576.101 449.6
576.101 DL 459.6 576.101 454.6 576.101 DL 464.6 576.101 459.6 576.101 DL
469.6 576.101 464.6 576.101 DL 474.6 576.101 469.6 576.101 DL 479.6
576.101 474.6 576.101 DL 484.6 576.101 479.6 576.101 DL 489.6 576.101
484.6 576.101 DL 494.6 576.101 489.6 576.101 DL 499.6 576.101 494.6
576.101 DL 504.6 576.101 499.6 576.101 DL 509.6 576.101 504.6 576.101 DL
514.6 576.101 509.6 576.101 DL 519.6 576.101 514.6 576.101 DL F2 16.2
(#include "call.h")129.6 585.602 R(/*)129.6 602.722 Q 5.4(*C)135 613.422
S(opy a file from local to remote.)-5.4 E(*/)135 624.122 Q(void)129.6
634.822 Q(put\(int remfd\))129.6 645.522 Q({)129.6 656.222 Q 0 Cg EP
%%Page: 51 51
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF 2.25(Section 8)93.6 84 R 2.25(Client Sour)
280.29 F 2.25(ce Code)-.162 F/F1 9/Palatino-Bold@0 SF(51)18 E .32 LW
97.6 91.2 93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL
107.6 91.2 103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2
DL 119.6 91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6
91.2 DL 131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2
135.6 91.2 DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6
91.2 147.6 91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL
163.6 91.2 159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2
DL 175.6 91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6
91.2 DL 187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2
191.6 91.2 DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6
91.2 203.6 91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL
219.6 91.2 215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2
DL 231.6 91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6
91.2 DL 243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2
247.6 91.2 DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6
91.2 259.6 91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL
275.6 91.2 271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2
DL 287.6 91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6
91.2 DL 299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2
303.6 91.2 DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6
91.2 315.6 91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL
331.6 91.2 327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2
DL 343.6 91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6
91.2 DL 355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2
359.6 91.2 DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6
91.2 371.6 91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL
387.6 91.2 383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2
DL 399.6 91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6
91.2 DL 411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2
415.6 91.2 DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6
91.2 427.6 91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL
443.6 91.2 439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2
DL 455.6 91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6
91.2 DL 467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2
471.6 91.2 DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6
91.2 483.6 91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL
499.6 91.2 495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2
DL 511.6 91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6
91.2 DL/F2 9/Courier@0 SF 21.6(int i,)151.2 121.7 R(n, linecnt;)5.4 E
16.2(char c,)151.2 132.4 R(cmd[MAXLINE];)5.4 E 16.2(FILE *fpin;)151.2
143.1 R(if \(prompt_read\("~[put] ", take_put_args\) < 0\) {)151.2
160.22 Q(printf\("usage: [put] <sourcefile> <destfile>\\n\\r"\);)172.8
170.92 Q(return;)172.8 181.62 Q(})151.2 192.32 Q(/*)151.2 209.44 Q 5.4
(*O)156.6 220.14 S(pen local input file.)-5.4 E(*/)156.6 230.84 Q
(if \(\(fpin = fopen\(src, "r"\)\) == NULL\) {)151.2 241.54 Q
(err_ret\("can't open %s for reading", src\);)172.8 252.24 Q
(putc\('\\r', stderr\);)172.8 262.94 Q(fflush\(stderr\);)172.8 273.64 Q
(return;)172.8 284.34 Q(})151.2 295.04 Q(/*)151.2 312.16 Q 5.4(*S)156.6
322.86 S(end stty/cat/stty command to remote host.)-5.4 E(*/)156.6
333.56 Q(sprintf\(cmd, "stty -echo; cat >%s; stty echo\\r", dst\);)151.2
344.26 Q 5.4(n=s)151.2 354.96 S(trlen\(cmd\);)-5.4 E
(if \(write\(remfd, cmd, n\) != n\))151.2 365.66 Q
(err_sys\("write error"\);)172.8 376.36 Q 21.6(tcdrain\(remfd\); /*)
151.2 387.06 R(wait for our output to be sent */)5.4 E 54
(sleep\(4\); /*)151.2 397.76 R(and let stty take effect */)5.4 E(/*)
151.2 414.88 Q 5.4(*S)156.6 425.58 S(end file to remote host.)-5.4 E(*/)
156.6 436.28 Q(linecnt = 0;)151.2 446.98 Q(for \( ; ; \) {)151.2 457.68
Q(if \(\(i = getc\(fpin\)\) == EOF\))172.8 468.38 Q 48.6(break; /*)194.4
479.08 R(all done */)5.4 E 5.4(c=i)172.8 489.78 S(;)-5.4 E
(if \(write\(remfd, &c, 1\) != 1\))172.8 500.48 Q 48.6(break; /*)194.4
511.18 R(line has probably dropped */)5.4 E(if \(c == '\\n'\))172.8
521.88 Q(/* increment and display line counter */)32.4 E
(printf\("\\r%d", ++linecnt\);)194.4 532.58 Q(})151.2 543.28 Q(/*)151.2
560.4 Q 5.4(*S)156.6 571.1 S(end EOF to remote, to terminate cat.)-5.4 E
(*/)156.6 581.8 Q 5.4(c=t)151.2 592.5 S(ty_termios\(\)->c_cc[VEOF];)-5.4
E(write\(remfd, &c, 1\);)151.2 603.2 Q 64.8(tcdrain\(remfd\); /*)151.2
613.9 R(wait for our output to be sent */)5.4 E(sleep\(2\);)151.2 624.6
Q(tcflush\(remfd, TCIOFLUSH\);)151.2 635.3 Q
(/* flush echo of stty/cat/stty */)10.8 E 5.4(c=')151.2 646 S(\\n';)-5.4
E(write\(remfd, &c, 1\);)151.2 656.7 Q 0 Cg EP
%%Page: 52 52
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Bold@0 SF(52)93.6 84 Q/F1 9/Palatino-Roman@0 SF 4.5(AM)18
G 2.25(odem Dialer)-4.5 F(The Lost Chapter)258.186 E .32 LW 97.6 91.2
93.6 91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2
103.6 91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6
91.2 115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL
131.6 91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2
DL 143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6
91.2 DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2
159.6 91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6
91.2 171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL
187.6 91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2
DL 199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6
91.2 DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2
215.6 91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6
91.2 227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL
243.6 91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2
DL 255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6
91.2 DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2
271.6 91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6
91.2 283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL
299.6 91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2
DL 311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6
91.2 DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2
327.6 91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6
91.2 339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL
355.6 91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2
DL 367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6
91.2 DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2
383.6 91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6
91.2 395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL
411.6 91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2
DL 423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6
91.2 DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2
439.6 91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6
91.2 451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL
467.6 91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2
DL 479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6
91.2 DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2
495.6 91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6
91.2 507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2
9/Courier@0 SF(if \(ferror\(fpin\)\) {)151.2 121.7 Q
(err_msg\("read error of local file"\);)172.8 132.4 Q
(putc\('\\r', stderr\);)172.8 143.1 Q(fflush\(stderr\);)172.8 153.8 Q(})
151.2 164.5 Q(fclose\(fpin\);)151.2 175.2 Q(})129.6 185.9 Q .4 LW 134.6
190.701 129.6 190.701 DL 139.6 190.701 134.6 190.701 DL 144.6 190.701
139.6 190.701 DL 149.6 190.701 144.6 190.701 DL 154.6 190.701 149.6
190.701 DL 159.6 190.701 154.6 190.701 DL 164.6 190.701 159.6 190.701 DL
169.6 190.701 164.6 190.701 DL 174.6 190.701 169.6 190.701 DL 179.6
190.701 174.6 190.701 DL 184.6 190.701 179.6 190.701 DL 189.6 190.701
184.6 190.701 DL 194.6 190.701 189.6 190.701 DL 199.6 190.701 194.6
190.701 DL 204.6 190.701 199.6 190.701 DL 209.6 190.701 204.6 190.701 DL
214.6 190.701 209.6 190.701 DL 219.6 190.701 214.6 190.701 DL 224.6
190.701 219.6 190.701 DL 229.6 190.701 224.6 190.701 DL 234.6 190.701
229.6 190.701 DL 239.6 190.701 234.6 190.701 DL 244.6 190.701 239.6
190.701 DL 249.6 190.701 244.6 190.701 DL 254.6 190.701 249.6 190.701 DL
259.6 190.701 254.6 190.701 DL 264.6 190.701 259.6 190.701 DL 269.6
190.701 264.6 190.701 DL 274.6 190.701 269.6 190.701 DL 279.6 190.701
274.6 190.701 DL 284.6 190.701 279.6 190.701 DL 289.6 190.701 284.6
190.701 DL 294.6 190.701 289.6 190.701 DL 299.6 190.701 294.6 190.701 DL
304.6 190.701 299.6 190.701 DL 309.6 190.701 304.6 190.701 DL 314.6
190.701 309.6 190.701 DL 319.6 190.701 314.6 190.701 DL 324.6 190.701
319.6 190.701 DL 329.6 190.701 324.6 190.701 DL 334.6 190.701 329.6
190.701 DL 339.6 190.701 334.6 190.701 DL 344.6 190.701 339.6 190.701 DL
349.6 190.701 344.6 190.701 DL 354.6 190.701 349.6 190.701 DL 359.6
190.701 354.6 190.701 DL 364.6 190.701 359.6 190.701 DL 369.6 190.701
364.6 190.701 DL 374.6 190.701 369.6 190.701 DL 379.6 190.701 374.6
190.701 DL 384.6 190.701 379.6 190.701 DL 389.6 190.701 384.6 190.701 DL
394.6 190.701 389.6 190.701 DL 399.6 190.701 394.6 190.701 DL 404.6
190.701 399.6 190.701 DL 409.6 190.701 404.6 190.701 DL 414.6 190.701
409.6 190.701 DL 419.6 190.701 414.6 190.701 DL 424.6 190.701 419.6
190.701 DL 429.6 190.701 424.6 190.701 DL 434.6 190.701 429.6 190.701 DL
439.6 190.701 434.6 190.701 DL 444.6 190.701 439.6 190.701 DL 449.6
190.701 444.6 190.701 DL 454.6 190.701 449.6 190.701 DL 459.6 190.701
454.6 190.701 DL 464.6 190.701 459.6 190.701 DL 469.6 190.701 464.6
190.701 DL 474.6 190.701 469.6 190.701 DL 479.6 190.701 474.6 190.701 DL
484.6 190.701 479.6 190.701 DL 489.6 190.701 484.6 190.701 DL 494.6
190.701 489.6 190.701 DL 499.6 190.701 494.6 190.701 DL 504.6 190.701
499.6 190.701 DL 509.6 190.701 504.6 190.701 DL 514.6 190.701 509.6
190.701 DL 519.6 190.701 514.6 190.701 DL/F3 8/Palatino-Bold@0 SF
(Figure 35)274.096 206.701 Q/F4 8/Palatino-Roman@0 SF(The)6 E/F5 8
/Courier@0 SF(put)2 E F4(function)2 E/F6 10/Palatino-Roman@0 SF 1.425
(As with the)129.6 230.701 R/F7 10/Courier@0 SF(take)3.925 E F6 1.426
(command, we send a command string to the r)3.925 F 1.426(emote system.)
-.18 F(This)6.426 E(time the command is)129.6 242.701 Q F7
(stty -echo; cat >)147.6 260.701 Q/F8 10/Palatino-Italic@0 SF
(dest\214le)8.5 E F7 6(;s)2.5 G(tty echo)-6 E F6 3.196 -.92(We h)129.6
278.701 T 1.356(ave to turn echo of).92 F 1.355(f, otherwise the entir)
-.18 F 3.855<658c>-.18 G 1.355(le would also be sent back to us.)-3.855
F -.92(To)6.355 G .976(terminate the)129.6 290.701 R F7(cat)3.476 E F6
.976(command we send the end-of-\214le character \(often Contr)3.476 F
(ol)-.18 E(-)-.9 I 3.477(D\). This).9 J -.18(re)129.6 302.701 S(quir).18
E 1.379(es that the same end-of-\214le character be used on both the lo\
cal system and the)-.18 F -.18(re)129.6 314.701 S 1.103(mote system.).18
F(Additionally)6.103 E 3.603(,t)-1.11 G 1.103
(he \214le cannot contain the ERASE or KILL characters in)-3.603 F
(use on the r)129.6 326.701 Q(emote system.)-.18 E/F9 12
/Helvetica-Bold@0 SF 29.328(9S)93.6 360.301 S -3.216(ummar y)-29.328 F
F6 1.372(In this chapter we've looked at two dif)129.6 384.301 R(fer)
-.18 E 1.372(ent pr)-.18 F 1.372(ograms: a daemon server that dials a)
-.18 F 1.557(modem and a r)129.6 396.301 R 1.558(emote login pr)-.18 F
1.558(ogram that uses the server to contact a r)-.18 F 1.558
(emote system)-.18 F 1.407(that's connected thr)129.6 408.301 R 1.407
(ough a terminal port.)-.18 F 1.407(The server can be used by other pr)
6.407 F(ograms)-.18 E 5.41(that need to contact r)129.6 420.301 R 5.41
(emote systems or har)-.18 F(dwar)-.18 E 7.91(ed)-.18 G 5.41
(evices connected thr)-7.91 F(ough)-.18 E(asynchr)129.6 432.301 Q
(onous terminal ports.)-.18 E .338(The design of the server was similar\
 to the open server in Section 17.6 and r)147.6 444.301 R(equir)-.18 E
(ed)-.18 E .14(the use of full-duplex pipes, unique per)129.6 456.301 R
.141(-client connections to the server)-.18 F 2.641(,a)-.74 G .141
(nd the passing)-2.641 F 3.782(of \214le descriptors.)129.6 468.301 R
3.782(These advanced IPC featur)8.782 F 3.782
(es allow us to build client\211server)-.18 F
(applications with many desirable featur)129.6 480.301 Q
(es, as described in Section 3.)-.18 E .356
(The client is similar to the)147.6 492.301 R F7(cu)2.856 E F6(and)2.856
E F7(tip)2.856 E F6(pr)2.857 E .357(ograms pr)-.18 F .357
(ovided by many UNIX systems,)-.18 F 1.123(but in our example we didn't\
 have to worry about dialing a modem, interfering with)129.6 504.301 R
.779(UUCP lock \214les, setting the characteristics of the modem's line\
 discipline module, and)129.6 516.301 R .78(the like.)129.6 528.301 R
.78(The server handles all these details.)5.78 F .779
(It let us concentrate on the r)5.779 F .779(eal issues of)-.18 F
(the client, such as pr)129.6 540.301 Q(oviding a r)-.18 E
(eliable \214le transfer mechanism.)-.18 E F9 19.32(10 Ref)93.6 573.901
R(erences)-.12 E F6(Pr)129.6 602.701 Q 2.047
(esotto, D. L., andRitchie, D. M.)-.18 F 4.547(1990. `)7.047 F(`Interpr)
-.37 E 2.048(ocess Communication in the Ninth)-.18 F 6.599
(Edition UNIX System,')158.4 614.701 R(')-.37 E F8(Softwar)9.099 E 9.099
(eP)-.18 G 6.599(ractice and Experience)-9.099 F F6 9.098(,v)C(ol. 20,)
-9.098 E(no. S1,)9.098 E(pp. S1/3)158.4 626.701 Q(-)-.9 I
(S1/17 \(June\).).9 I .316(Redman, B. E.)129.6 644.701 R 2.816(1989. `)
5.316 F .317(`UUCP UNIX-to-UNIX Copy)-.37 F(,')-1.11 E(')-.37 E F8 .317
(Unix Networking)2.817 F F6 2.817(,e)C .317(d. S. G. Kochan,)-2.817 F
(andP)158.4 656.701 Q 2.5(.H)-1.29 G 2.5(.W)-2.5 G(ood, pp. 5)-3.42 E(-)
-.9 I 2.5(48. Howar).9 J 2.5(dW)-.18 G 2.5(.S)-3.42 G
(ams and Company, Indianapolis, IN.)-2.5 E 0 Cg EP
%%Page: 53 53
%%BeginPageSetup
BP
%%EndPageSetup
/F0 9/Palatino-Roman@0 SF(The Lost Chapter)93.6 84 Q(Exer)293.538 E
(cises)-.162 E/F1 9/Palatino-Bold@0 SF(53)18 E .32 LW 97.6 91.2 93.6
91.2 DL 99.6 91.2 95.6 91.2 DL 103.6 91.2 99.6 91.2 DL 107.6 91.2 103.6
91.2 DL 111.6 91.2 107.6 91.2 DL 115.6 91.2 111.6 91.2 DL 119.6 91.2
115.6 91.2 DL 123.6 91.2 119.6 91.2 DL 127.6 91.2 123.6 91.2 DL 131.6
91.2 127.6 91.2 DL 135.6 91.2 131.6 91.2 DL 139.6 91.2 135.6 91.2 DL
143.6 91.2 139.6 91.2 DL 147.6 91.2 143.6 91.2 DL 151.6 91.2 147.6 91.2
DL 155.6 91.2 151.6 91.2 DL 159.6 91.2 155.6 91.2 DL 163.6 91.2 159.6
91.2 DL 167.6 91.2 163.6 91.2 DL 171.6 91.2 167.6 91.2 DL 175.6 91.2
171.6 91.2 DL 179.6 91.2 175.6 91.2 DL 183.6 91.2 179.6 91.2 DL 187.6
91.2 183.6 91.2 DL 191.6 91.2 187.6 91.2 DL 195.6 91.2 191.6 91.2 DL
199.6 91.2 195.6 91.2 DL 203.6 91.2 199.6 91.2 DL 207.6 91.2 203.6 91.2
DL 211.6 91.2 207.6 91.2 DL 215.6 91.2 211.6 91.2 DL 219.6 91.2 215.6
91.2 DL 223.6 91.2 219.6 91.2 DL 227.6 91.2 223.6 91.2 DL 231.6 91.2
227.6 91.2 DL 235.6 91.2 231.6 91.2 DL 239.6 91.2 235.6 91.2 DL 243.6
91.2 239.6 91.2 DL 247.6 91.2 243.6 91.2 DL 251.6 91.2 247.6 91.2 DL
255.6 91.2 251.6 91.2 DL 259.6 91.2 255.6 91.2 DL 263.6 91.2 259.6 91.2
DL 267.6 91.2 263.6 91.2 DL 271.6 91.2 267.6 91.2 DL 275.6 91.2 271.6
91.2 DL 279.6 91.2 275.6 91.2 DL 283.6 91.2 279.6 91.2 DL 287.6 91.2
283.6 91.2 DL 291.6 91.2 287.6 91.2 DL 295.6 91.2 291.6 91.2 DL 299.6
91.2 295.6 91.2 DL 303.6 91.2 299.6 91.2 DL 307.6 91.2 303.6 91.2 DL
311.6 91.2 307.6 91.2 DL 315.6 91.2 311.6 91.2 DL 319.6 91.2 315.6 91.2
DL 323.6 91.2 319.6 91.2 DL 327.6 91.2 323.6 91.2 DL 331.6 91.2 327.6
91.2 DL 335.6 91.2 331.6 91.2 DL 339.6 91.2 335.6 91.2 DL 343.6 91.2
339.6 91.2 DL 347.6 91.2 343.6 91.2 DL 351.6 91.2 347.6 91.2 DL 355.6
91.2 351.6 91.2 DL 359.6 91.2 355.6 91.2 DL 363.6 91.2 359.6 91.2 DL
367.6 91.2 363.6 91.2 DL 371.6 91.2 367.6 91.2 DL 375.6 91.2 371.6 91.2
DL 379.6 91.2 375.6 91.2 DL 383.6 91.2 379.6 91.2 DL 387.6 91.2 383.6
91.2 DL 391.6 91.2 387.6 91.2 DL 395.6 91.2 391.6 91.2 DL 399.6 91.2
395.6 91.2 DL 403.6 91.2 399.6 91.2 DL 407.6 91.2 403.6 91.2 DL 411.6
91.2 407.6 91.2 DL 415.6 91.2 411.6 91.2 DL 419.6 91.2 415.6 91.2 DL
423.6 91.2 419.6 91.2 DL 427.6 91.2 423.6 91.2 DL 431.6 91.2 427.6 91.2
DL 435.6 91.2 431.6 91.2 DL 439.6 91.2 435.6 91.2 DL 443.6 91.2 439.6
91.2 DL 447.6 91.2 443.6 91.2 DL 451.6 91.2 447.6 91.2 DL 455.6 91.2
451.6 91.2 DL 459.6 91.2 455.6 91.2 DL 463.6 91.2 459.6 91.2 DL 467.6
91.2 463.6 91.2 DL 471.6 91.2 467.6 91.2 DL 475.6 91.2 471.6 91.2 DL
479.6 91.2 475.6 91.2 DL 483.6 91.2 479.6 91.2 DL 487.6 91.2 483.6 91.2
DL 491.6 91.2 487.6 91.2 DL 495.6 91.2 491.6 91.2 DL 499.6 91.2 495.6
91.2 DL 503.6 91.2 499.6 91.2 DL 507.6 91.2 503.6 91.2 DL 511.6 91.2
507.6 91.2 DL 515.6 91.2 511.6 91.2 DL 519.6 91.2 515.6 91.2 DL/F2 12
/Helvetica-Bold@0 SF(Ex)129.6 123 Q(er)-.12 E(cises)-.24 E F1(1)129.6
144 Q F0
(How can we avoid step 0 \(starting the server by hand\) in Section 3?)
18.918 E F1(2)129.6 159 Q F0(What happens if we don't set)18.918 E/F3 9
/Courier@0 SF(optind)2.25 E F0(to 1 in Figur)2.25 E 2.25(e1)-.162 G(1?)
-2.745 E F1(3)129.6 174 Q F0 1.262(What happens if someone edits the)
18.918 F F3(Systems)3.512 E F0 1.261(\214le between the time)3.512 F F3
(request)3.511 E F0(\(Figur)3.511 E 3.511(e1)-.162 G(7\))-3.511 E F3
(fork)153.018 185 Q F0 2.25(sac)C
(hild and the time the child terminates with a status of 1?)-2.25 E F1
(4)129.6 200 Q F0 2.316(In Section 7.8 we said to be car)18.918 F 2.316
(eful any time we use pointers into a r)-.162 F 2.316(egion that gets)
-.162 F F3(realloc)153.018 211 Q F0 .676(ed, since the r)B .676
(egion can move ar)-.162 F .676(ound in memory on each call to)-.162 F
F3(realloc)2.925 E F0 5.175(.W)C(hy)-5.175 E 1.436
(can we use the pointer)153.018 222 R F3(cliptr)3.686 E F0 1.436
(in Figur)3.686 F 3.686(e1)-.162 G 3.686(0w)-3.686 G 1.436(hen the)
-3.686 F F3(client)3.686 E F0 1.436(array is manipulated by)3.686 F F3
(realloc)153.018 233 Q F0(?)A F1(5)129.6 248 Q F0 .086
(What happens if either of the pathname ar)18.918 F .086(guments to the)
-.162 F F3(take)2.336 E F0(and)2.335 E F3(put)2.335 E F0 .085
(commands contain)2.335 F 2.25(as)153.018 259 S(emicolon?)-2.25 E F1(6)
129.6 274 Q F0 .191(Modify the server to r)18.918 F .191(ead its thr)
-.162 F .191
(ee data \214les once when it starts, storing them in memory)-.162 F
4.692(.I)-.999 G(f)-4.692 E(the \214les ar)153.018 285 Q 2.25(em)-.162 G
(odi\214ed, how should the server handle this?)-2.25 E F1(7)129.6 300 Q
F0(In Figur)18.918 E 2.25(e3)-.162 G 2.25(0w)-2.25 G
(hy do we cast the ar)-2.25 E(gument)-.162 E F3(args)2.25 E F0
(when \214lling in the str)2.25 E(uctur)-.072 E 2.25(ef)-.162 G(or)-2.25
E F3(writev)2.25 E F0(?)A F1(8)129.6 315 Q F0(Implement Figur)18.918 E
2.25(e3)-.162 G 2.25(1u)-2.25 G(sing)-2.25 E F3(select)2.25 E F0
(instead of)2.25 E F3(poll)2.25 E F0(.)A F1(9)129.6 330 Q F0 2.219
(How can you verify that the \214le being sent with the)18.918 F F3(put)
4.468 E F0 2.218(command does not contain)4.468 F
(characters that will be interpr)153.018 341 Q
(eted by the line discipline on the r)-.162 E(emote system?)-.162 E F1
(10)129.6 356 Q F0 .631(The faster the dialing function r)14.418 F .631
(ecognizes that a dial has failed, the faster it can pr)-.162 F .632
(oceed to)-.162 F 1.683(the next possible entry in the)153.018 367 R F3
(Systems)3.933 E F0 3.933(\214le. For)3.933 F 1.682
(example, if we can determine that the)3.933 F -.162(re)153.018 378 S
.592(mote phone is busy and terminate befor).162 F 2.842(et)-.162 G .592
(he timer in)-2.842 F F3(expect_str)2.842 E F0(expir)2.843 E .593
(es, we can save)-.162 F 1.217(15 or 20 seconds.)153.018 389 R 2.873
-.828(To h)5.717 H 1.217(andle these types of err).828 F 1.216
(ors, the 4.3BSD UUCP expect\211send strings)-.162 F 1.203
(allow an expect string of)153.018 400 R F3(ABORT)3.453 E F0 3.453(,f)C
1.203(ollowed by a string that if matched, aborts the curr)-3.453 F(ent)
-.162 E 4.15(dial. For)153.018 411 R 1.9(example, right befor)4.15 F
4.149(et)-.162 G 1.899(he \214nal expect string)-4.149 F F3
(CONNECT\\sFAST)4.149 E F0 1.899(in Figur)4.149 F 4.149(e4w)-.162 G(e)
-4.149 E(would like to add)153.018 422 Q F3(ABORT BUSY)171.018 438.2 Q
F0(Implement this featur)153.018 454.7 Q(e.)-.162 E 0 Cg EP
%%Trailer
end
%%EOF
